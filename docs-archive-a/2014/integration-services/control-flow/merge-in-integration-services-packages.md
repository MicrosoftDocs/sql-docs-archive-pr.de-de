---
title: MERGE in Integration Services-Paketen | Microsoft-Dokumentation
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- MERGE statement [SQL Server]
ms.assetid: 7e44a5c2-e6d6-4fe2-a079-4f95ccdb147b
author: chugugrace
ms.author: chugu
ms.openlocfilehash: cc6de738d44b91a9e2a4885978ba4a46dfede8cf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87616615"
---
# <a name="merge-in-integration-services-packages"></a><span data-ttu-id="70ed8-102">MERGE in Integration Services-Paketen</span><span class="sxs-lookup"><span data-stu-id="70ed8-102">MERGE in Integration Services Packages</span></span>
  <span data-ttu-id="70ed8-103">In der aktuellen Version von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)][!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)]kann die SQL-Anweisung in einem Task „SQL ausführen“ eine MERGE-Anweisung enthalten.</span><span class="sxs-lookup"><span data-stu-id="70ed8-103">In the current release of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)][!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)], the SQL statement in an Execute SQL task can contain a MERGE statement.</span></span> <span data-ttu-id="70ed8-104">Diese MERGE-Anweisung ermöglicht es Ihnen, in einer einzelnen Anweisung mehrere INSERT-, UPDATE- und DELETE-Vorgänge auszuführen.</span><span class="sxs-lookup"><span data-stu-id="70ed8-104">This MERGE statement enables you to accomplish multiple INSERT, UPDATE, and DELETE operations in a single statement.</span></span>  
  
 <span data-ttu-id="70ed8-105">Um die MERGE-Anweisung in einem Paket zu verwenden, führen Sie folgende Schritte aus:</span><span class="sxs-lookup"><span data-stu-id="70ed8-105">To use the MERGE statement in a package, follow these steps:</span></span>  
  
-   <span data-ttu-id="70ed8-106">Erstellen Sie einen Datenflusstask, der die Quelldaten in eine temporäre oder Stagingtabelle lädt, transformiert und speichert.</span><span class="sxs-lookup"><span data-stu-id="70ed8-106">Create a Data Flow task that loads, transforms, and saves the source data to a temporary or staging table.</span></span>  
  
-   <span data-ttu-id="70ed8-107">Erstellen Sie einen Task "SQL ausführen", der die MERGE-Anweisung enthält.</span><span class="sxs-lookup"><span data-stu-id="70ed8-107">Create an Execute SQL task that contains the MERGE statement.</span></span>  
  
-   <span data-ttu-id="70ed8-108">Verbinden Sie den Datenflusstask mit der Aufgabe "SQL ausführen", und verwenden Sie die Daten in der Stagingtabelle als Eingabe für die MERGE-Anweisung.</span><span class="sxs-lookup"><span data-stu-id="70ed8-108">Connect the Data Flow task to the Execute SQL task, and use the data in the staging table as the input for the MERGE statement.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="70ed8-109">Obwohl eine MERGE-Anweisung in diesem Szenario normalerweise eine Stagingtabelle erfordert, übersteigt die Leistung der MERGE-Anweisung normalerweise die Leistung der von der Transformation für Suche ausgeführten zeilenweisen Suche.</span><span class="sxs-lookup"><span data-stu-id="70ed8-109">Although a MERGE statement typically requires a staging table in this scenario, the performance of the MERGE statement usually exceeds that of the row-by-row lookup performed by the Lookup transformation.</span></span> <span data-ttu-id="70ed8-110">Die MERGE-Anweisung ist außerdem nützlich, wenn die Größe einer Suchtabelle den Speicher testen würde, der der Transformation für Suche zum Zwischenspeichern der entsprechenden Verweistabelle zur Verfügung steht.</span><span class="sxs-lookup"><span data-stu-id="70ed8-110">MERGE is also useful when the large size of a lookup table would test the memory that is available to the Lookup transformation for caching its reference table.</span></span>  
  
 <span data-ttu-id="70ed8-111">Im weiteren Verlauf dieses Themas werden einige zusätzliche Verwendungen für die MERGE-Anweisung erläutert.</span><span class="sxs-lookup"><span data-stu-id="70ed8-111">The remainder of this topic discusses some additional uses for the MERGE statement.</span></span>  
  
 <span data-ttu-id="70ed8-112">Ein Beispiel für eine Zielkomponente, die die Verwendung der MERGE-Anweisung unterstützt, finden Sie im CodePlex-Communitybeispiel [MERGE Destination](https://go.microsoft.com/fwlink/?LinkId=141215).</span><span class="sxs-lookup"><span data-stu-id="70ed8-112">For a sample destination component that supports the use of the MERGE statement, see the CodePlex community sample, [MERGE Destination](https://go.microsoft.com/fwlink/?LinkId=141215).</span></span>  
  
## <a name="using-merge"></a><span data-ttu-id="70ed8-113">Verwenden von MERGE</span><span class="sxs-lookup"><span data-stu-id="70ed8-113">Using MERGE</span></span>  
 <span data-ttu-id="70ed8-114">In der Regel verwenden Sie die MERGE-Anweisung, wenn Sie Änderungen, die Einfügungen, Updates und Löschungen umfassen, von einer Tabelle in die andere Tabelle übernehmen möchten.</span><span class="sxs-lookup"><span data-stu-id="70ed8-114">Typically, you use the MERGE statement when you want to apply changes that include inserts, updates, and deletions from one table to another table.</span></span> <span data-ttu-id="70ed8-115">Vor [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)]erforderte dieser Prozess sowohl eine Transformation für Suche als auch mehrere Transformationen für OLE DB-Befehl.</span><span class="sxs-lookup"><span data-stu-id="70ed8-115">Prior to [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], this process required both a Lookup transformation and multiple OLE DB Command transformations.</span></span> <span data-ttu-id="70ed8-116">Die Transformation für Suche hat eine zeilenweise Suche ausgeführt, um zu bestimmen, ob jede Zeile neu war oder geändert wurde.</span><span class="sxs-lookup"><span data-stu-id="70ed8-116">The Lookup transformation performed a row-by-row lookup to determine whether each row was new or changed.</span></span> <span data-ttu-id="70ed8-117">Die Transformationen für OLE DB-Befehl haben anschließend die notwendigen INSERT-, UPDATE- und DELETE-Vorgänge ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="70ed8-117">The OLE DB Command transformations then performed the necessary INSERT, UPDATE, and DELETE operations.</span></span> <span data-ttu-id="70ed8-118">Ab [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)]kann eine einzelne MERGE-Anweisung sowohl die Transformation für Suche als auch die entsprechenden Transformationen für OLE DB-Befehl ersetzen.</span><span class="sxs-lookup"><span data-stu-id="70ed8-118">Beginning in [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], a single MERGE statement can replace both the Lookup transformation and the corresponding OLE DB Command transformations.</span></span>  
  
### <a name="merge-with-incremental-loads"></a><span data-ttu-id="70ed8-119">MERGE mit inkrementellem Laden</span><span class="sxs-lookup"><span data-stu-id="70ed8-119">MERGE with Incremental Loads</span></span>  
 <span data-ttu-id="70ed8-120">Die neue Change Data Capture-Funktion in [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] erleichtert es, inkrementelles Laden in ein Data Warehouse zuverlässig auszuführen.</span><span class="sxs-lookup"><span data-stu-id="70ed8-120">The change data capture functionality that is new in [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)] makes it easier to perform incremental loads reliably to a data warehouse.</span></span> <span data-ttu-id="70ed8-121">Als Alternative zu parametrisierten Transformationen für OLE DB-Befehl zur Durchführung von Einfügungen und Updates können Sie die MERGE-Anweisung verwenden, um beide Vorgänge zu kombinieren.</span><span class="sxs-lookup"><span data-stu-id="70ed8-121">As an alternative to using parameterized OLE DB Command transformations to perform the inserts and the updates, you can use the MERGE statement to combine both operations.</span></span>  
  
 <span data-ttu-id="70ed8-122">Weitere Informationen finden Sie unter [Anwenden der Änderungen auf das Ziel](../change-data-capture/apply-the-changes-to-the-destination.md).</span><span class="sxs-lookup"><span data-stu-id="70ed8-122">For more information, see [Apply the Changes to the Destination](../change-data-capture/apply-the-changes-to-the-destination.md).</span></span>  
  
#### <a name="merge-in-other-scenarios"></a><span data-ttu-id="70ed8-123">MERGE in anderen Szenarios</span><span class="sxs-lookup"><span data-stu-id="70ed8-123">MERGE in Other Scenarios</span></span>  
 <span data-ttu-id="70ed8-124">In den folgenden Szenarios können Sie die MERGE-Anweisung entweder außerhalb oder innerhalb eines [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] -Pakets verwenden.</span><span class="sxs-lookup"><span data-stu-id="70ed8-124">In the following scenarios, you can use the MERGE statement either outside or inside an [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] package.</span></span> <span data-ttu-id="70ed8-125">Häufig ist jedoch ein [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] -Paket erforderlich, um diese Daten aus mehreren heterogenen Quellen zu laden und sie anschließend zu kombinieren und zu bereinigen.</span><span class="sxs-lookup"><span data-stu-id="70ed8-125">However, an [!INCLUDE[ssISnoversion](../../includes/ssisnoversion-md.md)] package is often required to load this data from multiple heterogeneous sources, and then to combine and cleanse the data.</span></span> <span data-ttu-id="70ed8-126">Deshalb könnten Sie erwägen, die MERGE-Anweisung in einem Paket zu verwenden, um die Wartung zu erleichtern.</span><span class="sxs-lookup"><span data-stu-id="70ed8-126">Therefore, you might consider using the MERGE statement in a package for convenience and ease of maintenance.</span></span>  
  
##### <a name="track-buying-habits"></a><span data-ttu-id="70ed8-127">Nachverfolgen von Kaufgewohnheiten</span><span class="sxs-lookup"><span data-stu-id="70ed8-127">Track Buying Habits</span></span>  
 <span data-ttu-id="70ed8-128">Die FactBuyingHabits-Tabelle im Data Warehouse erfasst das letzte Datum, an dem ein Kunde ein bestimmtes Produkt gekauft hat.</span><span class="sxs-lookup"><span data-stu-id="70ed8-128">The FactBuyingHabits table in the data warehouse tracks the last date on which a customer bought a given product.</span></span> <span data-ttu-id="70ed8-129">Die Tabelle besteht aus den Spalten ProductID, CustomerID und PurchaseDate.</span><span class="sxs-lookup"><span data-stu-id="70ed8-129">The table consists of ProductID, CustomerID and PurchaseDate columns.</span></span> <span data-ttu-id="70ed8-130">Jede Woche generiert die Transaktionsdatenbank eine PurchaseRecords-Tabelle, in der die während dieser Woche getätigten Käufe enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="70ed8-130">Every week, the transactional database generates a PurchaseRecords table that includes the purchases made during that week.</span></span> <span data-ttu-id="70ed8-131">Das Ziel ist, mit einer einzigen MERGE-Anweisung die Informationen der PurchaseRecords-Tabelle in die FactBuyingHabits-Tabelle einzufügen.</span><span class="sxs-lookup"><span data-stu-id="70ed8-131">The objective is to use a single MERGE statement to merge the information in the PurchaseRecords table into the FactBuyingHabits table.</span></span> <span data-ttu-id="70ed8-132">Für Produkt/Kunde-Paare, die nicht vorhanden sind, fügt die MERGE-Anweisung neue Zeilen ein.</span><span class="sxs-lookup"><span data-stu-id="70ed8-132">For product-customer pairs that do not exist, the MERGE statement inserts new rows.</span></span> <span data-ttu-id="70ed8-133">Für Produkt/Kunde-Paare, die vorhanden sind, aktualisiert die MERGE-Anweisung das letzte Kaufdatum.</span><span class="sxs-lookup"><span data-stu-id="70ed8-133">For product-customer pairs that exist, the MERGE statement updates the most recent date-of-purchase.</span></span>  
  
###### <a name="track-price-history"></a><span data-ttu-id="70ed8-134">Nachverfolgen der Preisentwicklung</span><span class="sxs-lookup"><span data-stu-id="70ed8-134">Track Price History</span></span>  
 <span data-ttu-id="70ed8-135">Die DimBook-Tabelle repräsentiert die Liste der Bücher im Bestand eines Buchhändlers und identifiziert die Preisentwicklung für jedes Buch.</span><span class="sxs-lookup"><span data-stu-id="70ed8-135">The DimBook table represents the list of books in the inventory of a book seller and identifies the price history of each book.</span></span> <span data-ttu-id="70ed8-136">Diese Tabelle enthält folgende Spalten: ISBN, ProductID, Price, Shelf und IsCurrent.</span><span class="sxs-lookup"><span data-stu-id="70ed8-136">This table has these columns: ISBN, ProductID, Price, Shelf, and IsCurrent.</span></span> <span data-ttu-id="70ed8-137">Außerdem enthält die Tabelle eine Zeile für jeden Preis des Buchs in der Vergangenheit.</span><span class="sxs-lookup"><span data-stu-id="70ed8-137">This table also has one row for each price the book has had.</span></span> <span data-ttu-id="70ed8-138">Eine dieser Zeilen enthält den aktuellen Preis.</span><span class="sxs-lookup"><span data-stu-id="70ed8-138">One of these rows contains the current price.</span></span> <span data-ttu-id="70ed8-139">Um anzugeben, welche Zeile den aktuellen Preis enthält, wird der Wert der "IsCurrent"-Spalte für diese Zeile auf 1 gesetzt.</span><span class="sxs-lookup"><span data-stu-id="70ed8-139">To indicate which row contains the current price, the value of the IsCurrent column for that row is set to 1.</span></span>  
  
 <span data-ttu-id="70ed8-140">Jede Woche generiert die Datenbank eine WeeklyChanges-Tabelle, in der Preisänderungen und neue Bücher, die während der Woche in den Bestand aufgenommen wurden, enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="70ed8-140">Every week, the database generates a WeeklyChanges table that contains price changes for the week and new books that were added during the week.</span></span> <span data-ttu-id="70ed8-141">Mit einer einzigen MERGE-Anweisung können Sie die Änderungen der WeeklyChanges-Tabelle in die DimBook-Tabelle übernehmen.</span><span class="sxs-lookup"><span data-stu-id="70ed8-141">By using a single MERGE statement, you can apply the changes in the WeeklyChanges table to the DimBook table.</span></span> <span data-ttu-id="70ed8-142">Die MERGE-Anweisung fügt neue Zeilen für neu hinzugefügte Bücher hinzu und aktualisiert die IsCurrent-Spalte für Zeilen vorhandener Bücher, deren Preis sich geändert hat, auf 0.</span><span class="sxs-lookup"><span data-stu-id="70ed8-142">The MERGE statement inserts new rows for newly-added books, and updates the IsCurrent column to 0 for rows of existing books whose prices have changed.</span></span> <span data-ttu-id="70ed8-143">Außerdem fügt die MERGE-Anweisung neue Zeilen für Bücher hinzu, deren Preis sich geändert hat, und legt den Wert der IsCurrent-Spalte für diese neuen Zeilen auf 1 fest.</span><span class="sxs-lookup"><span data-stu-id="70ed8-143">The MERGE statement also inserts new rows for books whose prices have changed, and for these new rows, sets the value of the IsCurrent column to 1.</span></span>  
  
### <a name="merge-a-table-with-new-data-against-the-old-table"></a><span data-ttu-id="70ed8-144">Zusammenführen einer Tabelle mit neuen Daten aus der alten Tabelle</span><span class="sxs-lookup"><span data-stu-id="70ed8-144">Merge a Table with New Data Against the Old Table</span></span>  
 <span data-ttu-id="70ed8-145">Die Datenbank formt die Eigenschaften eines Objekts mit einem „offenen Schema“, das heißt, eine Tabelle enthält Name/Wert-Paare für jede Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="70ed8-145">The database models the properties of an object by using an "open schema," that is, a table contains name-value pairs for each property.</span></span> <span data-ttu-id="70ed8-146">Die Properties-Tabelle enthält drei Spalten: EntityID,  PropertyID und Value.</span><span class="sxs-lookup"><span data-stu-id="70ed8-146">The Properties table has three columns: EntityID, PropertyID, and Value.</span></span> <span data-ttu-id="70ed8-147">Eine NewProperties-Tabelle, bei der es sich um eine neuere Version der Tabelle handelt, muss mit der Properties-Tabelle synchronisiert werden.</span><span class="sxs-lookup"><span data-stu-id="70ed8-147">A NewProperties table that is a newer version of the table has to be synchronized with the Properties table.</span></span> <span data-ttu-id="70ed8-148">Um diese beiden Tabellen zu synchronisieren, können Sie eine einzelne MERGE-Anweisung verwenden, um die folgenden Vorgänge auszuführen:</span><span class="sxs-lookup"><span data-stu-id="70ed8-148">To synchronize these two tables, you can use a single MERGE statement to perform the following operations:</span></span>  
  
-   <span data-ttu-id="70ed8-149">Löschen Sie Eigenschaften aus der Properties-Tabelle, wenn sie in der NewProperties-Tabelle fehlen.</span><span class="sxs-lookup"><span data-stu-id="70ed8-149">Delete properties from the Properties table if they are absent from the NewProperties table.</span></span>  
  
-   <span data-ttu-id="70ed8-150">Aktualisieren Sie Werte für Eigenschaften in der Properties-Tabelle mit neuen Werten aus der NewProperties-Tabelle.</span><span class="sxs-lookup"><span data-stu-id="70ed8-150">Update values for properties that are in the Properties table with new values found in the NewProperties table.</span></span>  
  
-   <span data-ttu-id="70ed8-151">Fügen Sie neue Eigenschaften für Eigenschaften hinzu, die in der NewProperties-Tabelle vorhanden sind, jedoch in der Properties-Tabelle fehlen.</span><span class="sxs-lookup"><span data-stu-id="70ed8-151">Insert new properties for properties that are in the NewProperties table but are not found in the Properties table.</span></span>  
  
 <span data-ttu-id="70ed8-152">Dieser Ansatz ist in Szenarios nützlich, die Replikationsszenarios ähneln, deren Ziel darin besteht, Daten in zwei Tabellen auf zwei Servern synchronisiert zu halten.</span><span class="sxs-lookup"><span data-stu-id="70ed8-152">This approach is useful in scenarios that resemble replication scenarios, where the objective is to keep data in two tables on two servers synchronized.</span></span>  
  
### <a name="track-inventory"></a><span data-ttu-id="70ed8-153">Bestandsnachverfolgung</span><span class="sxs-lookup"><span data-stu-id="70ed8-153">Track Inventory</span></span>  
 <span data-ttu-id="70ed8-154">Die Inventory-Datenbank umfasst eine ProductsInventory-Tabelle mit den Spalten ProductID und StockOnHand.</span><span class="sxs-lookup"><span data-stu-id="70ed8-154">The Inventory database has a ProductsInventory table that has ProductID and StockOnHand columns.</span></span> <span data-ttu-id="70ed8-155">In einer Shipments-Tabelle mit den Spalten ProductID, CustomerID und Quantity werden Produktlieferungen an Kunden verfolgt.</span><span class="sxs-lookup"><span data-stu-id="70ed8-155">A Shipments table with ProductID, CustomerID, and Quantity columns tracks shipments of products to customers.</span></span> <span data-ttu-id="70ed8-156">Die ProductInventory-Tabelle muss täglich auf Basis der Informationen der Shipments-Tabelle aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="70ed8-156">The ProductInventory table has to be updated daily based on information in the Shipments table.</span></span> <span data-ttu-id="70ed8-157">Mit einer einzigen MERGE-Anweisung kann der Bestand in der ProductInventory-Tabelle auf Grundlage der erfolgten Lieferungen reduziert werden.</span><span class="sxs-lookup"><span data-stu-id="70ed8-157">A single MERGE statement can reduce the inventory in the ProductInventory table based on the shipments made.</span></span> <span data-ttu-id="70ed8-158">Wenn der Bestand für ein Produkt auf 0 reduziert wurde, kann diese MERGE-Anweisung die entsprechende Produktzeile auch in der ProductInventory-Tabelle löschen.</span><span class="sxs-lookup"><span data-stu-id="70ed8-158">If the inventory for a product has been reduced to 0, that MERGE statement can also delete that product row from the ProductInventory table.</span></span>  
  
  
