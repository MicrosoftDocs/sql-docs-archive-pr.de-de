---
title: Schleife durch Excel-Dateien und Tabellen mit einem Foreach-Schleifencontainer | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: integration-services
ms.topic: conceptual
helpviewer_keywords:
- connections [Integration Services], Excel
- Excel [Integration Services]
- connection managers [Integration Services], Excel
ms.assetid: a5393c1a-cc37-491a-a260-7aad84dbff68
author: chugugrace
ms.author: chugu
ms.openlocfilehash: 51de779b6869d80245302741035e6169aa750c83
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87616623"
---
# <a name="loop-through-excel-files-and-tables-by-using-a-foreach-loop-container"></a><span data-ttu-id="44d36-102">Schleife durch Excel-Dateien und Tabellen mit einem Foreach-Schleifencontainer</span><span class="sxs-lookup"><span data-stu-id="44d36-102">Loop through Excel Files and Tables by Using a Foreach Loop Container</span></span>
  <span data-ttu-id="44d36-103">In diesem Thema wird beschrieben, wie mithilfe des Foreach-Schleifencontainers und dem entsprechenden Enumerator die Excel-Arbeitsmappen in einem Ordner oder die Tabellen in einer Excel-Arbeitsmappe durchlaufen werden.</span><span class="sxs-lookup"><span data-stu-id="44d36-103">The procedures in this topic describe how to loop through the Excel workbooks in a folder, or through the tables in an Excel workbook, by using the Foreach Loop container with the appropriate enumerator.</span></span>  
  
### <a name="to-loop-through-excel-files-by-using-the-foreach-file-enumerator"></a><span data-ttu-id="44d36-104">So durchlaufen Sie Excel-Dateien mithilfe des Foreach-Dateienumerators</span><span class="sxs-lookup"><span data-stu-id="44d36-104">To loop through Excel files by using the Foreach File enumerator</span></span>  
  
1.  <span data-ttu-id="44d36-105">Erstellen Sie eine Zeichenfolgenvariable, die den aktuellen Excel-Pfad und -Dateinamen auf jeder Iteration der Schleife empfängt.</span><span class="sxs-lookup"><span data-stu-id="44d36-105">Create a string variable that will receive the current Excel path and file name on each iteration of the loop.</span></span> <span data-ttu-id="44d36-106">Zur Vermeidung von Validierungsproblemen weisen Sie einen gültigen Excel-Pfad und einen Dateinamen als Anfangswert der Variablen zu.</span><span class="sxs-lookup"><span data-stu-id="44d36-106">To avoid validation issues, assign a valid Excel path and file name as the initial value of the variable.</span></span> <span data-ttu-id="44d36-107">(Im weiter unten in dieser Prozedur gezeigten Beispielausdruck wird der Variablenname `ExcelFile`verwendet.)</span><span class="sxs-lookup"><span data-stu-id="44d36-107">(The sample expression shown later in this procedure uses the variable name, `ExcelFile`.)</span></span>  
  
2.  <span data-ttu-id="44d36-108">Erstellen Sie optional eine weitere Zeichenfolgenvariable für den Wert des Arguments Erweiterte Eigenschaften der Excel-Verbindungszeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="44d36-108">Optionally, create another string variable that will hold the value for the Extended Properties argument of the Excel connection string.</span></span> <span data-ttu-id="44d36-109">Dieses Argument enthält eine Reihe von Werten, die die Excel-Version angeben und bestimmen, ob die erste Zeile Spaltennamen enthält und ob der Importmodus verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="44d36-109">This argument contains a series of values that specify the Excel version and determine whether the first row contains column names, and whether import mode is used.</span></span> <span data-ttu-id="44d36-110">(Der Beispielausdruck, der weiter unten in dieser Prozedur dargestellt wird, verwendet den Variablennamen `ExtProperties`und weist einen Anfangswert von "`Excel 8.0;HDR=Yes`" auf.)</span><span class="sxs-lookup"><span data-stu-id="44d36-110">(The sample expression shown later in this procedure uses the variable name `ExtProperties`, with an initial value of "`Excel 8.0;HDR=Yes`".)</span></span>  
  
     <span data-ttu-id="44d36-111">Wenn Sie keine Variable für das Argument "Erweiterte Eigenschaften" verwenden, müssen Sie es dem Ausdruck, der die Verbindungszeichenfolge enthält, manuell hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="44d36-111">If you do not use a variable for the Extended Properties argument, then you must add it manually to the expression that contains the connection string.</span></span>  
  
3.  <span data-ttu-id="44d36-112">Fügen Sie der Registerkarte **Ablauf Steuerung** einen Foreach-Schleifen Container hinzu. Weitere Informationen zum Konfigurieren des Foreach-Schleifen Containers finden Sie unter [Konfigurieren eines Foreach-Schleifen Containers](foreach-loop-container.md).</span><span class="sxs-lookup"><span data-stu-id="44d36-112">Add a Foreach Loop container to the **Control Flow** tab. For information about how to configure the Foreach Loop Container, see [Configure a Foreach Loop Container](foreach-loop-container.md).</span></span>  
  
4.  <span data-ttu-id="44d36-113">Wählen Sie auf der Seite **Auflistung** des **Foreach-Schleifen-Editors**den Foreach-Dateienumerator aus, geben Sie den Ordner an, in dem sich die Excel-Arbeitsmappen befinden, und geben Sie den Dateifilter an (normalerweise \*.xls).</span><span class="sxs-lookup"><span data-stu-id="44d36-113">On the **Collection** page of the **Foreach Loop Editor**, select the Foreach File enumerator, specify the folder in which the Excel workbooks are located, and specify the file filter (ordinarily \*.xls).</span></span>  
  
5.  <span data-ttu-id="44d36-114">Ordnen Sie auf der Seite **Variablenzuordnungen** Index 0 einer benutzerdefinierten Zeichenfolgenvariablen zu, die bei jeder Iteration der Schleife den aktuellen Excel-Pfad und Dateinamen empfangen wird.</span><span class="sxs-lookup"><span data-stu-id="44d36-114">On the **Variable Mapping** page, map Index 0 to a user-defined string variable that will receive the current Excel path and file name on each iteration of the loop.</span></span> <span data-ttu-id="44d36-115">(Im weiter unten in dieser Prozedur gezeigten Beispielausdruck wird der Variablenname `ExcelFile`verwendet.)</span><span class="sxs-lookup"><span data-stu-id="44d36-115">(The sample expression shown later in this procedure uses the variable name `ExcelFile`.)</span></span>  
  
6.  <span data-ttu-id="44d36-116">Schließen Sie den **Foreach-Schleifen-Editor**.</span><span class="sxs-lookup"><span data-stu-id="44d36-116">Close the **Foreach Loop Editor**.</span></span>  
  
7.  <span data-ttu-id="44d36-117">Fügen Sie dem Paket einen Excel-Verbindungs-Manager hinzu, wie unter [Hinzufügen, Löschen oder Freigeben eines Verbindungs-Managers in einem Paket](../add-delete-or-share-a-connection-manager-in-a-package.md)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="44d36-117">Add an Excel connection manager to the package as described in [Add, Delete, or Share a Connection Manager in a Package](../add-delete-or-share-a-connection-manager-in-a-package.md).</span></span> <span data-ttu-id="44d36-118">Wählen Sie für die Verbindung eine vorhandene Excel-Arbeitsmappendatei aus, um Überprüfungsfehler zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="44d36-118">Select an existing Excel workbook file for the connection to avoid validation errors.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="44d36-119">Wählen Sie im **Verbindungs-Manager-Editor für Excel** eine vorhandene Excel-Arbeitsmappe aus, um Überprüfungsfehler zu vermeiden, wenn Sie Tasks und Datenflusskomponenten konfigurieren, die diesen Excel-Verbindungs-Manager verwenden.</span><span class="sxs-lookup"><span data-stu-id="44d36-119">To avoid validation errors as you configure tasks and data flow components that use this Excel connection manager, select an existing Excel workbook in the **Excel Connection Manager Editor**.</span></span> <span data-ttu-id="44d36-120">Diese Arbeitsmappe wird vom Verbindungs-Manager zur Laufzeit nicht mehr verwendet, wenn Sie, wie in den folgenden Schritten beschrieben, einen Ausdruck für die `ConnectionString`-Eigenschaft konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="44d36-120">The connection manager will not use this workbook at run time after you configure an expression for the `ConnectionString` property as described in the following steps.</span></span> <span data-ttu-id="44d36-121">Nachdem Sie das Paket erstellt und konfiguriert haben, können Sie im Eigenschaftenfenster den Wert der `ConnectionString`-Eigenschaft löschen.</span><span class="sxs-lookup"><span data-stu-id="44d36-121">After you create and configure the package, you can clear the value of the `ConnectionString` property in the Properties window.</span></span> <span data-ttu-id="44d36-122">Wenn Sie diesen Wert löschen, ist die Verbindungszeichenfolgen-Eigenschaft des Excel-Verbindungs-Managers allerdings erst dann wieder gültig, wenn die Foreach-Schleife ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="44d36-122">However, if you clear this value, the connection string property of the Excel connection manager is no longer valid until the Foreach Loop runs.</span></span> <span data-ttu-id="44d36-123">Daher müssen Sie für die Tasks, in denen der Verbindungs-Manager verwendet wird, oder für das Paket die `DelayValidation`-Eigenschaft auf `True` festlegen, um Überprüfungsfehler zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="44d36-123">Therefore you must set the `DelayValidation` property to `True` on the tasks in which the connection manager is used, or on the package, to avoid validation errors.</span></span>  
    >   
    >  <span data-ttu-id="44d36-124">Sie müssen auch den Standardwert von `False` für die `RetainSameConnection`-Eigenschaft des Excel-Verbindungs-Managers verwenden.</span><span class="sxs-lookup"><span data-stu-id="44d36-124">You must also use the default value of `False` for the `RetainSameConnection` property of the Excel connection manager.</span></span> <span data-ttu-id="44d36-125">Wenn Sie diesen Wert auf `True` ändern, wird jede Iteration der Schleife weiterhin die erste Excel-Arbeitsmappe öffnen.</span><span class="sxs-lookup"><span data-stu-id="44d36-125">If you change this value to `True`, each iteration of the loop will continue to open the first Excel workbook.</span></span>  
  
8.  <span data-ttu-id="44d36-126">Wählen Sie den neuen Excel-Verbindungs-Manager aus, klicken Sie im Eigenschaftenfenster auf die Eigenschaft **Ausdrücke** , und klicken Sie anschließend auf die Auslassungspunkte.</span><span class="sxs-lookup"><span data-stu-id="44d36-126">Select the new Excel connection manager, click the **Expressions** property in the Properties window, and then click the ellipsis.</span></span>  
  
9. <span data-ttu-id="44d36-127">Wählen Sie im **Eigenschafts Ausdrucks-Editor**die `ConnectionString` Eigenschaft aus, und klicken Sie dann auf die Auslassungs Punkte.</span><span class="sxs-lookup"><span data-stu-id="44d36-127">In the **Property Expressions Editor**, select the `ConnectionString` property, and then click the ellipsis.</span></span>  
  
10. <span data-ttu-id="44d36-128">Geben Sie im Ausdrucks-Generator den folgenden Ausdruck ein:</span><span class="sxs-lookup"><span data-stu-id="44d36-128">In the Expression Builder, enter the following expression:</span></span>  
  
    ```  
    "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" +  @[User::ExcelFile] + ";Extended Properties=\"" + @[User::ExtProperties] + "\""  
    ```  
  
     <span data-ttu-id="44d36-129">Beachten Sie die Verwendung des Escapezeichens „\\“ bei den inneren Anführungszeichen, die um den Wert des Arguments für erweiterte Eigenschaften herum erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="44d36-129">Note the use of the escape character "\\" to escape the inner quotation marks required around the value of the Extended Properties argument.</span></span>  
  
     <span data-ttu-id="44d36-130">Das Argument "Erweiterte Eigenschaften" ist nicht optional.</span><span class="sxs-lookup"><span data-stu-id="44d36-130">The Extended Properties argument is not optional.</span></span> <span data-ttu-id="44d36-131">Wenn Sie keine Variable zur Angabe des Werts verwenden, müssen Sie dem Ausdruck manuell einen Wert hinzufügen, wie im folgenden Beispiel einer Excel 2003-Datei gezeigt:</span><span class="sxs-lookup"><span data-stu-id="44d36-131">If you do not use a variable to contain its value, then you must add it manually to the expression, as in the following example for an Excel 2003 file:</span></span>  
  
    ```  
    "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=" +  @[User::ExcelFile] + ";Extended Properties=Excel 8.0"  
    ```  
  
11. <span data-ttu-id="44d36-132">Erstellen Sie Tasks innerhalb des Foreach-Schleifencontainers, die den Excel-Verbindungs-Manager verwenden, um für alle Excel-Arbeitsmappen, die dem angegebenen Dateispeicherort und Dateimuster entsprechen, die gleichen Vorgänge auszuführen.</span><span class="sxs-lookup"><span data-stu-id="44d36-132">Create tasks in the Foreach Loop container that use the Excel connection manager to perform the same operations on each Excel workbook that matches the specified file location and pattern.</span></span>  
  
### <a name="to-loop-through-excel-tables-by-using-the-foreach-adonet-schema-rowset-enumerator"></a><span data-ttu-id="44d36-133">So durchlaufen Sie Excel-Tabellen mithilfe des Enumerators für Foreach-ADO.NET-Schemarowset</span><span class="sxs-lookup"><span data-stu-id="44d36-133">To loop through Excel tables by using the Foreach ADO.NET Schema Rowset enumerator</span></span>  
  
1.  <span data-ttu-id="44d36-134">Erstellen Sie einen ADO.NET-Verbindungs-Manager, der den Microsoft Jet OLE DB-Anbieter zum Herstellen einer Verbindung mit einer Excel-Arbeitsmappe verwendet.</span><span class="sxs-lookup"><span data-stu-id="44d36-134">Create an ADO.NET connection manager that uses the Microsoft Jet OLE DB Provider to connect to an Excel workbook.</span></span> <span data-ttu-id="44d36-135">Stellen Sie auf der Seite Alle des Dialogfelds **Verbindungs-Manager** sicher, dass Sie Excel 8.0 als Wert der Eigenschaft für erweiterte Eigenschaften eingeben.</span><span class="sxs-lookup"><span data-stu-id="44d36-135">On the All page of the **Connection Manager** dialog box, make sure that you enter Excel 8.0 as the value of the Extended Properties property.</span></span> <span data-ttu-id="44d36-136">Weitere Informationen finden Sie unter [Hinzufügen, Löschen oder Freigeben eines Verbindungs-Managers in einem Paket](../add-delete-or-share-a-connection-manager-in-a-package.md)</span><span class="sxs-lookup"><span data-stu-id="44d36-136">For more information, see [Add, Delete, or Share a Connection Manager in a Package](../add-delete-or-share-a-connection-manager-in-a-package.md).</span></span>  
  
2.  <span data-ttu-id="44d36-137">Erstellen Sie eine Zeichenfolgenvariable, die bei jeder Iteration der Schleife den Namen der aktuellen Tabelle empfangen wird.</span><span class="sxs-lookup"><span data-stu-id="44d36-137">Create a string variable that will receive the name of the current table on each iteration of the loop.</span></span>  
  
3.  <span data-ttu-id="44d36-138">Fügen Sie der Registerkarte **Ablauf Steuerung** einen Foreach-Schleifen Container hinzu. Weitere Informationen zum Konfigurieren des Foreach-Schleifen Containers finden Sie unter [Konfigurieren eines Foreach-Schleifen Containers](foreach-loop-container.md).</span><span class="sxs-lookup"><span data-stu-id="44d36-138">Add a Foreach Loop container to the **Control Flow** tab. For information about how to configure the Foreach Loop container, see [Configure a Foreach Loop Container](foreach-loop-container.md).</span></span>  
  
4.  <span data-ttu-id="44d36-139">Wählen Sie auf der Seite **Auflistung** des **Foreach-Schleifen-Editors** den Enumerator für Foreach-ADO.NET-Schemarowset aus.</span><span class="sxs-lookup"><span data-stu-id="44d36-139">On the **Collection** page of the **Foreach Loop Editor**, select the Foreach ADO.NET Schema Rowset enumerator.</span></span>  
  
5.  <span data-ttu-id="44d36-140">Wählen Sie als Wert für **Verbindung** den ADO.NET-Verbindungs-Manager aus, den Sie zuvor erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="44d36-140">As the value of **Connection**, select the ADO.NET connection manager that you created previously.</span></span>  
  
6.  <span data-ttu-id="44d36-141">Wählen Sie als Wert für **Schema** die Option Tabellen aus.</span><span class="sxs-lookup"><span data-stu-id="44d36-141">As the value of **Schema**, select Tables.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="44d36-142">Die Liste der Tabellen in einer Excel-Arbeitsmappe schließt sowohl Arbeitsmappen (diese weisen das Suffix $ auf) als auch benannte Bereiche ein.</span><span class="sxs-lookup"><span data-stu-id="44d36-142">The list of tables in an Excel workbook includes both worksheets (which have the $ suffix) and named ranges.</span></span> <span data-ttu-id="44d36-143">Wenn Sie die Liste nach nur Arbeitsmappen oder nach nur benannten Bereichen filtern müssen, müssen Sie zu diesem Zweck möglicherweise benutzerdefinierten Code in einem Skripttask schreiben.</span><span class="sxs-lookup"><span data-stu-id="44d36-143">If you have to filter the list for only worksheets or only named ranges, you may have to write custom code in a Script task for this purpose.</span></span> <span data-ttu-id="44d36-144">Weitere Informationen finden Sie unter [Arbeiten mit Excel-Dateien mit dem Skripttask](script-task.md)</span><span class="sxs-lookup"><span data-stu-id="44d36-144">For more information, see [Working with Excel Files with the Script Task](script-task.md).</span></span>  
  
7.  <span data-ttu-id="44d36-145">Ordnen Sie auf der Seite **Variablenzuordnung** den Index 2 der zuvor erstellten Zeichenfolgenvariablen zu, die den Namen der aktuellen Tabelle enthält.</span><span class="sxs-lookup"><span data-stu-id="44d36-145">On the **Variable Mappings** page, map Index 2 to the string variable created earlier to hold the name of the current table.</span></span>  
  
8.  <span data-ttu-id="44d36-146">Schließen Sie den **Foreach-Schleifen-Editor**.</span><span class="sxs-lookup"><span data-stu-id="44d36-146">Close the **Foreach Loop Editor**.</span></span>  
  
9. <span data-ttu-id="44d36-147">Erstellen Sie Tasks innerhalb des Foreach-Schleifencontainers, die den Excel-Verbindungs-Manager verwenden, um für alle Excel-Tabellen in der angegebenen Arbeitsmappe die gleichen Vorgänge auszuführen.</span><span class="sxs-lookup"><span data-stu-id="44d36-147">Create tasks in the Foreach Loop container that use the Excel connection manager to perform the same operations on each Excel table in the specified workbook.</span></span> <span data-ttu-id="44d36-148">Wenn Sie einen Skripttask zum Überprüfen der aufgezählten Tabellennamen oder zum Arbeiten mit den Tabellen verwenden, müssen Sie die Zeichenfolgenvariable der ReadOnlyVariables-Eigenschaft des Skripttasks hinzufügen.</span><span class="sxs-lookup"><span data-stu-id="44d36-148">If you use a Script Task to examine the enumerated table name or to work with each table, remember to add the string variable to the ReadOnlyVariables property of the Script task.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="44d36-149">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="44d36-149">See Also</span></span>  
 <span data-ttu-id="44d36-150">[Importieren von Daten aus Excel oder Exportieren von Daten nach Excel mit SQL Server Integration Services (SSIS)](../load-data-to-from-excel-with-ssis.md) [Konfigurieren eines Foreach-Schleifen Containers](foreach-loop-container.md) </span><span class="sxs-lookup"><span data-stu-id="44d36-150">[Import data from Excel or export data to Excel with SQL Server Integration Services (SSIS)](../load-data-to-from-excel-with-ssis.md) [Configure a Foreach Loop Container](foreach-loop-container.md) </span></span>  
 <span data-ttu-id="44d36-151">[Hinzufügen oder Ändern eines Eigenschafts Ausdrucks](../expressions/add-or-change-a-property-expression.md) </span><span class="sxs-lookup"><span data-stu-id="44d36-151">[Add or Change a Property Expression](../expressions/add-or-change-a-property-expression.md) </span></span>  
 <span data-ttu-id="44d36-152">[Excel-Verbindungs-Manager](../connection-manager/excel-connection-manager.md) </span><span class="sxs-lookup"><span data-stu-id="44d36-152">[Excel Connection Manager](../connection-manager/excel-connection-manager.md) </span></span>  
 <span data-ttu-id="44d36-153">[Excel-Quelle](../data-flow/excel-source.md) </span><span class="sxs-lookup"><span data-stu-id="44d36-153">[Excel Source](../data-flow/excel-source.md) </span></span>  
 <span data-ttu-id="44d36-154">[Excel-Ziel](../data-flow/excel-destination.md) </span><span class="sxs-lookup"><span data-stu-id="44d36-154">[Excel Destination](../data-flow/excel-destination.md) </span></span>  
 [<span data-ttu-id="44d36-155">Arbeiten mit Excel-Dateien mit dem Skripttask</span><span class="sxs-lookup"><span data-stu-id="44d36-155">Working with Excel Files with the Script Task</span></span>](script-task.md)  
  
  
