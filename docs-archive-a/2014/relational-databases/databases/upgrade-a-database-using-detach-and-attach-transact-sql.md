---
title: Aktualisieren einer Datenbank durch Trennen und Anfügen (Transact-SQL) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- database attaching [SQL Server]
- upgrading databases
- database upgrades [SQL Server]
- database detaching [SQL Server]
- detaching databases [SQL Server]
- attaching databases [SQL Server]
ms.assetid: 99f66ed9-3a75-4e38-ad7d-6c27cc3529a9
author: stevestein
ms.author: sstein
ms.openlocfilehash: d430825fd862ff49b867790f366200a524df3c1c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87616098"
---
# <a name="upgrade-a-database-using-detach-and-attach-transact-sql"></a><span data-ttu-id="9414f-102">Aktualisieren einer Datenbank durch Trennen und Anfügen (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="9414f-102">Upgrade a Database Using Detach and Attach (Transact-SQL)</span></span>
  <span data-ttu-id="9414f-103">In diesem Thema wird beschrieben, wie Sie Trenn- und Anfügevorgänge verwenden, um eine Datenbank in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="9414f-103">This topic describes how to use detach and attach operations to upgrade a database in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="9414f-104">Nach dem Anfügen an [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]ist die Datenbank sofort verfügbar und wird automatisch aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="9414f-104">After being attached to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], the database is available immediately and is automatically upgraded.</span></span>  
  
 <span data-ttu-id="9414f-105">**In diesem Thema**</span><span class="sxs-lookup"><span data-stu-id="9414f-105">**In This Topic**</span></span>  
  
-   <span data-ttu-id="9414f-106">**Vorbereitungen:**</span><span class="sxs-lookup"><span data-stu-id="9414f-106">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="9414f-107">Einschränkungen</span><span class="sxs-lookup"><span data-stu-id="9414f-107">Limitations and Restrictions</span></span>](#Restrictions)  
  
     [<span data-ttu-id="9414f-108">Empfehlungen</span><span class="sxs-lookup"><span data-stu-id="9414f-108">Recommendations</span></span>](#Recommendations)  
  
-   <span data-ttu-id="9414f-109">**So aktualisieren Sie eine SQL Server-Datenbank:**</span><span class="sxs-lookup"><span data-stu-id="9414f-109">**To Upgrade a SQL Server Database:**</span></span>  
  
     [<span data-ttu-id="9414f-110">Verwenden von Trenn- und Anfügevorgängen</span><span class="sxs-lookup"><span data-stu-id="9414f-110">Using detach and attach operations</span></span>](#SSMSProcedure)  
  
-   <span data-ttu-id="9414f-111">**Nachverfolgung:**  [Nach dem Aktualisieren einer SQL Server-Datenbank](#FollowUp)</span><span class="sxs-lookup"><span data-stu-id="9414f-111">**Follow Up:**  [After Upgrading a SQL Server Database](#FollowUp)</span></span>  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="9414f-112">Vorbereitungen</span><span class="sxs-lookup"><span data-stu-id="9414f-112">Before You Begin</span></span>  
  
###  <a name="limitations-and-restrictions"></a><a name="Restrictions"></a> <span data-ttu-id="9414f-113">Einschränkungen</span><span class="sxs-lookup"><span data-stu-id="9414f-113">Limitations and Restrictions</span></span>  
  
-   <span data-ttu-id="9414f-114">Die Systemdatenbanken können nicht angefügt werden.</span><span class="sxs-lookup"><span data-stu-id="9414f-114">The system databases cannot be attached.</span></span>  
  
-   <span data-ttu-id="9414f-115">Durch das Anfügen und Trennen wird die datenbankübergreifende Besitzverkettung für die Datenbank deaktiviert, da deren Option **datenbankübergreifende Besitzverkettung** auf 0 festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="9414f-115">Attach and detach disable cross-database ownership chaining for the database by setting its **cross db ownership chaining** option to 0.</span></span> <span data-ttu-id="9414f-116">Informationen zum Aktivieren der Verkettung finden Sie unter [Datenbankübergreifende Besitzverkettung (Serverkonfigurationsoption)](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="9414f-116">For information about enabling chaining, see [cross db ownership chaining Server Configuration Option](../../database-engine/configure-windows/cross-db-ownership-chaining-server-configuration-option.md).</span></span>  
  
-   <span data-ttu-id="9414f-117">Wenn Sie eine replizierte Datenbank anfügen, die nicht getrennt, sondern kopiert wurde:</span><span class="sxs-lookup"><span data-stu-id="9414f-117">When attaching a replicated database that was copied instead of detached:</span></span>  
  
    -   <span data-ttu-id="9414f-118">Wenn Sie die Datenbank an eine aktualisierte Version derselben Serverinstanz anfügen, müssen Sie **sp_vupgrade_replication** ausführen, um die Replikation zu aktualisieren, nachdem der Anfügevorgang abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="9414f-118">If you attach the database to an upgraded version of the same server instance, you must execute **sp_vupgrade_replication** to upgrade replication after the attach operation finishes.</span></span> <span data-ttu-id="9414f-119">Weitere Informationen finden Sie unter [sp_vupgrade_replication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-vupgrade-replication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9414f-119">For more information, see [sp_vupgrade_replication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-vupgrade-replication-transact-sql).</span></span>  
  
    -   <span data-ttu-id="9414f-120">Wenn Sie die Datenbank an eine andere Serverinstanz anfügen, müssen Sie (unabhängig von der Version) **sp_removedbreplication** ausführen, um die Replikation zu entfernen, nachdem der Anfügevorgang abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="9414f-120">If you attach the database to a different server instance (regardless of version), you must execute **sp_removedbreplication** to remove replication after the attach operation finishes.</span></span> <span data-ttu-id="9414f-121">Weitere Informationen finden Sie unter [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9414f-121">For more information, see [sp_removedbreplication &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-removedbreplication-transact-sql).</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="9414f-122">Empfehlungen</span><span class="sxs-lookup"><span data-stu-id="9414f-122">Recommendations</span></span>  
 <span data-ttu-id="9414f-123">Das Anfügen oder Wiederherstellen von Datenbanken aus unbekannten oder nicht vertrauenswürdigen Quellen wird nicht empfohlen.</span><span class="sxs-lookup"><span data-stu-id="9414f-123">We recommend that you do not attach or restore databases from unknown or untrusted sources.</span></span> <span data-ttu-id="9414f-124">Solche Datenbanken können bösartigen Code enthalten, der möglicherweise unbeabsichtigten [!INCLUDE[tsql](../../includes/tsql-md.md)] -Code ausführt oder Fehler verursacht, indem er das Schema oder die physische Datenbankstruktur ändert.</span><span class="sxs-lookup"><span data-stu-id="9414f-124">Such databases could contain malicious code that might execute unintended [!INCLUDE[tsql](../../includes/tsql-md.md)] code or cause errors by modifying the schema or the physical database structure.</span></span> <span data-ttu-id="9414f-125">Bevor Sie eine Datenbank aus einer unbekannten oder nicht vertrauenswürdigen Quelle verwenden, führen Sie auf einem Nichtproduktionsserver [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) für die Datenbank aus. Überprüfen Sie außerdem den Code in der Datenbank, z.B. gespeicherte Prozeduren oder anderen benutzerdefinierten Code.</span><span class="sxs-lookup"><span data-stu-id="9414f-125">Before you use a database from an unknown or untrusted source, run [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) on the database on a nonproduction server and also examine the code, such as stored procedures or other user-defined code, in the database.</span></span>  
  
##  <a name="to-upgrade-a-database-by-using-detach-and-attach"></a><a name="SSMSProcedure"></a> <span data-ttu-id="9414f-126">So aktualisieren Sie eine Datenbank durch Trennen und Anfügen</span><span class="sxs-lookup"><span data-stu-id="9414f-126">To Upgrade a Database by Using Detach and Attach</span></span>  
  
1.  <span data-ttu-id="9414f-127">Trennen Sie die Datenbank.</span><span class="sxs-lookup"><span data-stu-id="9414f-127">Detach the database.</span></span> <span data-ttu-id="9414f-128">Weitere Informationen finden Sie unter [Trennen einer Datenbank](detach-a-database.md).</span><span class="sxs-lookup"><span data-stu-id="9414f-128">For more information, see [Detach a Database](detach-a-database.md).</span></span>  
  
2.  <span data-ttu-id="9414f-129">Optional können Sie die getrennte(n) Datenbankdatei(en) und die Protokolldatei(en) verschieben.</span><span class="sxs-lookup"><span data-stu-id="9414f-129">Optionally, move the detached database file or files and the log file or files.</span></span>  
  
     <span data-ttu-id="9414f-130">Sie sollten die Protokolldateien zusammen mit den Datendateien verschieben, auch wenn Sie neue Protokolldateien erstellen möchten.</span><span class="sxs-lookup"><span data-stu-id="9414f-130">You should move the log files along with the data files, even if you intend to create new log files.</span></span> <span data-ttu-id="9414f-131">In manchen Fällen sind zum erneuten Anfügen der Datenbank die vorhandenen Protokolldateien erforderlich.</span><span class="sxs-lookup"><span data-stu-id="9414f-131">In some cases, reattaching a database requires its existing log files.</span></span> <span data-ttu-id="9414f-132">Deshalb sollten Sie immer alle getrennten Protokolldateien behalten, bis die Datenbank ohne sie erfolgreich angefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="9414f-132">Therefore, always keep all the detached log files until the database has been successfully attached without them.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="9414f-133">Wenn Sie versuchen, die Datenbank ohne Angabe der Protokolldatei anzufügen, wird die Protokolldatei an ihrem ursprünglichen Speicherort gesucht.</span><span class="sxs-lookup"><span data-stu-id="9414f-133">If you try to attach the database without specifying the log file, the attach operation will look for the log file in its original location.</span></span> <span data-ttu-id="9414f-134">Ist die ursprüngliche Kopie des Protokolls an diesem Speicherort noch vorhanden, wird diese Kopie angefügt.</span><span class="sxs-lookup"><span data-stu-id="9414f-134">If the original copy of the log still exists in that location, that copy is attached.</span></span> <span data-ttu-id="9414f-135">Wenn Sie die Verwendung der ursprünglichen Protokolldatei verhindern möchten, geben Sie entweder den Pfad der neuen Protokolldatei an, oder entfernen Sie die ursprüngliche Kopie der Protokolldatei (nachdem Sie sie an einen neuen Speicherort kopiert haben).</span><span class="sxs-lookup"><span data-stu-id="9414f-135">To avoid using the original log file, either specify the path of the new log file or remove the original copy of the log file (after copying it to the new location).</span></span>  
  
3.  <span data-ttu-id="9414f-136">Fügen Sie die kopierten Dateien an die Instanz von [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]an.</span><span class="sxs-lookup"><span data-stu-id="9414f-136">Attach the copied files to the instance of [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="9414f-137">Weitere Informationen finden Sie unter [Attach a Database](attach-a-database.md).</span><span class="sxs-lookup"><span data-stu-id="9414f-137">For more information, see [Attach a Database](attach-a-database.md).</span></span>  
  
## <a name="example"></a><span data-ttu-id="9414f-138">Beispiel</span><span class="sxs-lookup"><span data-stu-id="9414f-138">Example</span></span>  
 <span data-ttu-id="9414f-139">Im folgenden Beispiel wird eine Kopie einer Datenbank aus einer früheren Version von SQL Server aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="9414f-139">The following example upgrades a copy of a database from an earlier version of SQL Server.</span></span> <span data-ttu-id="9414f-140">Die [!INCLUDE[tsql](../../includes/tsql-md.md)] -Anweisungen werden in einem Abfrage-Editorfenster ausgeführt, das mit der Serverinstanz verbunden ist, an die es angefügt ist.</span><span class="sxs-lookup"><span data-stu-id="9414f-140">The [!INCLUDE[tsql](../../includes/tsql-md.md)] statements are executed in a Query Editor window that is connected to the server instance to which is attached.</span></span>  
  
1.  <span data-ttu-id="9414f-141">Führen Sie die folgenden [!INCLUDE[tsql](../../includes/tsql-md.md)] -Anweisungen aus, um die Datenbank zu trennen:</span><span class="sxs-lookup"><span data-stu-id="9414f-141">Detach the database by executing the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statements:</span></span>  
  
    ```  
    USE master;  
    GO  
    EXEC sp_detach_db @dbname = N'MyDatabase';  
    GO  
    ```  
  
2.  <span data-ttu-id="9414f-142">Kopieren Sie die Daten- und Protokolldateien an den neuen Speicherort, indem Sie die von Ihnen bevorzugte Vorgehensweise verwenden.</span><span class="sxs-lookup"><span data-stu-id="9414f-142">Using the method of your choice, copy the data and log files to the new location.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="9414f-143">Platzieren Sie Datenbank und Transaktionsprotokoll bei einer Produktionsdatenbank auf separaten Datenträgern.</span><span class="sxs-lookup"><span data-stu-id="9414f-143">For a production database, place the database and transaction log on separate disks.</span></span>  
  
     <span data-ttu-id="9414f-144">Um Dateien im Netzwerk auf einen Datenträger auf einem Remotecomputer zu kopieren, verwenden Sie den UNC-Namen (Universal Naming Convention) des Remotespeicherorts.</span><span class="sxs-lookup"><span data-stu-id="9414f-144">To copy files over the network to a disk on a remote computer, use the universal naming convention (UNC) name of the remote location.</span></span> <span data-ttu-id="9414f-145">Ein UNC-Name hat das Format **\\\\** _Servername_ **\\** _ShareName_ **\\** _path_ **\\** _filename_.</span><span class="sxs-lookup"><span data-stu-id="9414f-145">A UNC name takes the form **\\\\**_Servername_**\\**_Sharename_**\\**_Path_**\\**_Filename_.</span></span> <span data-ttu-id="9414f-146">Wie beim Schreiben von Dateien auf die lokale Festplatte müssen die entsprechenden Berechtigungen für das Lesen oder Schreiben einer Datei auf dem Remotedatenträger dem von der [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]-Instanz verwendeten Benutzerkonto erteilt werden.</span><span class="sxs-lookup"><span data-stu-id="9414f-146">As with writing files to the local hard disk, the appropriate permissions that are required to read or write to a file on the remote disk must be granted to the user account used by the instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
3.  <span data-ttu-id="9414f-147">Führen Sie die folgende [!INCLUDE[tsql](../../includes/tsql-md.md)] -Anweisung aus, um die verschobene Datenbank und optional das zugehörige Protokoll anzufügen:</span><span class="sxs-lookup"><span data-stu-id="9414f-147">Attach the moved database and, optionally, its log by executing the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement:</span></span>  
  
    ```  
    USE master;  
    GO  
    CREATE DATABASE MyDatabase   
        ON (FILENAME = 'C:\MySQLServer\MyDatabase.mdf'),  
        (FILENAME = 'C:\MySQLServer\Database.ldf')  
        FOR ATTACH;  
    GO  
    ```  
  
     <span data-ttu-id="9414f-148">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]ist eine neu angefügte Datenbank nicht sofort im Objekt-Explorer sichtbar.</span><span class="sxs-lookup"><span data-stu-id="9414f-148">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], a newly attached database is not immediately visible in Object Explorer.</span></span> <span data-ttu-id="9414f-149">Um die Datenbank anzuzeigen, klicken Sie im Objekt-Explorer im Menü **Ansicht** auf **Aktualisieren**.</span><span class="sxs-lookup"><span data-stu-id="9414f-149">To view the database, in Object Explorer, click **View,** and then **Refresh**.</span></span> <span data-ttu-id="9414f-150">Wenn der **Datenbanken** -Knoten im Objekt-Explorer erweitert wird, wird nun die neu angefügte Datenbank in der Liste der Datenbanken angezeigt.</span><span class="sxs-lookup"><span data-stu-id="9414f-150">When the **Databases** node is expanded in Object Explorer, the newly attached database now appears in the list of databases.</span></span>  
  
##  <a name="follow-up-after-upgrading-a-sql-server-database"></a><a name="FollowUp"></a><span data-ttu-id="9414f-151">Nächster Schritt: Nach dem Aktualisieren einer SQL Server-Datenbank</span><span class="sxs-lookup"><span data-stu-id="9414f-151">Follow Up: After Upgrading a SQL Server Database</span></span>  
 <span data-ttu-id="9414f-152">Wenn die Datenbank Volltextindizes aufweist, werden diese beim Upgrade entweder importiert, zurückgesetzt oder neu erstellt, je nach der Einstellung der Servereigenschaft **upgrade_option** .</span><span class="sxs-lookup"><span data-stu-id="9414f-152">If the database has full-text indexes, the upgrade process either imports, resets, or rebuilds them, depending on the setting of the **upgrade_option** server property.</span></span> <span data-ttu-id="9414f-153">Wenn die Upgradeoption auf „Importieren“ (**upgrade_option** = 2) oder „Neu erstellen“ (**upgrade_option** = 0) festgelegt ist, sind die Volltextindizes während des Upgrades nicht verfügbar.</span><span class="sxs-lookup"><span data-stu-id="9414f-153">If the upgrade option is set to import (**upgrade_option** = 2) or rebuild (**upgrade_option** = 0), the full-text indexes will be unavailable during the upgrade.</span></span> <span data-ttu-id="9414f-154">Je nach Menge der indizierten Daten kann der Importvorgang mehrere Stunden dauern; die Neuerstellung sogar bis zu zehnmal länger.</span><span class="sxs-lookup"><span data-stu-id="9414f-154">Depending the amount of data being indexed, importing can take several hours, and rebuilding can take up to ten times longer.</span></span> <span data-ttu-id="9414f-155">Wenn die Upgradeoption auf Importieren festgelegt ist und kein Volltextkatalog verfügbar ist, werden die zugehörigen Volltextindizes neu erstellt.</span><span class="sxs-lookup"><span data-stu-id="9414f-155">Note also that when the upgrade option is set to import, the associated full-text indexes are rebuilt if a full-text catalog is not available.</span></span> <span data-ttu-id="9414f-156">Verwenden Sie **sp_fulltext_service** , um die Einstellung der Servereigenschaft [upgrade_option](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql)zu ändern.</span><span class="sxs-lookup"><span data-stu-id="9414f-156">To change the setting of the **upgrade_option** server property, use [sp_fulltext_service](/sql/relational-databases/system-stored-procedures/sp-fulltext-service-transact-sql).</span></span>  
  
### <a name="database-compatibility-level-after-upgrade"></a><span data-ttu-id="9414f-157">Datenbank-Kompatibilitätsgrad nach dem Upgrade</span><span class="sxs-lookup"><span data-stu-id="9414f-157">Database Compatibility Level After Upgrade</span></span>  
 <span data-ttu-id="9414f-158">War der Kompatibilitätsgrad einer Benutzerdatenbank vor dem Upgrade 100 oder höher, wird er nach dem Upgrade beibehalten.</span><span class="sxs-lookup"><span data-stu-id="9414f-158">If the compatibility level of a user database is 100 or higher before upgrade, it remains the same after upgrade.</span></span> <span data-ttu-id="9414f-159">War der Kompatibilitätsgrad der aktualisierten Datenbank vor dem Upgrade auf 90 festgelegt, wird er auf 100 erhöht, was dem niedrigsten unterstützten Kompatibilitätsgrad in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]entspricht.</span><span class="sxs-lookup"><span data-stu-id="9414f-159">If the compatibility level is 90 before upgrade in the upgraded database, the compatibility level is set to 100, which is the lowest supported compatibility level in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="9414f-160">Weitere Informationen finden Sie unter [ALTER DATABASE-Kompatibilitätsgrad &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level).</span><span class="sxs-lookup"><span data-stu-id="9414f-160">For more information, see [ALTER DATABASE Compatibility Level &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql-compatibility-level).</span></span>  
  
### <a name="managing-metadata-on-the-upgraded-server-instance"></a><span data-ttu-id="9414f-161">Verwalten von Metadaten auf der aktualisierten Serverinstanz</span><span class="sxs-lookup"><span data-stu-id="9414f-161">Managing Metadata on the Upgraded Server Instance</span></span>  
 <span data-ttu-id="9414f-162">Wenn Sie eine Datenbank an eine andere Serverinstanz anfügen, müssen Sie möglicherweise einen Teil oder auch alle Metadaten für die Datenbank (z. B. Anmeldenamen, Aufträge und Berechtigungen) auf der anderen Serverinstanz erneut erstellen, um Benutzern und Anwendungen ein konsistentes Verhalten bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="9414f-162">When you attach a database onto another server instance, to provide a consistent experience to users and applications, you might have to re-create some or all of the metadata for the database, such as logins, jobs, and permissions, on the other server instance.</span></span> <span data-ttu-id="9414f-163">Weitere Informationen finden Sie unter [Verwalten von Metadaten beim Bereitstellen einer Datenbank auf einer anderen Serverinstanz &#40;SQL Server&#41;](manage-metadata-when-making-a-database-available-on-another-server.md).</span><span class="sxs-lookup"><span data-stu-id="9414f-163">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](manage-metadata-when-making-a-database-available-on-another-server.md).</span></span>  
  
### <a name="service-master-key-and-database-master-key-encryption-changes-from-3des-to-aes"></a><span data-ttu-id="9414f-164">Die Verschlüsselung des Diensthauptschlüssels und Datenbank-Hauptschlüssels wird von 3DES in AES geändert.</span><span class="sxs-lookup"><span data-stu-id="9414f-164">Service Master Key and Database Master Key Encryption changes from 3DES to AES</span></span>  
 [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] <span data-ttu-id="9414f-165">und höhere Versionen schützen den Diensthauptschlüssel (Service Master Key, SMK) und den Datenbank-Hauptschlüssel (Database Master Key, DMK) mithilfe des AES-Verschlüsselungsalgorithmus.</span><span class="sxs-lookup"><span data-stu-id="9414f-165">and higher versions uses the AES encryption algorithm to protect the service master key (SMK) and the database master key (DMK).</span></span> <span data-ttu-id="9414f-166">AES ist ein neuerer Verschlüsselungsalgorithmus als der in früheren Versionen verwendete 3DES-Algorithmus.</span><span class="sxs-lookup"><span data-stu-id="9414f-166">AES is a newer encryption algorithm than 3DES used in earlier versions.</span></span> <span data-ttu-id="9414f-167">Wird eine Datenbank zum ersten Mal an eine neue Instanz von [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]angefügt oder wiederhergestellt, ist noch keine Kopie des Datenbank-Hauptschlüssels (verschlüsselt vom Diensthauptschlüssel) auf dem Server gespeichert.</span><span class="sxs-lookup"><span data-stu-id="9414f-167">When a database is first attached or restored to a new instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], a copy of the database master key (encrypted by the service master key) is not yet stored in the server.</span></span> <span data-ttu-id="9414f-168">Der Datenbank-Hauptschlüssel (Database Master Key, DMK) muss mithilfe der `OPEN MASTER KEY`-Anweisung entschlüsselt werden.</span><span class="sxs-lookup"><span data-stu-id="9414f-168">You must use the `OPEN MASTER KEY` statement to decrypt the database master key (DMK).</span></span> <span data-ttu-id="9414f-169">Nachdem der Datenbank-Hauptschlüssel entschlüsselt wurde, können Sie für die Zukunft die automatische Entschlüsselung aktivieren, indem Sie die `ALTER MASTER KEY REGENERATE`-Anweisung verwenden. Auf diese Weise können Sie eine Kopie des mit dem Diensthauptschlüssel (Service Master Key, SMK) verschlüsselten Datenbank-Hauptschlüssels für den Server bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="9414f-169">Once the DMK has been decrypted, you have the option of enabling automatic decryption in the future by using the `ALTER MASTER KEY REGENERATE` statement to provision the server with a copy of the DMK, encrypted with the service master key (SMK).</span></span> <span data-ttu-id="9414f-170">Wenn eine Datenbank von einer früheren Version aktualisiert wurde, sollte der DMK neu generiert werden, damit er den neueren AES-Algorithmus verwendet.</span><span class="sxs-lookup"><span data-stu-id="9414f-170">When a database has been upgraded from an earlier version, the DMK should be regenerated to use the newer AES algorithm.</span></span> <span data-ttu-id="9414f-171">Weitere Informationen zum Neugenerieren des DMK finden Sie unter [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="9414f-171">For more information about regenerating the DMK, see [ALTER MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-master-key-transact-sql).</span></span> <span data-ttu-id="9414f-172">Die zum Neugenerieren des DMK zum Upgrade auf AES erforderliche Zeit hängt von der Anzahl der Objekte ab, die durch den DMK geschützt werden.</span><span class="sxs-lookup"><span data-stu-id="9414f-172">The time required to regenerate the DMK key to upgrade to AES depends upon the number of objects protected by the DMK.</span></span> <span data-ttu-id="9414f-173">Der DMK muss nur einmal auf AES aktualisiert und neu generiert werden. Dies hat keine Auswirkungen auf zukünftige Neugenerierungen im Rahmen einer Schlüsselrotationsstrategie.</span><span class="sxs-lookup"><span data-stu-id="9414f-173">Regenerating the DMK key to upgrade to AES is only necessary once, and has no impact on future regenerations as part of a key rotation strategy.</span></span>  
  
  
