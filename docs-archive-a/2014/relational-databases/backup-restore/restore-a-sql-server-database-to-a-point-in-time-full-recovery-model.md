---
title: Wiederherstellen einer SQL Server-Datenbank zu einem Zeitpunkt (vollständiges Wiederherstellungsmodell) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- STOPAT clause [RESTORE LOG statement]
- point in time recovery [SQL Server]
- restoring databases [SQL Server], point in time
ms.assetid: 3a5daefd-08a8-4565-b54f-28ad01a47d32
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 0c71ff6e75cbbf27042c1eac70b1f97076290865
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87620463"
---
# <a name="restore-a-sql-server-database-to-a-point-in-time-full-recovery-model"></a><span data-ttu-id="b227d-102">Wiederherstellen einer SQL Server-Datenbank zu einem Zeitpunkt (vollständiges Wiederherstellungsmodell)</span><span class="sxs-lookup"><span data-stu-id="b227d-102">Restore a SQL Server Database to a Point in Time (Full Recovery Model)</span></span>
  <span data-ttu-id="b227d-103">In diesem Thema wird erläutert, wie in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] eine Datenbank bis zu einem bestimmten Zeitpunkt mithilfe von [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] oder [!INCLUDE[tsql](../../includes/tsql-md.md)]wiederhergestellt wird.</span><span class="sxs-lookup"><span data-stu-id="b227d-103">This topic describes how to restore a database to a point in time in [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] by using [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] or [!INCLUDE[tsql](../../includes/tsql-md.md)].</span></span> <span data-ttu-id="b227d-104">Dieses Thema ist nur für [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Datenbanken relevant, die das vollständige oder massenprotokollierte Wiederherstellungsmodell verwenden.</span><span class="sxs-lookup"><span data-stu-id="b227d-104">This topic is relevant only for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] databases that use the full or bulk-logged recovery models.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="b227d-105">Wenn jedoch beim massenprotokollierten Wiederherstellungsmodell die Protokollsicherung massenprotokollierte Änderungen enthält, ist die Wiederherstellung bis zu einem bestimmten Zeitpunkt nicht möglich.</span><span class="sxs-lookup"><span data-stu-id="b227d-105">Under the bulk-logged recovery model, if a log backup contains bulk-logged changes, point-in-time recovery is not possible to a point within that backup.</span></span> <span data-ttu-id="b227d-106">Die Datenbank muss bis zum Ende der Transaktionsprotokollsicherung wiederhergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="b227d-106">The database must be recovered to the end of the transaction log backup.</span></span>  
  
-   <span data-ttu-id="b227d-107">**Vorbereitungen:**</span><span class="sxs-lookup"><span data-stu-id="b227d-107">**Before you begin:**</span></span>  
  
     [<span data-ttu-id="b227d-108">Empfehlungen</span><span class="sxs-lookup"><span data-stu-id="b227d-108">Recommendations</span></span>](#Recommendations)  
  
     [<span data-ttu-id="b227d-109">Sicherheit</span><span class="sxs-lookup"><span data-stu-id="b227d-109">Security</span></span>](#Security)  
  
-   <span data-ttu-id="b227d-110">**Wiederherstellen einer SQL Server-Datenbank zu einem bestimmten Zeitpunkt mit:**</span><span class="sxs-lookup"><span data-stu-id="b227d-110">**To restore a SQL Server database to a point in time, using:**</span></span>  
  
     [<span data-ttu-id="b227d-111">SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="b227d-111">SQL Server Management Studio</span></span>](#SSMSProcedure)  
  
     [<span data-ttu-id="b227d-112">Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="b227d-112">Transact-SQL</span></span>](#TsqlProcedure)  
  
##  <a name="before-you-begin"></a><a name="BeforeYouBegin"></a> <span data-ttu-id="b227d-113">Vorbereitungen</span><span class="sxs-lookup"><span data-stu-id="b227d-113">Before You Begin</span></span>  
  
###  <a name="recommendations"></a><a name="Recommendations"></a> <span data-ttu-id="b227d-114">Empfehlungen</span><span class="sxs-lookup"><span data-stu-id="b227d-114">Recommendations</span></span>  
  
-   <span data-ttu-id="b227d-115">Verwenden von STANDBY zum Finden eines unbekannten Zeitpunkts</span><span class="sxs-lookup"><span data-stu-id="b227d-115">Use STANDBY to find unknown point in time.</span></span>  
  
-   <span data-ttu-id="b227d-116">Frühes Angeben des Zeitpunkts in einer Wiederherstellungssequenz</span><span class="sxs-lookup"><span data-stu-id="b227d-116">Specify the point in time early in a restore sequence</span></span>  
  
###  <a name="security"></a><a name="Security"></a> <span data-ttu-id="b227d-117">Sicherheit</span><span class="sxs-lookup"><span data-stu-id="b227d-117">Security</span></span>  
  
####  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="b227d-118">Berechtigungen</span><span class="sxs-lookup"><span data-stu-id="b227d-118">Permissions</span></span>  
 <span data-ttu-id="b227d-119">Ist die wiederherzustellende Datenbank nicht vorhanden, muss der Benutzer über CREATE DATABASE-Berechtigungen verfügen, um RESTORE ausführen zu können.</span><span class="sxs-lookup"><span data-stu-id="b227d-119">If the database being restored does not exist, the user must have CREATE DATABASE permissions to be able to execute RESTORE.</span></span> <span data-ttu-id="b227d-120">Ist die Datenbank vorhanden, werden RESTORE-Berechtigungen standardmäßig den Mitgliedern der festen Serverrollen **sysadmin** und **dbcreator** sowie dem Besitzer (**dbo**) der Datenbank erteilt (für die Option FROM DATABASE_SNAPSHOT ist die Datenbank immer vorhanden).</span><span class="sxs-lookup"><span data-stu-id="b227d-120">If the database exists, RESTORE permissions default to members of the **sysadmin** and **dbcreator** fixed server roles and the owner (**dbo**) of the database (for the FROM DATABASE_SNAPSHOT option, the database always exists).</span></span>  
  
 <span data-ttu-id="b227d-121">RESTORE-Berechtigungen werden Rollen erteilt, in denen Mitgliedsinformationen immer für den Server verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="b227d-121">RESTORE permissions are given to roles in which membership information is always readily available to the server.</span></span> <span data-ttu-id="b227d-122">Da die Mitgliedschaft in einer festen Datenbankrolle nur bei unbeschädigten und zugänglichen Datenbanken geprüft werden kann (was beim Ausführen von RESTORE nicht immer der Fall ist), verfügen Mitglieder der festen Datenbankrolle **db_owner** nicht über RESTORE-Berechtigungen.</span><span class="sxs-lookup"><span data-stu-id="b227d-122">Because fixed database role membership can be checked only when the database is accessible and undamaged, which is not always the case when RESTORE is executed, members of the **db_owner** fixed database role do not have RESTORE permissions.</span></span>  
  
##  <a name="using-sql-server-management-studio"></a><a name="SSMSProcedure"></a> <span data-ttu-id="b227d-123">Verwenden von SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="b227d-123">Using SQL Server Management Studio</span></span>  
 <span data-ttu-id="b227d-124">**So stellen Sie eine Datenbank bis zu einem Zeitpunkt wieder her**</span><span class="sxs-lookup"><span data-stu-id="b227d-124">**To restore a database to a point in time**</span></span>  
  
1.  <span data-ttu-id="b227d-125">Stellen Sie im Objekt-Explorer eine Verbindung mit der entsprechenden Instanz von [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)]her, und erweitern Sie die Serverstruktur.</span><span class="sxs-lookup"><span data-stu-id="b227d-125">In Object Explorer, connect to the appropriate instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)], and expand the server tree.</span></span>  
  
2.  <span data-ttu-id="b227d-126">Erweitern Sie **Datenbanken**.</span><span class="sxs-lookup"><span data-stu-id="b227d-126">Expand **Databases**.</span></span> <span data-ttu-id="b227d-127">Wählen Sie je nach Datenbank entweder eine Benutzerdatenbank aus, oder erweitern Sie **Systemdatenbanken**, und wählen Sie eine Systemdatenbank aus.</span><span class="sxs-lookup"><span data-stu-id="b227d-127">Depending on the database, either select a user database or expand **System Databases**, and then select a system database.</span></span>  
  
3.  <span data-ttu-id="b227d-128">Klicken Sie mit der rechten Maustaste auf die Datenbank, zeigen Sie auf **Tasks**und **Wiederherstellung**, und klicken Sie anschließend auf **Datenbank**.</span><span class="sxs-lookup"><span data-stu-id="b227d-128">Right-click the database, point to **Tasks**, point to **Restore**, and then click **Database**.</span></span>  
  
4.  <span data-ttu-id="b227d-129">Legen Sie Quelle und Speicherort der wiederherzustellenden Sicherungssätze auf der Seite **Allgemein** mithilfe des Abschnitts **Quelle** fest.</span><span class="sxs-lookup"><span data-stu-id="b227d-129">On the **General** page, use the **Source** section to specify the source and location of the backup sets to restore.</span></span> <span data-ttu-id="b227d-130">Wählen Sie eine der folgenden Optionen aus:</span><span class="sxs-lookup"><span data-stu-id="b227d-130">Select one of the following options:</span></span>  
  
    -   <span data-ttu-id="b227d-131">**Datenbank**</span><span class="sxs-lookup"><span data-stu-id="b227d-131">**Database**</span></span>  
  
         <span data-ttu-id="b227d-132">Wählen Sie die wiederherzustellende Datenbank aus der Dropdownliste aus.</span><span class="sxs-lookup"><span data-stu-id="b227d-132">Select the database to restore from the drop-down list.</span></span> <span data-ttu-id="b227d-133">Die Liste enthält nur Datenbanken, die entsprechend dem Sicherungsverlauf von **msdb** gesichert wurden.</span><span class="sxs-lookup"><span data-stu-id="b227d-133">The list contains only databases that have been backed up according to the **msdb** backup history.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="b227d-134">Wenn die Sicherung von einem anderen Server abgerufen wird, verfügt der Zielserver über keine Sicherungsverlaufsinformationen für die angegebene Datenbank.</span><span class="sxs-lookup"><span data-stu-id="b227d-134">If the backup is taken from a different server, the destination server will not have the backup history information for the specified database.</span></span> <span data-ttu-id="b227d-135">Wählen Sie in diesem Fall **Sicherungsmedium** aus, um die wiederherzustellende Datei oder das Medium manuell anzugeben.</span><span class="sxs-lookup"><span data-stu-id="b227d-135">In this case, select **Device** to manually specify the file or device to restore.</span></span>  
  
    -   <span data-ttu-id="b227d-136">**Device**</span><span class="sxs-lookup"><span data-stu-id="b227d-136">**Device**</span></span>  
  
         <span data-ttu-id="b227d-137">Klicken Sie auf die Schaltfläche zum Durchsuchen ( **...** ), um das Dialogfeld **Sicherungsmedien auswählen** zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="b227d-137">Click the browse (**...**) button to open the **Select backup devices** dialog box.</span></span> <span data-ttu-id="b227d-138">Wählen Sie im Feld **Sicherungsmedientyp** einen der aufgeführten Medientypen aus.</span><span class="sxs-lookup"><span data-stu-id="b227d-138">In the **Backup media type** box, select one of the listed device types.</span></span> <span data-ttu-id="b227d-139">Wenn Sie ein oder mehrere Medien für das Feld **Sicherungsmedien** auswählen möchten, klicken Sie auf **Hinzufügen**.</span><span class="sxs-lookup"><span data-stu-id="b227d-139">To select one or more devices for the **Backup media** box, click **Add**.</span></span>  
  
         <span data-ttu-id="b227d-140">Klicken Sie nach dem Hinzufügen der gewünschten Medien zum Listenfeld **Sicherungsmedien** auf **OK** , um zur Seite **Allgemein** zurückzukehren.</span><span class="sxs-lookup"><span data-stu-id="b227d-140">After you add the devices you want to the **Backup media** list box, click **OK** to return to the **General** page.</span></span>  
  
         <span data-ttu-id="b227d-141">Wählen Sie im Listenfeld **Quelle: Sicherungsmedium: Datenbank** den Namen der Datenbank aus, die wiederhergestellt werden soll.</span><span class="sxs-lookup"><span data-stu-id="b227d-141">In the **Source: Device: Database** list box, select the name of the database which should be restored.</span></span>  
  
         <span data-ttu-id="b227d-142">**Hinweis** Diese Liste ist nur verfügbar, wenn **Sicherungsmedium** ausgewählt wird.</span><span class="sxs-lookup"><span data-stu-id="b227d-142">**Note** This list is only available when **Device** is selected.</span></span> <span data-ttu-id="b227d-143">Nur Datenbanken mit Sicherungen auf dem ausgewählten Medium stehen zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="b227d-143">Only databases that have backups on the selected device will be available.</span></span>  
  
5.  <span data-ttu-id="b227d-144">Im Abschnitt **Ziel** wird das Feld **Datenbank** automatisch mit dem Namen der Datenbank aufgefüllt, die wiederhergestellt werden soll.</span><span class="sxs-lookup"><span data-stu-id="b227d-144">In the **Destination** section, the **Database** box is automatically populated with the name of the database to be restored.</span></span> <span data-ttu-id="b227d-145">Geben Sie zum Ändern des Datenbanknamens den neuen Namen ins Feld **Datenbank** ein.</span><span class="sxs-lookup"><span data-stu-id="b227d-145">To change the name of the database, enter the new name in the **Database** box.</span></span>  
  
6.  <span data-ttu-id="b227d-146">Klicken Sie auf **Zeitachse** , um auf das Dialogfeld **Sicherungszeitachse** zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="b227d-146">Click **Timeline** to access the **Backup Timeline** dialog box.</span></span>  
  
7.  <span data-ttu-id="b227d-147">Klicken Sie im Abschnitt **Wiederherstellen in** auf **Bestimmtes Datum und bestimmte Uhrzeit**.</span><span class="sxs-lookup"><span data-stu-id="b227d-147">In the **Restore to** section, click **Specific date and time**.</span></span>  
  
8.  <span data-ttu-id="b227d-148">Verwenden Sie die Felder **Datum** und **Uhrzeit** oder den Schieberegler, um ein bestimmtes Datum und eine bestimmte Uhrzeit anzugeben, bis zu dem die Wiederherstellung ausgeführt werden soll.</span><span class="sxs-lookup"><span data-stu-id="b227d-148">Use either the **Date** and **Time** boxes or the slider bar to specify a specific date and time to where the restore should stop.</span></span> [!INCLUDE[clickOK](../../includes/clickok-md.md)]  
  
    > [!NOTE]  
    >  <span data-ttu-id="b227d-149">Ändern Sie im Feld **Zeitachsenintervall** die auf der Zeitachse angezeigte Zeitdauer.</span><span class="sxs-lookup"><span data-stu-id="b227d-149">Use the **Timeline Interval** box to change the amount of time displayed on the timeline.</span></span>  
  
9. <span data-ttu-id="b227d-150">Nachdem Sie den gewünschten Zeitpunkt für die Wiederherstellung angegeben haben, stellt der Datenbankwiederherstellungsberater sicher, dass die Spalte **Wiederherstellen** des Rasters **Wiederherzustellende Sicherungssätze** nur die Sicherungen angezeigt, die für die Wiederherstellung bis zu diesem Zeitpunkt benötigt werden.</span><span class="sxs-lookup"><span data-stu-id="b227d-150">After you have specified a specific point in time, the Database Recovery Advisor ensures that only backups that are required for restoring to that point in time are selected in the **Restore** column of the **Backup sets to restore** grid.</span></span> <span data-ttu-id="b227d-151">Die ausgewählten Sicherungen machen den empfohlenen Wiederherstellungsplan für Ihre Zeitpunktwiederherstellung aus.</span><span class="sxs-lookup"><span data-stu-id="b227d-151">These selected backups make up the recommended restore plan for your point-in-time restore.</span></span> <span data-ttu-id="b227d-152">Verwenden Sie nach Möglichkeit nur die für diesen Wiederherstellungsvorgang ausgewählten Sicherungen.</span><span class="sxs-lookup"><span data-stu-id="b227d-152">You should use only the selected backups for your point-in-time restore operation.</span></span>  
  
     <span data-ttu-id="b227d-153">Weitere Informationen zu den Spalten des Rasters **Wiederherzustellende Sicherungssätze** finden Sie unter [Datenbank wiederherstellen &#40;Seite „Allgemein“&#41;](../../integration-services/general-page-of-integration-services-designers-options.md)bezeichnet) gesichert werden.</span><span class="sxs-lookup"><span data-stu-id="b227d-153">For information about the columns in the **Backup sets to restore** grid, see [Restore Database &#40;General Page&#41;](../../integration-services/general-page-of-integration-services-designers-options.md).</span></span> <span data-ttu-id="b227d-154">Informationen zum Datenbankwiederherstellungsberater finden Sie unter [Übersicht über Wiederherstellungsvorgänge &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="b227d-154">For information about the Database Recovery Advisor, see [Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md).</span></span>  
  
10. <span data-ttu-id="b227d-155">Auf der Seite **Optionen** im Bereich **Wiederherstellungsoptionen** können Sie entsprechend Ihren Anforderungen die folgenden Optionen auswählen:</span><span class="sxs-lookup"><span data-stu-id="b227d-155">On the **Options** page, in the **Restore options** panel, you can select any of the following options, if appropriate for your situation:</span></span>  
  
    -   <span data-ttu-id="b227d-156">**Vorhandene Datenbank überschreiben (WITH REPLACE)**</span><span class="sxs-lookup"><span data-stu-id="b227d-156">**Overwrite the existing database (WITH REPLACE)**</span></span>  
  
    -   <span data-ttu-id="b227d-157">**Replikationseinstellungen beibehalten (WITH KEEP_REPLICATION)**</span><span class="sxs-lookup"><span data-stu-id="b227d-157">**Preserve the replication settings (WITH KEEP_REPLICATION)**</span></span>  
  
    -   <span data-ttu-id="b227d-158">**Zugriff auf die wiederhergestellte Datenbank einschränken (WITH RESTRICTED_USER)**</span><span class="sxs-lookup"><span data-stu-id="b227d-158">**Restrict access to the restored database (WITH RESTRICTED_USER)**</span></span>  
  
     <span data-ttu-id="b227d-159">Weitere Informationen zu diesen Optionen finden Sie unter [Datenbank wiederherstellen &#40;Seite „Optionen“&#41;](restore-database-options-page.md).</span><span class="sxs-lookup"><span data-stu-id="b227d-159">For more information about these options, see [Restore Database &#40;Options Page&#41;](restore-database-options-page.md).</span></span>  
  
11. <span data-ttu-id="b227d-160">Aktivieren Sie eine Option für das Feld **Wiederherstellungsstatus** .</span><span class="sxs-lookup"><span data-stu-id="b227d-160">Select an option for the **Recovery state** box.</span></span> <span data-ttu-id="b227d-161">In diesem Feld wird der Status der Datenbank nach dem Wiederherstellungsvorgang bestimmt.</span><span class="sxs-lookup"><span data-stu-id="b227d-161">This box determines the state of the database after the restore operation.</span></span>  
  
    -   <span data-ttu-id="b227d-162">**RESTORE WITH RECOVERY** ist das Standardverhalten, das die Datenbank betriebsbereit belässt, indem für Transaktionen ohne Commit ein Rollback ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="b227d-162">**RESTORE WITH RECOVERY** is the default behavior which leaves the database ready for use by rolling back the uncommitted transactions.</span></span> <span data-ttu-id="b227d-163">Zusätzliche Transaktionsprotokolle können nicht wiederhergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="b227d-163">Additional transaction logs cannot be restored.</span></span> <span data-ttu-id="b227d-164">Wählen Sie diese Option nur aus, wenn Sie alle benötigten Sicherungen jetzt wiederherstellen möchten.</span><span class="sxs-lookup"><span data-stu-id="b227d-164">Select this option if you are restoring all of the necessary backups now.</span></span>  
  
    -   <span data-ttu-id="b227d-165">**RESTORE WITH NORECOVERY** belässt die Datenbank nicht betriebsbereit und führt kein Rollback für Transaktionen ohne Commit aus.</span><span class="sxs-lookup"><span data-stu-id="b227d-165">**RESTORE WITH NORECOVERY** which leaves the database non-operational, and does not roll back the uncommitted transactions.</span></span> <span data-ttu-id="b227d-166">Zusätzliche Transaktionsprotokolle können wiederhergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="b227d-166">Additional transaction logs can be restored.</span></span> <span data-ttu-id="b227d-167">Die Datenbank kann erst verwendet werden, wenn sie wiederhergestellt wurde.</span><span class="sxs-lookup"><span data-stu-id="b227d-167">The database cannot be used until it is recovered.</span></span>  
  
    -   <span data-ttu-id="b227d-168">**RESTORE WITH STANDBY** belässt die Datenbank im schreibgeschützten Modus.</span><span class="sxs-lookup"><span data-stu-id="b227d-168">**RESTORE WITH STANDBY** which leaves the database in read-only mode.</span></span> <span data-ttu-id="b227d-169">Diese Option macht Transaktionen rückgängig, für die noch kein Commit ausgeführt wurde, speichert die Umkehraktionen aber in einer Standbydatei, damit die Auswirkungen der Wiederherstellung rückgängig gemacht werden können.</span><span class="sxs-lookup"><span data-stu-id="b227d-169">It undoes uncommitted transactions, but saves the undo actions in a standby file so that recovery effects can be reverted.</span></span>  
  
     <span data-ttu-id="b227d-170">Beschreibungen der Optionen für den Bereich finden Sie unter [Datenbank wiederherstellen &#40;Seite Optionen&#41;](restore-database-options-page.md).</span><span class="sxs-lookup"><span data-stu-id="b227d-170">For descriptions of the options, see [Restore Database &#40;Options Page&#41;](restore-database-options-page.md).</span></span>  
  
12. <span data-ttu-id="b227d-171">**Erstellen der Sicherung des Protokollfragments vor dem Wiederherstellen** wird ausgewählt, wenn es für den ausgewählten Zeitpunkt erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="b227d-171">**Take tail-log backup before restore** will be selected if it is necessary for the point in time that you have selected.</span></span> <span data-ttu-id="b227d-172">Sie müssen diese Einstellung nicht ändern, können das Protokollfragment jedoch sichern, auch wenn es nicht erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="b227d-172">You do not need to modify this setting, but you can choose to backup the tail of the log even if it is not required.</span></span>  
  
13. <span data-ttu-id="b227d-173">Bei Wiederherstellungsvorgängen treten möglicherweise Fehler auf, wenn aktive Verbindungen zur Datenbank bestehen.</span><span class="sxs-lookup"><span data-stu-id="b227d-173">Restore operations may fail if there are active connections to the database.</span></span> <span data-ttu-id="b227d-174">Aktivieren Sie die Option **Bestehende Verbindungen schließen** , um sicherzustellen, dass alle aktiven Verbindungen zwischen [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] und der Datenbank geschlossen werden.</span><span class="sxs-lookup"><span data-stu-id="b227d-174">Check the **Close existing connections option** to ensure that all active connections between [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] and the database are closed.</span></span> <span data-ttu-id="b227d-175">Durch die Aktivierung dieses Kontrollkästchens wechselt die Datenbank in einen Einzelbenutzermodus, bevor Wiederherstellungsvorgänge ausgeführt werden. Außerdem wird dadurch die Datenbank auf einen Multibenutzermodus festgelegt, wenn der Vorgang abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="b227d-175">This check box sets the database to single user mode before performing the restore operations, and sets the database to multi-user mode when complete.</span></span>  
  
14. <span data-ttu-id="b227d-176">Wählen Sie **Bestätigung vor Wiederherstellen jeder einzelnen Sicherung** aus, wenn Sie zwischen jedem Wiederherstellungsvorgang zur Bestätigung aufgefordert werden möchten.</span><span class="sxs-lookup"><span data-stu-id="b227d-176">Select **Prompt before restoring each backup** if you wish to be prompted between each restore operation.</span></span> <span data-ttu-id="b227d-177">Dies ist in der Regel nur bei großen Datenbanken und bei der gewünschten Überwachung des Status des Wiederherstellungsvorgangs erforderlich.</span><span class="sxs-lookup"><span data-stu-id="b227d-177">This is not usually necessary unless the database is large and you wish to monitor the status of the restore operation.</span></span>  
  
##  <a name="using-transact-sql"></a><a name="TsqlProcedure"></a> <span data-ttu-id="b227d-178">Verwenden von Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="b227d-178">Using Transact-SQL</span></span>  
 <span data-ttu-id="b227d-179">**Voraussetzungen**</span><span class="sxs-lookup"><span data-stu-id="b227d-179">**Before you begin**</span></span>  
  
 <span data-ttu-id="b227d-180">Die Wiederherstellung zu einem bestimmten Zeitpunkt erfolgt immer aus einer Protokollsicherung.</span><span class="sxs-lookup"><span data-stu-id="b227d-180">A specified time is always restored from a log backup.</span></span> <span data-ttu-id="b227d-181">In jeder RESTORE LOG-Anweisung der Wiederherstellungssequenz müssen Sie den Zielzeitpunkt oder die Transaktion in einer identischen STOPAT-Klausel angeben.</span><span class="sxs-lookup"><span data-stu-id="b227d-181">In every RESTORE LOG statement of the restore sequence, you must specify your target time or transaction in an identical STOPAT clause.</span></span> <span data-ttu-id="b227d-182">Als Voraussetzung für eine Zeitpunktwiederherstellung müssen Sie zuerst eine vollständige Datenbanksicherung wiederherstellen, deren Endpunkt vor dem Zielwiederherstellungszeitpunkt liegt.</span><span class="sxs-lookup"><span data-stu-id="b227d-182">As a prerequisite to a point-in-time restore, you must first restore a full database backup whose end point is earlier than your target restore time.</span></span> <span data-ttu-id="b227d-183">Diese vollständige Datenbanksicherung kann älter als die letzte vollständige Datenbanksicherung sein, solange Sie dann jede nachfolgende Protokollsicherung wiederherstellen, bis zu und einschließlich der Protokollsicherung, die den Zielzeitpunkt enthält.</span><span class="sxs-lookup"><span data-stu-id="b227d-183">That full database backup can be older than the most recent full database backup as long as you then restore every subsequent log backup, up to and including the log backup that contains your target point in time.</span></span>  
  
 <span data-ttu-id="b227d-184">Damit Sie besser ermitteln können, welche Datenbanksicherung wiederhergestellt werden soll, können Sie in der RESTORE DATABASE-Anweisung die WITH STOPAT-Klausel angeben, um einen Fehler auszulösen, wenn eine Datensicherung für den angegebenen Zielzeitpunkt zu aktuell ist.</span><span class="sxs-lookup"><span data-stu-id="b227d-184">To help you identify which database backup to restore, you can optionally specify your WITH STOPAT clause in your RESTORE DATABASE statement to raise an error if a data backup is too recent for the specified target time.</span></span> <span data-ttu-id="b227d-185">Die vollständige Datensicherung wird immer wiederhergestellt, auch wenn sie den Zielzeitpunkt enthält.</span><span class="sxs-lookup"><span data-stu-id="b227d-185">The complete data backup is always restored, even if it contains the target time.</span></span>  
  
 <span data-ttu-id="b227d-186">**Grundlegende [!INCLUDE[tsql](../../includes/tsql-md.md)] -Syntax**</span><span class="sxs-lookup"><span data-stu-id="b227d-186">**Basic [!INCLUDE[tsql](../../includes/tsql-md.md)] syntax**</span></span>  
  
 <span data-ttu-id="b227d-187">Protokoll *database_name* aus <wiederherstellen backup_device> mit STOPAT \*\* = *`time`* ,\*\* Wiederherstellung...</span><span class="sxs-lookup"><span data-stu-id="b227d-187">RESTORE LOG *database_name* FROM <backup_device> WITH STOPAT **=*`time`*,** RECOVERY...</span></span>  
  
 <span data-ttu-id="b227d-188">Der Wiederherstellungspunkt ist der letzte Transaktionscommit, der am oder vor dem Wert aufgetreten ist `datetime` , der von *time*angegeben wird.</span><span class="sxs-lookup"><span data-stu-id="b227d-188">The recovery point is the latest transaction commit that occurred at or before the `datetime` value that is specified by *time*.</span></span>  
  
 <span data-ttu-id="b227d-189">Wenn Sie nur die Änderungen vor einem bestimmten Zeitpunkt wiederherstellen möchten, geben Sie für die einzelnen Sicherungen, die Sie wiederherstellen, WITH STOPAT **=** *time* an.</span><span class="sxs-lookup"><span data-stu-id="b227d-189">To restore only the modifications that were made before a specific point in time, specify WITH STOPAT **=** *time* for each backup you restore.</span></span> <span data-ttu-id="b227d-190">Damit stellen Sie sicher, dass der Zielzeitpunkt nicht überschritten wird.</span><span class="sxs-lookup"><span data-stu-id="b227d-190">This makes sure that you do not go past the target time.</span></span>  
  
 <span data-ttu-id="b227d-191">**So stellen Sie eine Datenbank bis zu einem Zeitpunkt wieder her**</span><span class="sxs-lookup"><span data-stu-id="b227d-191">**To restore a database to a point in time**</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="b227d-192">Ein Beispiel für diese Prozedur finden Sie weiter unten in diesem Abschnitt unter [Beispiel (Transact-SQL)](#TsqlExample).</span><span class="sxs-lookup"><span data-stu-id="b227d-192">For an example of this procedure, see [Example (Transact-SQL)](#TsqlExample), later in this section.</span></span>  
  
1.  <span data-ttu-id="b227d-193">Stellen Sie eine Verbindung mit der Serverinstanz her, auf der Sie die Datenbank wiederherstellen möchten.</span><span class="sxs-lookup"><span data-stu-id="b227d-193">Connect to server instance on which you want to restore the database.</span></span>  
  
2.  <span data-ttu-id="b227d-194">Führen Sie die RESTORE DATABASE-Anweisung mithilfe der Option NORECOVERY aus.</span><span class="sxs-lookup"><span data-stu-id="b227d-194">Execute the RESTORE DATABASE statement using the NORECOVERY option.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="b227d-195">Wenn in einer Teilwiederherstellungssequenz eine [FILESTREAM](../blob/filestream-sql-server.md) -Dateigruppe ausgeschlossen wird, wird die Wiederherstellung bis zu einem bestimmten Zeitpunkt nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="b227d-195">If a partial restore sequence excludes any [FILESTREAM](../blob/filestream-sql-server.md) filegroup, point-in-time restore is not supported.</span></span> <span data-ttu-id="b227d-196">Sie können das Fortsetzen der Wiederherstellungssequenz erzwingen.</span><span class="sxs-lookup"><span data-stu-id="b227d-196">You can force the restore sequence to continue.</span></span> <span data-ttu-id="b227d-197">Die FILESTREAM-Dateigruppen, die nicht in die RESTORE-Anweisung eingeschlossen werden, können jedoch zu keinem Zeitpunkt wiederhergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="b227d-197">However the FILESTREAM filegroups that are omitted from your RESTORE statement can never be restored.</span></span> <span data-ttu-id="b227d-198">Wenn Sie eine Wiederherstellung bis zu einem bestimmten Zeitpunkt erzwingen möchten, geben Sie die CONTINUE_AFTER_ERROR-Option zusammen mit der Option STOPAT, STOPATMARK oder STOPBEFOREMARK an. Diese müssen Sie auch in den folgenden RESTORE LOG-Anweisungen angeben.</span><span class="sxs-lookup"><span data-stu-id="b227d-198">To force a point-in-time restore, specify the CONTINUE_AFTER_ERROR option together with the STOPAT, STOPATMARK, or STOPBEFOREMARK option, which you must also specify in your subsequent RESTORE LOG statements.</span></span> <span data-ttu-id="b227d-199">Wenn Sie CONTINUE_AFTER_ERROR angeben, ist die Teilwiederherstellungssequenz erfolgreich, und die FILESTREAM-Dateigruppe wird nicht mehr wiederherstellbar.</span><span class="sxs-lookup"><span data-stu-id="b227d-199">If you specify CONTINUE_AFTER_ERROR, the partial restore sequence succeeds and the FILESTREAM filegroup becomes unrecoverable.</span></span>  
  
3.  <span data-ttu-id="b227d-200">Stellen Sie die letzte differenzielle Datenbanksicherung wieder her und – sofern vorhanden –  ohne dabei die Datenbank wiederherzustellen (RESTORE DATABASE *database_name* FROM *backup_device* WITH NORECOVERY).</span><span class="sxs-lookup"><span data-stu-id="b227d-200">Restore the last differential database backup, if any,  without recovering the database (RESTORE DATABASE *database_name* FROM *backup_device* WITH NORECOVERY).</span></span>  
  
4.  <span data-ttu-id="b227d-201">Wenden Sie jede Transaktionsprotokoll Sicherung in derselben Reihenfolge an, in der Sie erstellt wurden, und geben Sie dabei den Zeitpunkt an, zu dem die Wiederherstellung des Protokolls beendet werden soll (RESTORE DATABASE *database_name* from <backup_device> with STOPAT\*\* = *`time`* ,\*\* Recovery).</span><span class="sxs-lookup"><span data-stu-id="b227d-201">Apply each transaction log backup in the same sequence in which they were created, specifying the time at which you intend to stop restoring log (RESTORE DATABASE *database_name* FROM <backup_device> WITH STOPAT**=*`time`*,** RECOVERY).</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="b227d-202">Die Optionen RECOVERY und STOPAT.</span><span class="sxs-lookup"><span data-stu-id="b227d-202">The RECOVERY and STOPAT options.</span></span> <span data-ttu-id="b227d-203">Wenn die Transaktionsprotokollsicherung den geforderten Zeitpunkt nicht enthält (z. B. wenn der angegebene Zeitpunkt hinter dem Zeitpunkt liegt, bis zu dem das Transaktionsprotokoll reicht), wird eine Warnung erzeugt, und die Datenbank wird nicht wiederhergestellt.</span><span class="sxs-lookup"><span data-stu-id="b227d-203">If the transaction log backup does not contain the requested time (for example, if the time specified is beyond the end of the time covered by the transaction log), a warning is generated and the database remains unrecovered.</span></span>  
  
###  <a name="example-transact-sql"></a><a name="TsqlExample"></a> <span data-ttu-id="b227d-204">Beispiel (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="b227d-204">Example (Transact-SQL)</span></span>  
 <span data-ttu-id="b227d-205">Im folgenden Beispiel wird eine Datenbank in den am `12:00 AM` um `April 15, 2020` bestehenden Status wiederhergestellt und ein Wiederherstellungsvorgang gezeigt, der mehrere Protokollsicherungen umfasst.</span><span class="sxs-lookup"><span data-stu-id="b227d-205">The following example restores a database to its state as of `12:00 AM` on `April 15, 2020` and shows a restore operation that involves multiple log backups.</span></span> <span data-ttu-id="b227d-206">Auf dem Sicherungsmedium ( `AdventureWorksBackups`) ist die wiederherzustellende vollständige Datenbanksicherung der dritte Sicherungssatz (`FILE = 3`), die erste Protokollsicherung ist der vierte Sicherungssatz (`FILE = 4`), und die zweite Protokollsicherung ist der fünfte Sicherungssatz (`FILE = 5`).</span><span class="sxs-lookup"><span data-stu-id="b227d-206">On the backup device, `AdventureWorksBackups`, the full database backup to be restored is the third backup set on the device (`FILE = 3`), the first log backup is the fourth backup set (`FILE = 4`), and the second log backup is the fifth backup set (`FILE = 5`).</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="b227d-207">Für die [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] -Datenbank wird das einfache Wiederherstellungsmodell verwendet.</span><span class="sxs-lookup"><span data-stu-id="b227d-207">The [!INCLUDE[ssSampleDBobject](../../includes/sssampledbobject-md.md)] database uses the simple recovery model.</span></span> <span data-ttu-id="b227d-208">Um Protokollsicherungen zu ermöglichen, wurde für die Datenbank vor dem Erstellen einer vollständigen Datenbanksicherung mithilfe von `ALTER DATABASE AdventureWorks SET RECOVERY FULL`die Verwendung des vollständigen Wiederherstellungsmodells festgelegt.</span><span class="sxs-lookup"><span data-stu-id="b227d-208">To permit log backups, before taking a full database backup, the database was set to use the full recovery model, using `ALTER DATABASE AdventureWorks SET RECOVERY FULL`.</span></span>  
  
```  
RESTORE DATABASE AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=3, NORECOVERY;  
  
RESTORE LOG AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=4, NORECOVERY, STOPAT = 'Apr 15, 2020 12:00 AM';  
  
RESTORE LOG AdventureWorks  
   FROM AdventureWorksBackups  
   WITH FILE=5, NORECOVERY, STOPAT = 'Apr 15, 2020 12:00 AM';  
RESTORE DATABASE AdventureWorks WITH RECOVERY;   
GO  
  
```  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="b227d-209">Verwandte Aufgaben</span><span class="sxs-lookup"><span data-stu-id="b227d-209">Related Tasks</span></span>  
  
-   [<span data-ttu-id="b227d-210">Wiederherstellen einer Datenbanksicherung &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="b227d-210">Restore a Database Backup &#40;SQL Server Management Studio&#41;</span></span>](restore-a-database-backup-using-ssms.md)  
  
-   [<span data-ttu-id="b227d-211">Sichern eines Transaktionsprotokolls &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b227d-211">Back Up a Transaction Log &#40;SQL Server&#41;</span></span>](back-up-a-transaction-log-sql-server.md)  
  
-   [<span data-ttu-id="b227d-212">Wiederherstellen einer Datenbank bis zum Fehlerzeitpunkt im vollständigen Wiederherstellungsmodell &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b227d-212">Restore a Database to the Point of Failure Under the Full Recovery Model &#40;Transact-SQL&#41;</span></span>](restore-database-to-point-of-failure-full-recovery.md)  
  
-   [<span data-ttu-id="b227d-213">Wiederherstellen einer Datenbank bis zu einer markierten Transaktion &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="b227d-213">Restore a Database to a Marked Transaction &#40;SQL Server Management Studio&#41;</span></span>](restore-a-database-to-a-marked-transaction-sql-server-management-studio.md)  
  
-   [<span data-ttu-id="b227d-214">Wiederherstellen zu einer Protokollfolgenummer &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="b227d-214">Recover to a Log Sequence Number &#40;SQL Server&#41;</span></span>](recover-to-a-log-sequence-number-sql-server.md)  
  
## <a name="see-also"></a><span data-ttu-id="b227d-215">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="b227d-215">See Also</span></span>  
 <span data-ttu-id="b227d-216">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="b227d-216">[backupset &#40;Transact-SQL&#41;](/sql/relational-databases/system-tables/backupset-transact-sql) </span></span>  
 <span data-ttu-id="b227d-217">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="b227d-217">[RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql) </span></span>  
 [<span data-ttu-id="b227d-218">RESTORE HEADERONLY &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="b227d-218">RESTORE HEADERONLY &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-headeronly-transact-sql)  
  
  
