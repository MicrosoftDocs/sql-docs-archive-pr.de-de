---
title: Wiederherstellen von in Azure gespeicherten Sicherungen | Microsoft-Dokumentation
ms.custom: ''
ms.date: 03/07/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
ms.assetid: 6ae358b2-6f6f-46e0-a7c8-f9ac6ce79a0e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 68b270f18cb4dbc2724c5a062afae54fa711acec
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87620452"
---
# <a name="restoring-from-backups-stored-in-azure"></a><span data-ttu-id="5c13f-102">Wiederherstellen aus in Azure gespeicherten Sicherungen</span><span class="sxs-lookup"><span data-stu-id="5c13f-102">Restoring From Backups Stored in Azure</span></span>
  <span data-ttu-id="5c13f-103">In diesem Thema werden Überlegungen aufgeführt, die beim Wiederherstellen einer Datenbank aus einer Sicherung berücksichtigt werden müssen, die im Azure Blob Storage-Dienst gespeichert wurde.</span><span class="sxs-lookup"><span data-stu-id="5c13f-103">This topic outlines the considerations when restoring a database using a backup stored in the Azure Blob storage service.</span></span> <span data-ttu-id="5c13f-104">Dies gilt für Sicherungen, die mithilfe der SQL Server-Sicherung über URLs oder durch [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)]erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="5c13f-104">This applies to backups created either by using SQL Server Backup to URL backup or by [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)].</span></span>  
  
 <span data-ttu-id="5c13f-105">Eine Durchsicht dieses Themas wird empfohlen, wenn Sie im Azure Blob Storage-Dienst gespeicherte Sicherungen wiederherstellen möchten. Lesen Sie anschließend die Themen, in denen die Schritte zum Wiederherstellen einer Datenbank beschrieben werden. Die Vorgehensweise ist für lokale und für Azure-Sicherungen identisch.</span><span class="sxs-lookup"><span data-stu-id="5c13f-105">We recommend reviewing this topic if you have backups stored in the Azure Blob storage service that you plan to restore, and then review the topics that describe the steps on how to restore a database which is the same for both on-premises and azure backups.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="5c13f-106">Übersicht</span><span class="sxs-lookup"><span data-stu-id="5c13f-106">Overview</span></span>  
 <span data-ttu-id="5c13f-107">Die Tools und Methoden, die zum Wiederherstellen einer Datenbank aus einer lokalen Sicherung verwendet werden, sind ebenso für das Wiederherstellen einer Datenbank aus einer Cloud-Sicherung geeignet.</span><span class="sxs-lookup"><span data-stu-id="5c13f-107">The tools and methods that are used to restore a database from an on-premises backup apply to restoring a database from a cloud backup.</span></span>  <span data-ttu-id="5c13f-108">In den folgenden Abschnitten werden diese Überlegungen und die Unterschiede beschrieben, die sie beachten müssen, wenn Sie mit Sicherungen arbeiten, die in einem Windows Azure Blob Storage-Dienst gespeichert wurden.</span><span class="sxs-lookup"><span data-stu-id="5c13f-108">The following sections describe these considerations and any differences you should know about when you use backups stored in the Azure Blob storage service.</span></span>  
  
### <a name="using-transact-sql"></a><span data-ttu-id="5c13f-109">Verwenden von Transact-SQL</span><span class="sxs-lookup"><span data-stu-id="5c13f-109">Using Transact-SQL</span></span>  
  
-   <span data-ttu-id="5c13f-110">Da SQL Server eine Verbindung mit einer externen Datenquelle herstellen muss, um die Sicherungsdateien abzurufen, werden SQL-Anmeldeinformationen für die Authentifizierung beim Speicherkonto verwendet.</span><span class="sxs-lookup"><span data-stu-id="5c13f-110">Since SQL Server must connect to an external source to retrieve the backup files, SQL Credential is used to authenticate to the storage account.</span></span> <span data-ttu-id="5c13f-111">Aus diesem Grund muss die RESTORE-Anweisung mit der Option WITH CREDENTIAL angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="5c13f-111">Consequently, the RESTORE statement requires WITH CREDENTIAL option.</span></span> <span data-ttu-id="5c13f-112">Weitere Informationen finden Sie im Artikel zu [SQL Server-Sicherung und -Wiederherstellung mit dem Azure Blob Storage-Dienst](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).</span><span class="sxs-lookup"><span data-stu-id="5c13f-112">For more information, see [SQL Server Backup and Restore with Azure Blob Storage Service](sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service.md).</span></span>  
  
-   <span data-ttu-id="5c13f-113">Wenn Sie [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)] für die Verwaltung von Sicherungen in der Cloud verwenden, können Sie mit der **smart_admin.fn_available_backups** -Systemfunktion alle im Speicher verfügbaren Sicherungen überprüfen.</span><span class="sxs-lookup"><span data-stu-id="5c13f-113">If you are using the [!INCLUDE[ss_smartbackup](../../includes/ss-smartbackup-md.md)] to manage your backups to the cloud, you can review all the available backups in the storage, by using the **smart_admin.fn_available_backups** system function.</span></span> <span data-ttu-id="5c13f-114">Diese Systemfunktion eine Tabelle mit allen verfügbaren Sicherungen für eine Datenbank zurück.</span><span class="sxs-lookup"><span data-stu-id="5c13f-114">This system function returns all the available backups for a database in a table.</span></span> <span data-ttu-id="5c13f-115">Da die Ergebnisse in einer Tabelle zurückgegeben werden, können Sie die Ergebnisse filtern oder sortieren.</span><span class="sxs-lookup"><span data-stu-id="5c13f-115">As the results are returned in a table, you can filter or sort the results.</span></span> <span data-ttu-id="5c13f-116">Weitere Informationen finden Sie unter [smart_admin. fn_available_backups &#40;Transact-SQL-&#41;](/sql/relational-databases/system-functions/managed-backup-fn-available-backups-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="5c13f-116">For more information, see [smart_admin.fn_available_backups &#40;Transact-SQL&#41;](/sql/relational-databases/system-functions/managed-backup-fn-available-backups-transact-sql).</span></span>  
  
### <a name="using-sql-server-management-studio"></a><span data-ttu-id="5c13f-117">Verwendung von SQL Server Management Studio</span><span class="sxs-lookup"><span data-stu-id="5c13f-117">Using SQL Server Management Studio</span></span>  
  
-   <span data-ttu-id="5c13f-118">Beim Verwenden von SQL Server Management Studio wird der Wiederherstellungstask zum Wiederherstellen einer Datenbank verwendet.</span><span class="sxs-lookup"><span data-stu-id="5c13f-118">The restore task is used to restore a database using the SQL Server Management Studio.</span></span> <span data-ttu-id="5c13f-119">Auf der Seite Sicherungsmedien ist jetzt auch die Option **URL** verfügbar, mit der Sicherungsdateien angezeigt werden können, die im Azure Blob Storage-Dienst gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="5c13f-119">The backup media page now includes the **URL** option to show backup files stored in the Azure Blob storage service.</span></span> <span data-ttu-id="5c13f-120">Sie müssen auch die SQL-Anmeldeinformationen angeben, die zur Authentifizierung beim Speicherkonto verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="5c13f-120">You also must provide the SQL Credential that is used to authenticate to the storage account.</span></span> <span data-ttu-id="5c13f-121">Im Raster **Wiederherzustellende Sicherungssätze** werden daraufhin alle im Azure Blob Storage-Dienst verfügbaren Sicherungen angezeigt.</span><span class="sxs-lookup"><span data-stu-id="5c13f-121">The **Backup sets to restore** grid is then populated with the available backups in the Azure Blob storage.</span></span> <span data-ttu-id="5c13f-122">Weitere Informationen finden Sie unter [Wiederherstellen aus Azure Storage mit SQL Server Management Studio](sql-server-backup-to-url.md#RestoreSSMS).</span><span class="sxs-lookup"><span data-stu-id="5c13f-122">For more information, see [Restoring from Azure storage Using SQL Server Management Studio](sql-server-backup-to-url.md#RestoreSSMS).</span></span>  
  
### <a name="optimizing-restores"></a><span data-ttu-id="5c13f-123">Optimieren der Wiederherstellungsvorgänge</span><span class="sxs-lookup"><span data-stu-id="5c13f-123">Optimizing Restores</span></span>  
 <span data-ttu-id="5c13f-124">Um das Schreiben von Wiederherstellungsdaten zu beschleunigen, fügen Sie dem SQL Server-Benutzerkonto die Benutzerberechtigung **Durchführen von Volumewartungsaufgaben** hinzu.</span><span class="sxs-lookup"><span data-stu-id="5c13f-124">To reduce restore write time, Add **perform volume maintenance tasks** user right to the SQL Server user account.</span></span> <span data-ttu-id="5c13f-125">Weitere Informationen finden Sie unter [Datenbankdatei-Initialisierung](https://go.microsoft.com/fwlink/?LinkId=271622).</span><span class="sxs-lookup"><span data-stu-id="5c13f-125">For more information, see [Database File Initialization](https://go.microsoft.com/fwlink/?LinkId=271622).</span></span> <span data-ttu-id="5c13f-126">Wenn die Wiederherstellung trotz aktivierter sofortiger Dateiinitialisierung noch langsam verläuft, sollten Sie die Größe der Protokolldatei auf der Instanz überprüfen, auf der die Datenbank gesichert wurde.</span><span class="sxs-lookup"><span data-stu-id="5c13f-126">If restore is still slow with instant file initialization turned on, look at the size of the log file on the instance where the database was backed up.</span></span> <span data-ttu-id="5c13f-127">Wenn das Protokoll sehr groß ist (mehrere GB umfasst), ist zu erwarten, dass die Wiederherstellung langsam verläuft.</span><span class="sxs-lookup"><span data-stu-id="5c13f-127">If the log is very large in size (multiple GBs), it would be expected that restore would be slow.</span></span> <span data-ttu-id="5c13f-128">Während der Wiederherstellung muss die Protokolldatei mit Nullen (0) aufgefüllt werden, was beträchtliche Zeit in Anspruch nehmen kann.</span><span class="sxs-lookup"><span data-stu-id="5c13f-128">During restore the log file must be zeroed which takes a significant amount of time.</span></span>  
  
 <span data-ttu-id="5c13f-129">Um die Wiederherstellungszeit zu reduzieren, sollten Sie komprimierte Sicherungen verwenden.</span><span class="sxs-lookup"><span data-stu-id="5c13f-129">To reduce restore times it is recommended that you use compressed backups.</span></span>  <span data-ttu-id="5c13f-130">Falls die Sicherungsdatei größer als 25 GB ist, verwenden Sie das Dienstprogramm [AzCopy](https://docs.microsoft.com/archive/blogs/windowsazurestorage/azcopy-uploadingdownloading-files-for-windows-azure-blobs) zum Herunterladen auf den lokalen Datenträger, und führen Sie dann die Wiederherstellung durch.</span><span class="sxs-lookup"><span data-stu-id="5c13f-130">For backup sizes exceeding 25 GB, use [AzCopy utility](https://docs.microsoft.com/archive/blogs/windowsazurestorage/azcopy-uploadingdownloading-files-for-windows-azure-blobs) to download to the local drive and then perform the restore.</span></span> <span data-ttu-id="5c13f-131">Weitere bewährte Methoden und Empfehlungen zu Sicherungen finden Sie unter [SQL Server-URL-Sicherung – bewährte Methoden und Problembehandlung](sql-server-backup-to-url-best-practices-and-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="5c13f-131">For other backup best practices and recommendations, see [SQL Server Backup to URL Best Practices and Troubleshooting](sql-server-backup-to-url-best-practices-and-troubleshooting.md).</span></span>  
  
 <span data-ttu-id="5c13f-132">Sie können beim Ausführen der Wiederherstellung auch das Ablaufverfolgungsflag 3051 aktivieren, um ein ausführlicheres Protokoll zu generieren.</span><span class="sxs-lookup"><span data-stu-id="5c13f-132">You can also turn on Trace Flag 3051 when doing the restore to generate a detailed log.</span></span> <span data-ttu-id="5c13f-133">Die Protokolldatei wird im Protokollverzeichnis gespeichert und im folgenden Format benannt: BackupToUrl-\<instancename>-\<dbname>-action-\<PID>.log.</span><span class="sxs-lookup"><span data-stu-id="5c13f-133">This log file is placed in the log directory, and is named using the format: BackupToUrl-\<instancename>-\<dbname>-action-\<PID>.log.</span></span> <span data-ttu-id="5c13f-134">Die Protokolldatei enthält Informationen über jeden Roundtrip zum Azure Storage, einschließlich Zeitangaben, die hilfreich bei der Problemdiagnose sein können.</span><span class="sxs-lookup"><span data-stu-id="5c13f-134">The log file includes information about each round trip to Azure Storage including timing that can be helpful in diagnosing the issue.</span></span>  
  
### <a name="topics-on-performing-restore-operations"></a><span data-ttu-id="5c13f-135">Themen über die Durchführung von Wiederherstellungsvorgängen</span><span class="sxs-lookup"><span data-stu-id="5c13f-135">Topics on Performing Restore Operations</span></span>  
  
-   [<span data-ttu-id="5c13f-136">Vollständige Datenbankwiederherstellungen &#40;einfaches Wiederherstellungsmodell&#41;</span><span class="sxs-lookup"><span data-stu-id="5c13f-136">Complete Database Restores &#40;Simple Recovery Model&#41;</span></span>](complete-database-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="5c13f-137">RESTORE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="5c13f-137">RESTORE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-transact-sql)  
  
-   [<span data-ttu-id="5c13f-138">Vollständige Datenbankwiederherstellungen &#40;vollständiges Wiederherstellungsmodell&#41;</span><span class="sxs-lookup"><span data-stu-id="5c13f-138">Complete Database Restores &#40;Full Recovery Model&#41;</span></span>](complete-database-restores-full-recovery-model.md)  
  
-   [<span data-ttu-id="5c13f-139">Dateiwiederherstellungen &#40;einfaches Wiederherstellungsmodell&#41;</span><span class="sxs-lookup"><span data-stu-id="5c13f-139">File Restores &#40;Simple Recovery Model&#41;</span></span>](file-restores-simple-recovery-model.md)  
  
-   [<span data-ttu-id="5c13f-140">Dateiwiederherstellungen &#40;vollständiges Wiederherstellungsmodell&#41;</span><span class="sxs-lookup"><span data-stu-id="5c13f-140">File Restores &#40;Full Recovery Model&#41;</span></span>](file-restores-full-recovery-model.md)  
  
-   [<span data-ttu-id="5c13f-141">Schrittweise Wiederherstellungen &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="5c13f-141">Piecemeal Restores &#40;SQL Server&#41;</span></span>](piecemeal-restores-sql-server.md)  
  
  
