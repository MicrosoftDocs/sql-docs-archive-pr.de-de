---
title: Verzögerte Transaktionen (SQL Server) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: backup-restore
ms.topic: conceptual
helpviewer_keywords:
- I/O [SQL Server], database recovery
- restoring pages [SQL Server]
- deferred transactions
- modifying transaction deferred state
ms.assetid: 6fc0f9b6-d3ea-4971-9f27-d0195d1ff718
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 188a0409fbad3f12283adacafbfcb5f176650b72
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87617139"
---
# <a name="deferred-transactions-sql-server"></a><span data-ttu-id="232e2-102">Markierte Transaktionen [SQL Server]</span><span class="sxs-lookup"><span data-stu-id="232e2-102">Deferred Transactions (SQL Server)</span></span>
  <span data-ttu-id="232e2-103">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise kann eine beschädigte Transaktion verzögert werden, wenn für das Rollback (Rückgängig machen) erforderliche Daten während des Starts der Datenbank offline sind.</span><span class="sxs-lookup"><span data-stu-id="232e2-103">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise, a corrupted transaction can become deferred if data required by rollback (undo) is offline during database startup.</span></span> <span data-ttu-id="232e2-104">Bei einer *verzögerten Transaktion* handelt es sich um eine Transaktion, für die kein Commit ausgeführt wird, wenn die Rollforwardphase beendet wird, und bei der ein Fehler auftritt, sodass für die Transaktion kein Rollback ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="232e2-104">A *deferred transaction* is a transaction that is uncommitted when the roll forward phase finishes and that has encountered an error that prevents it from being rolled back.</span></span> <span data-ttu-id="232e2-105">Da kein Rollback ausgeführt werden kann, wird die Transaktion verzögert.</span><span class="sxs-lookup"><span data-stu-id="232e2-105">Because the transaction cannot be rolled back, it is deferred.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="232e2-106">Beschädigte Transaktionen werden nur in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise verzögert.</span><span class="sxs-lookup"><span data-stu-id="232e2-106">Corrupted transactions are deferred only in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Enterprise.</span></span> <span data-ttu-id="232e2-107">In anderen Editionen von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]kann eine beschädigte Transaktion nicht gestartet werden.</span><span class="sxs-lookup"><span data-stu-id="232e2-107">In other editions of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], a corrupted transaction causes startup to fail.</span></span>  
  
 <span data-ttu-id="232e2-108">Eine verzögerte Transaktion tritt normalerweise dann auf, wenn für eine Datenbank ein Rollforward ausgeführt wird und durch einen E/A-Fehler verhindert wird, dass eine Seite, die für die Transaktion erforderlich ist, gelesen werden kann.</span><span class="sxs-lookup"><span data-stu-id="232e2-108">Generally, a deferred transaction occurs because, while the database was being rolled forward, an I/O error prevented reading a page that was required by the transaction.</span></span> <span data-ttu-id="232e2-109">Doch auch ein Fehler auf Dateiebene kann verzögerte Transaktionen zur Folge haben.</span><span class="sxs-lookup"><span data-stu-id="232e2-109">However, an error at the file level can also cause deferred transactions.</span></span> <span data-ttu-id="232e2-110">Eine verzögerte Transaktion kann auch auftreten, wenn eine Teilwiederherstellungssequenz an einem Punkt angehalten wird, an dem ein Transaktionsrollback erforderlich ist und für eine Transaktion Daten erforderlich sind, die offline sind.</span><span class="sxs-lookup"><span data-stu-id="232e2-110">A deferred transaction can also occur when a partial restore sequence stops at a point at which transaction rollback is necessary and a transaction requires data that is offline.</span></span>  
  
 <span data-ttu-id="232e2-111">Bei Benutzertransaktionen, bei denen während des Rollbacks ein E/A-Fehler auftritt, wird die gesamte Datenbank in den Offlinezustand versetzt.</span><span class="sxs-lookup"><span data-stu-id="232e2-111">User transactions that are rolling back and hit an I/O error cause the whole database to go offline.</span></span> <span data-ttu-id="232e2-112">Wird die Datenbank zurück in den Onlinezustand versetzt, werden beim Wiederherstellungsvorgang alle vorherigen Sperren wiederhergestellt, und es wird versucht, für alle Transaktionen, für die kein Commit ausgeführt wurde, ein Rollback auszuführen.</span><span class="sxs-lookup"><span data-stu-id="232e2-112">When the database is brought back online, the redo reacquires all the locks it had and tries to roll back all the uncommitted transactions.</span></span> <span data-ttu-id="232e2-113">Alle durch eine Transaktion geänderten Daten bleiben entsprechend gesperrt, bis für die Transaktion ein Rollback ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="232e2-113">All data modified by a transaction remains appropriately locked until the transaction can roll back.</span></span> <span data-ttu-id="232e2-114">Für Transaktionen, für die kein Rollback ausgeführt werden kann, werden die Sperren freigegeben, sobald der Fehler behoben und die Datenbank neu gestartet wurde, oder nachdem eine Onlinewiederherstellung erfolgt, wenn die verzögerten Transaktionen gelöst werden, während die Datenbank online bleibt.</span><span class="sxs-lookup"><span data-stu-id="232e2-114">Transactions that cannot be rolled back will give up their locks when the corruption is fixed and the database restarted or, after an online restore, when the deferred transactions are resolved while the database remains online.</span></span> <span data-ttu-id="232e2-115">Bis zu diesem Zeitpunkt können die Sperren von einer verzögerten Transaktion aufrecht erhalten werden, wodurch bestimmte Vorgänge in der gesamten Datenbank verhindert werden.</span><span class="sxs-lookup"><span data-stu-id="232e2-115">Until that point, a deferred transaction can hold locks that prevent certain operations on the database as a whole.</span></span> <span data-ttu-id="232e2-116">Wenn eine verzögerte Transaktion beispielsweise eine CREATE TABLE-Anweisung enthält, können Benutzer Tabellen erst nach dem Auflösen der verzögerten Transaktion erstellen.</span><span class="sxs-lookup"><span data-stu-id="232e2-116">For example, if a deferred transaction contains a CREATE TABLE instruction, no user can create a table until the deferred transaction has been resolved.</span></span>  
  
 <span data-ttu-id="232e2-117">Eine verzögerte Transaktion kann auch auftreten, weil eine Datenbank mit einer schrittweisen Wiederherstellung bis zu einem Zeitpunkt wiederhergestellt wird, an dem sich eine oder mehrere aktive Transaktionen auf eine Dateigruppe auswirken, die bislang nicht wiederhergestellt wurde und offline ist.</span><span class="sxs-lookup"><span data-stu-id="232e2-117">Deferred transaction can also occur because a piecemeal restore recovers a database to a point at which one or more active transactions are affecting a filegroup that has not yet been restored and is offline.</span></span> <span data-ttu-id="232e2-118">Da kein Rollback ausgeführt werden kann, werden die Transaktionen verzögert.</span><span class="sxs-lookup"><span data-stu-id="232e2-118">Because the transactions cannot be rolled back, they become deferred.</span></span>  
  
 <span data-ttu-id="232e2-119">In der folgenden Tabelle sind die Aktionen aufgeführt, die einen Wiederherstellungsvorgang der Datenbank verursachen. Die Tabelle veranschaulicht außerdem das Ergebnis von E/A-Fehlern.</span><span class="sxs-lookup"><span data-stu-id="232e2-119">The following table lists the actions that cause a database to perform recovery and the outcome if an I/O problem occurs.</span></span>  
  
|<span data-ttu-id="232e2-120">Aktion</span><span class="sxs-lookup"><span data-stu-id="232e2-120">Action</span></span>|<span data-ttu-id="232e2-121">Lösung (bei E/A-Fehlern oder wenn erforderliche Daten offline sind)</span><span class="sxs-lookup"><span data-stu-id="232e2-121">Resolution (if I/O problems occur or required data is offline)</span></span>|  
|------------|-----------------------------------------------------------------------|  
|<span data-ttu-id="232e2-122">Serverstart</span><span class="sxs-lookup"><span data-stu-id="232e2-122">Server start</span></span>|<span data-ttu-id="232e2-123">verzögerten Transaktion</span><span class="sxs-lookup"><span data-stu-id="232e2-123">Deferred transaction</span></span>|  
|<span data-ttu-id="232e2-124">Restore</span><span class="sxs-lookup"><span data-stu-id="232e2-124">Restore</span></span>|<span data-ttu-id="232e2-125">verzögerten Transaktion</span><span class="sxs-lookup"><span data-stu-id="232e2-125">Deferred transaction</span></span>|  
|<span data-ttu-id="232e2-126">Attach</span><span class="sxs-lookup"><span data-stu-id="232e2-126">Attach</span></span>|<span data-ttu-id="232e2-127">Anfügen erzeugt einen Fehler</span><span class="sxs-lookup"><span data-stu-id="232e2-127">Attach fails</span></span>|  
|<span data-ttu-id="232e2-128">AutoNeustart</span><span class="sxs-lookup"><span data-stu-id="232e2-128">Autorestart</span></span>|<span data-ttu-id="232e2-129">verzögerten Transaktion</span><span class="sxs-lookup"><span data-stu-id="232e2-129">Deferred transaction</span></span>|  
|<span data-ttu-id="232e2-130">Erstellen einer Datenbank oder einer Datenbankmomentaufnahme</span><span class="sxs-lookup"><span data-stu-id="232e2-130">Create database or database snapshot</span></span>|<span data-ttu-id="232e2-131">Erstellen erzeugt einen Fehler</span><span class="sxs-lookup"><span data-stu-id="232e2-131">Creation fails</span></span>|  
|<span data-ttu-id="232e2-132">Wiederholen bei Datenbankspiegelung</span><span class="sxs-lookup"><span data-stu-id="232e2-132">Redo on database mirroring</span></span>|<span data-ttu-id="232e2-133">verzögerten Transaktion</span><span class="sxs-lookup"><span data-stu-id="232e2-133">Deferred transaction</span></span>|  
|<span data-ttu-id="232e2-134">Dateigruppe ist offline</span><span class="sxs-lookup"><span data-stu-id="232e2-134">Filegroup is offline</span></span>|<span data-ttu-id="232e2-135">verzögerten Transaktion</span><span class="sxs-lookup"><span data-stu-id="232e2-135">Deferred transaction</span></span>|  
  
## <a name="moving-a-transaction-out-of-the-deferred-state"></a><span data-ttu-id="232e2-136">Beenden des VERZÖGERTEN Zustands einer Transaktion</span><span class="sxs-lookup"><span data-stu-id="232e2-136">Moving a Transaction Out of the DEFERRED State</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="232e2-137">Das Transaktionsprotokoll bleibt bei verzögerten Transaktionen aktiv.</span><span class="sxs-lookup"><span data-stu-id="232e2-137">Deferred transactions keep the transaction log active.</span></span> <span data-ttu-id="232e2-138">Eine virtuelle Protokolldatei, in der verzögerte Transaktionen enthalten sind, kann erst abgeschnitten werden, wenn sich diese Transaktionen nicht mehr im Verzögerungsmodus befinden.</span><span class="sxs-lookup"><span data-stu-id="232e2-138">A virtual log file that contains any deferred transactions cannot be truncated until those transactions are moved out of the deferred state.</span></span> <span data-ttu-id="232e2-139">Weitere Informationen zu Protokollkürzung finden Sie unter [Das Transaktionsprotokoll &#40;SQL Server&#41;](../logs/the-transaction-log-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="232e2-139">For more information about log truncation, see [The Transaction Log &#40;SQL Server&#41;](../logs/the-transaction-log-sql-server.md).</span></span>  
  
 <span data-ttu-id="232e2-140">Damit der verzögerte Zustand der Transaktion beendet wird, muss die Datenbank ordnungsgemäß und ohne E/A-Fehler gestartet werden.</span><span class="sxs-lookup"><span data-stu-id="232e2-140">To move the transaction out of the deferred state, the database must start cleanly without any I/O errors.</span></span> <span data-ttu-id="232e2-141">Falls verzögerte Transaktionen vorhanden sind, müssen Sie die Ursache der E/A-Fehler beheben.</span><span class="sxs-lookup"><span data-stu-id="232e2-141">If deferred transactions exist, you must fix the source of the I/O errors.</span></span> <span data-ttu-id="232e2-142">Die verfügbaren Lösungen werden nachfolgend in der Reihenfolge aufgelistet, in der sie normalerweise versucht werden:</span><span class="sxs-lookup"><span data-stu-id="232e2-142">The available solutions, listed in the order in which they are typically tried, are as follows:</span></span>  
  
-   <span data-ttu-id="232e2-143">Starten Sie die Datenbank neu.</span><span class="sxs-lookup"><span data-stu-id="232e2-143">Restart the database.</span></span> <span data-ttu-id="232e2-144">Wenn es sich um ein vorübergehendes Problem gehandelt hat, sollte die Datenbank ohne verzögerte Transaktionen gestartet werden.</span><span class="sxs-lookup"><span data-stu-id="232e2-144">If the problem was transient, the database should start without deferred transactions.</span></span>  
  
-   <span data-ttu-id="232e2-145">Wenn die Transaktionen verzögert wurden, weil eine Dateigruppe offline war, schalten Sie die Dateigruppe wieder online.</span><span class="sxs-lookup"><span data-stu-id="232e2-145">If the transactions were deferred because a filegroup was offline, bring the filegroup back online.</span></span>  
  
     <span data-ttu-id="232e2-146">Mithilfe der folgenden [!INCLUDE[tsql](../../includes/tsql-md.md)] -Anweisung können Sie eine Offlinedateigruppe wieder in den Onlinezustand versetzen:</span><span class="sxs-lookup"><span data-stu-id="232e2-146">To bring an offline filegroup back online, use the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement:</span></span>  
  
    ```  
    RESTORE DATABASE database_name FILEGROUP=<filegroup_name>  
    ```  
  
-   <span data-ttu-id="232e2-147">Stellen Sie die Datenbank wieder her.</span><span class="sxs-lookup"><span data-stu-id="232e2-147">Restore the database.</span></span> <span data-ttu-id="232e2-148">Nach einer Onlinewiederherstellung werden alle verzögerten Transaktionen aufgelöst.</span><span class="sxs-lookup"><span data-stu-id="232e2-148">After an online restore, any deferred transactions are resolved.</span></span>  
  
     <span data-ttu-id="232e2-149">Wurden die verzögerten Transaktionen im Rahmen des Modells der vollständigen oder massenprotokollierten Wiederherstellung von einigen wenigen beschädigten Seiten verursacht, können die Fehler möglicherweise durch eine Onlinewiederherstellung der entsprechenden Seiten behoben werden (sofern diese unterstützt wird).</span><span class="sxs-lookup"><span data-stu-id="232e2-149">Under the full or bulk-logged recovery model, if the deferred transactions were caused by only a few corrupted pages, an online page restore might resolve the errors (where supported).</span></span>  
  
-   <span data-ttu-id="232e2-150">Wenn keine Dateigruppe mehr erforderlich ist, deren Offlinestatus zu verzögerten Transaktionen führt, setzen Sie die offline geschaltete Dateigruppe außer Kraft.</span><span class="sxs-lookup"><span data-stu-id="232e2-150">If you are no longer require a filegroup whose offline status is causing deferred transactions, make the offline filegroup defunct.</span></span> <span data-ttu-id="232e2-151">Transaktionen, die sich verzögert haben, weil eine Dateigruppe offline ist, befinden sich, nachdem eine Dateigruppe außer Kraft gesetzt wird, nicht mehr im Verzögerungsmodus.</span><span class="sxs-lookup"><span data-stu-id="232e2-151">Transactions that were deferred because the filegroup was offline are moved out of the deferred state after the filegroup becomes defunct.</span></span>  
  
    > [!IMPORTANT]  
    >  <span data-ttu-id="232e2-152">Eine außer Kraft gesetzte Dateigruppe kann nicht wiederhergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="232e2-152">A defunct filegroup can never be recovered.</span></span>  
  
     <span data-ttu-id="232e2-153">Weitere Informationen finden Sie unter [Entfernen von veralteten Dateigruppen &#40;SQL Server&#41;](remove-defunct-filegroups-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="232e2-153">For more information, see [Remove Defunct Filegroups &#40;SQL Server&#41;](remove-defunct-filegroups-sql-server.md).</span></span>  
  
-   <span data-ttu-id="232e2-154">Wenn Transaktionen aufgrund einer beschädigten Seite verzögert wurden und keine gute Sicherung der Datenbank vorhanden ist, müssen Sie zum Reparieren der Datenbank wie folgt vorgehen:</span><span class="sxs-lookup"><span data-stu-id="232e2-154">If transactions were deferred because of a bad page and if a good backup of the database does not exist, use the following process to repair the database:</span></span>  
  
    -   <span data-ttu-id="232e2-155">Versetzen Sie die Datenbank zunächst in den Notfallmodus. Führen Sie dazu die folgende [!INCLUDE[tsql](../../includes/tsql-md.md)] -Anweisung aus:</span><span class="sxs-lookup"><span data-stu-id="232e2-155">First put the database into emergency mode by executing the following [!INCLUDE[tsql](../../includes/tsql-md.md)] statement:</span></span>  
  
        ```  
        ALTER DATABASE <database_name> SET EMERGENCY  
        ```  
  
         <span data-ttu-id="232e2-156">Informationen zum Notfallmodus finden Sie unter [Database States](../databases/database-states.md).</span><span class="sxs-lookup"><span data-stu-id="232e2-156">For information about emergency mode, see [Database States](../databases/database-states.md).</span></span>  
  
    -   <span data-ttu-id="232e2-157">Reparieren Sie anschließend die Datenbank, indem Sie die Option DBCC REPAIR_ALLOW_DATA_LOSS in einer der folgenden DBCC-Anweisungen verwenden: [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql), [DBCC CHECKALLOC](/sql/t-sql/database-console-commands/dbcc-checkalloc-transact-sql) oder [DBCC CHECKTABLE](/sql/t-sql/database-console-commands/dbcc-checktable-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="232e2-157">Then, repair the database by using the DBCC REPAIR_ALLOW_DATA_LOSS option in one of the following DBCC statements: [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql), [DBCC CHECKALLOC](/sql/t-sql/database-console-commands/dbcc-checkalloc-transact-sql), or [DBCC CHECKTABLE](/sql/t-sql/database-console-commands/dbcc-checktable-transact-sql).</span></span>  
  
         <span data-ttu-id="232e2-158">Sobald DBCC auf die beschädigte Seite stößt, wird ihre Zuordnung aufgehoben, und es werden alle damit verbundenen Fehler repariert.</span><span class="sxs-lookup"><span data-stu-id="232e2-158">When DBCC encounters the bad page, DBCC deallocates it and repairs any related errors.</span></span> <span data-ttu-id="232e2-159">Durch diesen Ansatz kann die Datenbank in einem physisch konsistenten Status wieder online geschaltet werden.</span><span class="sxs-lookup"><span data-stu-id="232e2-159">This approach enables the database to be brought back online in a physically consistent state.</span></span> <span data-ttu-id="232e2-160">Allerdings können dabei weitere Daten verloren gehen. Aus diesem Grund sollte dieser Ansatz nur als letzte Möglichkeit verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="232e2-160">However, additional data might also be lost; therefore, this approach should be used as a last resort.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="232e2-161">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="232e2-161">See Also</span></span>  
 <span data-ttu-id="232e2-162">[Übersicht über Wiederherstellungsvorgänge &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="232e2-162">[Restore and Recovery Overview &#40;SQL Server&#41;](restore-and-recovery-overview-sql-server.md) </span></span>  
 <span data-ttu-id="232e2-163">[Entfernen von veralteten Dateigruppen &#40;SQL Server&#41;](remove-defunct-filegroups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="232e2-163">[Remove Defunct Filegroups &#40;SQL Server&#41;](remove-defunct-filegroups-sql-server.md) </span></span>  
 <span data-ttu-id="232e2-164">[Dateiwiederherstellungen &#40;vollständiges Wiederherstellungsmodell&#41;](file-restores-full-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="232e2-164">[File Restores &#40;Full Recovery Model&#41;](file-restores-full-recovery-model.md) </span></span>  
 <span data-ttu-id="232e2-165">[Dateiwiederherstellungen &#40;einfaches Wiederherstellungsmodell&#41;](file-restores-simple-recovery-model.md) </span><span class="sxs-lookup"><span data-stu-id="232e2-165">[File Restores &#40;Simple Recovery Model&#41;](file-restores-simple-recovery-model.md) </span></span>  
 <span data-ttu-id="232e2-166">[Wiederherstellung von Seiten &#40;SQL Server&#41;](restore-pages-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="232e2-166">[Restore Pages &#40;SQL Server&#41;](restore-pages-sql-server.md) </span></span>  
 <span data-ttu-id="232e2-167">[Schrittweise Wiederherstellungen &#40;SQL Server&#41;](piecemeal-restores-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="232e2-167">[Piecemeal Restores &#40;SQL Server&#41;](piecemeal-restores-sql-server.md) </span></span>  
 <span data-ttu-id="232e2-168">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="232e2-168">[ALTER DATABASE &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-database-transact-sql) </span></span>  
 [<span data-ttu-id="232e2-169">RESTORE &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="232e2-169">RESTORE &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/restore-statements-transact-sql)  
  
  
