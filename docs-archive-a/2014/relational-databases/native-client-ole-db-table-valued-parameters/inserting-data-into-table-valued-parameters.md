---
title: Einfügen von Daten in Tabellenwertparameter | Microsoft-Dokumentation
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- table-valued parameters, inserting data into
ms.assetid: 9c1a3234-4675-40d3-b473-8df06208f880
author: rothja
ms.author: jroth
ms.openlocfilehash: 38e33c6e58bc2633591fa80e095ceafe46f67045
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87616035"
---
# <a name="inserting-data-into-table-valued-parameters"></a><span data-ttu-id="6fcfc-102">Einfügen von Daten in Tabellenwertparameter</span><span class="sxs-lookup"><span data-stu-id="6fcfc-102">Inserting Data into Table-Valued Parameters</span></span>
  <span data-ttu-id="6fcfc-103">Der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB-Anbieter unterstützt zwei Modelle für den Consumer, um Daten für Tabellenwert Parameter-Zeilen anzugeben: ein Push-Modell und ein Pull-Modell.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-103">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider supports two models for the consumer to specify data for table valued parameter rows: a push model and a pull model.</span></span> <span data-ttu-id="6fcfc-104">Ein Beispiel zur Veranschaulichung des Pullmodells finden Sie unter [Programmierbeispiele für SQL Server-Daten](https://msftdpprodsamples.codeplex.com/).</span><span class="sxs-lookup"><span data-stu-id="6fcfc-104">A sample that demonstrates the pull model is available; see [SQL Server Data Programming Samples](https://msftdpprodsamples.codeplex.com/).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6fcfc-105">Eine Tabellenwertparameter-Spalte muss entweder nicht standardmäßige oder standardmäßige Werte in allen Zeilen aufweisen.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-105">A table-valued parameter column must have either non-default values in all rows or default values in all rows.</span></span> <span data-ttu-id="6fcfc-106">Es ist nicht möglich, dass Standardwerte nur in einigen Zeilen vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-106">It is not possible to have default values in some rows but not others.</span></span> <span data-ttu-id="6fcfc-107">Daher sind in Tabellenwertparameter-Bindungen die einzigen für Tabellenwertparameter-Rowsetspaltendaten zugelassenen Statuswerte DBSTATUS_S_ISNULL und DBSTATUS_S_OK.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-107">Therefore, in table-valued parameter bindings, the only status values allowed for table-valued parameter rowset column data are DBSTATUS_S_ISNULL and DBSTATUS_S_OK.</span></span> <span data-ttu-id="6fcfc-108">DBSTATUS_S_DEFAULT führt zu einem Fehler, und der gebundene Statuswert wird auf DBSTATUS_E_BADSTATUS festgelegt.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-108">DBSTATUS_S_DEFAULT will result in a failure and the bound status value will be set to DBSTATUS_E_BADSTATUS.</span></span>  
  
## <a name="push-model-loads-all-table-valued-paremeter-data-in-memory"></a><span data-ttu-id="6fcfc-109">Pushmodell (lädt alle Tabellenwertparameter-Daten im Arbeitsspeicher)</span><span class="sxs-lookup"><span data-stu-id="6fcfc-109">Push Model (Loads All Table-Valued Paremeter Data in Memory)</span></span>  
 <span data-ttu-id="6fcfc-110">Das Pushmodell ähnelt der Verwendung von Parametersätzen (das heißt, dem DBPARAMS-Parameter in ICommand::Execute).</span><span class="sxs-lookup"><span data-stu-id="6fcfc-110">The push model is similar to the use of parameter sets (that is, the DBPARAMS parameter in ICommand::Execute).</span></span> <span data-ttu-id="6fcfc-111">Das Pushmodell wird nur dann verwendet, wenn Tabellenwertparameter-Rowsetobjekte ohne benutzerdefinierte Implementierung von IRowset-Schnittstellen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-111">The push model is only used if table-valued parameter rowset objects are used without a customized implementation of IRowset interfaces.</span></span> <span data-ttu-id="6fcfc-112">Die Verwendung des Pushmodells ist empfehlenswert, wenn die Anzahl der Zeilen im Tabellenwertparameter-Rowset gering ist und die Arbeitsspeicherauslastung für die Anwendung daher nicht allzu hoch ist.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-112">The push model is recommended when the number of rows in the table-valued parameter rowset is small and is not expected to put excessive memory pressure on the application.</span></span> <span data-ttu-id="6fcfc-113">Diese Vorgehensweise ist einfacher als die des Pullmodells, da neben den aktuellen gängigen Funktionen in typischen OLE DC-Anwendungen keine zusätzlichen Funktionen der Consumeranwendung erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-113">This is simpler than the pull model, because it does not require any more functionality from the consumer application than what is currently common in typical OLE DB applications.</span></span>  
  
 <span data-ttu-id="6fcfc-114">Es wird vorausgesetzt, dass der Consumer vor der Ausführung eines Befehls alle Tabellenwertparameter-Daten für den Anbieter bereitstellt.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-114">The consumer is expected to provide all the table-valued parameter data to the provider before executing a command.</span></span> <span data-ttu-id="6fcfc-115">Zum Bereitstellen der Daten füllt der Consumer ein Tabellenwertparameter-Rowsetobjekt für den Tabellenwertparameter auf.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-115">To provide the data, the consumer populates a table-valued parameter rowset object for each table-valued parameter.</span></span> <span data-ttu-id="6fcfc-116">Das Tabellenwertparameter-Rowsetobjekt macht Vorgänge zum Einfügen, Festlegen und Löschen verfügbar, mit denen der Consumer die Tabellenwertparameter-Daten bearbeiten kann.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-116">The table-valued parameter rowset object exposes rowset Insert, Set, and Delete operations, which the consumer will use to manipulate the table-valued parameter data.</span></span> <span data-ttu-id="6fcfc-117">Der Anbieter ruft die Daten zum Zeitpunkt der Ausführung von diesem Tabellenwertparameter-Rowsetobjekt ab.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-117">The provider will fetch the data from this table-valued parameter rowset object at execution time.</span></span>  
  
 <span data-ttu-id="6fcfc-118">Wenn ein Tabellenwertparameter-Rowsetobjekt für den Consumer bereitgestellt wird, kann dieser es als Rowsetobjekt verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-118">When a table-valued parameter rowset object is provided to the consumer, the consumer can process it as a rowset object.</span></span> <span data-ttu-id="6fcfc-119">Der Consumer kann mithilfe der Schnittstellenmethoden „IColumnsInfo::GetColumnInfo“ oder „IColumnsRowset::GetColumnsRowset“ die Typinformationen für jede Spalte (Typ, maximale Länge, Genauigkeit und Dezimalstellen) abfragen.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-119">The consumer can obtain the type information of each column (type, maximum length, precision, and scale) by using the IColumnsInfo::GetColumnInfo or IColumnsRowset::GetColumnsRowset interface method.</span></span> <span data-ttu-id="6fcfc-120">Der Consumer erstellt anschließend einen Accessor, um die Bindungen für die Daten anzugeben.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-120">The consumer then creates an accessor to specify the bindings for the data.</span></span> <span data-ttu-id="6fcfc-121">Der nächste Schritt besteht darin, Zeilen mit Daten in das Tabellenwertparameter-Rowset einzufügen.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-121">The next step is to insert rows of data into the table-valued parameter rowset.</span></span> <span data-ttu-id="6fcfc-122">Hierzu können Sie IRowsetChange::InsertRow verwenden.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-122">This can be done by using IRowsetChange::InsertRow.</span></span> <span data-ttu-id="6fcfc-123">Die Schnittstellen „IRowsetChange::SetData“ und „IRowsetChange::DeleteRows“ können auch für das Rowsetobjekt für Tabellenwertparameter verwendet werden, wenn Sie die Daten bearbeiten müssen.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-123">IRowsetChange::SetData or IRowsetChange::DeleteRows can also be used on the table-valued parameter rowset object if you have to manipulate the data.</span></span> <span data-ttu-id="6fcfc-124">Tabellenwertparameter-Rowsetobjekte weisen einen Verweiszähler auf, ähnlich wie Datenstromobjekte.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-124">Table-valued parameter rowset objects are reference counted, similar to stream objects.</span></span>  
  
 <span data-ttu-id="6fcfc-125">Wenn IColumnsRowset::GetColumnsRowset verwendet wird, werden die Methoden „IRowset::GetNextRows“, „IRowset::GetData“ und „IRowset::ReleaseRows“ für das Rowsetobjekt der Ergebnisspalte aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-125">If IColumnsRowset::GetColumnsRowset is used, there will be subsequent calls to IRowset::GetNextRows, IRowset::GetData, and IRowset::ReleaseRows methods on the rowset object of the resulting column.</span></span>  
  
 <span data-ttu-id="6fcfc-126">Nachdem der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB-Anbieter mit dem Ausführen des Befehls begonnen hat, werden die Tabellenwert Parameter-Werte aus diesem Tabellenwert Parameter-Rowsetobjekt abgerufen und an den Server gesendet.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-126">After the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider begins executing the command, the table-valued parameter values will be fetched from this table-valued parameter rowset object and sent to the server.</span></span>  
  
 <span data-ttu-id="6fcfc-127">Das Pushmodell erfordert nur minimale Arbeitsschritte seitens des Consumers, es benötigt jedoch mehr Arbeitsspeicher als das Pullmodell, da sich alle Tabellenwertparameter-Daten zum Zeitpunkt der Ausführung im Arbeitsspeicher befinden müssen.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-127">The push model requires minimal work by the consumer, but uses more memory than the pull model, because all the table-valued parameter data has to be in memory at execution time.</span></span>  
  
## <a name="pull-model-obtaining-table-valued-parameter-data-on-demand-from-the-consumer"></a><span data-ttu-id="6fcfc-128">Pullmodell (Abrufen von Tabellenwertparameter-Daten bei Bedarf vom Consumer)</span><span class="sxs-lookup"><span data-stu-id="6fcfc-128">Pull Model (Obtaining Table-Valued Parameter Data on Demand from the Consumer)</span></span>  
 <span data-ttu-id="6fcfc-129">Das Pullmodell ist für zwei Szenarien nützlich:</span><span class="sxs-lookup"><span data-stu-id="6fcfc-129">The pull model is useful for two scenarios:</span></span>  
  
-   <span data-ttu-id="6fcfc-130">Zum Streamen von Zeilen.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-130">To stream rows.</span></span>  
  
-   <span data-ttu-id="6fcfc-131">Wenn ein Rowset von einem anderen Anbieter als Tabellenwertparameter-Wert verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-131">If a rowset from another provider is being used as the table-valued parameter value.</span></span>  
  
 <span data-ttu-id="6fcfc-132">Im Pullmodell stellt der Consumer nach Bedarf Daten für den Anbieter bereit.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-132">In the pull model, the consumer provides data on demand to the provider.</span></span> <span data-ttu-id="6fcfc-133">Verwenden Sie diesen Ansatz, wenn Ihre Anwendung zahlreiche Dateneinfügungen aufweist und die Tabellenwertparameter-Rowsetdaten zu einer hohen Speicherauslastung führen würden.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-133">Use this approach if your application has many data insertions, and table-valued parameter rowset data in memory would result in excessive memory access.</span></span> <span data-ttu-id="6fcfc-134">Wenn mehrere OLE DB-Anbieter verwendet werden, ermöglicht das Consumer-Pullmodell dem Consumer, ein beliebiges Rowsetobjekt als Tabellenwertparameter-Wert bereitzustellen.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-134">If multiple OLE DB providers are used, the consumer pull model enables the consumer to provide any rowset object as the table-valued parameter value.</span></span>  
  
 <span data-ttu-id="6fcfc-135">Um das Pullmodell verwenden zu können, müssen Consumer ihre eigene Implementierung eines Rowsetobjekts bereitstellen.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-135">To use the pull model, consumers have to provide their own implementation of a rowset object.</span></span> <span data-ttu-id="6fcfc-136">Beim Verwenden des Pullmodells mit Rowsets für Tabellenwertparameter (CLSID_ROWSET_TVP) muss der Consumer das Rowsetobjekt für Tabellenwertparameter aggregieren, das der Anbieter mithilfe der Methoden „ITableDefinitionWithConstraints::CreateTableWithConstraints“ oder „IOpenRowset::OpenRowset“ verfügbar macht.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-136">When using the pull model with table-valued parameter rowsets (CLSID_ROWSET_TVP), the consumer is required to aggregate the table-valued parameter rowset object that the provider exposes through the ITableDefinitionWithConstraints::CreateTableWithConstraints method or the IOpenRowset::OpenRowset method.</span></span> <span data-ttu-id="6fcfc-137">Das Consumerobjekt soll nur die IRowset-Schnittstellenimplementierung überschreiben.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-137">The consumer object is only expected to override the IRowset interface implementation.</span></span> <span data-ttu-id="6fcfc-138">Sie müssen die folgenden Funktionen überschreiben:</span><span class="sxs-lookup"><span data-stu-id="6fcfc-138">You must override the following functions:</span></span>  
  
-   <span data-ttu-id="6fcfc-139">IRowset::GetNextRows</span><span class="sxs-lookup"><span data-stu-id="6fcfc-139">IRowset::GetNextRows</span></span>  
  
-   <span data-ttu-id="6fcfc-140">IRowset::AddRefRows</span><span class="sxs-lookup"><span data-stu-id="6fcfc-140">IRowset::AddRefRows</span></span>  
  
-   <span data-ttu-id="6fcfc-141">IRowset::GetData</span><span class="sxs-lookup"><span data-stu-id="6fcfc-141">IRowset::GetData</span></span>  
  
-   <span data-ttu-id="6fcfc-142">IRowset::ReleaseRows</span><span class="sxs-lookup"><span data-stu-id="6fcfc-142">IRowset::ReleaseRows</span></span>  
  
-   <span data-ttu-id="6fcfc-143">IRowset::RestartPosition</span><span class="sxs-lookup"><span data-stu-id="6fcfc-143">IRowset::RestartPosition</span></span>  
  
 <span data-ttu-id="6fcfc-144">Der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB-Anbieter liest jeweils eine oder mehrere Zeilen vom Rowsetobjekt des Consumers gleichzeitig, um das Streamingverhalten für Tabellenwertparameter zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-144">[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider will read one or more rows at a time from the consumer rowset object to support streaming behavior in table-valued parameters.</span></span> <span data-ttu-id="6fcfc-145">Ein Beispiel: Dem Benutzer liegen die Tabellenwertparameter-Rowsetdaten auf einem Datenträger (nicht im Speicher) vor, und er implementiert die Funktion zum Lesen von Daten vom Datenträger, wenn dies für den [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB-Anbieter erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-145">For example, the user might have the table-valued parameter rowset data on disk (not in memory) and might implement the functionality to read data from the disk when required by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider.</span></span>  
  
 <span data-ttu-id="6fcfc-146">Der Consumer kommuniziert das Datenformat an [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] den Native Client OLE DB-Anbieter, indem er IAccessor:: deateaccessor für das Tabellenwert Parameter-Rowsetobjekt verwendet.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-146">The consumer will communicate its data format to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider by using IAccessor::CreateAccessor on the table-valued parameter rowset object.</span></span> <span data-ttu-id="6fcfc-147">Beim Lesen der Daten vom Consumerpuffer überprüft der Anbieter, ob alle schreibbaren, nicht standardmäßigen Spalten über mindestens ein Accessorhandle verfügbar sind, und verwendet die entsprechenden Handles zum Lesen der Spaltendaten.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-147">When reading data from the consumer buffer, the provider verifies that all the writable and non-default columns are available through at least one accessor handle, and uses the corresponding handles to read columns data.</span></span> <span data-ttu-id="6fcfc-148">Um Mehrdeutigkeit zu vermeiden, sollte eine 1:1-Entsprechung zwischen einer Tabellenwertparameter-Rowset-Spalte und einer Bindung vorliegen.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-148">To avoid ambiguity, there should be a one-to-one correspondence between a table-valued parameter rowset column and a binding.</span></span> <span data-ttu-id="6fcfc-149">Doppelte Bindungen zur gleichen Spalte führen zu einem Fehler.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-149">Duplicate bindings to the same column will result in an error.</span></span> <span data-ttu-id="6fcfc-150">Es wird außerdem davon ausgegangen, dass jeder Accessor über das Element *iOrdinal* von DBBindings in der Sequenz verfügt.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-150">Also, each accessor is expected to have the *iOrdinal* member of DBBindings in sequence.</span></span> <span data-ttu-id="6fcfc-151">Die Anzahl der Aufrufe von entspricht der Anzahl der Accessoren pro Zeile, und die Reihenfolge der Aufrufe basiert auf der Reihenfolge des *iOrdinal*-Werts von den niedrigeren zu den höheren Werten.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-151">There will be as many calls to IRowset::GetData as the number of accessors per row, and the order of calls will be based on the order of *iOrdinal* value from lower to higher values.</span></span>  
  
 <span data-ttu-id="6fcfc-152">Es wird davon ausgegangen, dass der Anbieter die meisten der Schnittstellen implementiert, die vom Tabellenwertparameter-Rowsetobjekt verfügbar gemacht werden.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-152">The provider is expected to implement most of the interfaces exposed by the table-valued parameter rowset object.</span></span> <span data-ttu-id="6fcfc-153">Der Consumer implementiert ein Rowset-Objekt mit minimalen Schnittstellen (IRowset).</span><span class="sxs-lookup"><span data-stu-id="6fcfc-153">The consumer will implement a rowset object with minimal interfaces (IRowset).</span></span> <span data-ttu-id="6fcfc-154">Aufgrund von "blinder" Aggregation werden die verbleibenden obligatorischen Rowsetobjektschnittstellen von Tabellenwertparameter-Rowsetobjekten implementiert.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-154">Because of blind aggregation, the remaining mandatory rowset object interfaces will be implemented by the table-valued parameter rowset object.</span></span>  
  
 <span data-ttu-id="6fcfc-155">Für jedes beliebige Rowsetobjekt, wie Rowsetobjekte, die für einen beliebigen OLE DB-Anbieter abgerufen werden, muss das vom Consumer bereitgestellt Rowset alle erforderlichen Rowsetobjektschnittstellen wie in der OLE DB-Spezifikation angegeben implementieren.</span><span class="sxs-lookup"><span data-stu-id="6fcfc-155">For any other rowset object, such as rowset objects obtained for any OLE DB provider, the consumer-provided rowset must implement all the mandatory rowset object interfaces as specified in the OLE DB specification.</span></span>  
  
 <span data-ttu-id="6fcfc-156">Zum Zeitpunkt der Ausführung erfolgt ein Rückruf des [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB-Anbieters an das Rowsetobjekt, um Zeilen abzurufen und Spaltendaten zu lesen</span><span class="sxs-lookup"><span data-stu-id="6fcfc-156">At the time of execution, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client OLE DB Provider will call back to the rowset object to fetch rows and read column data.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6fcfc-157">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="6fcfc-157">See Also</span></span>  
 <span data-ttu-id="6fcfc-158">[Tabellenwert Parameter &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span><span class="sxs-lookup"><span data-stu-id="6fcfc-158">[Table-Valued Parameters &#40;OLE DB&#41;](table-valued-parameters-ole-db.md) </span></span>  
 [<span data-ttu-id="6fcfc-159">Verwenden von Tabellenwertparametern &#40;OLE DB&#41;</span><span class="sxs-lookup"><span data-stu-id="6fcfc-159">Use Table-Valued Parameters &#40;OLE DB&#41;</span></span>](../native-client-ole-db-how-to/use-table-valued-parameters-ole-db.md)  
  
