---
title: Verwenden der Verschlüsselung | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: reference
helpviewer_keywords:
- database master key [SMO]
- cryptography [SMO]
- cryptography [SQL Server], SMO
- encryption keys [SMO]
- encryption [SQL Server], SMO
- encryption [SMO]
- certificates [SMO]
- service master key [SMO]
ms.assetid: 405e0ed7-50a9-430e-a343-471f54b4af76
author: stevestein
ms.author: sstein
ms.openlocfilehash: 1f1f7d6a8714deb1317562dce669fa0e7adbd45c
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87621439"
---
# <a name="using-encryption"></a><span data-ttu-id="57507-102">Verwenden der Verschlüsselung</span><span class="sxs-lookup"><span data-stu-id="57507-102">Using Encryption</span></span>
  <span data-ttu-id="57507-103">In SMO wird der Diensthauptschlüssel durch das <xref:Microsoft.SqlServer.Management.Smo.ServiceMasterKey>-Objekt dargestellt.</span><span class="sxs-lookup"><span data-stu-id="57507-103">In SMO, the service master key is represented by the <xref:Microsoft.SqlServer.Management.Smo.ServiceMasterKey> object.</span></span> <span data-ttu-id="57507-104">Hierauf wird von der <xref:Microsoft.SqlServer.Management.Smo.Server.ServiceMasterKey%2A>-Eigenschaft des <xref:Microsoft.SqlServer.Management.Smo.Server>-Objekts verwiesen.</span><span class="sxs-lookup"><span data-stu-id="57507-104">This is referenced by the <xref:Microsoft.SqlServer.Management.Smo.Server.ServiceMasterKey%2A> property of the <xref:Microsoft.SqlServer.Management.Smo.Server> object.</span></span> <span data-ttu-id="57507-105">Er wird durch die Verwendung der <xref:Microsoft.SqlServer.Management.Smo.ServiceMasterKey.Regenerate%2A>-Methode erneut generiert.</span><span class="sxs-lookup"><span data-stu-id="57507-105">It can be regenerated by using the <xref:Microsoft.SqlServer.Management.Smo.ServiceMasterKey.Regenerate%2A> method.</span></span>  
  
 <span data-ttu-id="57507-106">Der Datenbank-Hauptschlüssel wird durch das <xref:Microsoft.SqlServer.Management.Smo.MasterKey>-Objekt dargestellt.</span><span class="sxs-lookup"><span data-stu-id="57507-106">The database master key is represented by the <xref:Microsoft.SqlServer.Management.Smo.MasterKey> object.</span></span> <span data-ttu-id="57507-107">Die <xref:Microsoft.SqlServer.Management.Smo.MasterKey.IsEncryptedByServer%2A>-Eigenschaft gibt an, ob der Datenbank-Hauptschlüssel durch den Diensthauptschlüssel verschlüsselt ist oder nicht.</span><span class="sxs-lookup"><span data-stu-id="57507-107">The <xref:Microsoft.SqlServer.Management.Smo.MasterKey.IsEncryptedByServer%2A> property indicates whether or not the database master key is encrypted by the service master key.</span></span> <span data-ttu-id="57507-108">Die verschlüsselte Kopie in der Hauptdatenbank wird immer dann automatisch aktualisiert, wenn der Datenbank-Hauptschlüssel geändert wird.</span><span class="sxs-lookup"><span data-stu-id="57507-108">The encrypted copy in the master database is automatically updated whenever the database master key is changed.</span></span>  
  
 <span data-ttu-id="57507-109">Es ist möglich, die Verschlüsselung des Dienstschlüssels durch die <xref:Microsoft.SqlServer.Management.Smo.MasterKey.DropServiceKeyEncryption%2A>-Methode zu verwerfen und den Datenbank-Hauptschlüssel mit einem Kennwort zu verschlüsseln.</span><span class="sxs-lookup"><span data-stu-id="57507-109">It is possible to drop service key encryption using the <xref:Microsoft.SqlServer.Management.Smo.MasterKey.DropServiceKeyEncryption%2A> method and encrypt the database master key with a password.</span></span> <span data-ttu-id="57507-110">In diesem Fall müssen Sie den Datenbank-Hauptschlüssel explizit öffnen, bevor Sie auf die privaten Schlüssel zugreifen, die von diesem gesichert wurden.</span><span class="sxs-lookup"><span data-stu-id="57507-110">In that situation, you will have to explicitly open the database master key before accessing private keys that it has secured.</span></span>  
  
 <span data-ttu-id="57507-111">Wenn eine Datenbank an eine Instanz von [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] angehängt wird, müssen Sie entweder das Kennwort für den Datenbank-Hauptschlüssel bereitstellen oder die <xref:Microsoft.SqlServer.Management.Smo.MasterKey.AddServiceKeyEncryption%2A>-Methode ausführen, um eine unverschlüsselte Kopie des Datenbank-Hauptschlüssels für die Verschlüsselung mit dem Diensthauptschlüssel verfügbar zu machen.</span><span class="sxs-lookup"><span data-stu-id="57507-111">When a database is being attached to an instance of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)], you must either supply the password for the database master key or execute the <xref:Microsoft.SqlServer.Management.Smo.MasterKey.AddServiceKeyEncryption%2A> method to make an unencrypted copy of the database master key available for encryption with the service master key.</span></span> <span data-ttu-id="57507-112">Dieser Schritt wird empfohlen, um zu vermeiden, dass der Datenbank-Hauptschlüssel explizit geöffnet werden muss.</span><span class="sxs-lookup"><span data-stu-id="57507-112">This step is recommended to avoid the need to explicitly open the database master key.</span></span>  
  
 <span data-ttu-id="57507-113">Die <xref:Microsoft.SqlServer.Management.Smo.MasterKey.Regenerate%2A>-Methode generiert den Datenbank-Hauptschlüssel neu.</span><span class="sxs-lookup"><span data-stu-id="57507-113">The <xref:Microsoft.SqlServer.Management.Smo.MasterKey.Regenerate%2A> method regenerates the database master key.</span></span> <span data-ttu-id="57507-114">Wenn der Datenbank-Hauptschlüssel neu generiert wird, werden alle Schlüssel, die durch den Datenbank-Hauptschlüssel verschlüsselt wurden, entschlüsselt. Daraufhin werden diese mit dem neuen Datenbank-Hauptschlüssel verschlüsselt.</span><span class="sxs-lookup"><span data-stu-id="57507-114">When the database master key is regenerated, all the keys that have been encrypted with the database master key are decrypted, and then encrypts them with the new database master key.</span></span> <span data-ttu-id="57507-115">Die <xref:Microsoft.SqlServer.Management.Smo.MasterKey.DropServiceKeyEncryption%2A>-Methode entfernt die Verschlüsselung des Datenbankhauptschlüssels durch den Diensthauptschlüssel.</span><span class="sxs-lookup"><span data-stu-id="57507-115">The <xref:Microsoft.SqlServer.Management.Smo.MasterKey.DropServiceKeyEncryption%2A> method removes the encryption of the database master key by the service master key.</span></span> <span data-ttu-id="57507-116">Mit <xref:Microsoft.SqlServer.Management.Smo.MasterKey.AddServiceKeyEncryption%2A> wird eine Kopie des Hauptschlüssels mithilfe des Diensthauptschlüssels verschlüsselt und in der aktuellen Datenbank und in der Masterdatenbank gespeichert.</span><span class="sxs-lookup"><span data-stu-id="57507-116"><xref:Microsoft.SqlServer.Management.Smo.MasterKey.AddServiceKeyEncryption%2A> causes a copy of the master key to be encrypted using the service master key and stored in both the current database and in the master database.</span></span>  
  
 <span data-ttu-id="57507-117">In SMO werden Zertifikate durch das <xref:Microsoft.SqlServer.Management.Smo.Certificate>-Objekt dargestellt.</span><span class="sxs-lookup"><span data-stu-id="57507-117">In SMO, certificates are represented by the <xref:Microsoft.SqlServer.Management.Smo.Certificate> object.</span></span> <span data-ttu-id="57507-118">Das <xref:Microsoft.SqlServer.Management.Smo.Certificate>-Objekt verfügt über Eigenschaften, die den öffentlichen Schlüssel, den Namen des Betreffs, die Gültigkeitsdauer und Informationen über den Aussteller festlegen.</span><span class="sxs-lookup"><span data-stu-id="57507-118">The <xref:Microsoft.SqlServer.Management.Smo.Certificate> object has properties that specify the public key, the name of the subject, period of validity, and information about the issuer.</span></span> <span data-ttu-id="57507-119">Die Berechtigung, auf das Zertifikat zuzugreifen, wird über die Methoden `Grant`, `Revoke` und `Deny` gesteuert.</span><span class="sxs-lookup"><span data-stu-id="57507-119">Permission to access the certificate is controlled by using the `Grant`, `Revoke` and `Deny` methods.</span></span>  
  
## <a name="example"></a><span data-ttu-id="57507-120">Beispiel</span><span class="sxs-lookup"><span data-stu-id="57507-120">Example</span></span>  
 <span data-ttu-id="57507-121">Für das folgende Codebeispiel müssen Sie die Programmierungsumgebung, die Programmiervorlage und die Programmiersprache auswählen, um Ihre Anwendung zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="57507-121">For the following code example, you will have to select the programming environment, programming template and the programming language to create your application.</span></span> <span data-ttu-id="57507-122">Weitere Informationen finden Sie unter [Erstellen eines Visual Basic SMO-Projekts in Visual Studio .net](../../../database-engine/dev-guide/create-a-visual-basic-smo-project-in-visual-studio-net.md) und [Erstellen eines Visual C&#35; SMO-Projekts in Visual Studio .net](../how-to-create-a-visual-csharp-smo-project-in-visual-studio-net.md).</span><span class="sxs-lookup"><span data-stu-id="57507-122">For more information, see [Create a Visual Basic SMO Project in Visual Studio .NET](../../../database-engine/dev-guide/create-a-visual-basic-smo-project-in-visual-studio-net.md) and [Create a Visual C&#35; SMO Project in Visual Studio .NET](../how-to-create-a-visual-csharp-smo-project-in-visual-studio-net.md).</span></span>  
  
## <a name="adding-a-certificate-in-visual-basic"></a><span data-ttu-id="57507-123">Hinzufügen eines Zertifikats in Visual Basic</span><span class="sxs-lookup"><span data-stu-id="57507-123">Adding a Certificate in Visual Basic</span></span>  
 <span data-ttu-id="57507-124">Im Codebeispiel wird ein einfaches Zertifikat mit einem Verschlüsselungskennwort erstellt.</span><span class="sxs-lookup"><span data-stu-id="57507-124">The code example creates a simple certificate with an encryption password.</span></span> <span data-ttu-id="57507-125">Im Gegensatz zu anderen Objekten verfügt die <xref:Microsoft.SqlServer.Management.Smo.Certificate.Create%2A>-Methode über mehrere Überladungen.</span><span class="sxs-lookup"><span data-stu-id="57507-125">Unlike other objects, the <xref:Microsoft.SqlServer.Management.Smo.Certificate.Create%2A> method has several overloads.</span></span> <span data-ttu-id="57507-126">Die im Beispiel verwendete Überladung erstellt ein Zertifikat mit einem Verschlüsselungskennwort.</span><span class="sxs-lookup"><span data-stu-id="57507-126">The overload used in the example creates a new certificate with an encryption password.</span></span>  
  
<!-- TODO: review snippet reference  [!CODE [SMO How to#SMO_VBCertificate1](SMO How to#SMO_VBCertificate1)]  -->  
  
## <a name="adding-a-certificate-in-visual-c"></a><span data-ttu-id="57507-127">Hinzufügen eines Zertifikats in Visual C#</span><span class="sxs-lookup"><span data-stu-id="57507-127">Adding a Certificate in Visual C#</span></span>  
 <span data-ttu-id="57507-128">Im Codebeispiel wird ein einfaches Zertifikat mit einem Verschlüsselungskennwort erstellt.</span><span class="sxs-lookup"><span data-stu-id="57507-128">The code example creates a simple certificate with an encryption password.</span></span> <span data-ttu-id="57507-129">Im Gegensatz zu anderen Objekten verfügt die <xref:Microsoft.SqlServer.Management.Smo.Certificate.Create%2A>-Methode über mehrere Überladungen.</span><span class="sxs-lookup"><span data-stu-id="57507-129">Unlike other objects, the <xref:Microsoft.SqlServer.Management.Smo.Certificate.Create%2A> method has several overloads.</span></span> <span data-ttu-id="57507-130">Die im Beispiel verwendete Überladung erstellt ein Zertifikat mit einem Verschlüsselungskennwort.</span><span class="sxs-lookup"><span data-stu-id="57507-130">The overload used in the example creates a new certificate with an encryption password.</span></span>  
  
```csharp
{  
            //Connect to the local, default instance of SQL Server.   
            {  
                Server srv = new Server();  
  
                //Reference the AdventureWorks2012 database.   
                Database db = srv.Databases["AdventureWorks2012"];  
  
                //Define a Certificate object variable by supplying the parent database and name in the constructor.   
                Certificate c = new Certificate(db, "Test_Certificate");  
  
                //Set the start date, expiry date, and description.   
                System.DateTime dt;  
                DateTime.TryParse("January 01, 2010", out dt);  
                c.StartDate = dt;  
                DateTime.TryParse("January 01, 2015", out dt);  
                c.ExpirationDate = dt;  
                c.Subject = "This is a test certificate.";  
                //Create the certificate on the instance of SQL Server by supplying the certificate password argument.   
                c.Create("pGFD4bb925DGvbd2439587y");  
            }  
        }   
```  
  
## <a name="adding-a-certificate-in-powershell"></a><span data-ttu-id="57507-131">Hinzufügen eines Zertifikats in PowerShell</span><span class="sxs-lookup"><span data-stu-id="57507-131">Adding a Certificate in PowerShell</span></span>  
 <span data-ttu-id="57507-132">Im Codebeispiel wird ein einfaches Zertifikat mit einem Verschlüsselungskennwort erstellt.</span><span class="sxs-lookup"><span data-stu-id="57507-132">The code example creates a simple certificate with an encryption password.</span></span> <span data-ttu-id="57507-133">Im Gegensatz zu anderen Objekten verfügt die <xref:Microsoft.SqlServer.Management.Smo.Certificate.Create%2A>-Methode über mehrere Überladungen.</span><span class="sxs-lookup"><span data-stu-id="57507-133">Unlike other objects, the <xref:Microsoft.SqlServer.Management.Smo.Certificate.Create%2A> method has several overloads.</span></span> <span data-ttu-id="57507-134">Die im Beispiel verwendete Überladung erstellt ein Zertifikat mit einem Verschlüsselungskennwort.</span><span class="sxs-lookup"><span data-stu-id="57507-134">The overload used in the example creates a new certificate with an encryption password.</span></span>  
  
```powershell
# Set the path context to the local, default instance of SQL Server and get a reference to AdventureWorks2012  
CD \sql\localhost\default\databases  
$db = get-item AdventureWorks2012  
  
#Create a certificate
$c = New-Object -TypeName Microsoft.SqlServer.Management.Smo.Certificate -ArgumentList $db, "Test_Certificate"  
$c.StartDate = "January 01, 2010"  
$c.Subject = "This is a test certificate."  
$c.ExpirationDate = "January 01, 2015"  
  
#Create the certificate on the instance of SQL Server by supplying the certificate password argument.  
$c.Create("pGFD4bb925DGvbd2439587y")
```  
  
## <a name="see-also"></a><span data-ttu-id="57507-135">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="57507-135">See Also</span></span>  
 [<span data-ttu-id="57507-136">Verwenden von Verschlüsselungsschlüsseln</span><span class="sxs-lookup"><span data-stu-id="57507-136">Using Encryption Keys</span></span>](using-encryption.md)  
