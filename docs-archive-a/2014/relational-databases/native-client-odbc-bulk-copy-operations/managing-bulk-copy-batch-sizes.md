---
title: Verwalten von Batch Größen für das Massen kopieren | Microsoft-Dokumentation
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- SQL Server Native Client ODBC driver, bulk copy
- ODBC, bulk copy operations
- batches [ODBC]
- bulk copy [ODBC], batch sizes
ms.assetid: 4b24139f-788b-45a6-86dc-ae835435d737
author: rothja
ms.author: jroth
ms.openlocfilehash: 1f24ece176cbb834e4162f9e516ff23013fd256a
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87620349"
---
# <a name="managing-bulk-copy-batch-sizes"></a><span data-ttu-id="10c24-102">Verwalten von Batchgrößen für das Massenkopieren</span><span class="sxs-lookup"><span data-stu-id="10c24-102">Managing Bulk Copy Batch Sizes</span></span>
  <span data-ttu-id="10c24-103">Der Hauptzweck eines Batches in Massenkopiervorgängen besteht darin, den Umfang einer Transaktion zu definieren.</span><span class="sxs-lookup"><span data-stu-id="10c24-103">The primary purpose of a batch in bulk copy operations is to define the scope of a transaction.</span></span> <span data-ttu-id="10c24-104">Wenn keine Batchgröße festgelegt ist, wird der gesamte Massenkopiervorgang von den Massenkopierfunktionen als eine einzige Transaktion behandelt.</span><span class="sxs-lookup"><span data-stu-id="10c24-104">If a batch size is not set, then bulk copy functions consider an entire bulk copy to be one transaction.</span></span> <span data-ttu-id="10c24-105">Ist eine Batchgröße festgelegt, stellt jeder Batch eine Transaktion dar, für die nach Beendigung des Batches ein Commit ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="10c24-105">If a batch size is set, then each batch constitutes a transaction that is committed when the batch finishes.</span></span>  
  
 <span data-ttu-id="10c24-106">Wenn ein Massenkopiervorgang ohne festgelegte Batchgröße ausgeführt wird und ein Fehler auftritt, wird für den gesamten Massenkopiervorgang ein Rollback durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="10c24-106">If a bulk copy is performed with no batch size specified and an error is encountered, the entire bulk copy is rolled back.</span></span> <span data-ttu-id="10c24-107">Das Wiederherstellen eines Massenkopiervorgangs mit langer Laufzeit kann einige Zeit in Anspruch nehmen.</span><span class="sxs-lookup"><span data-stu-id="10c24-107">The recovery of a long-running bulk copy can take a long time.</span></span> <span data-ttu-id="10c24-108">Wenn eine Batchgröße festgelegt wird, wird jeder Batch als Transaktion betrachtet und ein Commit für jeden Batch ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="10c24-108">When a batch size is set, bulk copy considers each batch a transaction and commits each batch.</span></span> <span data-ttu-id="10c24-109">Wenn ein Fehler auftritt, muss nur für den letzten ausstehenden Batch ein Rollback ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="10c24-109">If an error is encountered, only the last outstanding batch needs to be rolled back.</span></span>  
  
 <span data-ttu-id="10c24-110">Die Batchgröße kann auch den Sperrenaufwand beeinflussen.</span><span class="sxs-lookup"><span data-stu-id="10c24-110">The batch size can also affect locking overhead.</span></span> <span data-ttu-id="10c24-111">Beim Ausführen eines Massen Kopiervorgangs [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] kann der TABLOCK-Hinweis mithilfe [bcp_control](../native-client-odbc-extensions-bulk-copy-functions/bcp-control.md) angegeben werden, um anstelle von Zeilen Sperren eine Tabellensperre zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="10c24-111">When performing a bulk copy against [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the TABLOCK hint can be specified using [bcp_control](../native-client-odbc-extensions-bulk-copy-functions/bcp-control.md) to acquire a table lock instead of row locks.</span></span> <span data-ttu-id="10c24-112">Die einzelne Tabellensperre kann mit minimalem Aufwand für einen ganzen Massenkopiervorgang aufrechterhalten werden.</span><span class="sxs-lookup"><span data-stu-id="10c24-112">The single table lock can be held with minimal overhead for an entire bulk copy operation.</span></span> <span data-ttu-id="10c24-113">Wird TABLOCK nicht festgelegt, werden Sperren für einzelne Zeilen errichtet und der Aufwand zur Aufrechterhaltung aller Sperren für die Dauer des Massenkopiervorgangs kann die Leistung beeinträchtigen.</span><span class="sxs-lookup"><span data-stu-id="10c24-113">If TABLOCK is not specified then locks are held on individual rows and the overhead of maintaining all the locks for the duration of the bulk copy can slow performance.</span></span> <span data-ttu-id="10c24-114">Da die Sperren nur für die Dauer der Transaktion aufrechterhalten werden, wird dieses Problem durch Angabe einer Batchgröße behoben, indem ein Commit ausgeführt wird, mit dem die aktuellen Sperren freigegeben werden.</span><span class="sxs-lookup"><span data-stu-id="10c24-114">Because locks are only held for the length of a transaction, specifying a batch size addresses this problem by periodically generating a commit that frees the locks currently held.</span></span>  
  
 <span data-ttu-id="10c24-115">Die Anzahl der Zeilen, die zu einem Batch gehören, kann sich erheblich auf die Leistung auswirken, wenn die Zeilenzahl für das Massenkopieren groß ist.</span><span class="sxs-lookup"><span data-stu-id="10c24-115">The number of rows making up a batch can have significant performance effects when bulk copying a large number of rows.</span></span> <span data-ttu-id="10c24-116">Die Empfehlungen für die Batchgröße hängen vom Typ des auszuführenden Massenkopiervorgangs ab.</span><span class="sxs-lookup"><span data-stu-id="10c24-116">The recommendations for batch size depend on the type of bulk copy being performed.</span></span>  
  
-   <span data-ttu-id="10c24-117">Bei einem Massenkopiervorgang in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] geben Sie den TABLOCK-Massenkopierhinweis an und legen eine große Batchgröße fest.</span><span class="sxs-lookup"><span data-stu-id="10c24-117">When bulk copying to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], specify the TABLOCK bulk copy hint and set a large batch size.</span></span>  
  
-   <span data-ttu-id="10c24-118">Wenn TABLOCK nicht angegeben wird, beschränken Sie Batchgrößen auf unter 1.000 Zeilen.</span><span class="sxs-lookup"><span data-stu-id="10c24-118">When TABLOCK is not specified, limit batch sizes to less than 1,000 rows.</span></span>  
  
 <span data-ttu-id="10c24-119">Beim Massen kopieren aus einer Datendatei wird die Batch Größe durch Aufrufen von **bcp_control** mit der BCPBATCH-Option angegeben, bevor [bcp_exec](../native-client-odbc-extensions-bulk-copy-functions/bcp-exec.md)aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="10c24-119">When bulk copying in from a data file, the batch size is specified by calling **bcp_control** with the BCPBATCH option before calling [bcp_exec](../native-client-odbc-extensions-bulk-copy-functions/bcp-exec.md).</span></span> <span data-ttu-id="10c24-120">Beim Massen Kopieren von Programmvariablen mithilfe von [bcp_bind](../native-client-odbc-extensions-bulk-copy-functions/bcp-bind.md) und [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md)wird die Batch Größe durch Aufrufen von [bcp_batch](../native-client-odbc-extensions-bulk-copy-functions/bcp-batch.md) nach dem Aufrufen [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md) *x* -Mal gesteuert, wobei *x* die Anzahl der Zeilen in einem Batch ist.</span><span class="sxs-lookup"><span data-stu-id="10c24-120">When bulk copying from program variables using [bcp_bind](../native-client-odbc-extensions-bulk-copy-functions/bcp-bind.md) and [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md), the batch size is controlled by calling [bcp_batch](../native-client-odbc-extensions-bulk-copy-functions/bcp-batch.md) after calling [bcp_sendrow](../native-client-odbc-extensions-bulk-copy-functions/bcp-sendrow.md) *x* times, where *x* is the number of rows in a batch.</span></span>  
  
 <span data-ttu-id="10c24-121">Batches sind nicht nur für das Festlegen der Größe einer Transaktion relevant, sondern wirken sich auch auf den Zeitpunkt aus, an dem Zeilen über das Netzwerk an den Server gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="10c24-121">In addition to specifying the size of a transaction, batches also affect when rows are sent across the network to the server.</span></span> <span data-ttu-id="10c24-122">Massen Kopierfunktionen speichern die Zeilen in der Regel **bcp_sendrow** zwischen, bis ein Netzwerk Paket ausgefüllt ist, und senden das vollständige Paket an den Server.</span><span class="sxs-lookup"><span data-stu-id="10c24-122">Bulk copy functions normally cache the rows from **bcp_sendrow** until a network packet is filled, and then send the full packet to the server.</span></span> <span data-ttu-id="10c24-123">Wenn eine Anwendung **bcp_batch**aufruft, wird das aktuelle Paket jedoch unabhängig davon, ob es ausgefüllt wurde, an den Server gesendet.</span><span class="sxs-lookup"><span data-stu-id="10c24-123">When an application calls **bcp_batch**, however, the current packet is sent to the server regardless of whether it has been filled.</span></span> <span data-ttu-id="10c24-124">Eine sehr niedrige Batchgröße kann die Leistung herabsetzen, wenn dadurch viele teilweise aufgefüllte Pakete an den Server gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="10c24-124">Using a very low batch size can slow performance if it results in sending many partially filled packets to the server.</span></span> <span data-ttu-id="10c24-125">Wenn Sie z. b. nach jeder **bcp_sendrow** **bcp_batch** aufrufen, bewirkt dies, dass jede Zeile in einem separaten Paket gesendet wird. wenn die Zeilen sehr groß sind, verschwendet der Speicherplatz in jedem Paket.</span><span class="sxs-lookup"><span data-stu-id="10c24-125">For example, calling **bcp_batch** after every **bcp_sendrow** causes each row to be sent in a separate packet and, unless the rows are very large, wastes space in each packet.</span></span> <span data-ttu-id="10c24-126">Die Standardgröße von Netzwerk Paketen für SQL Server beträgt 4 KB, obwohl eine Anwendung die Größe durch Aufrufen von [SQLSetConnectAttr](../native-client-odbc-api/sqlsetconnectattr.md) , die das SQL_ATTR_PACKET_SIZE Attribut angibt, ändern kann.</span><span class="sxs-lookup"><span data-stu-id="10c24-126">The default size of network packets for SQL Server is 4 KB, although an application can change the size by calling [SQLSetConnectAttr](../native-client-odbc-api/sqlsetconnectattr.md) specifying the SQL_ATTR_PACKET_SIZE attribute.</span></span>  
  
 <span data-ttu-id="10c24-127">Ein weiterer Nebeneffekt von Batches besteht darin, dass jeder Batch als ausstehendes Resultset betrachtet wird, bis es mit **bcp_batch**abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="10c24-127">Another side effect of batches is that each batch is considered an outstanding result set until it is completed with **bcp_batch**.</span></span> <span data-ttu-id="10c24-128">Wenn bei einem Verbindungs Handle andere Vorgänge versucht werden, während ein Batch aussteht, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] gibt der Native Client-ODBC-Treiber einen Fehler mit SQLSTATE = "HY000" und der folgenden Fehlermeldungs Zeichenfolge aus:</span><span class="sxs-lookup"><span data-stu-id="10c24-128">If any other operations are attempted on a connection handle while a batch is outstanding, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client ODBC driver issues an error with SQLState = "HY000" and an error message string of:</span></span>  
  
```  
"[Microsoft][SQL Server Native Client] Connection is busy with  
results for another hstmt."  
```  
  
## <a name="see-also"></a><span data-ttu-id="10c24-129">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="10c24-129">See Also</span></span>  
 <span data-ttu-id="10c24-130">[Ausführen von Massen Kopier Vorgängen &#40;ODBC-&#41;](performing-bulk-copy-operations-odbc.md) </span><span class="sxs-lookup"><span data-stu-id="10c24-130">[Performing Bulk Copy Operations &#40;ODBC&#41;](performing-bulk-copy-operations-odbc.md) </span></span>  
 [<span data-ttu-id="10c24-131">Massenimport und -export von Daten &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="10c24-131">Bulk Import and Export of Data &#40;SQL Server&#41;</span></span>](../import-export/bulk-import-and-export-of-data-sql-server.md)  
  
  
