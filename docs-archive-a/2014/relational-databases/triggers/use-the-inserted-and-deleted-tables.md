---
title: Verwenden der Tabellen „inserted“ und „deleted“ | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- inserted tables
- UPDATE statement [SQL Server], DML triggers
- DELETE statement [SQL Server], DML triggers
- INSTEAD OF triggers
- deleted tables
- INSERT statement [SQL Server], DML triggers
- DML triggers, deleted or inserted tables
ms.assetid: ed84567f-7b91-4b44-b5b2-c400bda4590d
author: rothja
ms.author: jroth
ms.openlocfilehash: facc534177113bd93e56e50fca3ae14c3e6b2cfc
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87621912"
---
# <a name="use-the-inserted-and-deleted-tables"></a><span data-ttu-id="4e5d5-102">Verwenden der Tabellen inserted und deleted</span><span class="sxs-lookup"><span data-stu-id="4e5d5-102">Use the inserted and deleted Tables</span></span>
  <span data-ttu-id="4e5d5-103">DML-Triggeranweisungen verwenden zwei besondere Tabellen: die inserted-Tabelle und die deleted-Tabelle.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-103">DML trigger statements use two special tables: the deleted table and the inserted tables.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="4e5d5-104">erstellt und verwendet diese Tabellen automatisch.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-104">automatically creates and manages these tables.</span></span> <span data-ttu-id="4e5d5-105">Sie können diese temporären, speicherresidenten Tabellen verwenden, um die Auswirkungen bestimmter Datenänderungen zu testen und Bedingungen für DML-Triggeraktionen festzulegen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-105">You can use these temporary, memory-resident tables to test the effects of certain data modifications and to set conditions for DML trigger actions.</span></span> <span data-ttu-id="4e5d5-106">Das direkte Ändern der Daten in den Tabellen bzw. das Ausführen von Data Definition Language-(DDL-)Vorgängen für die Tabellen, beispielsweise CREATE INDEX, ist nicht möglich.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-106">You cannot directly modify the data in the tables or perform data definition language (DDL) operations on the tables, such as CREATE INDEX.</span></span>  
  
 <span data-ttu-id="4e5d5-107">In DML-Triggern werden die Tabellen inserted und deleted hauptsächlich für folgende Vorgänge verwendet:</span><span class="sxs-lookup"><span data-stu-id="4e5d5-107">In DML triggers, the inserted and deleted tables are primarily used to perform the following:</span></span>  
  
-   <span data-ttu-id="4e5d5-108">Erweitern der referenziellen Integrität zwischen Tabellen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-108">Extend referential integrity between tables.</span></span>  
  
-   <span data-ttu-id="4e5d5-109">Einfügen oder Aktualisieren von Daten in Basistabellen, die einer Sicht zugrunde liegen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-109">Insert or update data in base tables underlying a view.</span></span>  
  
-   <span data-ttu-id="4e5d5-110">Testen im Hinblick auf Fehler und Ausführen der entsprechenden Vorgänge.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-110">Test for errors and take action based on the error.</span></span>  
  
-   <span data-ttu-id="4e5d5-111">Ermitteln des Unterschieds zwischen dem Tabellenstatus vor und nach einer Datenänderung und Ausführen von Aktionen, die auf diesem Unterschied basieren</span><span class="sxs-lookup"><span data-stu-id="4e5d5-111">Find the difference between the state of a table before and after a data modification and take actions based on that difference.</span></span>  
  
 <span data-ttu-id="4e5d5-112">In der deleted-Tabelle werden Kopien der von DELETE- und UPDATE-Anweisungen betroffenen Zeilen gespeichert.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-112">The deleted table stores copies of the affected rows during DELETE and UPDATE statements.</span></span> <span data-ttu-id="4e5d5-113">Während der Ausführung einer DELETE- oder UPDATE-Anweisung werden Zeilen aus der Triggertabelle gelöscht und in die deleted-Tabelle übertragen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-113">During the execution of a DELETE or UPDATE statement, rows are deleted from the trigger table and transferred to the deleted table.</span></span> <span data-ttu-id="4e5d5-114">Die deleted-Tabelle und die Triggertabelle enthalten normalerweise nicht die gleichen Zeilen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-114">The deleted table and the trigger table ordinarily have no rows in common.</span></span>  
  
 <span data-ttu-id="4e5d5-115">In der inserted-Tabelle werden Kopien der durch INSERT- und UPDATE-Anweisungen betroffenen Zeilen gespeichert.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-115">The inserted table stores copies of the affected rows during INSERT and UPDATE statements.</span></span> <span data-ttu-id="4e5d5-116">Während einer Einfügungs- oder Updatetransaktion werden neue Zeilen sowohl der inserted-Tabelle als auch der Triggertabelle hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-116">During an insert or update transaction, new rows are added to both the inserted table and the trigger table.</span></span> <span data-ttu-id="4e5d5-117">Die Zeilen in der inserted-Tabelle sind Kopien der neuen Zeilen in der Triggertabelle.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-117">The rows in the inserted table are copies of the new rows in the trigger table.</span></span>  
  
 <span data-ttu-id="4e5d5-118">Eine Updatetransaktion entspricht einem Löschvorgang mit anschließender Einfügung; die alten Zeilen werden zunächst in die deleted-Tabelle kopiert, und anschließend werden die neuen Zeilen in die Triggertabelle und die inserted-Tabelle kopiert.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-118">An update transaction is similar to a delete operation followed by an insert operation; the old rows are copied to the deleted table first, and then the new rows are copied to the trigger table and to the inserted table.</span></span>  
  
 <span data-ttu-id="4e5d5-119">Wenn Sie Triggerbedingungen festlegen, sollten Sie die inserted- und die deleted-Tabelle entsprechend der Aktion verwenden, die den Trigger ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-119">When you set trigger conditions, use the inserted and deleted tables appropriately for the action that fired the trigger.</span></span> <span data-ttu-id="4e5d5-120">Es wird zwar kein Fehler ausgegeben, wenn Sie beim Testen einer INSERT-Anweisung auf die deleted-Tabelle oder beim Testen einer DELETE-Anweisung auf die inserted-Tabelle verweisen, diese Triggertesttabellen enthalten jedoch in diesen Fällen keine Zeilen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-120">Although referencing the deleted table when testing an INSERT or the inserted table when testing a DELETE does not cause any errors, these trigger test tables do not contain any rows in these cases.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="4e5d5-121">Wenn Triggeraktionen von der Anzahl der Zeilen abhängen, die von einer Datenänderung betroffen sind, sollten Sie Tests verwenden (z.B. die Untersuchung von @@ROWCOUNT), die mehrzeilige Datenänderungen (eine INSERT-, DELETE- oder UPDATE-Anweisung, die auf einer SELECT-Anweisung basiert) überprüfen und die entsprechenden Vorgänge ausführen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-121">If trigger actions depend on the number of rows a data modification effects, use tests (such as an examination of @@ROWCOUNT) for multirow data modifications (an INSERT, DELETE, or UPDATE based on a SELECT statement), and take appropriate actions.</span></span>  
  
 <span data-ttu-id="4e5d5-122">In [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] sind Spaltenverweise vom Typ `text`, `ntext` oder `image` in der inserted-Tabelle und der deleted-Tabelle für AFTER-Trigger nicht zulässig.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-122">[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] does not allow for `text`, `ntext`, or `image` column references in the inserted and deleted tables for AFTER triggers.</span></span> <span data-ttu-id="4e5d5-123">Diese Datentypen sind jedoch nur aus Gründen der Abwärtskompatibilität eingeschlossen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-123">However, these data types are included for backward compatibility purposes only.</span></span> <span data-ttu-id="4e5d5-124">Die bevorzugte Speichermethode für große Datenmengen ist die Verwendung der `varchar(max)`-, `nvarchar(max)`- und `varbinary(max)`-Datentypen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-124">The preferred storage for large data is to use the `varchar(max)`, `nvarchar(max)`, and `varbinary(max)` data types.</span></span> <span data-ttu-id="4e5d5-125">Sowohl AFTER- als auch INSTEAD OF-Trigger unterstützen `varchar(max)`-, `nvarchar(max)`- und `varbinary(max)`-Daten in den eingefügten und gelöschten Tabellen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-125">Both AFTER and INSTEAD OF triggers support `varchar(max)`, `nvarchar(max)`, and `varbinary(max)` data in the inserted and deleted tables.</span></span> <span data-ttu-id="4e5d5-126">Weitere Informationen finden Sie unter [CREATE TRIGGER &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-trigger-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="4e5d5-126">For more information, see [CREATE TRIGGER &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-trigger-transact-sql).</span></span>  
  
 <span data-ttu-id="4e5d5-127">**Beispiel für die Verwendung der inserted-Tabelle in einem Trigger zum Erzwingen einer Geschäftsregel**</span><span class="sxs-lookup"><span data-stu-id="4e5d5-127">**An Example of Using the inserted Table in a Trigger to Enforce Business Rules**</span></span>  
  
 <span data-ttu-id="4e5d5-128">Da sich CHECK-Einschränkungen nur auf Spalten beziehen können, für die die Einschränkung auf Spalten- oder Tabellenebene definiert wurde, müssen tabellenübergreifende Einschränkungen (in diesem Fall Geschäftsregeln) als Trigger definiert werden.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-128">Because CHECK constraints can reference only the columns on which the column-level or table-level constraint is defined, any cross-table constraints (in this case, business rules) must be defined as triggers.</span></span>  
  
 <span data-ttu-id="4e5d5-129">Im folgenden Beispiel wird ein DML-Trigger erstellt.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-129">The following example creates a DML trigger.</span></span> <span data-ttu-id="4e5d5-130">Der Trigger überprüft die Bonität eines Herstellers, wenn versucht wird, eine neue Bestellung in die `PurchaseOrderHeader` -Tabelle einzufügen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-130">This trigger checks to make sure the credit rating for the vendor is good when an attempt is made to insert a new purchase order into the `PurchaseOrderHeader` table.</span></span> <span data-ttu-id="4e5d5-131">Zum Ermitteln der Bonität des Herstellers im Zusammenhang mit der gerade eingefügten Bestellung muss auf die `Vendor` -Tabelle verwiesen und diese mit der inserted-Tabelle verknüpft werden.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-131">To obtain the credit rating of the vendor corresponding to the purchase order that was just inserted, the `Vendor` table must be referenced and joined with the inserted table.</span></span> <span data-ttu-id="4e5d5-132">Ist die Bonität zu niedrig, wird eine Meldung angezeigt, und die Bestellung wird nicht eingefügt.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-132">If the credit rating is too low, a message is displayed and the insertion does not execute.</span></span> <span data-ttu-id="4e5d5-133">Bitte beachten Sie, dass in diesem Beispiel multirow-Datenänderungen nicht berücksichtigt werden.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-133">Note that this example does not allow for multirow data modifications.</span></span> <span data-ttu-id="4e5d5-134">Weitere Informationen finden Sie unter [Erstellen von DML-Triggern für die Verarbeitung mehrerer Datenzeilen](../triggers/create-dml-triggers-to-handle-multiple-rows-of-data.md).</span><span class="sxs-lookup"><span data-stu-id="4e5d5-134">For more information, see [Create DML Triggers to Handle Multiple Rows of Data](../triggers/create-dml-triggers-to-handle-multiple-rows-of-data.md).</span></span>  
  
 [!code-sql[TriggerDDL#CreateTrigger3](../../snippets/tsql/SQL14/tsql/triggerddl/transact-sql/snippet_create_alter_drop_trigger.sql#createtrigger3)]  
  
## <a name="using-the-inserted-and-deleted-tables-in-instead-of-triggers"></a><span data-ttu-id="4e5d5-135">Verwenden der inserted- und deleted-Tabellen in INSTEAD OF-Triggern</span><span class="sxs-lookup"><span data-stu-id="4e5d5-135">Using the inserted and deleted Tables in INSTEAD OF Triggers</span></span>  
 <span data-ttu-id="4e5d5-136">Für die inserted- und deleted-Tabellen, die an für Tabellen definierte INSTEAD OF-Trigger übergeben werden, gelten dieselben Regeln wie für die inserted- und deleted-Tabellen, die an AFTER-Trigger übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-136">The inserted and deleted tables passed to INSTEAD OF triggers defined on tables follow the same rules as the inserted and deleted tables passed to AFTER triggers.</span></span> <span data-ttu-id="4e5d5-137">Das Format der inserted- und deleted-Tabellen ist mit dem Format der Tabelle identisch, für die der INSTEAD OF-Trigger definiert wurde.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-137">The format of the inserted and deleted tables is the same as the format of the table on which the INSTEAD OF trigger is defined.</span></span> <span data-ttu-id="4e5d5-138">Jede Spalte in den inserted- und deleted-Tabellen ist direkt einer Spalte in der Basistabelle zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-138">Each column in the inserted and deleted tables maps directly to a column in the base table.</span></span>  
  
 <span data-ttu-id="4e5d5-139">Für die Frage, wann eine INSERT- oder UPDATE-Anweisung, die auf eine Tabelle mit einem INSTEAD OF-Trigger verweist, Werte für Spalten angeben muss, gelten dieselben Regeln, wie wenn in der Tabelle kein INSTEAD OF-Trigger vorhanden wäre:</span><span class="sxs-lookup"><span data-stu-id="4e5d5-139">The following rules regarding when an INSERT or UPDATE statement referencing a table with an INSTEAD OF trigger must supply values for columns are the same as if the table did not have an INSTEAD OF trigger:</span></span>  
  
-   <span data-ttu-id="4e5d5-140">Für berechnete Spalten oder Spalten mit einem `timestamp`-Datentyp können keine Werte angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-140">Values cannot be specified for computed columns or columns with a `timestamp` data type.</span></span>  
  
-   <span data-ttu-id="4e5d5-141">Für Spalten mit einer IDENTITY-Eigenschaft können nur Werte angegeben werden, wenn IDENTITY_INSERT für diese Tabelle auf ON festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-141">Values cannot be specified for columns with an IDENTITY property, unless IDENTITY_INSERT is ON for that table.</span></span> <span data-ttu-id="4e5d5-142">Wenn IDENTITY_INSERT auf ON festgelegt ist, müssen INSERT-Anweisungen einen Wert angeben.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-142">When IDENTITY_INSERT is ON, INSERT statements must supply a value.</span></span>  
  
-   <span data-ttu-id="4e5d5-143">INSERT-Anweisungen müssen Werte für alle NOT NULL-Spalten angeben, die keine DEFAULT-Einschränkungen aufweisen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-143">INSERT statements must supply values for all NOT NULL columns that do not have DEFAULT constraints.</span></span>  
  
-   <span data-ttu-id="4e5d5-144">Außer in berechneten Spalten, Identitätsspalten oder `timestamp`-Spalten sind Werte für alle Spalten, die NULL-Werte zulassen, oder für alle NOT NULL-Spalten optional, die eine DEFAULT-Definition aufweisen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-144">For any columns except computed, identity, or `timestamp` columns, values are optional for any column that allows nulls, or any NOT NULL column that has a DEFAULT definition.</span></span>  
  
 <span data-ttu-id="4e5d5-145">Wenn eine INSERT-, UPDATE- oder DELETE-Anweisung auf eine Sicht verweist, die einen INSTEAD OF-Trigger aufweist, ruft [!INCLUDE[ssDE](../../includes/ssde-md.md)] den Trigger auf, anstatt direkte Aktionen für Tabellen auszuführen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-145">When an INSERT, UPDATE, or DELETE statement references a view that has an INSTEAD OF trigger, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] calls the trigger instead of taking any direct action against any table.</span></span> <span data-ttu-id="4e5d5-146">Der Trigger muss anhand der in den inserted- und deleted-Tabellen dargestellten Informationen Anweisungen erstellen, die zum Implementieren der angeforderten Aktion in den Basistabellen erforderlich sind, selbst wenn das Format der für die Sicht erstellten Informationen in den inserted- und deleted-Tabellen nicht mit dem Format der Daten in den Basistabellen identisch ist.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-146">The trigger must use the information presented in the inserted and deleted tables to build any statements required to implement the requested action in the base tables, even when the format of the information in the inserted and deleted tables built for the view is different from the format of the data in the base tables.</span></span>  
  
 <span data-ttu-id="4e5d5-147">Das Format der inserted- und deleted-Tabellen, das an einen in einer Sicht definierten INSTEAD OF-Trigger übergeben wird, stimmt mit der Auswahlliste der SELECT-Anweisung überein, die für die Sicht definiert wurde.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-147">The format of the inserted and deleted tables passed to an INSTEAD OF trigger defined on a view matches the select list of the SELECT statement defined for the view.</span></span> <span data-ttu-id="4e5d5-148">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="4e5d5-148">For example:</span></span>  
  
```  
USE AdventureWorks2012;  
GO  
CREATE VIEW dbo.EmployeeNames (BusinessEntityID, LName, FName)  
AS  
SELECT e.BusinessEntityID, p.LastName, p.FirstName  
FROM HumanResources.Employee AS e   
JOIN Person.Person AS p  
ON e.BusinessEntityID = p.BusinessEntityID;  
```  
  
 <span data-ttu-id="4e5d5-149">Das Resultset für diese Sicht weist drei Spalten auf: eine `int`-Spalte und zwei `nvarchar`-Spalten.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-149">The result set for this view has three columns: an `int` column and two `nvarchar` columns.</span></span> <span data-ttu-id="4e5d5-150">Die inserted-Tabelle und die deleted-Tabelle, die an einen für die Sicht definierten INSTEAD OF-Trigger übergeben werden, enthalten ebenfalls eine `int`-Spalte mit der Bezeichnung `BusinessEntityID`, eine `nvarchar`-Spalte mit der Bezeichnung `LName` und eine `nvarchar`-Spalte mit der Bezeichnung `FName`.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-150">The inserted and deleted tables passed to an INSTEAD OF trigger defined on the view also have an `int` column named `BusinessEntityID`, an `nvarchar` column named `LName`, and an `nvarchar` column named `FName`.</span></span>  
  
 <span data-ttu-id="4e5d5-151">Die Auswahlliste einer Sicht kann auch Ausdrücke aufweisen, die nicht direkt einer einzigen Basistabellenspalte zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-151">The select list of a view can also contain expressions that do not directly map to a single base-table column.</span></span> <span data-ttu-id="4e5d5-152">Einige Sichtausdrücke, z. B. Konstanten- oder Funktionsaufrufe, verweisen möglicherweise nicht auf Spalten und können deshalb ignoriert werden.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-152">Some view expressions, such as a constant or function invocation, may not reference any columns and can be ignored.</span></span> <span data-ttu-id="4e5d5-153">Komplexe Ausdrücke können auf mehrere Spalten verweisen, aber die inserted- und deleted-Tabellen enthalten für jede eingefügte Zeile nur einen einzigen Wert.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-153">Complex expressions can reference multiple columns, yet the inserted and deleted tables have only one value for each inserted row.</span></span> <span data-ttu-id="4e5d5-154">Dasselbe gilt für einfache Ausdrücke in einer Sicht, wenn sie auf eine berechnete Spalte mit einem komplexen Ausdruck verweisen.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-154">The same issues apply to simple expressions in a view if they reference a computed column that has a complex expression.</span></span> <span data-ttu-id="4e5d5-155">Ein INSTEAD OF-Trigger in der Sicht muss diese Ausdruckstypen verarbeiten.</span><span class="sxs-lookup"><span data-stu-id="4e5d5-155">An INSTEAD OF trigger on the view must handle these types of expressions.</span></span>  
  
  
