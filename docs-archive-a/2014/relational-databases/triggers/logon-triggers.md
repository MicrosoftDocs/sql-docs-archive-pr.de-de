---
title: Logon-Trigger | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
f1_keywords:
- logon triggers
- login triggers
helpviewer_keywords:
- triggers [SQL Server], logon
ms.assetid: 2f0ebb2f-de10-482d-9806-1a5de5b312b8
author: rothja
ms.author: jroth
ms.openlocfilehash: cda0be25f07ed2ee283b9707884041e7c6e4692f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87621918"
---
# <a name="logon-triggers"></a><span data-ttu-id="fa58b-102">Logon-Trigger</span><span class="sxs-lookup"><span data-stu-id="fa58b-102">Logon Triggers</span></span>
  <span data-ttu-id="fa58b-103">Logon-Trigger lösen gespeicherte Prozeduren als Antwort auf ein LOGON-Ereignis aus.</span><span class="sxs-lookup"><span data-stu-id="fa58b-103">Logon triggers fire stored procedures in response to a LOGON event.</span></span> <span data-ttu-id="fa58b-104">Dieses Ereignis wird ausgelöst, wenn eine Benutzersitzung mit einer Instanz von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="fa58b-104">This event is raised when a user session is established with an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="fa58b-105">Logon-Trigger werden ausgelöst, nachdem die Authentifizierungsphase der Anmeldung abgeschlossen ist und bevor die Benutzersitzung erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="fa58b-105">Logon triggers fire after the authentication phase of logging in finishes, but before the user session is actually established.</span></span> <span data-ttu-id="fa58b-106">Aus diesem Grund werden alle Meldungen, die aus dem Trigger stammen und normalerweise den Benutzer erreichen (z. B. Fehlermeldungen und Meldungen aus der PRINT-Anweisung) zum [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Fehlerprotokoll umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="fa58b-106">Therefore, all messages originating inside the trigger that would typically reach the user, such as error messages and messages from the PRINT statement, are diverted to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span> <span data-ttu-id="fa58b-107">Logon-Trigger werden nicht ausgelöst, wenn die Authentifizierung nicht ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="fa58b-107">Logon triggers do not fire if authentication fails.</span></span>  
  
 <span data-ttu-id="fa58b-108">Sie können Logon-Trigger zum Überwachen und Steuern von Serversitzungen verwenden, beispielsweise durch Nachverfolgung der Anmeldeaktivität, Einschränkung von Anmeldungen auf [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]oder durch Einschränkung der Anzahl der Sitzungen für einen bestimmten Anmeldenamen.</span><span class="sxs-lookup"><span data-stu-id="fa58b-108">You can use logon triggers to audit and control server sessions, such as by tracking login activity, restricting logins to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], or limiting the number of sessions for a specific login.</span></span> <span data-ttu-id="fa58b-109">Beispielsweise werden im folgenden Code durch den Logon-Trigger Anmeldeversuche für [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] abgelehnt, die mit dem Anmeldenamen *login_test* initiiert werden, wenn mit diesem Anmeldenamen bereits drei Benutzersitzungen erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="fa58b-109">For example, in the following code, the logon trigger denies log in attempts to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] initiated by login *login_test* if there are already three user sessions created by that login.</span></span>  
  
 [!code-sql[TriggerDDL#LogonTrigger1](../../snippets/tsql/SQL14/tsql/triggerddl/transact-sql/snippet_create_alter_drop_trigger.sql#logontrigger1)]  
  
 <span data-ttu-id="fa58b-110">Beachten Sie, dass das LOGON-Ereignis dem AUDIT_LOGIN SQL-Ablaufverfolgungsereignis entspricht, das in [Ereignisbenachrichtigungen](../service-broker/event-notifications.md)verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="fa58b-110">Note that the LOGON event corresponds to the AUDIT_LOGIN SQL Trace event, which can be used in [Event Notifications](../service-broker/event-notifications.md).</span></span> <span data-ttu-id="fa58b-111">Der Hauptunterschied zwischen Triggern und Ereignisbenachrichtigungen besteht darin, dass Trigger synchron mit Ereignissen ausgelöst werden und Ereignisbenachrichtigungen sich asynchron verhalten.</span><span class="sxs-lookup"><span data-stu-id="fa58b-111">The primary difference between triggers and event notifications is that triggers are raised synchronously with events, whereas event notifications are asynchronous.</span></span> <span data-ttu-id="fa58b-112">Dies bedeutet beispielsweise, dass Sie einen Logon-Trigger verwenden müssen, wenn Sie das Erstellen einer Sitzung abbrechen möchten.</span><span class="sxs-lookup"><span data-stu-id="fa58b-112">This means, for example, that if you want to stop a session from being established, you must use a logon trigger.</span></span> <span data-ttu-id="fa58b-113">Eine Ereignisbenachrichtigung für ein AUDIT_LOGIN-Ereignis kann nicht für diesen Zweck verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="fa58b-113">An event notification on an AUDIT_LOGIN event cannot be used for this purpose.</span></span>  
  
## <a name="specifying-first-and-last-trigger"></a><span data-ttu-id="fa58b-114">Angeben des ersten und des letzten Triggers</span><span class="sxs-lookup"><span data-stu-id="fa58b-114">Specifying First and Last Trigger</span></span>  
 <span data-ttu-id="fa58b-115">Für das LOGON-Ereignis können mehrere Trigger definiert werden.</span><span class="sxs-lookup"><span data-stu-id="fa58b-115">Multiple triggers can be defined on the LOGON event.</span></span> <span data-ttu-id="fa58b-116">Jeder dieser Trigger kann als zuerst oder zuletzt für ein Ereignis ausgelöster Trigger festgelegt werden. Hierfür wird die gespeicherte Systemprozedur [sp_settriggerorder](/sql/relational-databases/system-stored-procedures/sp-settriggerorder-transact-sql) verwendet.</span><span class="sxs-lookup"><span data-stu-id="fa58b-116">Any one of these triggers can be designated the first or last trigger to be fired on an event by using the [sp_settriggerorder](/sql/relational-databases/system-stored-procedures/sp-settriggerorder-transact-sql) system stored procedure.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="fa58b-117">gibt es keine Garantie für die Ausführungsreihenfolge der restlichen Trigger.</span><span class="sxs-lookup"><span data-stu-id="fa58b-117">does not guarantee the execution order of the remaining triggers.</span></span>  
  
## <a name="managing-transactions"></a><span data-ttu-id="fa58b-118">Verwalten von Transaktionen</span><span class="sxs-lookup"><span data-stu-id="fa58b-118">Managing Transactions</span></span>  
 <span data-ttu-id="fa58b-119">Bevor in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ein Logon-Trigger ausgelöst wird, wird in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] eine implizite Transaktion erstellt, die von keiner Benutzertransaktion abhängig ist.</span><span class="sxs-lookup"><span data-stu-id="fa58b-119">Before [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] fires a logon trigger, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] creates an implicit transaction that is independent from any user transaction.</span></span> <span data-ttu-id="fa58b-120">Aus diesem Grund lautet die Transaktionsanzahl 1, wenn der erste Logon-Trigger ausgelöst wird.</span><span class="sxs-lookup"><span data-stu-id="fa58b-120">Therefore, when the first logon trigger starts firing, the transaction count is 1.</span></span> <span data-ttu-id="fa58b-121">Nachdem alle Logon-Trigger ausgeführt wurden, wird ein Commit für die Transaktion ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="fa58b-121">After all the logon triggers finish executing, the transaction commits.</span></span> <span data-ttu-id="fa58b-122">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] wird wie bei anderen Arten von Triggern auch ein Fehler zurückgegeben, wenn die Ausführung eines Logon-Triggers mit der Transaktionsanzahl 0 abgeschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="fa58b-122">As with other types of triggers, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] returns an error if a logon trigger finishes execution with a transaction count of 0.</span></span> <span data-ttu-id="fa58b-123">Mit der ROLLBACK TRANSACTION-Anweisung wird die Transaktionsanzahl auch dann auf 0 zurückgesetzt, wenn die Anweisung in einer geschachtelten Transaktion ausgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="fa58b-123">The ROLLBACK TRANSACTION statement resets the transaction count to 0, even if the statement is issued inside a nested transaction.</span></span> <span data-ttu-id="fa58b-124">Mit COMMIT TRANSACTION kann die Transaktionsanzahl auf 0 verringert werden.</span><span class="sxs-lookup"><span data-stu-id="fa58b-124">COMMIT TRANSACTION might decrement the transaction count to 0.</span></span> <span data-ttu-id="fa58b-125">Aus diesem Grund empfiehlt es sich nicht, COMMIT TRANSACTION-Anweisungen in Logon-Triggern auszugeben.</span><span class="sxs-lookup"><span data-stu-id="fa58b-125">Therefore, we advise against issuing COMMIT TRANSACTION statements inside logon triggers.</span></span>  
  
 <span data-ttu-id="fa58b-126">Bedenken Sie folgende Punkte, wenn Sie eine ROLLBACK TRANSACTION-Anweisung in Logon-Triggern verwenden:</span><span class="sxs-lookup"><span data-stu-id="fa58b-126">Consider the following when you are using a ROLLBACK TRANSACTION statement inside logon triggers:</span></span>  
  
-   <span data-ttu-id="fa58b-127">Für alle Datenänderungen, die bis zum Zeitpunkt von ROLLBACK TRANSACTION vorgenommen werden, wird ein Rollback ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="fa58b-127">Any data modifications made up to the point of ROLLBACK TRANSACTION are rolled back.</span></span> <span data-ttu-id="fa58b-128">Zu diesen Änderungen zählen die durch den aktuellen Trigger vorgenommenen Änderungen sowie die durch vorherige Trigger erfolgten Änderungen, die für das gleiche Ereignis ausgeführt wurden.</span><span class="sxs-lookup"><span data-stu-id="fa58b-128">These modifications include those made by the current trigger and those made by previous triggers that executed on the same event.</span></span> <span data-ttu-id="fa58b-129">Die restlichen Trigger für dieses bestimmte Ereignis werden nicht ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="fa58b-129">Any remaining triggers for the specific event are not executed.</span></span>  
  
-   <span data-ttu-id="fa58b-130">Durch den aktuellen Trigger werden weiterhin alle restlichen Anweisungen ausgeführt, die nach der ROLLBACK-Anweisung auftreten.</span><span class="sxs-lookup"><span data-stu-id="fa58b-130">The current trigger continues to execute any remaining statements that appear after the ROLLBACK statement.</span></span> <span data-ttu-id="fa58b-131">Wenn durch eine dieser Anweisungen Daten geändert werden, wird für die Änderungen kein Rollback ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="fa58b-131">If any of these statements modify data, the modifications are not rolled back.</span></span>  
  
 <span data-ttu-id="fa58b-132">Es wird keine Benutzersitzung erstellt, wenn eine der folgenden Bedingungen während der Ausführung eines Triggers für ein LOGON-Ereignis auftritt:</span><span class="sxs-lookup"><span data-stu-id="fa58b-132">A user session is not established if any one of the following conditions occur during execution of a trigger on a LOGON event:</span></span>  
  
-   <span data-ttu-id="fa58b-133">Für die ursprüngliche implizite Transaktion treten Rollbacks oder Fehler auf.</span><span class="sxs-lookup"><span data-stu-id="fa58b-133">The original implicit transaction is rolled back or fails.</span></span>  
  
-   <span data-ttu-id="fa58b-134">Ein Fehler mit einem Schweregrad über 20 wird im Triggertext ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="fa58b-134">An error that has severity greater than 20 is raised inside the trigger body.</span></span>  
  
## <a name="disabling-a-logon-trigger"></a><span data-ttu-id="fa58b-135">Deaktivieren eines Logon-Triggers</span><span class="sxs-lookup"><span data-stu-id="fa58b-135">Disabling a Logon Trigger</span></span>  
 <span data-ttu-id="fa58b-136">Ein Logon-Trigger kann effektiv erfolgreiche Verbindungen zu [!INCLUDE[ssDE](../../../includes/ssde-md.md)] für alle Benutzer verhindern, einschließlich Elementen der festen Serverrolle `sysadmin`.</span><span class="sxs-lookup"><span data-stu-id="fa58b-136">A logon trigger can effectively prevent successful connections to the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] for all users, including members of the `sysadmin` fixed server role.</span></span> <span data-ttu-id="fa58b-137">Wenn ein LOGON-Trigger Verbindungen verhindert, können die Mitglieder der festen Serverrolle `sysadmin` über die dedizierte Administratorverbindung eine Verbindung herstellen oder durch Starten des [!INCLUDE[ssDE](../../../includes/ssde-md.md)]s im minimalen Konfigurationsmodus (-f).</span><span class="sxs-lookup"><span data-stu-id="fa58b-137">When a logon trigger is preventing connections, members of the `sysadmin` fixed server role can connect by using the dedicated administrator connection, or by starting the [!INCLUDE[ssDE](../../../includes/ssde-md.md)] in minimal configuration mode (-f).</span></span> <span data-ttu-id="fa58b-138">Weitere Informationen finden Sie unter [Startoptionen für den Datenbank-Engine-Dienst](../../database-engine/configure-windows/database-engine-service-startup-options.md).</span><span class="sxs-lookup"><span data-stu-id="fa58b-138">For more information, see [Database Engine Service Startup Options](../../database-engine/configure-windows/database-engine-service-startup-options.md).</span></span>  
  
## <a name="related-tasks"></a><span data-ttu-id="fa58b-139">Related Tasks</span><span class="sxs-lookup"><span data-stu-id="fa58b-139">Related Tasks</span></span>  
  
|<span data-ttu-id="fa58b-140">Aufgabe</span><span class="sxs-lookup"><span data-stu-id="fa58b-140">Task</span></span>|<span data-ttu-id="fa58b-141">Thema</span><span class="sxs-lookup"><span data-stu-id="fa58b-141">Topic</span></span>|  
|----------|-----------|  
|<span data-ttu-id="fa58b-142">Beschreibt, wie Logon-Trigger erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="fa58b-142">Describes how to create logon triggers.</span></span> <span data-ttu-id="fa58b-143">Logon-Trigger können anhand einer beliebigen Datenbank erstellt werden, sie werden jedoch auf der Serverebene registriert und befinden sich in der **master** -Datenbank.</span><span class="sxs-lookup"><span data-stu-id="fa58b-143">Logon triggers can be created from any database, but are registered at the server level and reside in the **master** database.</span></span>|[<span data-ttu-id="fa58b-144">CREATE TRIGGER &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="fa58b-144">CREATE TRIGGER &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/create-trigger-transact-sql)|  
|<span data-ttu-id="fa58b-145">Beschreibt, wie Logon-Trigger geändert werden.</span><span class="sxs-lookup"><span data-stu-id="fa58b-145">Describes how to modify logon triggers.</span></span>|[<span data-ttu-id="fa58b-146">ALTER TRIGGER &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="fa58b-146">ALTER TRIGGER &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-trigger-transact-sql)|  
|<span data-ttu-id="fa58b-147">Beschreibt, wie Logon-Trigger gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="fa58b-147">Describes how to delete logon triggers.</span></span>|[<span data-ttu-id="fa58b-148">DROP TRIGGER &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="fa58b-148">DROP TRIGGER &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/drop-trigger-transact-sql)|  
|<span data-ttu-id="fa58b-149">Beschreibt, wie Informationen zu Logon-Triggern zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="fa58b-149">Describes how to return information about logon triggers.</span></span>|[<span data-ttu-id="fa58b-150">sys.server_triggers &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="fa58b-150">sys.server_triggers &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-server-triggers-transact-sql)<br /><br /> [<span data-ttu-id="fa58b-151">sys.server_trigger_events &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="fa58b-151">sys.server_trigger_events &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-catalog-views/sys-server-trigger-events-transact-sql)|  
|<span data-ttu-id="fa58b-152">Beschreibt, wie Ereignisdaten zu Logon-Triggern aufgezeichnet werden.</span><span class="sxs-lookup"><span data-stu-id="fa58b-152">Describes how to capture logon trigger event data.</span></span>||  
  
## <a name="see-also"></a><span data-ttu-id="fa58b-153">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="fa58b-153">See Also</span></span>  
 [<span data-ttu-id="fa58b-154">DDL-Trigger</span><span class="sxs-lookup"><span data-stu-id="fa58b-154">DDL Triggers</span></span>](../triggers/ddl-triggers.md)  
  
  
