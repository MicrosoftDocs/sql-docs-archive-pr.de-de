---
title: Arbeiten mit Abfrage Benachrichtigungen | Microsoft-Dokumentation
ms.custom: ''
ms.date: 04/27/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- data access [SQL Server Native Client], query notifications
- rowsets [SQL Server], notifications
- SQL Server Native Client, query notifications
- notifications [SQL Server Native Client]
- query notifications [SQL Server], SQL Server Native Client
- canceling rowset changes
- IRowsetNotify interface
- SQLNCLI, query notifications
- SQL Server Native Client OLE DB provider, query notifications
- consumer notification for rowset changes [SQL Server Native Client]
ms.assetid: 2f906fff-5ed9-4527-9fd3-9c0d27c3dff7
author: rothja
ms.author: jroth
ms.openlocfilehash: ba30bfc8df05a55e297ae8fcb8e2253de57e3ca6
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87620309"
---
# <a name="working-with-query-notifications"></a><span data-ttu-id="d48b3-102">Arbeiten mit Abfragebenachrichtigungen</span><span class="sxs-lookup"><span data-stu-id="d48b3-102">Working with Query Notifications</span></span>
  <span data-ttu-id="d48b3-103">Abfragebenachrichtigungen wurden in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] und [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client eingeführt.</span><span class="sxs-lookup"><span data-stu-id="d48b3-103">Query notifications were introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] and [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client.</span></span> <span data-ttu-id="d48b3-104">Mit Abfragebenachrichtigungen, die auf der in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] eingeführten Service Broker-Infrastruktur aufsetzen, können Anwendungen benachrichtigt werden, wenn sich Daten geändert haben.</span><span class="sxs-lookup"><span data-stu-id="d48b3-104">Built upon the Service Broker infrastructure introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], query notifications allow applications to be notified when data has changed.</span></span> <span data-ttu-id="d48b3-105">Diese Funktion ist besonders nützlich für Anwendungen, die einen Informationscache aus einer Datenbank zur Verfügung stellen, z. B. eine Webanwendung, und die benachrichtigt werden müssen, wenn die Quelldaten geändert wurden.</span><span class="sxs-lookup"><span data-stu-id="d48b3-105">This feature is particularly useful for applications that provide a cache of information from a database, such as a Web application, and need to be notified when the source data is changed.</span></span>  
  
 <span data-ttu-id="d48b3-106">Mit Abfragebenachrichtigungen können Sie eine Benachrichtigung innerhalb eines festgelegten Timeoutzeitraums anfordern, wenn sich die einer Abfrage zugrunde liegenden Daten ändern.</span><span class="sxs-lookup"><span data-stu-id="d48b3-106">Query notifications allow you to request notification within a specified time-out period when the underlying data of a query changes.</span></span> <span data-ttu-id="d48b3-107">Die Anforderung für die Benachrichtigung gibt die Benachrichtigungsoptionen an. Dazu gehören der Dienstname, der Meldungstext und der Timeoutwert für den Server.</span><span class="sxs-lookup"><span data-stu-id="d48b3-107">The request for notification specifies the notification options, which include the service name, message text, and time-out value to the server.</span></span> <span data-ttu-id="d48b3-108">Benachrichtigungen werden durch eine Service Broker-Warteschlange übermittelt, von der Anwendungen verfügbare Benachrichtigungen abrufen können.</span><span class="sxs-lookup"><span data-stu-id="d48b3-108">Notifications are delivered through a Service Broker queue that applications may poll for available notifications.</span></span>  
  
 <span data-ttu-id="d48b3-109">Die Syntax der Zeichenfolge für die Abfragebenachrichtigungsoptionen lautet:</span><span class="sxs-lookup"><span data-stu-id="d48b3-109">The syntax of the query notifications options string is:</span></span>  
  
 `service=<service-name>[;(local database=<database> | broker instance=<broker instance>)]`  
  
 <span data-ttu-id="d48b3-110">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="d48b3-110">For example:</span></span>  
  
 `service=mySSBService;local database=mydb`  
  
 <span data-ttu-id="d48b3-111">Benachrichtigungsabonnements überdauern den Prozess, mit dem sie initiiert wurden, da eine Anwendung ein Benachrichtigungsabonnement erstellen und anschließend beendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="d48b3-111">Notification subscriptions outlive the process that initiates them, as an application may create a notification subscription and then terminate.</span></span> <span data-ttu-id="d48b3-112">Das Abonnement bleibt gültig, und die Benachrichtigung wird gesendet, wenn die Daten innerhalb des während der Erstellung des Abonnements angegebenen Timeoutzeitraums geändert werden.</span><span class="sxs-lookup"><span data-stu-id="d48b3-112">The subscription remains valid, and the notification will occur if the data changes within the time-out period specified when the subscription was created.</span></span> <span data-ttu-id="d48b3-113">Eine Benachrichtigung wird durch die ausgeführte Abfrage, die Benachrichtigungsoptionen und den Meldungstext identifiziert und wird möglicherweise abgebrochen, wenn der Timeoutwert auf NULL festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="d48b3-113">A notification is identified by the query executed, the notification options, and the message text, and may be cancelled by setting its time-out value to zero.</span></span>  
  
 <span data-ttu-id="d48b3-114">Benachrichtigungen werden nur einmal gesendet.</span><span class="sxs-lookup"><span data-stu-id="d48b3-114">Notifications are sent only once.</span></span> <span data-ttu-id="d48b3-115">Für die kontinuierliche Benachrichtigung bei Datenänderungen müssen Sie ein neues Abonnement erstellen, indem Sie die Abfrage nach der Verarbeitung jeder Benachrichtigung erneut ausführen.</span><span class="sxs-lookup"><span data-stu-id="d48b3-115">For continuous notification of data change, a new subscription must be created by re-executing the query after each notification is processed.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="d48b3-116">Native Client Anwendungen erhalten in der Regel Benachrichtigungen, indem Sie den [!INCLUDE[tsql](../../../includes/tsql-md.md)] [Receive](/sql/t-sql/statements/receive-transact-sql) -Befehl verwenden, um Benachrichtigungen aus der Warteschlange zu lesen, die dem in den Benachrichtigungs Optionen angegebenen Dienst zugeordnet</span><span class="sxs-lookup"><span data-stu-id="d48b3-116">Native Client applications typically receive notifications by using the [!INCLUDE[tsql](../../../includes/tsql-md.md)] [RECEIVE](/sql/t-sql/statements/receive-transact-sql) command to read notifications from the queue associated with the service specified in the notification options.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d48b3-117">Tabellennamen müssen in Abfragen qualifiziert werden, für die Benachrichtigungen erforderlich sind, z. B. `dbo.myTable`.</span><span class="sxs-lookup"><span data-stu-id="d48b3-117">Table names must be qualified in queries for which notification is required, for example, `dbo.myTable`.</span></span> <span data-ttu-id="d48b3-118">Tabellennamen müssen mit zwei Teilnamen qualifiziert werden.</span><span class="sxs-lookup"><span data-stu-id="d48b3-118">Table names must be qualified with two part names.</span></span> <span data-ttu-id="d48b3-119">Das Abonnement ist ungültig, wenn drei oder vier Teilnamen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="d48b3-119">Subscription is invalid if three- or four-part names are used.</span></span>  
  
 <span data-ttu-id="d48b3-120">Die Benachrichtigungsinfrastruktur setzt auf einer in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] eingeführten Queuing-Funktion auf.</span><span class="sxs-lookup"><span data-stu-id="d48b3-120">The notification infrastructure is built on top of a queuing feature introduced in [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="d48b3-121">Im Allgemeinen werden auf dem Server generierte Benachrichtigungen durch diese Warteschlangen gesendet, um später verarbeitet zu werden.</span><span class="sxs-lookup"><span data-stu-id="d48b3-121">In general, notifications generated at the server are sent through these queues to be processed later.</span></span>  
  
 <span data-ttu-id="d48b3-122">Für die Verwendung von Abfragebenachrichtigungen ist eine Warteschlange und ein Dienst auf dem Server erforderlich.</span><span class="sxs-lookup"><span data-stu-id="d48b3-122">To use query notifications a queue and a service must exist on the server.</span></span> <span data-ttu-id="d48b3-123">Diese können mit [!INCLUDE[tsql](../../../includes/tsql-md.md)] erstellt werden, wie in folgendem Beispiel veranschaulicht:</span><span class="sxs-lookup"><span data-stu-id="d48b3-123">These can be created using [!INCLUDE[tsql](../../../includes/tsql-md.md)] similar to the following:</span></span>  
  
```  
CREATE QUEUE myQueue  
CREATE SERVICE myService ON QUEUE myQueue   
  
([https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification])  
```  
  
> [!NOTE]  
>  <span data-ttu-id="d48b3-124">Der Dienst muss den vordefinierten Vertrag `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification` verwenden wie oben dargestellt.</span><span class="sxs-lookup"><span data-stu-id="d48b3-124">The service must use the predefined contract `https://schemas.microsoft.com/SQL/Notifications/PostQueryNotification` as shown above.</span></span>  
  
## <a name="sql-server-native-client-ole-db-provider"></a><span data-ttu-id="d48b3-125">SQL Server Native Client OLE DB-Anbieter</span><span class="sxs-lookup"><span data-stu-id="d48b3-125">SQL Server Native Client OLE DB Provider</span></span>  
 <span data-ttu-id="d48b3-126">Der [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB-Anbieter unterstützt Consumer-Benachrichtigungen bei der Änderung von Rowsets.</span><span class="sxs-lookup"><span data-stu-id="d48b3-126">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider supports consumer notification on rowset modification.</span></span> <span data-ttu-id="d48b3-127">Der Consumer erhält in jeder Phase der Rowsetänderung und bei jeder versuchten Änderung eine Benachrichtigung.</span><span class="sxs-lookup"><span data-stu-id="d48b3-127">The consumer receives notification at every phase of rowset modification and on any attempted change.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d48b3-128">Das übergeben einer Benachrichtigungs Abfrage an den Server mit **ICommand:: Execute** ist die einzige gültige Methode zum Abonnieren von Abfrage Benachrichtigungen mit dem [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB-Anbieter.</span><span class="sxs-lookup"><span data-stu-id="d48b3-128">Passing a notifications query to the server with **ICommand::Execute** is the only valid way to subscribe to query notifications with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client OLE DB provider.</span></span>  
  
### <a name="the-dbpropset_sqlserverrowset-property-set"></a><span data-ttu-id="d48b3-129">Die DBPROPSET_SQLSERVERROWSET-Eigenschaftsgruppe</span><span class="sxs-lookup"><span data-stu-id="d48b3-129">The DBPROPSET_SQLSERVERROWSET Property Set</span></span>  
 <span data-ttu-id="d48b3-130">Um Abfrage Benachrichtigungen über OLE DB zu unterstützen, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] fügt Native Client die folgenden neuen Eigenschaften der DBPROPSET_SQLSERVERROWSET-Eigenschaften Gruppe hinzu.</span><span class="sxs-lookup"><span data-stu-id="d48b3-130">In order to support query notifications through OLE DB, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client adds the following new properties to the DBPROPSET_SQLSERVERROWSET property set.</span></span>  
  
|<span data-ttu-id="d48b3-131">Name</span><span class="sxs-lookup"><span data-stu-id="d48b3-131">Name</span></span>|<span data-ttu-id="d48b3-132">type</span><span class="sxs-lookup"><span data-stu-id="d48b3-132">Type</span></span>|<span data-ttu-id="d48b3-133">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="d48b3-133">Description</span></span>|  
|----------|----------|-----------------|  
|<span data-ttu-id="d48b3-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="d48b3-134">SSPROP_QP_NOTIFICATION_TIMEOUT</span></span>|<span data-ttu-id="d48b3-135">VT_UI4</span><span class="sxs-lookup"><span data-stu-id="d48b3-135">VT_UI4</span></span>|<span data-ttu-id="d48b3-136">Die Anzahl der Sekunden, die die Abfragebenachrichtigung aktiv bleiben soll.</span><span class="sxs-lookup"><span data-stu-id="d48b3-136">The number of seconds that the query notification is to remain active.</span></span><br /><br /> <span data-ttu-id="d48b3-137">Der Standardwert ist 432000 Sekunden (5 Tage).</span><span class="sxs-lookup"><span data-stu-id="d48b3-137">The default is 432000 seconds (5 days).</span></span> <span data-ttu-id="d48b3-138">Der Mindestwert ist 1 Sekunde und der Höchstwert 2^31-1 Sekunden.</span><span class="sxs-lookup"><span data-stu-id="d48b3-138">The minimum value is 1 second, and the maximum value is 2^31-1 seconds.</span></span>|  
|<span data-ttu-id="d48b3-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="d48b3-139">SSPROP_QP_NOTIFICATION_MSGTEXT</span></span>|<span data-ttu-id="d48b3-140">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="d48b3-140">VT_BSTR</span></span>|<span data-ttu-id="d48b3-141">Der Text der Benachrichtigung.</span><span class="sxs-lookup"><span data-stu-id="d48b3-141">The message text of the notification.</span></span> <span data-ttu-id="d48b3-142">Dieser ist benutzerdefiniert und weist kein vordefiniertes Format auf.</span><span class="sxs-lookup"><span data-stu-id="d48b3-142">This is user defined, and has no predefined format.</span></span><br /><br /> <span data-ttu-id="d48b3-143">Standardmäßig ist die Zeichenfolge leer.</span><span class="sxs-lookup"><span data-stu-id="d48b3-143">By default, the string is empty.</span></span> <span data-ttu-id="d48b3-144">Sie können eine Meldung mit 1-2000 Zeichen angeben.</span><span class="sxs-lookup"><span data-stu-id="d48b3-144">You can specify a message using 1-2000 characters.</span></span>|  
|<span data-ttu-id="d48b3-145">SSPROP_QP_NOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="d48b3-145">SSPROP_QP_NOTIFICATION_OPTIONS</span></span>|<span data-ttu-id="d48b3-146">VT_BSTR</span><span class="sxs-lookup"><span data-stu-id="d48b3-146">VT_BSTR</span></span>|<span data-ttu-id="d48b3-147">Die Abfragebenachrichtigungsoptionen.</span><span class="sxs-lookup"><span data-stu-id="d48b3-147">The query notification options.</span></span> <span data-ttu-id="d48b3-148">Diese werden in einer Zeichenfolge mit *Name*- = *Wert* -Syntax angegeben.</span><span class="sxs-lookup"><span data-stu-id="d48b3-148">These are specified in a string with *name*=*value* syntax.</span></span> <span data-ttu-id="d48b3-149">Der Benutzer ist für das Erstellen des Diensts und Lesen von Benachrichtigungen von der Warteschlange verantwortlich.</span><span class="sxs-lookup"><span data-stu-id="d48b3-149">The user is responsible for creating the service and reading notifications off of the queue.</span></span><br /><br /> <span data-ttu-id="d48b3-150">Der Standardwert ist eine leere Zeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="d48b3-150">The default is an empty string.</span></span>|  
  
 <span data-ttu-id="d48b3-151">Für das Benachrichtigungsabonnement wird immer ein Commit durchgeführt, unabhängig davon, ob die Anweisung in einer Benutzertransaktion oder im Autocommitmodus ausgeführt wurde oder ob für die Transaktion, in der die Anweisung ausgeführt wurde, ein Commit oder Rollback durchgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="d48b3-151">The notification subscription is always committed, regardless of whether the statement ran in a user transaction or in auto commit or whether the transaction in which the statement ran committed or rolled back.</span></span> <span data-ttu-id="d48b3-152">Die Serverbenachrichtigung wird bei einer der folgenden unzulässigen Benachrichtigungsbedingungen ausgelöst: bei einer Änderung der zugrunde liegenden Daten oder des zugrunde liegenden Schemas oder bei Erreichung des Timeoutzeitraums, je nachdem, welches Ereignis früher eintritt.</span><span class="sxs-lookup"><span data-stu-id="d48b3-152">The server notification fires upon any of the following invalid notification conditions: change of underlying data or schema, or when the timeout period is reached; whichever is first.</span></span> <span data-ttu-id="d48b3-153">Benachrichtigungsregistrierungen werden gelöscht, sobald sie ausgelöst wurden.</span><span class="sxs-lookup"><span data-stu-id="d48b3-153">Notification registrations are deleted as soon as they are fired.</span></span> <span data-ttu-id="d48b3-154">Nach dem Empfang von Benachrichtigungen muss die Anwendung das Abonnement erneuern für den Fall, dass weitere Updates abgerufen werden sollen.</span><span class="sxs-lookup"><span data-stu-id="d48b3-154">Hence upon receiving notifications, the application must subscribe again in case they want to get further updates.</span></span>  
  
 <span data-ttu-id="d48b3-155">Eine andere Verbindung oder ein Thread kann die Zielwarteschlange auf Benachrichtigungen überprüfen.</span><span class="sxs-lookup"><span data-stu-id="d48b3-155">Another connection or thread can check the destination queue for notifications.</span></span> <span data-ttu-id="d48b3-156">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="d48b3-156">For example:</span></span>  
  
```  
WAITFOR (RECEIVE * FROM MyQueue);   // Where MyQueue is the queue name.   
```  
  
 <span data-ttu-id="d48b3-157">Beachten Sie, dass SELECT \* den Eintrag in der Warteschlange nicht löscht, RECEIVE \* FROM jedoch schon.</span><span class="sxs-lookup"><span data-stu-id="d48b3-157">Note that SELECT \* does not delete the entry from the Queue, however RECEIVE \* FROM does.</span></span> <span data-ttu-id="d48b3-158">Dadurch wird ein Serverthread blockiert, wenn die Warteschlange leer ist.</span><span class="sxs-lookup"><span data-stu-id="d48b3-158">This stalls a server thread if the queue is empty.</span></span> <span data-ttu-id="d48b3-159">Wenn zum Zeitpunkt des Aufrufs Warteschlangeneinträge vorhanden sind, werden sie unmittelbar zurückgegeben. Andernfalls wartet der Aufruf, bis ein Warteschlangeneintrag vorgenommen wird.</span><span class="sxs-lookup"><span data-stu-id="d48b3-159">If there are queue entries at the time of the call, they are returned immediately; otherwise the call waits until a queue entry is made.</span></span>  
  
```  
RECEIVE * FROM MyQueue  
```  
  
 <span data-ttu-id="d48b3-160">Diese Anweisung gibt unverzüglich ein leeres Resultset zurück, wenn die Warteschlange leer ist. Andernfalls gibt sie alle Warteschlangenbenachrichtigungen zurück.</span><span class="sxs-lookup"><span data-stu-id="d48b3-160">This statement immediately returns an empty result set if the queue is empty; otherwise it returns all queue notifications.</span></span>  
  
 <span data-ttu-id="d48b3-161">Wenn SSPROP_QP_NOTIFICATION_MSGTEXT und SSPROP_QP_NOTIFICATION_OPTIONS nicht NULL und nicht leer sind, wird der TDS-Abfragebenachrichtigungsheader mit den drei oben definierten Eigenschaften bei jeder Ausführung des Befehls an den Server gesendet.</span><span class="sxs-lookup"><span data-stu-id="d48b3-161">If SSPROP_QP_NOTIFICATION_MSGTEXT and SSPROP_QP_NOTIFICATION_OPTIONS are non-NULL and non-empty, the query notifications TDS header containing the three properties defined above are sent to the server with each execution of the command.</span></span> <span data-ttu-id="d48b3-162">Wenn einer der Werte NULL (oder leer) ist, wird der Header nicht gesendet und DB_E_ERRORSOCCURRED ausgelöst (oder DB_S_ERRORSOCCURRED, wenn die Eigenschaften beide als optional gekennzeichnet sind). Der Statuswert wird auf DBPROPSTATUS_BADVALUE festgelegt.</span><span class="sxs-lookup"><span data-stu-id="d48b3-162">If either of them is null (or empty), the header is not sent and DB_E_ERRORSOCCURRED is raised, (or DB_S_ERRORSOCCURRED if the properties are both marked as optional), and the status value is set to DBPROPSTATUS_BADVALUE.</span></span> <span data-ttu-id="d48b3-163">Die Überprüfung wird bei Ausführen/Vorbereiten vorgenommen.</span><span class="sxs-lookup"><span data-stu-id="d48b3-163">The validation occurs on Execute/Prepare.</span></span> <span data-ttu-id="d48b3-164">Entsprechend wird DB_S_ERRORSOCCURED ausgelöst, wenn die Abfragebenachrichtigungseigenschaften für Verbindungen mit [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]-Versionen vor [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] festgelegt wurden.</span><span class="sxs-lookup"><span data-stu-id="d48b3-164">Similarly, DB_S_ERRORSOCCURED is raised when the query notification properties are set for connections to [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)].</span></span> <span data-ttu-id="d48b3-165">In diesem Fall ist der Statuswert DBPROPSTATUS_NOTSUPPORTED.</span><span class="sxs-lookup"><span data-stu-id="d48b3-165">The status value in this case is DBPROPSTATUS_NOTSUPPORTED.</span></span>  
  
 <span data-ttu-id="d48b3-166">Ein Abonnement zu initiieren gewährleistet nicht, dass nachfolgende Meldungen erfolgreich übermittelt werden.</span><span class="sxs-lookup"><span data-stu-id="d48b3-166">Initiating a subscription does not guarantee that subsequent messages will be successfully delivered.</span></span> <span data-ttu-id="d48b3-167">Außerdem wird keine Prüfung im Hinblick auf die Gültigkeit des angegebenen Dienstnamens durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="d48b3-167">In addition, no check is made as to the validity of the service name specified.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d48b3-168">Durch Vorbereiten der Anweisungen wird nie eine Initiierung des Abonnements ausgelöst. Dies wird nur durch die Ausführung der Anweisung erreicht. Abfragebenachrichtigungen werden von der Verwendung von OLE DB-Basisdiensten nicht beeinflusst.</span><span class="sxs-lookup"><span data-stu-id="d48b3-168">Preparing statements will never cause the subscription to be initiated; only statement execution will achieve this and query notifications are not impacted by the use of OLE DB core services.</span></span>  
  
 <span data-ttu-id="d48b3-169">Weitere Informationen zum DBPROPSET_SQLSERVERROWSET-Eigenschaften Satz finden Sie unter [Eigenschaften und Verhaltensweisen von Rowsets](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md).</span><span class="sxs-lookup"><span data-stu-id="d48b3-169">For more information about the DBPROPSET_SQLSERVERROWSET property set, see [Rowset Properties and Behaviors](../../native-client-ole-db-rowsets/rowset-properties-and-behaviors.md).</span></span>  
  
## <a name="sql-server-native-client-odbc-driver"></a><span data-ttu-id="d48b3-170">ODBC-Treiber für SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="d48b3-170">SQL Server Native Client ODBC Driver</span></span>  
 <span data-ttu-id="d48b3-171">Der [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client-ODBC-Treiber unterstützt Abfrage Benachrichtigungen durch das Hinzufügen von drei neuen Attributen zu den Funktionen [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) und [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) :</span><span class="sxs-lookup"><span data-stu-id="d48b3-171">The [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver supports query notifications through the addition of three new attributes to the [SQLGetStmtAttr](../../native-client-odbc-api/sqlgetstmtattr.md) and [SQLSetStmtAttr](../../native-client-odbc-api/sqlsetstmtattr.md) functions:</span></span>  
  
-   <span data-ttu-id="d48b3-172">SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span><span class="sxs-lookup"><span data-stu-id="d48b3-172">SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT</span></span>  
  
-   <span data-ttu-id="d48b3-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span><span class="sxs-lookup"><span data-stu-id="d48b3-173">SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS</span></span>  
  
-   <span data-ttu-id="d48b3-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span><span class="sxs-lookup"><span data-stu-id="d48b3-174">SQL_SOPT_SS_QUERYNOTIFICATION_TIMEOUT</span></span>  
  
 <span data-ttu-id="d48b3-175">Wenn SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT und SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS nicht NULL sind, wird der TDS-Abfragebenachrichtigungsheader mit den drei oben definierten Attributen bei jeder Ausführung des Befehls an den Server gesendet.</span><span class="sxs-lookup"><span data-stu-id="d48b3-175">If SQL_SOPT_SS_QUERYNOTIFICATION_MSGTEXT and SQL_SOPT_SS_QUERYNOTIFICATION_OPTIONS are not NULL, the query notifications TDS header containing the three attributes defined above will be sent to the server each time the command is executed.</span></span> <span data-ttu-id="d48b3-176">Wenn eine der Eigenschaften NULL ist, wird der Header nicht gesendet und SQL_SUCCESS_WITH_INFO zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="d48b3-176">If either of them is null, the header is not sent, and SQL_SUCCESS_WITH_INFO is returned.</span></span> <span data-ttu-id="d48b3-177">Die Überprüfung erfolgt auf der [SQLPrepare-Funktion](https://go.microsoft.com/fwlink/?LinkId=59360), **SQLExecDirect**und **SQLExecute**, die alle fehlschlagen, wenn die Attribute nicht gültig sind.</span><span class="sxs-lookup"><span data-stu-id="d48b3-177">The validation occurs on [SQLPrepare Function](https://go.microsoft.com/fwlink/?LinkId=59360), **SqlExecDirect**, and **SqlExecute**, all of which fail if the attributes are not valid.</span></span> <span data-ttu-id="d48b3-178">Entsprechend schlägt die Ausführung mit SQL_SUCCESS_WITH_INFO fehl, wenn diese Abfragebenachrichtigungsattribute für [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]-Versionen vor [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="d48b3-178">Similarly, when these query notification attributes are set for [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] versions before [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)], the execution fails with SQL_SUCCESS_WITH_INFO.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="d48b3-179">Durch Vorbereiten der Anweisungen wird nie eine Initiierung des Abonnements ausgelöst. Das Abonnement kann nur durch die Anweisungsausführung initiiert werden.</span><span class="sxs-lookup"><span data-stu-id="d48b3-179">Prepare statements will never cause the subscription to be initiated; subscription can be initiated by statement execution.</span></span>  
  
## <a name="special-cases-and-restrictions"></a><span data-ttu-id="d48b3-180">Sonderfälle und Einschränkungen</span><span class="sxs-lookup"><span data-stu-id="d48b3-180">Special Cases and Restrictions</span></span>  
 <span data-ttu-id="d48b3-181">Die folgenden Datentypen werden für Benachrichtigungen nicht unterstützt:</span><span class="sxs-lookup"><span data-stu-id="d48b3-181">The following data types are not supported for notifications:</span></span>  
  
-   `text`  
  
-   `ntext`  
  
-   `image`  
  
 <span data-ttu-id="d48b3-182">Wenn eine Benachrichtigungsanforderung für eine Abfrage gesendet wird, die einen dieser Typen zurückgibt, wird die Benachrichtigung sofort mit dem Hinweis ausgelöst, dass das Benachrichtigungsabonnement nicht möglich sei.</span><span class="sxs-lookup"><span data-stu-id="d48b3-182">If a notification request is made for a query which returns any of these types, the notification fires immediately, specifying that notification subscription was not possible.</span></span>  
  
 <span data-ttu-id="d48b3-183">Wenn eine Abonnementanforderung für einen Batch oder eine gespeicherte Prozedur erfolgt, wird für jede Anweisung, die innerhalb des Batches oder der gespeicherten Prozedur ausgeführt wird, eine separate Abonnementanforderung ausgegeben.</span><span class="sxs-lookup"><span data-stu-id="d48b3-183">If a subscription request is made for a batch or stored procedure, a separate subscription request is made for each statement executed within the batch or stored procedure.</span></span> <span data-ttu-id="d48b3-184">EXECUTE-Anweisungen registrieren keine Benachrichtigung, sondern senden die Benachrichtigungsanforderung an den ausgeführten Befehl.</span><span class="sxs-lookup"><span data-stu-id="d48b3-184">EXECUTE statements will not register a notification, but will send the notification request to the executed command.</span></span> <span data-ttu-id="d48b3-185">Wenn es sich um einen Batch handelt, wird der Kontext auf die ausgeführten Anweisungen angewendet, und es gelten die gleichen Regeln wie oben beschrieben.</span><span class="sxs-lookup"><span data-stu-id="d48b3-185">If it is a batch, the context will be applied to the executed statements and the same rules described above apply.</span></span>  
  
 <span data-ttu-id="d48b3-186">Wenn eine Abfrage für eine Benachrichtigung gesendet wird, die vom gleichen Benutzer unter demselben Daten Bank Kontext gesendet wurde und die gleiche Vorlage, dieselben Parameterwerte, dieselbe Benachrichtigungs-ID und denselben Übermittlungs Speicherort eines vorhandenen aktiven Abonnements aufweist, wird das vorhandene Abonnement erneuert, und das neue angegebene Timeout wird zurückgesetzt. Dies bedeutet, dass nur eine Benachrichtigung gesendet wird, wenn eine Benachrichtigung für identische Abfragen angefordert wird.</span><span class="sxs-lookup"><span data-stu-id="d48b3-186">Submission of a query for notification that was submitted by the same user under the same database context and has the same template, same parameter values, same notification ID, and same delivery location of an existing active subscription, will renew the existing subscription, resetting the new specified time-out. This means that if notification is requested for identical queries, only one notification will be sent.</span></span> <span data-ttu-id="d48b3-187">Dies gilt sowohl für Abfragen, die in einem Batch dupliziert werden, als auch für Abfragen in einer gespeicherten Prozedur, die mehrmals aufgerufen wurde.</span><span class="sxs-lookup"><span data-stu-id="d48b3-187">This would apply to a query duplicated in a batch, or a query in a stored procedure that was called multiple times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="d48b3-188">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="d48b3-188">See Also</span></span>  
 [<span data-ttu-id="d48b3-189">SQL Server Native Client-Funktionen</span><span class="sxs-lookup"><span data-stu-id="d48b3-189">SQL Server Native Client Features</span></span>](sql-server-native-client-features.md)  
  
  
