---
title: Vorbereitete Ausführung | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: native-client
ms.topic: reference
helpviewer_keywords:
- deferred statement preparation
- prepared execution [ODBC]
- SQLPrepare function
- ODBC applications, statements
- SQLExecute function
- statements [ODBC], prepared execution
ms.assetid: f3a9d32b-6cd7-4f0c-b38d-c8ccc4ee40c3
author: rothja
ms.author: jroth
ms.openlocfilehash: 33ab9f35cd9d3eaf04e688a89390b5eb3f00ae58
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87608608"
---
# <a name="prepared-execution"></a><span data-ttu-id="76775-102">Vorbereitete Ausführung</span><span class="sxs-lookup"><span data-stu-id="76775-102">Prepared Execution</span></span>
  <span data-ttu-id="76775-103">Die ODBC-API definiert eine vorbereitete Ausführung als einen Weg, den Analyse- und Kompilieraufwand, der mit dem wiederholten Ausführen einer [!INCLUDE[tsql](../../../includes/tsql-md.md)]-Anweisung einhergeht, zu reduzieren.</span><span class="sxs-lookup"><span data-stu-id="76775-103">The ODBC API defines prepared execution as a way to reduce the parsing and compiling overhead associated with repeatedly executing a [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement.</span></span> <span data-ttu-id="76775-104">Die Anwendung erstellt eine Zeichenfolge, die eine SQL-Anweisung enthält, und führt diese Anweisung dann in zwei Phasen aus.</span><span class="sxs-lookup"><span data-stu-id="76775-104">The application builds a character string containing an SQL statement and then executes it in two stages.</span></span> <span data-ttu-id="76775-105">Sie ruft die [SQLPrepare-Funktion](https://go.microsoft.com/fwlink/?LinkId=59360) einmal auf, damit die-Anweisung vom analysiert und in einen Ausführungsplan kompiliert wird [!INCLUDE[ssDE](../../../includes/ssde-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="76775-105">It calls [SQLPrepare Function](https://go.microsoft.com/fwlink/?LinkId=59360) once to have the statement parsed and compiled into an execution plan by the [!INCLUDE[ssDE](../../../includes/ssde-md.md)].</span></span> <span data-ttu-id="76775-106">Anschließend wird für jede Ausführung des vorbereiteten Ausführungs Plans **SQLExecute** aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="76775-106">It then calls **SQLExecute** for each execution of the prepared execution plan.</span></span> <span data-ttu-id="76775-107">Dadurch wird bei jeder Ausführung der mit der Analyse und Kompilierung verbundene Aufwand reduziert.</span><span class="sxs-lookup"><span data-stu-id="76775-107">This saves the parsing and compiling overhead on each execution.</span></span> <span data-ttu-id="76775-108">Die vorbereitete Ausführung wird in Anwendungen häufig verwendet, um dieselbe parametrisierte SQL-Anweisung mehrfach auszuführen.</span><span class="sxs-lookup"><span data-stu-id="76775-108">Prepared execution is commonly used by applications to repeatedly execute the same, parameterized SQL statement.</span></span>  
  
 <span data-ttu-id="76775-109">Bei den meisten Datenbanken ist die vorbereitete Ausführung schneller als eine direkte Ausführung von Anweisungen, die mehr als drei- oder viermal ausgeführt werden, hauptsächlich da die Anweisung nur einmal kompiliert wird, während die direkt ausgeführten Anweisungen bei jeder Ausführung kompiliert werden.</span><span class="sxs-lookup"><span data-stu-id="76775-109">For most databases, prepared execution is faster than direct execution for statements executed more than three or four times primarily because the statement is compiled only once, while statements executed directly are compiled each time they are executed.</span></span> <span data-ttu-id="76775-110">Die vorbereitete Ausführung kann auch zu einer Reduzierung des Netzwerkverkehrs beitragen, da der Treiber bei jeder Ausführung der Anweisung eine Ausführungsplan-ID und die Parameterwerte an die Datenquelle senden kann, anstatt die gesamte SQL-Anweisung zu senden.</span><span class="sxs-lookup"><span data-stu-id="76775-110">Prepared execution can also provide a reduction in network traffic because the driver can send an execution plan identifier and the parameter values, rather than an entire SQL statement, to the data source each time the statement is executed.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)]<span data-ttu-id="76775-111">verringert den Leistungsunterschied zwischen direkter und vorbereiteter Ausführung durch verbesserte Algorithmen zum erkennen und wieder verwenden von Ausführungsplänen von **SQLExecDirect**.</span><span class="sxs-lookup"><span data-stu-id="76775-111">reduces the performance difference between direct and prepared execution through improved algorithms for detecting and reusing execution plans from **SQLExecDirect**.</span></span> <span data-ttu-id="76775-112">Dadurch stehen einige der Leistungsvorteile einer vorbereiteten Ausführung auch für direkt ausgeführte Anweisungen zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="76775-112">This makes some of the performance benefits of prepared execution available to statements executed directly.</span></span> <span data-ttu-id="76775-113">Weitere Informationen finden Sie unter [direkte Ausführung](direct-execution.md).</span><span class="sxs-lookup"><span data-stu-id="76775-113">For more information, see [Direct Execution](direct-execution.md).</span></span>  
  
 [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] <span data-ttu-id="76775-114">stellt außerdem auch eine systemeigene Unterstützung für die vorbereitete Ausführung bereit.</span><span class="sxs-lookup"><span data-stu-id="76775-114">also provides native support for prepared execution.</span></span> <span data-ttu-id="76775-115">Ein Ausführungsplan wird auf **SQLPrepare** erstellt und später ausgeführt, wenn **SQLExecute** aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="76775-115">An execution plan is built on **SQLPrepare** and later executed when **SQLExecute** is called.</span></span> <span data-ttu-id="76775-116">Da [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] nicht zum Erstellen temporärer gespeicherter Prozeduren auf **SQLPrepare**erforderlich ist, wird in den Systemtabellen in **tempdb**kein zusätzlicher mehr Aufwand geboten.</span><span class="sxs-lookup"><span data-stu-id="76775-116">Because [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is not required to build temporary stored procedures on **SQLPrepare**, there is no extra overhead on the system tables in **tempdb**.</span></span>  
  
 <span data-ttu-id="76775-117">Aus Leistungsgründen wird die Anweisungs Vorbereitung verzögert, bis **SQLExecute** aufgerufen wird oder ein Metaeigenschaftsvorgang (z. b. [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) oder [SQLDescribeParam](../../native-client-odbc-api/sqldescribeparam.md) in ODBC) ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="76775-117">For performance reasons, the statement preparation is deferred until **SQLExecute** is called or a metaproperty operation (such as [SQLDescribeCol](../../native-client-odbc-api/sqldescribecol.md) or [SQLDescribeParam](../../native-client-odbc-api/sqldescribeparam.md) in ODBC) is performed.</span></span> <span data-ttu-id="76775-118">Dies ist das Standardverhalten.</span><span class="sxs-lookup"><span data-stu-id="76775-118">This is the default behavior.</span></span> <span data-ttu-id="76775-119">Fehler in der vorbereiteten Anweisung werden erst dann erkannt, wenn die Anweisung ausgeführt oder ein Metaeigenschaftsvorgang durchgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="76775-119">Any errors in the statement being prepared are not known until the statement is executed or a metaproperty operation is performed.</span></span> <span data-ttu-id="76775-120">Wenn Sie das [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC-treiberspezifische Anweisungsattribut SQL_SOPT_SS_DEFER_PREPARE auf SQL_DP_OFF setzen, kann dieses Standardverhalten deaktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="76775-120">Setting the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver-specific statement attribute SQL_SOPT_SS_DEFER_PREPARE to SQL_DP_OFF can turn off this default behavior.</span></span>  
  
 <span data-ttu-id="76775-121">Bei einer verzögerten Vorbereitung wird durch das Aufrufen von **SQLDescribeCol** oder **SQLDescribeParam** vor dem Aufrufen von **SQLExecute** ein zusätzlicher Roundtrip zum Server generiert.</span><span class="sxs-lookup"><span data-stu-id="76775-121">In case of deferred prepare, calling either **SQLDescribeCol** or **SQLDescribeParam** before calling **SQLExecute** generates an extra roundtrip to the server.</span></span> <span data-ttu-id="76775-122">In **SQLDescribeCol**entfernt der Treiber die WHERE-Klausel aus der Abfrage und sendet Sie an den Server mit SET FMTONLY ON, um die Beschreibung der Spalten im ersten Resultset zu erhalten, das von der Abfrage zurückgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="76775-122">On **SQLDescribeCol**, the driver removes the WHERE clause from the query and sends it to the server with SET FMTONLY ON to get the description of the columns in the first result set returned by the query.</span></span> <span data-ttu-id="76775-123">In **SQLDescribeParam**ruft der Treiber den Server auf, um eine Beschreibung der Ausdrücke oder Spalten zu erhalten, auf die von beliebigen Parameter Markierungen in der Abfrage verwiesen wird.</span><span class="sxs-lookup"><span data-stu-id="76775-123">On **SQLDescribeParam**, the driver calls the server to get a description of the expressions or columns referenced by any parameter markers in the query.</span></span> <span data-ttu-id="76775-124">Bei dieser Methode kommt es auch zu einigen Einschränkungen, z. B. können keine Parameter in Unterabfragen gelöst werden.</span><span class="sxs-lookup"><span data-stu-id="76775-124">This method also has some restrictions, such as not being able to resolve parameters in subqueries.</span></span>  
  
 <span data-ttu-id="76775-125">Die übermäßige Verwendung von **SQLPrepare** mit dem [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client-ODBC-Treiber beeinträchtigt die Leistung, insbesondere, wenn eine Verbindung mit früheren Versionen von SQL Server besteht.</span><span class="sxs-lookup"><span data-stu-id="76775-125">Excess use of **SQLPrepare** with the [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] Native Client ODBC driver degrades performance, especially when connected to earlier versions of SQL Server.</span></span> <span data-ttu-id="76775-126">Die vorbereitete Ausführung sollte nicht für Anwendungen verwendet werden, die nur einmal ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="76775-126">Prepared execution should not be used for statements executed a single time.</span></span> <span data-ttu-id="76775-127">Die vorbereitete Ausführung dauert länger als eine direkte Ausführung für eine einzelne Ausführung einer Anweisung, da ein zusätzlicher Netzwerkroundtrip vom Client zum Server erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="76775-127">Prepared execution is slower than direct execution for a single execution of a statement because it requires an extra network roundtrip from the client to the server.</span></span> <span data-ttu-id="76775-128">Auf früheren Versionen von [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] wird auch eine temporär gespeicherte Prozedur erstellt.</span><span class="sxs-lookup"><span data-stu-id="76775-128">On earlier versions of [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] it also generates a temporary stored procedure.</span></span>  
  
 <span data-ttu-id="76775-129">Vorbereitete Anweisungen können nicht zum Erstellen von temporären Objekten in [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="76775-129">Prepared statements cannot be used to create temporary objects on [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)].</span></span>  
  
 <span data-ttu-id="76775-130">Einige frühe ODBC-Anwendungen haben **SQLPrepare** bei jeder Verwendung von [SQLBindParameter](../../native-client-odbc-api/sqlbindparameter.md) verwendet.</span><span class="sxs-lookup"><span data-stu-id="76775-130">Some early ODBC applications used **SQLPrepare** any time [SQLBindParameter](../../native-client-odbc-api/sqlbindparameter.md) was used.</span></span> <span data-ttu-id="76775-131">**SQLBindParameter** erfordert nicht die Verwendung von **SQLPrepare**, sondern kann mit **SQLExecDirect**verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="76775-131">**SQLBindParameter** does not require the use of **SQLPrepare**, it can be used with **SQLExecDirect**.</span></span> <span data-ttu-id="76775-132">Verwenden Sie z. b. **SQLExecDirect** mit **SQLBindParameter** , um den Rückgabecode oder die Ausgabeparameter aus einer gespeicherten Prozedur abzurufen, die nur einmal ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="76775-132">For example, use **SQLExecDirect** with **SQLBindParameter** to retrieve the return code or output parameters from a stored procedure that is only executed one time.</span></span> <span data-ttu-id="76775-133">Verwenden Sie **SQLPrepare** nicht mit **SQLBindParameter** , es sei denn, dieselbe Anweisung wird mehrmals ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="76775-133">Do not use **SQLPrepare** with **SQLBindParameter** unless the same statement will be executed multiple times.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="76775-134">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="76775-134">See Also</span></span>  
 [<span data-ttu-id="76775-135">Ausführen von Anweisungen &#40;ODBC-&#41;</span><span class="sxs-lookup"><span data-stu-id="76775-135">Executing Statements &#40;ODBC&#41;</span></span>](executing-statements-odbc.md)  
  
  
