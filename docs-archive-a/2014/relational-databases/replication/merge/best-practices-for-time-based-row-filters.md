---
title: Bewährte Methoden für zeitbasierte Zeilenfilter | Microsoft-Dokumentation
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- best practices
ms.assetid: 773c5c62-fd44-44ab-9c6b-4257dbf8ffdb
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: ccaafe71d4137fd4b31eec412c1e35595861bdd0
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87607704"
---
# <a name="best-practices-for-time-based-row-filters"></a><span data-ttu-id="1c01b-102">Bewährte Methoden für zeitbasierte Zeilenfilter</span><span class="sxs-lookup"><span data-stu-id="1c01b-102">Best Practices for Time-Based Row Filters</span></span>
  <span data-ttu-id="1c01b-103">Benutzer von Anwendungen benötigen häufig eine zeitbasierte Teilmenge der Daten in einer Tabelle.</span><span class="sxs-lookup"><span data-stu-id="1c01b-103">Users of applications often require a time-based subset of data from a table.</span></span> <span data-ttu-id="1c01b-104">Ein Verkäufer könnte z. B. Daten zu Bestellungen der letzten Woche benötigen und ein Ereignisplaner Daten zu Ereignissen in der kommenden Woche.</span><span class="sxs-lookup"><span data-stu-id="1c01b-104">For instance, a salesperson might require data for orders in the last week, or an event planner might require data for events in the upcoming week.</span></span> <span data-ttu-id="1c01b-105">Anwendungen verwenden in diesen Fällen häufig Abfragen mit der `GETDATE()`-Funktion.</span><span class="sxs-lookup"><span data-stu-id="1c01b-105">In many cases, applications use queries containing the `GETDATE()` function to accomplish this.</span></span> <span data-ttu-id="1c01b-106">Betrachten Sie die folgende Zeilenfilteranweisung:</span><span class="sxs-lookup"><span data-stu-id="1c01b-106">Consider the following row filter statement:</span></span>  
  
```  
WHERE SalesPersonID = CONVERT(INT,HOST_NAME()) AND OrderDate >= (GETDATE()-6)  
```  
  
 <span data-ttu-id="1c01b-107">Bei einem Filter dieses Typs wird davon ausgegangen, dass zwei Aktionen eingeleitet werden, wenn der Merge-Agent ausgeführt wird: Zeilen, die dem Filter entsprechen, werden auf die Abonnenten repliziert, und für Zeilen, die dem Filter nicht mehr entsprechen, wird auf den Abonnenten ein Cleanup ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="1c01b-107">With a filter of this type, it is usually assumed that two things always occur when the Merge Agent runs: rows that satisfy this filter are replicated to Subscribers; and rows that no longer satisfy this filter are cleaned up at Subscribers.</span></span> <span data-ttu-id="1c01b-108">(Weitere Informationen zum Filtern mit `HOST_NAME()` finden Sie unter [Parameterized Row Filters](parameterized-filters-parameterized-row-filters.md).) Bei der Mergereplikation werden jedoch nur Daten repliziert und bereinigt, die seit der letzten Synchronisierung geändert wurden, unabhängig davon, wie ein Zeilen Filter für diese Daten definiert wird.</span><span class="sxs-lookup"><span data-stu-id="1c01b-108">(For more information about filtering with `HOST_NAME()`, see [Parameterized Row Filters](parameterized-filters-parameterized-row-filters.md).) However, merge replication only replicates and cleans up data that has changed since the last synchronization, regardless of how you define a row filter for that data.</span></span>  
  
 <span data-ttu-id="1c01b-109">Damit eine Zeile bei der Mergereplikation verarbeitet wird, müssen die Daten in der Zeile dem Zeilenfilter entsprechen, und sie müssen seit der letzten Synchronisierung geändert worden sein.</span><span class="sxs-lookup"><span data-stu-id="1c01b-109">For merge replication to process a row, the data in the row must satisfy the row filter, and it must have changed since the last synchronization.</span></span> <span data-ttu-id="1c01b-110">In der **SalesOrderHeader** -Tabelle wird **OrderDate** eingegeben, wenn eine Zeile eingefügt wird.</span><span class="sxs-lookup"><span data-stu-id="1c01b-110">In the case of the **SalesOrderHeader** table, **OrderDate** is entered when a row is inserted.</span></span> <span data-ttu-id="1c01b-111">Die Zeilen werden wie erwartet auf den Abonnenten repliziert, da die Einfügung eine Datenänderung darstellt.</span><span class="sxs-lookup"><span data-stu-id="1c01b-111">Rows are replicated to the Subscriber as expected because the insert is a data change.</span></span> <span data-ttu-id="1c01b-112">Befinden sich auf dem Abonnenten jedoch Zeilen, die dem Filter nicht mehr entsprechen (z. B. für Bestellungen, die mehr als sieben Tage zurückliegen), werden sie vom Abonnenten nicht entfernt, es sei denn, sie wurden aus einem anderen Grund aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="1c01b-112">However, if there are rows at the Subscriber that no longer satisfy the filter (they are for orders older than seven days), they are not removed from the Subscriber unless they were updated for some other reason.</span></span>  
  
 <span data-ttu-id="1c01b-113">Das Beispiel des Ereignisplaners veranschaulicht das Problem mit dieser Art der Filterung.</span><span class="sxs-lookup"><span data-stu-id="1c01b-113">The case of the event planner further highlights the issue with this type of filtering.</span></span> <span data-ttu-id="1c01b-114">Betrachten Sie den folgenden Filter für eine **Events** -Tabelle:</span><span class="sxs-lookup"><span data-stu-id="1c01b-114">Consider the following filter for an **Events** table:</span></span>  
  
```  
WHERE EventCoordID = CONVERT(INT,HOST_NAME()) AND EventDate <= (GETDATE()+6)  
```  
  
 <span data-ttu-id="1c01b-115">In einer Tabelle mit Ereignissen erfolgen Einfügungen möglicherweise vor dem Datum des Ereignisses.</span><span class="sxs-lookup"><span data-stu-id="1c01b-115">For a table that contains events, inserts might be made well ahead of the event date.</span></span> <span data-ttu-id="1c01b-116">Wenn die Einfügung für ein Ereignis in der kommenden Woche bereits vor einem Monat erfolgt ist und die Zeile nicht aus einem anderen Grund aktualisiert wurde, wird die Zeile auf dem Abonnenten nicht repliziert, auch dann nicht, wenn sie dem Zeilenfilter entspricht.</span><span class="sxs-lookup"><span data-stu-id="1c01b-116">If the insert for an event in the coming week was made a month ago and the row was not updated for another reason, the row is not replicated to the Subscriber even if it satisfies the row filter.</span></span>  
  
 <span data-ttu-id="1c01b-117">Abhängig von der Konfiguration der Veröffentlichung wertet die Mergereplikation Filter außerdem zu unterschiedlichen Zeiten aus:</span><span class="sxs-lookup"><span data-stu-id="1c01b-117">In addition, depending on how the publication is configured, merge replication evaluates filters at different times:</span></span>  
  
-   <span data-ttu-id="1c01b-118">Verwendet eine Veröffentlichung vorausberechnete Partitionen (Standardeinstellung), werden die Filter beim Einfügen oder Aktualisieren einer Zeile ausgewertet.</span><span class="sxs-lookup"><span data-stu-id="1c01b-118">If a publication uses precomputed partitions (the default), filters are evaluated when a row is inserted or updated.</span></span>  
  
-   <span data-ttu-id="1c01b-119">Verwendet die Veröffentlichung keine vorausberechneten Partitionen, werden die Filter beim Ausführen des Merge-Agents ausgewertet.</span><span class="sxs-lookup"><span data-stu-id="1c01b-119">If the publication does not use precomputed partitions, filters are evaluated when the Merge Agent runs.</span></span>  
  
 <span data-ttu-id="1c01b-120">Weitere Informationen zu vorausberechneten Partitionen finden Sie unter [Optimieren der Leistung parametrisierter Filter mithilfe vorausberechneter Partitionen](parameterized-filters-optimize-for-precomputed-partitions.md).</span><span class="sxs-lookup"><span data-stu-id="1c01b-120">For more information about precomputed partitions, see [Optimize Parameterized Filter Performance with Precomputed Partitions](parameterized-filters-optimize-for-precomputed-partitions.md).</span></span> <span data-ttu-id="1c01b-121">Der Zeitpunkt der Auswertung des Filters wirkt sich darauf aus, welche Daten den Filter erfüllen.</span><span class="sxs-lookup"><span data-stu-id="1c01b-121">The time at which the filter is evaluated affects what data satisfies the filter.</span></span> <span data-ttu-id="1c01b-122">Wenn eine Veröffentlichung z. B. vorausberechnete Partitionen verwendet und Sie die Daten alle zwei Tage synchronisieren, könnte die Teilmenge der Daten für den Verkäufer Zeilen enthalten, die bis zu zwei Tage älter sind als erwartet.</span><span class="sxs-lookup"><span data-stu-id="1c01b-122">For example, if a publication uses precomputed partitions, and you synchronize data every two days, the subset of data for the salesperson could include rows up to two days older than expected.</span></span>  
  
## <a name="recommendations-for-using-time-based-row-filters"></a><span data-ttu-id="1c01b-123">Empfehlungen für die Verwendung zeitbasierter Zeilenfilter</span><span class="sxs-lookup"><span data-stu-id="1c01b-123">Recommendations for Using Time-Based Row Filters</span></span>  
 <span data-ttu-id="1c01b-124">Die folgende Methode stellt einen leistungsfähigen und unkomplizierten Ansatz für die zeitbasierte Filterung bereit:</span><span class="sxs-lookup"><span data-stu-id="1c01b-124">The following method provides a robust and straightforward approach to filtering based on time:</span></span>  
  
-   <span data-ttu-id="1c01b-125">Fügen Sie der Tabelle eine Spalte des `bit`-Datentyps hinzu.</span><span class="sxs-lookup"><span data-stu-id="1c01b-125">Add a column to the table of data type `bit`.</span></span> <span data-ttu-id="1c01b-126">Diese Spalte gibt an, ob eine Zeile repliziert werden soll.</span><span class="sxs-lookup"><span data-stu-id="1c01b-126">This column is used to indicate whether a row should be replicated.</span></span>  
  
-   <span data-ttu-id="1c01b-127">Verwenden Sie einen Zeilenfilter, der auf die neue Spalte und nicht auf eine zeitbasierte Spalte verweist.</span><span class="sxs-lookup"><span data-stu-id="1c01b-127">Use a row filter that references the new column rather than a time-based column.</span></span>  
  
-   <span data-ttu-id="1c01b-128">Erstellen Sie einen SQL Server-Agent-Auftrag (oder einen Auftrag, der mithilfe eines anderen Mechanismus geplant wurde), der die Spalte vor der geplanten Ausführung des Merge-Agents aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="1c01b-128">Create a SQL Server Agent job (or a job scheduled through another mechanism) that updates the column before the Merge Agent is scheduled to run.</span></span>  
  
 <span data-ttu-id="1c01b-129">Dieser Ansatz gleicht die Mängel bei der Verwendung von `GETDATE()` oder einer anderen zeitbasierten Methode aus. Außerdem muss nicht bestimmt werden, wann Filter für Partitionen ausgewertet werden.</span><span class="sxs-lookup"><span data-stu-id="1c01b-129">This approach addresses the shortcomings of using `GETDATE()` or another time-based method and avoids the problem of having to determine when filters are evaluated for partitions.</span></span> <span data-ttu-id="1c01b-130">Betrachten Sie das folgende Beispiel einer **Events** -Tabelle:</span><span class="sxs-lookup"><span data-stu-id="1c01b-130">Consider the following example of an **Events** table:</span></span>  
  
|<span data-ttu-id="1c01b-131">**EventID**</span><span class="sxs-lookup"><span data-stu-id="1c01b-131">**EventID**</span></span>|<span data-ttu-id="1c01b-132">**EventName**</span><span class="sxs-lookup"><span data-stu-id="1c01b-132">**EventName**</span></span>|<span data-ttu-id="1c01b-133">**EventCoordID**</span><span class="sxs-lookup"><span data-stu-id="1c01b-133">**EventCoordID**</span></span>|<span data-ttu-id="1c01b-134">**EventDate**</span><span class="sxs-lookup"><span data-stu-id="1c01b-134">**EventDate**</span></span>|<span data-ttu-id="1c01b-135">**Replikat**</span><span class="sxs-lookup"><span data-stu-id="1c01b-135">**Replicate**</span></span>|  
|-----------------|-------------------|----------------------|-------------------|-------------------|  
|<span data-ttu-id="1c01b-136">1</span><span class="sxs-lookup"><span data-stu-id="1c01b-136">1</span></span>|<span data-ttu-id="1c01b-137">Reception</span><span class="sxs-lookup"><span data-stu-id="1c01b-137">Reception</span></span>|<span data-ttu-id="1c01b-138">112</span><span class="sxs-lookup"><span data-stu-id="1c01b-138">112</span></span>|<span data-ttu-id="1c01b-139">2006-10-04</span><span class="sxs-lookup"><span data-stu-id="1c01b-139">2006-10-04</span></span>|<span data-ttu-id="1c01b-140">1</span><span class="sxs-lookup"><span data-stu-id="1c01b-140">1</span></span>|  
|<span data-ttu-id="1c01b-141">2</span><span class="sxs-lookup"><span data-stu-id="1c01b-141">2</span></span>|<span data-ttu-id="1c01b-142">Abendessen</span><span class="sxs-lookup"><span data-stu-id="1c01b-142">Dinner</span></span>|<span data-ttu-id="1c01b-143">112</span><span class="sxs-lookup"><span data-stu-id="1c01b-143">112</span></span>|<span data-ttu-id="1c01b-144">2006-10-10</span><span class="sxs-lookup"><span data-stu-id="1c01b-144">2006-10-10</span></span>|<span data-ttu-id="1c01b-145">0</span><span class="sxs-lookup"><span data-stu-id="1c01b-145">0</span></span>|  
|<span data-ttu-id="1c01b-146">3</span><span class="sxs-lookup"><span data-stu-id="1c01b-146">3</span></span>|<span data-ttu-id="1c01b-147">Party</span><span class="sxs-lookup"><span data-stu-id="1c01b-147">Party</span></span>|<span data-ttu-id="1c01b-148">112</span><span class="sxs-lookup"><span data-stu-id="1c01b-148">112</span></span>|<span data-ttu-id="1c01b-149">2006-10-11</span><span class="sxs-lookup"><span data-stu-id="1c01b-149">2006-10-11</span></span>|<span data-ttu-id="1c01b-150">0</span><span class="sxs-lookup"><span data-stu-id="1c01b-150">0</span></span>|  
|<span data-ttu-id="1c01b-151">4</span><span class="sxs-lookup"><span data-stu-id="1c01b-151">4</span></span>|<span data-ttu-id="1c01b-152">Wedding</span><span class="sxs-lookup"><span data-stu-id="1c01b-152">Wedding</span></span>|<span data-ttu-id="1c01b-153">112</span><span class="sxs-lookup"><span data-stu-id="1c01b-153">112</span></span>|<span data-ttu-id="1c01b-154">2006-10-12</span><span class="sxs-lookup"><span data-stu-id="1c01b-154">2006-10-12</span></span>|<span data-ttu-id="1c01b-155">0</span><span class="sxs-lookup"><span data-stu-id="1c01b-155">0</span></span>|  
  
 <span data-ttu-id="1c01b-156">Der Zeilenfilter für diese Tabelle würde dann folgendermaßen aussehen:</span><span class="sxs-lookup"><span data-stu-id="1c01b-156">The row filter for this table would then look like this:</span></span>  
  
```  
WHERE EventCoordID = CONVERT(INT,HOST_NAME()) AND Replicate = 1  
```  
  
 <span data-ttu-id="1c01b-157">Der SQL Server-Agent-Auftrag könnte vor jeder Ausführung des Merge-Agents [!INCLUDE[tsql](../../../includes/tsql-md.md)] -Anweisungen wie die folgenden ausführen:</span><span class="sxs-lookup"><span data-stu-id="1c01b-157">The SQL Server Agent job could execute [!INCLUDE[tsql](../../../includes/tsql-md.md)] statements similar to the following before each Merge Agent run:</span></span>  
  
```  
UPDATE Events SET Replicate = 0 WHERE Replicate = 1  
GO  
UPDATE Events SET Replicate = 1 WHERE EventDate <= GETDATE()+6  
GO  
```  
  
 <span data-ttu-id="1c01b-158">Die erste Zeile setzt die **Replicate** -Spalte auf **0**zurück, und die zweite Zeile setzt die Spalte für Ereignisse, die in den nächsten sieben Tagen stattfinden, auf **1** .</span><span class="sxs-lookup"><span data-stu-id="1c01b-158">The first line resets the **Replicate** column to **0**, and the second line sets the column to **1** for events that occur in the next seven days.</span></span> <span data-ttu-id="1c01b-159">Wenn diese [!INCLUDE[tsql](../../../includes/tsql-md.md)] -Anweisung am 07.10.2006 ausgeführt wird, wird die Tabelle folgendermaßen aktualisiert:</span><span class="sxs-lookup"><span data-stu-id="1c01b-159">If this [!INCLUDE[tsql](../../../includes/tsql-md.md)] statement runs on 10/07/2006, the table is updated to:</span></span>  
  
|<span data-ttu-id="1c01b-160">**EventID**</span><span class="sxs-lookup"><span data-stu-id="1c01b-160">**EventID**</span></span>|<span data-ttu-id="1c01b-161">**EventName**</span><span class="sxs-lookup"><span data-stu-id="1c01b-161">**EventName**</span></span>|<span data-ttu-id="1c01b-162">**EventCoordID**</span><span class="sxs-lookup"><span data-stu-id="1c01b-162">**EventCoordID**</span></span>|<span data-ttu-id="1c01b-163">**EventDate**</span><span class="sxs-lookup"><span data-stu-id="1c01b-163">**EventDate**</span></span>|<span data-ttu-id="1c01b-164">**Replikat**</span><span class="sxs-lookup"><span data-stu-id="1c01b-164">**Replicate**</span></span>|  
|-----------------|-------------------|----------------------|-------------------|-------------------|  
|<span data-ttu-id="1c01b-165">1</span><span class="sxs-lookup"><span data-stu-id="1c01b-165">1</span></span>|<span data-ttu-id="1c01b-166">Reception</span><span class="sxs-lookup"><span data-stu-id="1c01b-166">Reception</span></span>|<span data-ttu-id="1c01b-167">112</span><span class="sxs-lookup"><span data-stu-id="1c01b-167">112</span></span>|<span data-ttu-id="1c01b-168">2006-10-04</span><span class="sxs-lookup"><span data-stu-id="1c01b-168">2006-10-04</span></span>|<span data-ttu-id="1c01b-169">0</span><span class="sxs-lookup"><span data-stu-id="1c01b-169">0</span></span>|  
|<span data-ttu-id="1c01b-170">2</span><span class="sxs-lookup"><span data-stu-id="1c01b-170">2</span></span>|<span data-ttu-id="1c01b-171">Abendessen</span><span class="sxs-lookup"><span data-stu-id="1c01b-171">Dinner</span></span>|<span data-ttu-id="1c01b-172">112</span><span class="sxs-lookup"><span data-stu-id="1c01b-172">112</span></span>|<span data-ttu-id="1c01b-173">2006-10-10</span><span class="sxs-lookup"><span data-stu-id="1c01b-173">2006-10-10</span></span>|<span data-ttu-id="1c01b-174">1</span><span class="sxs-lookup"><span data-stu-id="1c01b-174">1</span></span>|  
|<span data-ttu-id="1c01b-175">3</span><span class="sxs-lookup"><span data-stu-id="1c01b-175">3</span></span>|<span data-ttu-id="1c01b-176">Party</span><span class="sxs-lookup"><span data-stu-id="1c01b-176">Party</span></span>|<span data-ttu-id="1c01b-177">112</span><span class="sxs-lookup"><span data-stu-id="1c01b-177">112</span></span>|<span data-ttu-id="1c01b-178">2006-10-11</span><span class="sxs-lookup"><span data-stu-id="1c01b-178">2006-10-11</span></span>|<span data-ttu-id="1c01b-179">1</span><span class="sxs-lookup"><span data-stu-id="1c01b-179">1</span></span>|  
|<span data-ttu-id="1c01b-180">4</span><span class="sxs-lookup"><span data-stu-id="1c01b-180">4</span></span>|<span data-ttu-id="1c01b-181">Wedding</span><span class="sxs-lookup"><span data-stu-id="1c01b-181">Wedding</span></span>|<span data-ttu-id="1c01b-182">112</span><span class="sxs-lookup"><span data-stu-id="1c01b-182">112</span></span>|<span data-ttu-id="1c01b-183">2006-10-12</span><span class="sxs-lookup"><span data-stu-id="1c01b-183">2006-10-12</span></span>|<span data-ttu-id="1c01b-184">1</span><span class="sxs-lookup"><span data-stu-id="1c01b-184">1</span></span>|  
  
 <span data-ttu-id="1c01b-185">Die Ereignisse für die nächste Woche sind nunmehr als replikationsbereit markiert.</span><span class="sxs-lookup"><span data-stu-id="1c01b-185">The events for the next week are now flagged as being ready to replicate.</span></span> <span data-ttu-id="1c01b-186">Wird der Merge-Agent das nächste Mal für das Abonnement ausgeführt, das der Ereigniskoordinator 112 verwendet, werden die Zeilen 2, 3 und 4 auf den Abonnenten heruntergeladen, und die Zeile 1 wird vom Abonnenten entfernt.</span><span class="sxs-lookup"><span data-stu-id="1c01b-186">The next time the Merge Agent runs for the subscription that event coordinator 112 uses, rows 2, 3, and 4 will be downloaded to the Subscriber and row 1 will be removed from the Subscriber.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="1c01b-187">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="1c01b-187">See Also</span></span>  
 <span data-ttu-id="1c01b-188">[GETDATE &#40;Transact-SQL&#41;](/sql/t-sql/functions/getdate-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="1c01b-188">[GETDATE &#40;Transact-SQL&#41;](/sql/t-sql/functions/getdate-transact-sql) </span></span>  
 <span data-ttu-id="1c01b-189">[Implementieren von Aufträgen](../../../ssms/agent/implement-jobs.md) </span><span class="sxs-lookup"><span data-stu-id="1c01b-189">[Implement Jobs](../../../ssms/agent/implement-jobs.md) </span></span>  
 [<span data-ttu-id="1c01b-190">Parametrisierte Zeilenfilter</span><span class="sxs-lookup"><span data-stu-id="1c01b-190">Parameterized Row Filters</span></span>](parameterized-filters-parameterized-row-filters.md)  
  
  
