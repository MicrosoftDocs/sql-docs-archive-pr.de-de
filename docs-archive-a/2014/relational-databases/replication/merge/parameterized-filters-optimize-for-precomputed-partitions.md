---
title: Optimieren der Leistung parametrisierter Filter mithilfe vorausberechneter Partitionen | Microsoft-Dokumentation
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- precomputed partitions [SQL Server replication]
- merge replication precomputed partitions [SQL Server replication]
- merge replication precomputed partitions [SQL Server replication], about precomputed partitions
ms.assetid: 85654bf4-e25f-4f04-8e34-bbbd738d60fa
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 4ad0a33f0a5951256ff94bc78e7f09a88c05f227
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87724518"
---
# <a name="optimize-parameterized-filter-performance-with-precomputed-partitions"></a><span data-ttu-id="cdcc4-102">Optimieren der Leistung parametrisierter Filter mithilfe vorausberechneter Partitionen</span><span class="sxs-lookup"><span data-stu-id="cdcc4-102">Optimize Parameterized Filter Performance with Precomputed Partitions</span></span>
  <span data-ttu-id="cdcc4-103">Vorausberechnete Partitionen dienen der Leistungsoptimierung und können mit gefilterten Mergeveröffentlichungen verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-103">Precomputed partitions is a performance optimization that can be used with filtered merge publications.</span></span> <span data-ttu-id="cdcc4-104">Vorausberechnete Partitionen sind darüber hinaus eine Anforderung für die Verwendung logischer Datensätze bei gefilterten Veröffentlichungen.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-104">Precomputed partitions is also a requirement for using logical records on filtered publications.</span></span> <span data-ttu-id="cdcc4-105">Weitere Informationen zu logischen Datensätzen finden Sie unter [Gruppieren von Änderungen an verknüpften Zeilen mithilfe von logischen Datensätzen](group-changes-to-related-rows-with-logical-records.md).</span><span class="sxs-lookup"><span data-stu-id="cdcc4-105">For more information about logical records, see [Group Changes to Related Rows with Logical Records](group-changes-to-related-rows-with-logical-records.md).</span></span>  
  
 <span data-ttu-id="cdcc4-106">Wenn ein Abonnement eine Synchronisierung mit einem Verleger ausführt, muss der Verleger die Filter des Abonnenten auswerten. Dabei werden die Zeilen ermittelt, die zu dieser Abonnentenpartition oder zum Dataset gehören.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-106">When a Subscriber synchronizes with a Publisher, the Publisher must evaluate the Subscriber's filters to determine which rows belong to that Subscriber's partition, or data set.</span></span> <span data-ttu-id="cdcc4-107">Dieses Ermitteln der Partitionsmitgliedschaft von Änderungen auf dem Verleger für jeden Abonnenten, der ein gefiltertes Dataset erhält, wird *Partitionsauswertung*genannt.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-107">This process of determining partition membership of changes at the Publisher for each Subscriber receiving a filtered dataset is referred to as *partition evaluation*.</span></span> <span data-ttu-id="cdcc4-108">Ohne vorausberechnete Partitionen muss die Partitionsauswertung für jede Änderung an einer gefilterten Spalte ausgeführt werden, die auf dem Verleger vorgenommen wurde, seit der Merge-Agent zuletzt für einen bestimmten Abonnenten ausgeführt wurde. Außerdem muss dieser Vorgang dann für jeden Abonnenten wiederholt werden, der eine Synchronisierung mit dem Verleger ausführt.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-108">Without precomputed partitions, partition evaluation must be performed for each change made to a filtered column at the Publisher since the last time the Merge Agent ran for a specific Subscriber, and this process has to be repeated for every Subscriber that synchronizes with the Publisher.</span></span>  
  
 <span data-ttu-id="cdcc4-109">Wenn der Verleger und der Abonnent jedoch unter [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] oder einer höheren Version ausgeführt werden und Sie Voraus berechnete Partitionen verwenden, wird die Partitions Mitgliedschaft für alle Änderungen auf dem Verleger voraus berechnet und zum Zeitpunkt der Änderungen beibehalten.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-109">However, if the Publisher and Subscriber are running on [!INCLUDE[msCoName](../../../includes/msconame-md.md)] [!INCLUDE[ssVersion2005](../../../includes/ssversion2005-md.md)] or a later version and you use precomputed partitions, partition membership for all changes at the Publisher is precomputed and persisted at the time that the changes are made.</span></span> <span data-ttu-id="cdcc4-110">Als Folge kann ein Abonnent beim Synchronisieren mit dem Verleger sofort mit dem Download von Änderungen beginnen, die seine Partition betreffen, ohne die Partitionsauswertung durchlaufen zu müssen.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-110">As a result, when a Subscriber synchronizes with the Publisher, it can immediately start to download changes relevant to its partition without having to go through the partition evaluation process.</span></span> <span data-ttu-id="cdcc4-111">Das kann zu einer erheblichen Verbesserung der Leistung führen, wenn eine Veröffentlichung eine große Zahl von Änderungen, Abonnenten oder Artikeln aufweist.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-111">This can lead to significant performance gains when a publication has a large number of changes, Subscribers, or articles in the publication.</span></span>  
  
 <span data-ttu-id="cdcc4-112">Neben dem Verwenden von vordefinierten Partitionen generieren Sie vorab Momentaufnahmen und/oder ermöglichen Abonnenten das Anfordern der Momentaufnahmegenerierung und -anwendung beim ersten Synchronisieren.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-112">In addition to using precomputed partitions, pre-generate snapshots and/or allow Subscribers to request snapshot generation and application the first time they synchronize.</span></span> <span data-ttu-id="cdcc4-113">Verwenden Sie eine oder beide dieser Optionen, um Momentaufnahmen für Veröffentlichungen bereitzustellen, die parametrisierte Filter verwenden.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-113">Use one or both of these options to provide snapshots for publications that use parameterized filters.</span></span> <span data-ttu-id="cdcc4-114">Wenn Sie keine dieser beiden Optionen angeben, werden die Abonnements mit einer Reihe von SELECT- und INSERT-Anweisungen statt mit dem **bcp** -Hilfsprogramm initialisiert, wodurch sich der Prozess deutlich verlangsamt.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-114">If you do not specify one of these options, subscriptions are initialized using a series of SELECT and INSERT statements, rather than using the **bcp** utility; this process is much slower.</span></span> <span data-ttu-id="cdcc4-115">Weitere Informationen finden Sie unter [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span><span class="sxs-lookup"><span data-stu-id="cdcc4-115">For more information, see [Snapshots for Merge Publications with Parameterized Filters](../snapshots-for-merge-publications-with-parameterized-filters.md).</span></span>  
  
 <span data-ttu-id="cdcc4-116">**So verwenden Sie vorausberechnete Partitionen**</span><span class="sxs-lookup"><span data-stu-id="cdcc4-116">**To use precomputed partitions**</span></span>  
  
 <span data-ttu-id="cdcc4-117">Vorausberechnete Partitionen werden standardmäßig für alle neuen und vorhandenen Veröffentlichungen aktiviert, die den oben beschriebenen Richtlinien folgen.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-117">Precomputed partitions are enabled by default on all new and existing publications that adhere to the guidelines described above.</span></span> <span data-ttu-id="cdcc4-118">Die Einstellung kann mithilfe von [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] oder programmgesteuert geändert werden.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-118">The setting can be changed through [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)] or programmatically.</span></span> <span data-ttu-id="cdcc4-119">Weitere Informationen finden Sie unter [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="cdcc4-119">For more information, see [Optimize Parameterized Row Filters](../publish/optimize-parameterized-row-filters.md).</span></span>  
  
## <a name="requirements-for-using-precomputed-partitions"></a><span data-ttu-id="cdcc4-120">Anforderungen für die Verwendung vorausberechneter Partitionen</span><span class="sxs-lookup"><span data-stu-id="cdcc4-120">Requirements for Using Precomputed Partitions</span></span>  
 <span data-ttu-id="cdcc4-121">Wenn die folgenden Anforderungen erfüllt sind, werden neue Mergeveröffentlichungen standardmäßig mit vorausberechneten Partitionen aktiviert, und vorhandene Veröffentlichungen werden automatisch für die Verwendung dieser Funktion aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-121">If the following requirements are met, new merge publications are, by default, created with precomputed partitions enabled, and existing publications are automatically upgraded to use the feature.</span></span> <span data-ttu-id="cdcc4-122">Erfüllt eine Veröffentlichung die Anforderungen nicht, kann sie geändert, und anschließend können vorausberechnete Partitionen aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-122">If a publication does not meet the requirements, it can be changed, and then precomputed partitions can be enabled.</span></span> <span data-ttu-id="cdcc4-123">Wenn einige Artikel den Anforderungen entsprechen und andere nicht, können Sie gegebenenfalls zwei Partitionen erstellen, von denen eine für vorausberechnete Partitionen aktiviert wird.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-123">If some articles meet these requirements and some do not, consider creating two publications, with one enabled for precomputed partitions.</span></span>  
  
### <a name="requirements-for-filter-clauses"></a><span data-ttu-id="cdcc4-124">Anforderungen für Filterklauseln</span><span class="sxs-lookup"><span data-stu-id="cdcc4-124">Requirements for Filter Clauses</span></span>  
  
-   <span data-ttu-id="cdcc4-125">Alle in parametrisierten Zeilenfiltern verwendeten Funktionen, wie HOST_NAME() und SUSER_SNAME(), müssen direkt in die parametrisierte Filterklausel eingeschlossen sein und dürfen nicht innerhalb einer Sicht oder dynamischen Funktion geschachtelt sein.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-125">Any functions used in parameterized row filters, such as HOST_NAME() and SUSER_SNAME(), should appear directly in the parameterized filter clause and not be nested inside of a view or dynamic function.</span></span> <span data-ttu-id="cdcc4-126">Weitere Informationen zu diesen Funktionen finden Sie unter [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql), [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql) und [Parametrisierte Zeilenfilter](parameterized-filters-parameterized-row-filters.md).</span><span class="sxs-lookup"><span data-stu-id="cdcc4-126">For more information about these functions, see [HOST_NAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/host-name-transact-sql), [SUSER_SNAME &#40;Transact-SQL&#41;](/sql/t-sql/functions/suser-sname-transact-sql), and [Parameterized Row Filters](parameterized-filters-parameterized-row-filters.md).</span></span>  
  
-   <span data-ttu-id="cdcc4-127">Die nach dem Erstellen der Partition für jeden Abonnenten zurückgegebenen Werte dürfen sich nicht ändern.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-127">The values returned for each Subscriber should not change after the partition is created.</span></span> <span data-ttu-id="cdcc4-128">Wenn Sie z. B. HOST_NAME() in einem Filter verwenden (und den Wert von HOST_NAME() nicht überschreiben), ändern Sie nicht den Computernamen auf dem Abonnenten.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-128">For example, if you use HOST_NAME() in a filter (and do not override the HOST_NAME() value) do not change the computer name at the Subscriber.</span></span>  
  
-   <span data-ttu-id="cdcc4-129">Joinfilter dürfen keine dynamischen Funktionen enthalten (Funktionen wie HOST_NAME() und SUSER_SNAME(), die je nach Abonnent, der die Synchronisierung ausführt, zu einem unterschiedlichen Wert ausgewertet werden).</span><span class="sxs-lookup"><span data-stu-id="cdcc4-129">Join filters should not contain dynamic functions (functions such as HOST_NAME() and SUSER_SNAME() that evaluate to a different value depending upon the Subscriber that is synchronizing).</span></span> <span data-ttu-id="cdcc4-130">Nur parametrisierte Zeilenfilter dürfen dynamische Funktionen enthalten.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-130">Only parameterized row filters should contain dynamic functions.</span></span>  
  
-   <span data-ttu-id="cdcc4-131">Nicht deterministische Funktionen können nicht in einer Filterklausel verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-131">Nondeterministic functions cannot be used in a filter clause.</span></span> <span data-ttu-id="cdcc4-132">Weitere Informationen zu nicht deterministischen Funktionen finden Sie unter [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span><span class="sxs-lookup"><span data-stu-id="cdcc4-132">For more information about nondeterministic functions, see [Deterministic and Nondeterministic Functions](../../user-defined-functions/deterministic-and-nondeterministic-functions.md).</span></span>  
  
-   <span data-ttu-id="cdcc4-133">Sichten, auf die in Joinklauseln oder parametrisierten Filterklauseln verwiesen wird, dürfen keine dynamischen Funktionen enthalten.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-133">Views referenced in join filter clauses or parameterized filter clauses should not contain dynamic functions.</span></span>  
  
-   <span data-ttu-id="cdcc4-134">In der Veröffentlichung dürfen keine kreisförmigen Joinfilterbeziehungen enthalten sein.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-134">There should be no circular join filter relationships in the publication.</span></span>  
  
### <a name="database-collation"></a><span data-ttu-id="cdcc4-135">Datenbanksortierung</span><span class="sxs-lookup"><span data-stu-id="cdcc4-135">Database Collation</span></span>  
  
-   <span data-ttu-id="cdcc4-136">Wenn vorausberechnete Partitionen verwendet werden, wird stets die Sortierung der Datenbank zu Vergleichen herangezogen und nicht die Sortierung der Tabelle oder Spalte.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-136">When precomputed partitions are used, the collation of the database is always used when making comparisons, rather than the collation of the table or column.</span></span> <span data-ttu-id="cdcc4-137">Betrachten Sie das folgende Szenario:</span><span class="sxs-lookup"><span data-stu-id="cdcc4-137">Consider the following scenario:</span></span>  
  
    -   <span data-ttu-id="cdcc4-138">Eine Datenbank mit einer Sortierung, die Groß- und Kleinschreibung unterscheidet, enthält eine Tabelle mit einer Sortierung ohne Unterscheidung der Groß- und Kleinschreibung.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-138">A database with a case-sensitive collation contains a table with a case-insensitive collation.</span></span>  
  
    -   <span data-ttu-id="cdcc4-139">Die Tabelle enthält eine **ComputerName**-Spalte, die mit dem Hostnamen des Abonnenten in einem parametrisierten Filter verglichen wird.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-139">The table contains a column **ComputerName**, which is compared against the host name of the Subscriber in a parameterized filter.</span></span>  
  
    -   <span data-ttu-id="cdcc4-140">Die Tabelle enthält eine Spalte mit dem Wert "MYCOMPUTER" und eine Zeile mit dem Wert "mycomputer" in dieser Spalte.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-140">The table contains one row with the value "MYCOMPUTER" and one row with the value "mycomputer" in this column.</span></span>  
  
     <span data-ttu-id="cdcc4-141">Wenn der Abonnent mit dem Hostnamen "mycomputer" eine Synchronisierung ausführt, empfängt der Abonnent nur eine Zeile, da bei dem Vergleich Groß- und Kleinschreibung berücksichtigt wird (die Sortierung der Datenbank).</span><span class="sxs-lookup"><span data-stu-id="cdcc4-141">If the Subscriber synchronizes with a host name of "mycomputer", the Subscriber receives only one row because the comparison is case-sensitive (the collation of the database).</span></span> <span data-ttu-id="cdcc4-142">Werden keine vorausberechneten Partitionen verwendet, empfängt der Abonnent beide Zeilen, da die Tabelle eine Sortierung aufweist, bei der Groß- und Kleinschreibung nicht berücksichtigt wird.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-142">If precomputed partitions are not used, the Subscriber receives both rows, because the table has a case-insensitive collation.</span></span>  
  
## <a name="performance-of-precomputed-partitions"></a><span data-ttu-id="cdcc4-143">Leistung vorausberechneter Partitionen</span><span class="sxs-lookup"><span data-stu-id="cdcc4-143">Performance of Precomputed Partitions</span></span>  
 <span data-ttu-id="cdcc4-144">Bei vorausberechneten Partitionen besteht ein geringfügiger Leistungsabfall, wenn Änderungen vom Abonnenten auf den Verleger hochgeladen werden. Der Großteil der Zeit bei der Mergeverarbeitung wird jedoch für die Auswertung von Partitionen und den Download von Änderungen vom Verleger zum Abonnenten aufgewendet. Deshalb kann der Reingewinn noch immer erheblich sein.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-144">There is a small performance cost with precomputed partitions when changes are uploaded from the Subscriber to the Publisher, but the bulk of merge processing time is spent evaluating partitions and downloading changes from the Publisher to the Subscriber, so the net gain can still be significant.</span></span> <span data-ttu-id="cdcc4-145">Der Leistungsvorteil variiert je nach Anzahl der Abonnenten, die gleichzeitig eine Synchronisierung ausführen, und der Anzahl von Updates pro Synchronisierung, bei denen Zeilen zwischen Partitionen verschoben werden.</span><span class="sxs-lookup"><span data-stu-id="cdcc4-145">The performance benefit will vary, depending on the number of Subscribers synchronizing concurrently and the number of updates per synchronization that move rows from one partition to another.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="cdcc4-146">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="cdcc4-146">See Also</span></span>  
 [<span data-ttu-id="cdcc4-147">Parametrisierte Zeilenfilter</span><span class="sxs-lookup"><span data-stu-id="cdcc4-147">Parameterized Row Filters</span></span>](parameterized-filters-parameterized-row-filters.md)  
  
  
