---
title: Konflikterkennung und -lösung beim verzögerten Update über eine Warteschlange | Microsoft.Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: replication
ms.topic: conceptual
helpviewer_keywords:
- conflict resolution [SQL Server replication], queued updating subscriptions
- viewing queued updating conflicts
- conflict resolution [SQL Server replication]
- queued updating subscriptions [SQL Server replication]
- articles [SQL Server replication], conflict resolution
ms.assetid: 084ac587-25e7-4bd0-a385-556bbe07d02f
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 8c4608347ab119e25caa45b0ee4a592a953e34a4
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87622534"
---
# <a name="queued-updating-conflict-detection-and-resolution"></a><span data-ttu-id="b81a1-102">Queued Updating Conflict Detection and Resolution</span><span class="sxs-lookup"><span data-stu-id="b81a1-102">Queued Updating Conflict Detection and Resolution</span></span>
  <span data-ttu-id="b81a1-103">Da die verzögerte Aktualisierung von Abonnements über eine Warteschlange Änderungen an denselben Daten an mehreren Standorten zulässt, können Konflikte auftreten, wenn die Daten auf dem Verleger synchronisiert werden.</span><span class="sxs-lookup"><span data-stu-id="b81a1-103">Because queued updating subscriptions allow modifications to the same data at multiple locations, there may be conflicts when data is synchronized at the Publisher.</span></span> <span data-ttu-id="b81a1-104">Die Replikation erkennt alle Konflikte, wenn Änderungen mit dem Verleger synchronisiert werden, und löst die Konflikte anhand der Richtlinie zur Konfliktlösung, die Sie beim Erstellen der Veröffentlichung ausgewählt haben.</span><span class="sxs-lookup"><span data-stu-id="b81a1-104">Replication detects any conflicts when changes are synchronized with the Publisher and resolves those conflicts using the resolution policy you selected when creating the publication.</span></span> <span data-ttu-id="b81a1-105">Die folgenden Konflikte sind möglich:</span><span class="sxs-lookup"><span data-stu-id="b81a1-105">The following conflicts can occur:</span></span>  
  
-   <span data-ttu-id="b81a1-106">Update- und Einfügekonflikte.</span><span class="sxs-lookup"><span data-stu-id="b81a1-106">Update and insert conflicts.</span></span> <span data-ttu-id="b81a1-107">Diese Konflikte treten auf, wenn dieselben Daten an zwei verschiedenen Speicherorten geändert werden.</span><span class="sxs-lookup"><span data-stu-id="b81a1-107">This conflict happens when the same data is changed at two locations.</span></span> <span data-ttu-id="b81a1-108">Eine Änderung setzt sich dabei unbeabsichtigt gegen eine andere durch.</span><span class="sxs-lookup"><span data-stu-id="b81a1-108">One change wins, and the other one loses.</span></span>  
  
-   <span data-ttu-id="b81a1-109">Löschkonflikte.</span><span class="sxs-lookup"><span data-stu-id="b81a1-109">Delete conflicts.</span></span> <span data-ttu-id="b81a1-110">Diese Konflikte treten auf, wenn dieselbe Zeile an einem Speicherort gelöscht und an einem anderen bearbeitet wird.</span><span class="sxs-lookup"><span data-stu-id="b81a1-110">This conflict occurs when the same row is deleted at one location and changed at the other.</span></span>  
  
 <span data-ttu-id="b81a1-111">Die Konflikterkennung und -lösung kann ein zeitaufwändiger und ressourcenintensiver Prozess sein. Daher sollten Konflikte in der Anwendung, sofern möglich, minimiert werden, indem Sie Datenpartitionen erstellen, sodass die unterschiedlichen Abonnenten andere Datenteilmengen ändern.</span><span class="sxs-lookup"><span data-stu-id="b81a1-111">Conflict detection and resolution can be a time-consuming and resource-intensive process; therefore, it is best to minimize conflicts in the application by creating data partitions so that different Subscribers modify different subsets of data.</span></span>  
  
## <a name="detecting-conflicts"></a><span data-ttu-id="b81a1-112">Erkennen von Konflikten</span><span class="sxs-lookup"><span data-stu-id="b81a1-112">Detecting Conflicts</span></span>  
 <span data-ttu-id="b81a1-113">Beim Erstellen einer Veröffentlichung und beim Aktivieren des verzögerten Updates über eine Warteschlange fügt die Replikation eine **uniqueidentifier** -Spalte (**msrepl_tran_version**) mit dem Standardwert **newid()** der zugrunde liegenden Tabelle hinzu.</span><span class="sxs-lookup"><span data-stu-id="b81a1-113">When creating a publication and enabling queued updating, replication adds a **uniqueidentifier** column (**msrepl_tran_version**) with the default of **newid()** to the underlying table.</span></span> <span data-ttu-id="b81a1-114">Werden veröffentlichte Daten auf dem Verleger oder dem Abonnenten geändert, erhält die Zeile einen neuen Globally Unique Identifier (GUID), um anzuzeigen, dass eine neue Zeilenversion vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="b81a1-114">When published data is changed at either the Publisher or the Subscriber, the row receives a new globally unique identifier (GUID) to indicate that a new row version exists.</span></span> <span data-ttu-id="b81a1-115">Der Warteschlangenlese-Agent verwendet diese Spalte während der Synchronisierung, um zu bestimmen, ob ein Konflikt vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="b81a1-115">The Queue Reader Agent uses this column during synchronization to determine if a conflict exists.</span></span>  
  
 <span data-ttu-id="b81a1-116">Eine Transaktion in einer Warteschlange behält die alten und neuen Zeilenversionswerte bei.</span><span class="sxs-lookup"><span data-stu-id="b81a1-116">A transaction in a queue maintains the old and new row version values.</span></span> <span data-ttu-id="b81a1-117">Wird die Transaktion auf dem Verleger angewendet, werden die GUIDs von der Transaktion und der GUID in der Veröffentlichung verglichen.</span><span class="sxs-lookup"><span data-stu-id="b81a1-117">When the transaction is applied at the Publisher, the GUIDs from the transaction and the GUID in the publication are compared.</span></span> <span data-ttu-id="b81a1-118">Wenn der alte in der Transaktion gespeicherte GUID mit dem GUID in der Veröffentlichung übereinstimmt, wird die Veröffentlichung aktualisiert, und der Zeile wird der neue GUID zugewiesen, der vom Abonnenten generiert wurde.</span><span class="sxs-lookup"><span data-stu-id="b81a1-118">If the old GUID stored in the transaction matches the GUID in the publication, the publication is updated and the row is assigned the new GUID that was generated by the Subscriber.</span></span> <span data-ttu-id="b81a1-119">Durch Aktualisieren der Veröffentlichung mit dem GUID der Transaktion finden Sie übereinstimmende Zeilenversionen in der Veröffentlichung und der Transaktion.</span><span class="sxs-lookup"><span data-stu-id="b81a1-119">By updating the publication with the GUID from the transaction, you have matching row versions in the publication and in the transaction.</span></span>  
  
 <span data-ttu-id="b81a1-120">Wenn der alte in der Transaktion gespeicherte GUID nicht mit dem GUID in der Veröffentlichung übereinstimmt, wird ein Konflikt erkannt.</span><span class="sxs-lookup"><span data-stu-id="b81a1-120">If the old GUID stored in the transaction does not match the GUID in the publication, a conflict is detected.</span></span> <span data-ttu-id="b81a1-121">Der neue GUID in der Veröffentlichung zeigt an, dass zwei verschiedene Zeilenversionen vorhanden sind: eine in der Transaktion, die vom Abonnenten gesendet wird, und eine neuere, die beim Verleger vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="b81a1-121">The new GUID in the publication indicates that two different row versions exist: one in the transaction being submitted by the Subscriber and a newer one that exists on the Publisher.</span></span> <span data-ttu-id="b81a1-122">In diesem Fall hat ein anderer Abonnent oder der Verleger dieselbe Zeile in der Veröffentlichung aktualisiert, bevor diese Abonnententransaktion synchronisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="b81a1-122">In this case, another Subscriber or the Publisher updated the same row in the publication before this Subscriber transaction was synchronized.</span></span>  
  
 <span data-ttu-id="b81a1-123">Im Gegensatz zur Mergereplikation wird eine GUID-Spalte nicht zur Identifikation der eigentlichen Zeile verwendet, sondern um zu überprüfen, ob sich die Zeile geändert hat.</span><span class="sxs-lookup"><span data-stu-id="b81a1-123">Unlike merge replication, the use of a GUID column is not used to identify the row itself, but is used to check if the row has changed.</span></span>  
  
## <a name="resolving-conflicts"></a><span data-ttu-id="b81a1-124">Lösen von Konflikten</span><span class="sxs-lookup"><span data-stu-id="b81a1-124">Resolving Conflicts</span></span>  
 <span data-ttu-id="b81a1-125">Beim Erstellen einer Veröffentlichung über ein verzögertes Update wählen Sie einen Konfliktlöser aus, der verwendet werden soll, wenn Konflikte erkannt werden.</span><span class="sxs-lookup"><span data-stu-id="b81a1-125">When you create a publication using queued updating, you select a conflict resolver to be used if any conflicts are detected.</span></span> <span data-ttu-id="b81a1-126">Durch den Konfliktlöser wird bestimmt, wie der Warteschlangenlese-Agent unterschiedliche Versionen derselben Zeile behandelt, die während der Synchronisierung auftreten.</span><span class="sxs-lookup"><span data-stu-id="b81a1-126">The conflict resolver governs how the Queue Reader Agent handles different versions of the same row encountered during synchronization.</span></span> <span data-ttu-id="b81a1-127">Sie können die Vorgehensweise zur Konfliktlösung nach dem Erstellen der Veröffentlichung ändern, sofern keine Abonnements der Veröffentlichung vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="b81a1-127">You can change the conflict resolution policy after the publication is created as long as there are no subscriptions to the publication.</span></span> <span data-ttu-id="b81a1-128">Die Wahlmöglichkeiten für den Konfliktlöser sind Folgende:</span><span class="sxs-lookup"><span data-stu-id="b81a1-128">The conflict resolver choices are the following:</span></span>  
  
-   <span data-ttu-id="b81a1-129">Verleger gewinnt (Standardeinstellung)</span><span class="sxs-lookup"><span data-stu-id="b81a1-129">Publisher wins (the default)</span></span>  
  
-   <span data-ttu-id="b81a1-130">Verleger gewinnt, und das Abonnement wird erneut initialisiert</span><span class="sxs-lookup"><span data-stu-id="b81a1-130">Publisher wins and the subscription is reinitialized</span></span>  
  
-   <span data-ttu-id="b81a1-131">Abonnent gewinnt</span><span class="sxs-lookup"><span data-stu-id="b81a1-131">Subscriber wins</span></span>  
  
 <span data-ttu-id="b81a1-132">Konflikte werden aufgezeichnet und können mithilfe des Konflikt-Viewers angezeigt werden.</span><span class="sxs-lookup"><span data-stu-id="b81a1-132">Conflicts are recorded and can be viewed using the Conflict Viewer.</span></span>  
  
 <span data-ttu-id="b81a1-133">**So legen Sie die Vorgehensweise zur Konfliktlösung für das verzögerte Update über eine Warteschlange fest**</span><span class="sxs-lookup"><span data-stu-id="b81a1-133">**To set the queued updating conflict resolution policy**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="b81a1-134">: [Festlegen der Konfliktlösungsoptionen für verzögerte Updates über eine Warteschlange &#40;SQL Server Management Studio&#41;](../publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span><span class="sxs-lookup"><span data-stu-id="b81a1-134">: [Set Queued Updating Conflict Resolution Options &#40;SQL Server Management Studio&#41;](../publish/create-an-updatable-subscription-to-a-transactional-publication.md)</span></span>  
  
-   <span data-ttu-id="b81a1-135">Replikationsprogrammierung mit Transact-SQL: [Aktivieren des Aktualisierens von Abonnements für Transaktionsveröffentlichungen](../publish/enable-updating-subscriptions-for-transactional-publications.md)</span><span class="sxs-lookup"><span data-stu-id="b81a1-135">Replication Transact-SQL programming: [Enable Updating Subscriptions for Transactional Publications](../publish/enable-updating-subscriptions-for-transactional-publications.md)</span></span>  
  
 <span data-ttu-id="b81a1-136">**So zeigen Sie Datenkonflikte an**</span><span class="sxs-lookup"><span data-stu-id="b81a1-136">**To view data conflicts**</span></span>  
  
-   [!INCLUDE[ssManStudioFull](../../../includes/ssmanstudiofull-md.md)]<span data-ttu-id="b81a1-137">: [Anzeigen von Datenkonflikten für Transaktionsveröffentlichungen &#40;SQL Server Management Studio&#41;](../view-data-conflicts-for-transactional-publications-sql-server-management-studio.md)</span><span class="sxs-lookup"><span data-stu-id="b81a1-137">: [View Data Conflicts for Transactional Publications &#40;SQL Server Management Studio&#41;](../view-data-conflicts-for-transactional-publications-sql-server-management-studio.md)</span></span>  
  
### <a name="publisher-wins"></a><span data-ttu-id="b81a1-138">Verleger gewinnt</span><span class="sxs-lookup"><span data-stu-id="b81a1-138">Publisher Wins</span></span>  
 <span data-ttu-id="b81a1-139">Wenn die Konfliktlösung auf das Gewinnen des Verlegers festgelegt ist, wird die Transaktionskonsistenz basierend auf den Daten auf dem Verleger beibehalten.</span><span class="sxs-lookup"><span data-stu-id="b81a1-139">When the conflict resolution is set to the Publisher wins, transactional consistency is maintained based on the data at the Publisher.</span></span> <span data-ttu-id="b81a1-140">Es wird ein Rollback für die konfliktverursachende Transaktion auf dem Abonnenten ausgeführt, der die Transaktion initialisiert hat.</span><span class="sxs-lookup"><span data-stu-id="b81a1-140">The conflicting transaction is rolled back at the Subscriber that initiated it.</span></span>  
  
 <span data-ttu-id="b81a1-141">Der Warteschlangenlese-Agent erkennt einen Konflikt, und kompensierende Befehle werden generiert und an den Abonnenten weitergegeben, indem sie in der Verteilungsdatenbank bereitgestellt werden.</span><span class="sxs-lookup"><span data-stu-id="b81a1-141">The Queue Reader Agent detects a conflict and compensating commands are generated and propagated to the Subscriber by posting them in the distribution database.</span></span> <span data-ttu-id="b81a1-142">Der Verteilungs-Agent wendet die kompensierenden Befehle dann auf den Abonnenten an, von dem die konfliktverursachende Transaktion stammt.</span><span class="sxs-lookup"><span data-stu-id="b81a1-142">The Distribution Agent then applies the compensating commands to the Subscriber that originated the conflicting transaction.</span></span> <span data-ttu-id="b81a1-143">Durch die kompensierenden Aktionen werden die Zeilen auf dem Abonnenten so aktualisiert, dass sie mit den Zeilen auf dem Verleger übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="b81a1-143">The compensating actions update the rows on the Subscriber to match the rows on the Publisher.</span></span>  
  
 <span data-ttu-id="b81a1-144">Bis zum Anwenden der kompensierenden Befehle können die Ergebnisse einer Transaktion gelesen werden, für die schließlich ein Rollback auf dem Abonnenten ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="b81a1-144">Until the compensating commands are applied, it is possible to read the results of a transaction that will eventually be rolled back at the Subscriber.</span></span> <span data-ttu-id="b81a1-145">Dies entspricht einem Dirty Read (Isolationsstufe Read uncommitted).</span><span class="sxs-lookup"><span data-stu-id="b81a1-145">This is equivalent to a dirty read (read uncommitted isolation level).</span></span> <span data-ttu-id="b81a1-146">Eine Kompensation für die nachfolgenden abhängigen Transaktionen, die auftreten können, ist nicht vorhanden.</span><span class="sxs-lookup"><span data-stu-id="b81a1-146">There is no compensation for the subsequent dependent transactions that can occur.</span></span> <span data-ttu-id="b81a1-147">Die Transaktionsgrenzen werden jedoch berücksichtigt, und für alle Aktionen in einer Transaktion wird ein Commit oder bei einem Konflikt ein Rollback ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="b81a1-147">However, transaction boundaries are honored and all the actions within a transaction are either committed, or in the case of a conflict, rolled back.</span></span>  
  
### <a name="publisher-wins-and-the-subscription-is-reinitialized"></a><span data-ttu-id="b81a1-148">Verleger gewinnt, und das Abonnement wird erneut initialisiert</span><span class="sxs-lookup"><span data-stu-id="b81a1-148">Publisher Wins and the Subscription Is Reinitialized</span></span>  
 <span data-ttu-id="b81a1-149">Das erneute Initialisieren des Abonnenten zur Konfliktlösung behält eine strenge Transaktionskonsistenz auf dem Abonnenten bei, kann jedoch zeitaufwändig sein, wenn die Veröffentlichung viele Daten enthält.</span><span class="sxs-lookup"><span data-stu-id="b81a1-149">Reinitializing the Subscriber to resolve conflicts maintains strict transactional consistency at the Subscriber, but it can be time consuming if the publication contains large amounts of data.</span></span>  
  
 <span data-ttu-id="b81a1-150">Erkennt der Warteschlangenlese-Agent einen Konflikt, werden alle restlichen Transaktionen in der Warteschlange (einschließlich der Transaktion mit dem Konflikt) zurückgewiesen, und der Abonnent wird zur erneuten Initialisierung markiert.</span><span class="sxs-lookup"><span data-stu-id="b81a1-150">When the Queue Reader Agent detects a conflict, all remaining transactions in the queue (including the transaction in conflict) are rejected, and the Subscriber is marked for reinitialization.</span></span> <span data-ttu-id="b81a1-151">Die nächste Momentaufnahme, die für die Veröffentlichung generiert wird, wird vom Verteilungs-Agent auf den Abonnenten angewendet.</span><span class="sxs-lookup"><span data-stu-id="b81a1-151">The next snapshot generated for the publication is applied by the Distribution Agent to the Subscriber.</span></span>  
  
### <a name="subscriber-wins"></a><span data-ttu-id="b81a1-152">Abonnent gewinnt</span><span class="sxs-lookup"><span data-stu-id="b81a1-152">Subscriber Wins</span></span>  
 <span data-ttu-id="b81a1-153">Die Konflikterkennung unter der Richtlinie Abonnent gewinnt bedeutet, dass die letzte Abonnententransaktion gewinnt, die den Verleger aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="b81a1-153">Conflict detection under the Subscriber wins policy means the last Subscriber transaction to update the Publisher wins.</span></span> <span data-ttu-id="b81a1-154">Wird ein Konflikt erkannt, wird in diesem Fall die vom Abonnenten gesendete Transaktion weiterhin verwendet, und der Verleger wird aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="b81a1-154">In this case, when a conflict is detected, the transaction sent by the Subscriber is still used and the Publisher is updated.</span></span> <span data-ttu-id="b81a1-155">Diese Vorgehensweise eignet sich für Anwendungen, in denen die Datenintegrität durch diese Änderungen nicht gefährdet wird.</span><span class="sxs-lookup"><span data-stu-id="b81a1-155">This policy is suitable for applications where such changes do not compromise data integrity.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="b81a1-156">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="b81a1-156">See Also</span></span>  
 [<span data-ttu-id="b81a1-157">Updatable Subscriptions for Transactional Replication</span><span class="sxs-lookup"><span data-stu-id="b81a1-157">Updatable Subscriptions for Transactional Replication</span></span>](updatable-subscriptions-for-transactional-replication.md)  
  
  
