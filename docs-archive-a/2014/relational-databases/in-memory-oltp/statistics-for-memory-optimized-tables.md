---
title: Statistiken für speicheroptimierte Tabellen | Microsoft Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: e644766d-1d1c-43d7-83ff-8ccfe4f3af9f
author: rothja
ms.author: jroth
ms.openlocfilehash: 0ae09d76c2642e23c56afcdd5ae4e1e468ef5883
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87724674"
---
# <a name="statistics-for-memory-optimized-tables"></a><span data-ttu-id="6fa0b-102">Statistiken für speicheroptimierte Tabellen</span><span class="sxs-lookup"><span data-stu-id="6fa0b-102">Statistics for Memory-Optimized Tables</span></span>
  <span data-ttu-id="6fa0b-103">Der Abfrageoptimierer verwendet Statistiken zu Spalten zum Erstellen von Abfrageplänen, die die Abfrageleistung verbessern.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-103">The query optimizer uses statistics about columns to create query plans that improve query performance.</span></span> <span data-ttu-id="6fa0b-104">Die Statistiken werden aus den Tabellen in der Datenbank gesammelt und in den Datenbankmetadaten gespeichert.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-104">Statistics are collected from the tables in the database and stored in the database metadata.</span></span>  
  
 <span data-ttu-id="6fa0b-105">Statistiken werden automatisch erstellt, sie können jedoch auch manuell erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-105">Statistics are created automatically, but can also be created manually.</span></span> <span data-ttu-id="6fa0b-106">Beispielsweise werden Statistiken automatisch für Indexschlüsselspalten erstellt, wenn der Index erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-106">For example, statistics are created automatically for index key columns when the index is created.</span></span> <span data-ttu-id="6fa0b-107">Weitere Informationen zum Erstellen von Statistiken finden Sie unter [Statistics](../statistics/statistics.md).</span><span class="sxs-lookup"><span data-stu-id="6fa0b-107">For more information about creating statistics see [Statistics](../statistics/statistics.md).</span></span>  
  
 <span data-ttu-id="6fa0b-108">Tabellendaten ändern sich normalerweise mit der Zeit, wenn Zeilen eingefügt, aktualisiert und gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-108">Table data typically changes over time as rows are inserted, updated, and deleted.</span></span> <span data-ttu-id="6fa0b-109">Dies bedeutet, dass Statistiken regelmäßig aktualisiert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-109">This means statistics need to be updated periodically.</span></span> <span data-ttu-id="6fa0b-110">Standardmäßig werden Statistiken zu datenträgerbasierten Tabellen automatisch aktualisiert, wenn sie vom Abfrageoptimierer als möglicherweise veraltet eingestuft werden.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-110">By default, statistics on disk-based tables are updated automatically when the optimizer determines they might be out of date.</span></span>  
  
 <span data-ttu-id="6fa0b-111">Statistiken für speicheroptimierte Tabellen werden nicht standardmäßig aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-111">Statistics on memory-optimized tables are not updated by default.</span></span> <span data-ttu-id="6fa0b-112">Stattdessen müssen Sie diese manuell aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-112">Instead, you need to update them manually.</span></span> <span data-ttu-id="6fa0b-113">Verwenden Sie [Update Statistics &#40;Transact-SQL-&#41;](/sql/t-sql/statements/update-statistics-transact-sql) für einzelne Spalten, Indizes oder Tabellen.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-113">Use [UPDATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql) for individual columns, indexes, or tables.</span></span> <span data-ttu-id="6fa0b-114">Verwenden Sie [sp_updatestats &#40;Transact-SQL-&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) , um die Statistiken für alle Benutzer-und internen Tabellen in der Datenbank zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-114">Use [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) to update statistics for all user and internal tables in the database.</span></span>  
  
 <span data-ttu-id="6fa0b-115">Bei Verwendung von [CREATE STATISTICS &#40;Transact-SQL-&#41;](/sql/t-sql/statements/create-statistics-transact-sql) oder [Update Statistics &#40;Transact-SQL-&#41;](/sql/t-sql/statements/update-statistics-transact-sql)müssen Sie angeben, `NORECOMPUTE` dass die automatische Aktualisierung von Statistiken für Speicher optimierte Tabellen deaktiviert werden soll.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-115">When using [CREATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-statistics-transact-sql) or [UPDATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql), you must specify `NORECOMPUTE` to disable automatic statistics update for memory-optimized tables.</span></span> <span data-ttu-id="6fa0b-116">Bei Datenträger basierten Tabellen werden [sp_updatestats &#40;Transact-SQL-&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) nur Statistiken aktualisiert, wenn die Tabelle seit der letzten [sp_updatestats &#40;Transact-SQL-&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql)geändert wurde.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-116">For disk based tables, [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) only updates statistics if the table has been modified since the last [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql).</span></span> <span data-ttu-id="6fa0b-117">Für Speicher optimierte Tabellen generiert [sp_updatestats &#40;Transact-SQL-&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) immer aktualisierte Statistiken.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-117">For memory-optimized tables, [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) always generates updated statistics.</span></span> <span data-ttu-id="6fa0b-118">[sp_updatestats &#40;Transact-SQL-&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) ist eine gute Option für Speicher optimierte Tabellen. Andernfalls müssen Sie wissen, welche Tabellen bedeutende Änderungen aufweisen, damit Sie Statistiken einzeln aktualisieren können.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-118">[sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql) is a good option for memory-optimized tables; otherwise you need to know which tables have significant changes so you can update statistics individually.</span></span>  
  
 <span data-ttu-id="6fa0b-119">Statistiken können entweder generiert werden, indem Datenstichproben entnommen werden oder ein vollständiger Scan ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-119">Statistics can either be generated by either sampling the data or performing a full scan.</span></span> <span data-ttu-id="6fa0b-120">Bei Statistiken aus Stichproben wird die Datenverteilung nur anhand einer Stichprobe der Tabellendaten geschätzt.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-120">Sampled statistics only use a sample of the table data to estimate the data distribution.</span></span> <span data-ttu-id="6fa0b-121">Bei Statistiken auf Grundlage eines vollständigen Scans wird die gesamte Tabelle überprüft, um die Datenverteilung zu bestimmen.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-121">Fullscan statistics scan the entire table to determine the data distribution.</span></span> <span data-ttu-id="6fa0b-122">Während Statistiken, die auf einem vollständigen Scan basieren, normalerweise genauer sind, dauert die Berechnung länger.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-122">Fullscan statistics are usually more accurate but take longer to compute.</span></span> <span data-ttu-id="6fa0b-123">Aus Stichproben gewonnene Statistiken können schneller gesammelt werden.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-123">Sampled statistics can be collected faster.</span></span>  
  
 <span data-ttu-id="6fa0b-124">Für datenträgerbasierte Tabellen werden standardmäßig auf Stichproben beruhende Statistiken verwendet.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-124">Disk-based tables use sampled statistics by default.</span></span> <span data-ttu-id="6fa0b-125">Speicheroptimierte Tabellen unterstützen nur Statistiken auf Grundlage vollständiger Scans.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-125">Memory-optimized tables only support fullscan statistics.</span></span> <span data-ttu-id="6fa0b-126">Bei Verwendung von [CREATE STATISTICS &#40;Transact-SQL-&#41;](/sql/t-sql/statements/create-statistics-transact-sql) oder [Update Statistics &#40;Transact-SQL-&#41;](/sql/t-sql/statements/update-statistics-transact-sql)müssen Sie die `FULLSCAN` Option für Speicher optimierte Tabellen angeben.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-126">When using [CREATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/create-statistics-transact-sql) or [UPDATE STATISTICS &#40;Transact-SQL&#41;](/sql/t-sql/statements/update-statistics-transact-sql), you must specify the `FULLSCAN` option for memory-optimized tables.</span></span>  
  
 <span data-ttu-id="6fa0b-127">Zusätzliche Überlegungen zu Statistiken für speicheroptimierte Tabellen:</span><span class="sxs-lookup"><span data-stu-id="6fa0b-127">Additional considerations for statistics on memory-optimized tables:</span></span>  
  
-   <span data-ttu-id="6fa0b-128">Indizes für speicheroptimierten Tabellen werden mit der Tabelle erstellt.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-128">Indexes on memory-optimized tables are created with the table.</span></span> <span data-ttu-id="6fa0b-129">Die Statistiken zu den Indexschlüsselspalten werden erstellt, wenn die Tabelle leer ist.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-129">The statistics on the index key columns are created when the table is empty.</span></span> <span data-ttu-id="6fa0b-130">Daher müssen diese Statistiken aktualisiert werden, nachdem Daten in die Tabelle geladen wurden.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-130">Therefore, these statistics need to be updated after data is loaded into the table.</span></span>  
  
-   <span data-ttu-id="6fa0b-131">Für systemintern kompilierte gespeicherte Prozeduren werden Ausführungspläne für Abfragen in der Prozedur optimiert, wenn die Prozedur kompiliert wird.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-131">For natively compiled stored procedures, execution plans for queries in the procedure are optimized when the procedure is compiled.</span></span> <span data-ttu-id="6fa0b-132">Dies geschieht nur beim Erstellen der Prozedur und beim Neustart des Servers, nicht beim Aktualisieren der Statistiken.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-132">This happens only when the procedure is created and when the server restarts, not when statistics are updated.</span></span> <span data-ttu-id="6fa0b-133">Daher müssen die Tabellen eine repräsentative Menge von Daten enthalten, und die Statistiken müssen auf dem aktuellen Stand sein, bevor die Prozeduren erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-133">Therefore, the tables need to contain a representative set of data and statistics need to be up-to-date before the procedures are created.</span></span> <span data-ttu-id="6fa0b-134">(Systemintern kompilierte gespeicherte Prozeduren werden neu kompiliert, wenn die Datenbank offline und anschließend wieder online geschaltet oder der Server neu gestartet wird.)</span><span class="sxs-lookup"><span data-stu-id="6fa0b-134">(Natively compiled stored procedures are recompiled if the database is taken offline and brought back online, or if there is a server restart.)</span></span>  
  
## <a name="guidelines-for-statistics-when-deploying-memory-optimized-tables"></a><span data-ttu-id="6fa0b-135">Richtlinien für Statistiken beim Bereitstellen speicheroptimierter Tabellen</span><span class="sxs-lookup"><span data-stu-id="6fa0b-135">Guidelines for Statistics When Deploying Memory-Optimized Tables</span></span>  
 <span data-ttu-id="6fa0b-136">Um sicherzustellen, dass der Abfrageoptimierer beim Erstellen von Abfrageplänen über aktuelle Statistiken verfügt, führen Sie die folgenden fünf Schritte aus, um speicheroptimierte Tabellen bereitzustellen:</span><span class="sxs-lookup"><span data-stu-id="6fa0b-136">To ensure that the query optimizer has up-to-date statistics when creating query plans, deploy memory-optimized tables using these five steps:</span></span>  
  
1.  <span data-ttu-id="6fa0b-137">Erstellen Sie Tabellen und Indizes.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-137">Create tables and indexes.</span></span> <span data-ttu-id="6fa0b-138">Indizes werden inline in den `CREATE TABLE`-Anweisungen angegeben.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-138">Indexes are specified inline in the `CREATE TABLE` statements.</span></span>  
  
2.  <span data-ttu-id="6fa0b-139">Laden Sie Daten in die Tabellen.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-139">Load data into the tables.</span></span>  
  
3.  <span data-ttu-id="6fa0b-140">Aktualisieren Sie die Statistik zu den Tabellen.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-140">Update statistics on the tables.</span></span>  
  
4.  <span data-ttu-id="6fa0b-141">Erstellen Sie gespeicherte Prozeduren, die auf die Tabellen zugreifen.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-141">Create stored procedures that access the tables.</span></span>  
  
5.  <span data-ttu-id="6fa0b-142">Führen Sie die Arbeitsauslastung aus, die eine Kombination aus systemintern kompilierten und interpretierten gespeicherten [!INCLUDE[tsql](../../../includes/tsql-md.md)] -Prozeduren sowie Ad-hoc-Batches enthalten kann.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-142">Run the workload, which can contain a mix of natively compiled and interpreted [!INCLUDE[tsql](../../../includes/tsql-md.md)] stored procedures, as well as ad hoc batches.</span></span>  
  
 <span data-ttu-id="6fa0b-143">Indem Sie systemintern kompilierte gespeicherten Prozeduren erstellen, nachdem die Daten geladen und Statistiken aktualisiert wurden, wird sichergestellt, dass der Abfrageoptimierer über die für die speicheroptimierten Tabellen erforderlichen Statistiken verfügt.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-143">Creating natively compiled stored procedures after you load the data and update the statistics ensures that the optimizer has statistics available for the memory-optimized tables.</span></span> <span data-ttu-id="6fa0b-144">Damit liegen effiziente Abfragepläne vor, wenn die Prozedur kompiliert wird.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-144">This will ensure efficient query plans when the procedure is compiled.</span></span>  
  
## <a name="guidelines-for-maintaining-statistics-on-memory-optimized-tables"></a><span data-ttu-id="6fa0b-145">Richtlinien zum Pflegen von Statistiken für speicheroptimierte Tabellen</span><span class="sxs-lookup"><span data-stu-id="6fa0b-145">Guidelines for Maintaining Statistics on Memory-Optimized Tables</span></span>  
 <span data-ttu-id="6fa0b-146">Um die Statistiken auf dem aktuellen Stand zu halten, aktualisieren Sie die Statistiken für speicheroptimierte Tabellen regelmäßig.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-146">To keep statistics up-to-date, regularly update the statistics on memory-optimized tables.</span></span>  
  
 <span data-ttu-id="6fa0b-147">Wenn sich Daten häufig ändern, sollten Sie auch die Statistik häufig aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-147">If data changes frequently, you should update statistics frequently.</span></span> <span data-ttu-id="6fa0b-148">Aktualisieren Sie die Tabellenstatistik beispielsweise nach einem Batchupdate.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-148">For example, update table statistics after a batch update.</span></span> <span data-ttu-id="6fa0b-149">Löschen Sie nach dem Aktualisieren der Statistiken systemintern kompilierte gespeicherte Prozeduren, und erstellen Sie sie neu, sodass sie von den aktualisierten Statistiken profitieren.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-149">After you update statistics, drop and recreate natively compiled stored procedures so they can benefit from the updated statistics.</span></span>  
  
 <span data-ttu-id="6fa0b-150">.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-150">.</span></span>  
  
 <span data-ttu-id="6fa0b-151">Aktualisieren Sie Statistiken nicht während der maximalen Arbeitsauslastung.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-151">Do not update statistics during peak workload.</span></span>  
  
 <span data-ttu-id="6fa0b-152">So aktualisieren Sie Statistiken:</span><span class="sxs-lookup"><span data-stu-id="6fa0b-152">To update statistics:</span></span>  
  
-   <span data-ttu-id="6fa0b-153">Verwenden [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] zum [Erstellen eines Wartungsplans](../maintenance-plans/create-a-maintenance-plan.md) mit einem [Task "Statistiken aktualisieren](../maintenance-plans/update-statistics-task-maintenance-plan.md) "</span><span class="sxs-lookup"><span data-stu-id="6fa0b-153">Use [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)] to [Create a Maintenance Plan](../maintenance-plans/create-a-maintenance-plan.md) with an [Update Statistic Task](../maintenance-plans/update-statistics-task-maintenance-plan.md)</span></span>  
  
-   <span data-ttu-id="6fa0b-154">Sie können Statistiken auch über ein [!INCLUDE[tsql](../../../includes/tsql-md.md)]-Skript aktualisieren, wie im Folgenden erläutert.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-154">Or, update statistics through a [!INCLUDE[tsql](../../../includes/tsql-md.md)] script, as discussed below.</span></span>  
  
 <span data-ttu-id="6fa0b-155">Zum Aktualisieren der Statistiken für eine einzelne Speicher optimierte Tabelle (*MySchema*.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-155">To update the statistics for a single memory-optimized table (*myschema*.</span></span> <span data-ttu-id="6fa0b-156">*MyTable*), führen Sie das folgende Skript aus:</span><span class="sxs-lookup"><span data-stu-id="6fa0b-156">*Mytable*), run the following script:</span></span>  
  
```  
UPDATE STATISTICS myschema.Mytable WITH FULLSCAN, NORECOMPUTE  
```  
  
 <span data-ttu-id="6fa0b-157">Führen Sie zum Aktualisieren der Statistiken für alle speicheroptimierten Tabellen in der aktuellen Datenbank das folgende Skript aus:</span><span class="sxs-lookup"><span data-stu-id="6fa0b-157">To update statistics for all memory-optimized tables in the current database, run the following script:</span></span>  
  
```sql  
DECLARE @sql NVARCHAR(MAX) = N''  
  
SELECT @sql += N'  
   UPDATE STATISTICS ' + quotename(schema_name(schema_id)) + N'.' + quotename(name) + N' WITH FULLSCAN, NORECOMPUTE'  
FROM sys.tables WHERE is_memory_optimized=1  
  
EXEC sp_executesql @sql  
```  
  
 <span data-ttu-id="6fa0b-158">Um die Statistiken für alle Tabellen in der Datenbank zu aktualisieren, führen Sie [sp_updatestats &#40;Transact-SQL-&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql)aus.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-158">To update statistics for all tables in the database, run [sp_updatestats &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-updatestats-transact-sql).</span></span>  
  
 <span data-ttu-id="6fa0b-159">Im folgenden Beispiel wird ausgegeben, wann die Statistiken für speicheroptimierte Tabellen zuletzt aktualisiert wurden.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-159">The following sample reports when the statistics on memory-optimized tables were last updated.</span></span> <span data-ttu-id="6fa0b-160">Anhand dieser Informationen können Sie entscheiden, ob die Statistiken aktualisiert werden müssen.</span><span class="sxs-lookup"><span data-stu-id="6fa0b-160">This information can help you decide if you need to update the statistics.</span></span>  
  
```sql  
select t.object_id, t.name, sp.last_updated as 'stats_last_updated'  
from sys.tables t join sys.stats s on t.object_id=s.object_id cross apply sys.dm_db_stats_properties(t.object_id, s.stats_id) sp  
where t.is_memory_optimized=1  
```  
  
## <a name="see-also"></a><span data-ttu-id="6fa0b-161">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="6fa0b-161">See Also</span></span>  
 [<span data-ttu-id="6fa0b-162">Speicheroptimierte Tabellen</span><span class="sxs-lookup"><span data-stu-id="6fa0b-162">Memory-Optimized Tables</span></span>](memory-optimized-tables.md)  
  
  
