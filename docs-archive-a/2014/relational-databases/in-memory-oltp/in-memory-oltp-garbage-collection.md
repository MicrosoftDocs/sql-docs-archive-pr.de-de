---
title: In-Memory OLTP-Garbage Collection | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 940140a7-4785-46fc-8bf4-151435dccd3c
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 23997d3664fb48902d2be08bbb22d2189c832298
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87723882"
---
# <a name="in-memory-oltp-garbage-collection"></a><span data-ttu-id="f94ab-102">In-Memory OLTP-Garbage Collection</span><span class="sxs-lookup"><span data-stu-id="f94ab-102">In-Memory OLTP Garbage Collection</span></span>
  <span data-ttu-id="f94ab-103">Eine Datenzeile wird als veraltet betrachtet, wenn sie durch eine nicht mehr aktive Transaktion gelöscht wurde.</span><span class="sxs-lookup"><span data-stu-id="f94ab-103">A data row is considered stale if it was deleted by a transaction that is no longer active.</span></span> <span data-ttu-id="f94ab-104">Eine veraltete Zeile kann durch die Garbage Collection bereinigt werden.</span><span class="sxs-lookup"><span data-stu-id="f94ab-104">A stale row is eligible for garbage collection.</span></span> <span data-ttu-id="f94ab-105">Die Garbage Collection in [!INCLUDE[hek_2](../../includes/hek-2-md.md)]weist die folgenden Merkmale auf:</span><span class="sxs-lookup"><span data-stu-id="f94ab-105">The following are characteristics of garbage collection in [!INCLUDE[hek_2](../../includes/hek-2-md.md)]:</span></span>  
  
-   <span data-ttu-id="f94ab-106">Nicht blockierend.</span><span class="sxs-lookup"><span data-stu-id="f94ab-106">Non-blocking.</span></span> <span data-ttu-id="f94ab-107">Die Garbage Collection erfolgt über einen längeren Zeitraum und wirkt sich nur minimal auf die Arbeitsauslastung aus.</span><span class="sxs-lookup"><span data-stu-id="f94ab-107">Garbage collection is distributed over time with minimal impact on the workload.</span></span>  
  
-   <span data-ttu-id="f94ab-108">Kooperativ.</span><span class="sxs-lookup"><span data-stu-id="f94ab-108">Cooperative.</span></span> <span data-ttu-id="f94ab-109">Benutzertransaktionen nehmen über den GC-Hauptthread an der Garbage Collection teil.</span><span class="sxs-lookup"><span data-stu-id="f94ab-109">User transactions participate in garbage collection with main garbage-collection thread.</span></span>  
  
-   <span data-ttu-id="f94ab-110">Effizient.</span><span class="sxs-lookup"><span data-stu-id="f94ab-110">Efficient.</span></span> <span data-ttu-id="f94ab-111">Benutzertransaktionen löschen die Verknüpfungen veralteter Zeilen aus dem verwendeten Zugriffspfad (dem Index).</span><span class="sxs-lookup"><span data-stu-id="f94ab-111">User transactions delink stale rows in the access path (the index) being used.</span></span> <span data-ttu-id="f94ab-112">Dadurch wird der erforderliche Aufwand bei der endgültigen Entfernung der Zeile verringert.</span><span class="sxs-lookup"><span data-stu-id="f94ab-112">This reduces the work required when the row is finally removed.</span></span>  
  
-   <span data-ttu-id="f94ab-113">Reaktionsschnell.</span><span class="sxs-lookup"><span data-stu-id="f94ab-113">Responsive.</span></span> <span data-ttu-id="f94ab-114">Hohe Arbeitsspeicherauslastung führt zu aggressiver Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="f94ab-114">Memory pressure leads to aggressive garbage collection.</span></span>  
  
-   <span data-ttu-id="f94ab-115">Skalierbar.</span><span class="sxs-lookup"><span data-stu-id="f94ab-115">Scalable.</span></span> <span data-ttu-id="f94ab-116">Nach dem Commit übernehmen Benutzertransaktionen einen Teil der Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="f94ab-116">After commit, user transactions do part of the work of garbage collection.</span></span> <span data-ttu-id="f94ab-117">Je höher die Transaktionsaktivität, umso mehr werden Verknüpfungen veralteter Zeilen von den Transaktionen entfernt.</span><span class="sxs-lookup"><span data-stu-id="f94ab-117">The more transaction activity, the more the transactions delink stale rows.</span></span>  
  
 <span data-ttu-id="f94ab-118">Die Garbage Collection wird vom GC-Hauptthread gesteuert.</span><span class="sxs-lookup"><span data-stu-id="f94ab-118">Garbage collection is controlled by the main garbage collection thread.</span></span> <span data-ttu-id="f94ab-119">Dieser GC-Hauptthread wird einmal pro Minute ausgeführt oder wenn die Anzahl der Transaktionen, für die ein Commit ausgeführt wurde, einen internen Schwellenwert überschreitet.</span><span class="sxs-lookup"><span data-stu-id="f94ab-119">The main garbage collection thread runs every minute, or when the number of committed transactions exceeds an internal threshold.</span></span> <span data-ttu-id="f94ab-120">Aufgaben der Garbage Collection:</span><span class="sxs-lookup"><span data-stu-id="f94ab-120">The task of the garbage collector is to:</span></span>  
  
-   <span data-ttu-id="f94ab-121">Identifizieren der Transaktionen, durch die eine Reihe von Zeilen gelöscht oder aktualisiert wurden und für die vor der ältesten aktiven Transaktion ein Commit ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="f94ab-121">Identify transactions that have deleted or updated a set of rows and have committed before the oldest active transaction.</span></span>  
  
-   <span data-ttu-id="f94ab-122">Identifizieren von Zeilenversionen, die durch diese alten Transaktionen erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="f94ab-122">Identity row versions created by these old transactions.</span></span>  
  
-   <span data-ttu-id="f94ab-123">Gruppieren alter Zeilen in einer oder mehrere Einheiten von jeweils 16 Zeilen.</span><span class="sxs-lookup"><span data-stu-id="f94ab-123">Group old rows into one or more units of 16 rows each.</span></span> <span data-ttu-id="f94ab-124">Dadurch wird die Arbeitslast der Garbage Collection auf kleinere Einheiten verteilt.</span><span class="sxs-lookup"><span data-stu-id="f94ab-124">This is done to distribute the work of the garbage collector into smaller units.</span></span>  
  
-   <span data-ttu-id="f94ab-125">Verschieben dieser Arbeitseinheiten in die Warteschlange der Garbage Collection (eine für jedes Zeitplanungsmodul).</span><span class="sxs-lookup"><span data-stu-id="f94ab-125">Move these work units into the garbage collection queue, one for each scheduler.</span></span> <span data-ttu-id="f94ab-126">Ausführliche Informationen finden Sie in den Garbage Collector-DMVs: [sys.dm_xtp_gc_stats &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xtp-gc-stats-transact-sql), [sys.dm_db_xtp_gc_cycle_stats &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-gc-cycle-stats-transact-sql) und [sys.dm_xtp_gc_queue_stats &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xtp-gc-queue-stats-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f94ab-126">Refer to the garbage collector DMVs for the details: [sys.dm_xtp_gc_stats &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xtp-gc-stats-transact-sql), [sys.dm_db_xtp_gc_cycle_stats &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-gc-cycle-stats-transact-sql), and [sys.dm_xtp_gc_queue_stats &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-xtp-gc-queue-stats-transact-sql).</span></span>  
  
 <span data-ttu-id="f94ab-127">Nachdem für eine Benutzertransaktion ein Commit ausgeführt wurde, identifiziert sie alle Elemente in der Warteschlange, die dem Zeitplanungsmodul zugeordnet sind, in dem sie ausgeführt wurde, und gibt dann den Arbeitsspeicher frei.</span><span class="sxs-lookup"><span data-stu-id="f94ab-127">After a user transaction commits, it identifies all queued items associated with the scheduler it ran on and then releases the memory.</span></span> <span data-ttu-id="f94ab-128">Wenn die Garbage Collection-Warteschlange im Zeitplanungsmodul leer ist, wird nach einer nicht leeren Warteschlange im aktuellen NUMA-Knoten gesucht.</span><span class="sxs-lookup"><span data-stu-id="f94ab-128">If the garbage collection queue on the scheduler is empty, it searches for any non-empty queue in the current NUMA node.</span></span> <span data-ttu-id="f94ab-129">Bei einer geringen Transaktionsaktivität und nicht ausreichendem Arbeitsspeicher kann der Garbage Collector-Hauptthread auf GC-Zeilen aus einer beliebigen Warteschlange zugreifen.</span><span class="sxs-lookup"><span data-stu-id="f94ab-129">If there is low transactional activity and there is memory pressure, the main garbage-collection thread can access garbage collect rows from any queue.</span></span> <span data-ttu-id="f94ab-130">Wenn beispielsweise nach dem Löschen einer großen Anzahl von Zeilen keine Transaktionsaktivität erfolgt und kein Engpass bei der Arbeitsspeicherverfügbarkeit besteht, werden die gelöschten Zeilen erst wieder durch die Garbage Collection bereinigt, wenn die Transaktionsaktivität fortgesetzt wird bzw. nicht mehr genügend Arbeitsspeicher zur Verfügung steht.</span><span class="sxs-lookup"><span data-stu-id="f94ab-130">If there is no transactional activity after (for example) deleting a large number of rows and there is no memory pressure, the deleted rows will not be garbage collected until the transactional activity resumes or there is memory pressure.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f94ab-131">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="f94ab-131">See Also</span></span>  
 [<span data-ttu-id="f94ab-132">Verwalten des Arbeitsspeichers für In-Memory-OLTP</span><span class="sxs-lookup"><span data-stu-id="f94ab-132">Managing Memory for In-Memory OLTP</span></span>](../../database-engine/managing-memory-for-in-memory-oltp.md)  
  
  
