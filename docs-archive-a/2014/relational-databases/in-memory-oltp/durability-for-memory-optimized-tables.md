---
title: Dauerhaftigkeit für speicheroptimierte Tabellen | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: d304c94d-3ab4-47b0-905d-3c8c2aba9db6
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 1d48d671b23d7b7b17557e7829d6f2522c375acd
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87722833"
---
# <a name="durability-for-memory-optimized-tables"></a><span data-ttu-id="129fb-102">Dauerhaftigkeit für speicheroptimierte Tabellen</span><span class="sxs-lookup"><span data-stu-id="129fb-102">Durability for Memory-Optimized Tables</span></span>
  [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] <span data-ttu-id="129fb-103">bietet vollständige Dauerhaftigkeit für speicheroptimierte Tabellen.</span><span class="sxs-lookup"><span data-stu-id="129fb-103">provides full durability for memory-optimized tables.</span></span> <span data-ttu-id="129fb-104">Wenn für eine Transaktion, durch die eine speicheroptimierte Tabelle geändert wurde, ein Commit ausgeführt wird, gewährleistet [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (genauso wie bei datenträgerbasierten Tabellen), dass die Änderungen dauerhaft sind (bei einem Neustart der Datenbank erhalten bleiben), vorausgesetzt der zugrunde liegende Speicher ist verfügbar.</span><span class="sxs-lookup"><span data-stu-id="129fb-104">When a transaction that changed a memory-optimized table commits, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] (as it does for disk-based tables), guarantees that the changes are permanent (will survive a database restart), provided the underlying storage is available.</span></span> <span data-ttu-id="129fb-105">Die Dauerhaftigkeit basiert auf zwei Hauptmechanismen: der Transaktionsprotokollierung und der dauerhaften Speicherung von Datenänderungen auf einem Datenträger.</span><span class="sxs-lookup"><span data-stu-id="129fb-105">There are two key components of durability: transaction logging and persisting data changes to on-disk storage.</span></span>

## <a name="transaction-log"></a><span data-ttu-id="129fb-106">Transaktionsprotokoll</span><span class="sxs-lookup"><span data-stu-id="129fb-106">Transaction Log</span></span>
 <span data-ttu-id="129fb-107">Alle Änderungen, die an datenträgerbasierten oder dauerhaften speicheroptimierten Tabellen vorgenommen werden, werden in einem oder mehreren Transaktionsprotokoll-Datensätzen erfasst.</span><span class="sxs-lookup"><span data-stu-id="129fb-107">All changes made to disk-based tables or durable memory-optimized tables are captured in one or more transaction log records.</span></span> <span data-ttu-id="129fb-108">Wenn für eine Transaktion ein Commit ausgeführt wird, werden die mit der Transaktion verknüpften Protokolldatensätze von [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] auf den Datenträger geschrieben, bevor der Anwendung oder Benutzersitzung mitgeteilt wird, dass der Commit für die Transaktion abgeschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="129fb-108">When a transaction commits, [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] writes the log records associated with the transaction to disk before communicating to the application or user session that the transaction has committed.</span></span> <span data-ttu-id="129fb-109">So wird sichergestellt, dass die von der Transaktion vorgenommenen Änderungen dauerhaft sind.</span><span class="sxs-lookup"><span data-stu-id="129fb-109">This guarantees that changes made by the transaction are durable.</span></span> <span data-ttu-id="129fb-110">Das Transaktionsprotokoll für speicheroptimierte Tabellen ist vollständig in den Protokolldatenstrom integriert, der auch von datenträgerbasierten Tabellen verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="129fb-110">The transaction log for memory-optimized tables is fully integrated with the same log stream used by disk-based tables.</span></span> <span data-ttu-id="129fb-111">Durch diese Integration sind vorhandene, für das Transaktionsprotokoll ausgeführte Sicherungs- und Wiederherstellungsvorgänge ohne zusätzliche Schritte weiterhin funktionsfähig.</span><span class="sxs-lookup"><span data-stu-id="129fb-111">This integration allows existing transaction log backup, recover, and restore operations to continue to work without requiring any additional steps.</span></span> <span data-ttu-id="129fb-112">Da der Transaktionsdurchsatz der Arbeitsauslastung durch [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] jedoch deutlich anwachsen kann, müssen Sie sicherstellen, dass der Transaktionsprotokollspeicher für die Verarbeitung der erhöhten E/A-Anforderungen entsprechend konfiguriert wird.</span><span class="sxs-lookup"><span data-stu-id="129fb-112">However, since [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] can increase transaction throughput of your workload significantly, you need to make sure that transaction log storage is configured appropriately to handle the increased IO requirements.</span></span>

## <a name="data-and-delta-files"></a><span data-ttu-id="129fb-113">Daten- und Änderungsdateien</span><span class="sxs-lookup"><span data-stu-id="129fb-113">Data and Delta Files</span></span>
 <span data-ttu-id="129fb-114">Die Daten in speicheroptimierten Tabellen werden als Freiform-Datenzeilen gespeichert, die durch mindestens einen Index im Arbeitsspeicher verknüpft sind.</span><span class="sxs-lookup"><span data-stu-id="129fb-114">The data in memory-optimized tables is stored as free-form data rows that are linked through one or more in-memory indexes, in memory.</span></span> <span data-ttu-id="129fb-115">Datenzeilen weisen im Gegensatz zu datenträgerbasierten Tabellen keine Seitenstrukturen auf.</span><span class="sxs-lookup"><span data-stu-id="129fb-115">There are no page structures for data rows, such as those used for disk-based tables.</span></span> <span data-ttu-id="129fb-116">Sobald von der Anwendung ein Commit für die Transaktion ausgeführt werden kann, werden die Protokolldatensätze für die Transaktion von [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] generiert.</span><span class="sxs-lookup"><span data-stu-id="129fb-116">When the application is ready to commit the transaction, the [!INCLUDE[hek_2](../../../includes/hek-2-md.md)] generates the log records for the transaction.</span></span> <span data-ttu-id="129fb-117">Die Persistenz speicheroptimierter Tabellen wird mit einer Reihe von Daten- und Änderungsdateien unter Verwendung eines Hintergrundthreads erzielt.</span><span class="sxs-lookup"><span data-stu-id="129fb-117">The persistence of memory-optimized tables is done with a set of data and delta files using a background thread.</span></span> <span data-ttu-id="129fb-118">Die Daten- und Änderungsdateien sind in einem oder mehreren Containern enthalten (und nutzen denselben Mechanismus wie für FILESTREAM-Daten).</span><span class="sxs-lookup"><span data-stu-id="129fb-118">The data and delta files are located in one or more containers (using the same mechanism used for FILESTREAM data).</span></span> <span data-ttu-id="129fb-119">Diese Container werden einer neuen Art von Dateigruppe, einer sogenannten speicheroptimierten Dateigruppe, zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="129fb-119">These containers are mapped to a new type of filegroup, called a memory-optimized filegroup.</span></span>

 <span data-ttu-id="129fb-120">Daten werden in diese Dateien streng sequenziell geschrieben. Dadurch wird die Datenträgerlatenz für herkömmliche Medien minimiert.</span><span class="sxs-lookup"><span data-stu-id="129fb-120">Data is written to these files in a strictly sequential fashion, which minimizes disk latency for spinning media.</span></span> <span data-ttu-id="129fb-121">Sie können mehrere Container auf verschiedenen Datenträgern verwenden, um die E/A-Aktivität zu verteilen.</span><span class="sxs-lookup"><span data-stu-id="129fb-121">You can use multiple containers on different disks to distribute the I/O activity.</span></span> <span data-ttu-id="129fb-122">Daten- und Änderungsdateien in mehreren Containern auf verschiedenen Datenträgern verbessern die Wiederherstellungsleistung, wenn Daten aus den Daten- und Änderungsdateien auf dem Datenträger in den Arbeitsspeicher gelesen werden.</span><span class="sxs-lookup"><span data-stu-id="129fb-122">Data and delta files in multiple containers on different disks will increase recovery performance when data is read from the data and delta files on disk, into memory.</span></span>

 <span data-ttu-id="129fb-123">Eine Anwendung greift nicht direkt auf Daten- und Änderungsdateien zu.</span><span class="sxs-lookup"><span data-stu-id="129fb-123">An application does not directly access data and delta files.</span></span> <span data-ttu-id="129fb-124">Alle Datenlese- und -schreibvorgänge verwenden speicherinterne Daten.</span><span class="sxs-lookup"><span data-stu-id="129fb-124">All data reads and writes use in-memory data.</span></span>

### <a name="the-data-file"></a><span data-ttu-id="129fb-125">Die Datendatei</span><span class="sxs-lookup"><span data-stu-id="129fb-125">The Data File</span></span>
 <span data-ttu-id="129fb-126">Eine Datendatei enthält Zeilen aus einer oder mehreren speicheroptimierten Tabellen, die von mehreren Transaktionen im Rahmen eines INSERT- oder UPDATE-Vorgangs eingefügt wurden.</span><span class="sxs-lookup"><span data-stu-id="129fb-126">A data file contains rows from one or more memory-optimized tables that were inserted by multiple transactions as part of INSERT or UPDATE operations.</span></span> <span data-ttu-id="129fb-127">Beispielsweise können eine Zeile aus der speicheroptimierten Tabelle T1 und die nächste Zeile aus der speicheroptimierten Tabelle T2 stammen.</span><span class="sxs-lookup"><span data-stu-id="129fb-127">For example, one row can be from memory-optimized table T1 and the next row can be from memory-optimized table T2.</span></span> <span data-ttu-id="129fb-128">Die Zeilen werden an die Datendatei in der Transaktionsreihenfolge im Transaktionsprotokoll angefügt, sodass sequenzieller Datenzugriff gewährleistet wird.</span><span class="sxs-lookup"><span data-stu-id="129fb-128">The rows are appended to the data file in the order of transactions in the transaction log, making data access sequential.</span></span> <span data-ttu-id="129fb-129">Dies ermöglicht im Vergleich zu zufälliger E/A einen erheblich besseren E/A-Durchsatz.</span><span class="sxs-lookup"><span data-stu-id="129fb-129">This enables an order of magnitude better I/O throughput compared to random I/O.</span></span> <span data-ttu-id="129fb-130">Auf Computern mit einer Arbeitsspeicherkapazität über 16 GB beträgt die Größe jeder Datendatei ungefähr 128 MB, und auf Computern mit einer Arbeitsspeicherkapazität bis 16 GB beträgt die Größe 16 MB.</span><span class="sxs-lookup"><span data-stu-id="129fb-130">Each data file is sized approximately to 128MB for computers with memory greater than 16GB, and 16MB for computers with less than or equal to 16GB.</span></span> <span data-ttu-id="129fb-131">Sobald die Datendatei voll ist, werden die Zeilen, die durch neue Transaktionen eingefügt werden, in einer weiteren Datendatei gespeichert.</span><span class="sxs-lookup"><span data-stu-id="129fb-131">Once the data file is full, the rows inserted by new transactions are stored in another data file.</span></span> <span data-ttu-id="129fb-132">Im Laufe der Zeit werden die Zeilen aus dauerhaften speicheroptimierten Tabellen in einer oder mehreren Datendateien gespeichert, die Zeilen aus einem disjunkten, aber zusammenhängenden Bereich von Transaktionen enthalten.</span><span class="sxs-lookup"><span data-stu-id="129fb-132">Over time, the rows from durable memory-optimized tables are stored in one of more data files and each data file containing rows from a disjoint but contiguous range of transactions.</span></span> <span data-ttu-id="129fb-133">Beispielsweise enthält eine Datendatei, deren Zeitstempel für den Transaktionscommit im Bereich (100, 200) liegt, alle Zeilen, die von Transaktionen mit einem Commitzeitstempel größer als 100 und kleiner oder gleich 200 eingefügt wurden.</span><span class="sxs-lookup"><span data-stu-id="129fb-133">For example a data file with transaction commit timestamp in the range of (100, 200) has all the rows inserted by transactions that have commit timestamp greater than 100 and less than or equal to 200.</span></span> <span data-ttu-id="129fb-134">Beim Commitzeitstempel handelt es sich um eine monoton ansteigende Zahl, die einer Transaktion zugewiesen wird, sobald sie für den Commit bereit ist.</span><span class="sxs-lookup"><span data-stu-id="129fb-134">The commit timestamp is a monotonically increasing number assigned to a transaction when it is ready to commit.</span></span> <span data-ttu-id="129fb-135">Jede Transaktion besitzt einen eindeutigen Commitzeitstempel.</span><span class="sxs-lookup"><span data-stu-id="129fb-135">Each transaction has a unique commit timestamp.</span></span>

 <span data-ttu-id="129fb-136">Wenn eine Zeile gelöscht oder aktualisiert wird, wird die Zeile in der Datendatei nicht entfernt oder direkt geändert. Stattdessen werden die gelöschten Zeilen in einem anderen Typ von Datei, der Änderungsdatei, nachverfolgt.</span><span class="sxs-lookup"><span data-stu-id="129fb-136">When a row is deleted or updated, the row is not removed or changed in-place in the data file but the deleted rows are tracked in another type of file: the delta file.</span></span> <span data-ttu-id="129fb-137">Updatevorgänge werden für jede einzelne Zeile als Tupel von Lösch- und Einfügevorgängen verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="129fb-137">Update operations are processed as a tuple of delete and insert operations for each row.</span></span> <span data-ttu-id="129fb-138">Dadurch werden zufällige E/A-Vorgänge für die Datendatei verhindert.</span><span class="sxs-lookup"><span data-stu-id="129fb-138">This eliminates random IO on the data file.</span></span>

### <a name="the-delta-file"></a><span data-ttu-id="129fb-139">Die Änderungsdatei</span><span class="sxs-lookup"><span data-stu-id="129fb-139">The Delta File</span></span>
 <span data-ttu-id="129fb-140">Jeder Datendatei ist eine entsprechende Änderungsdatei zugeordnet, die den gleichen Transaktionsbereich besitzt und die gelöschten Zeilen nachverfolgt, die von Transaktionen im Transaktionsbereich eingefügt wurden.</span><span class="sxs-lookup"><span data-stu-id="129fb-140">Each data file is paired with a delta file that has the same transaction range and tracks the deleted rows inserted by transactions in the transaction range.</span></span> <span data-ttu-id="129fb-141">Die Daten- und Änderungsdatei wird als Prüfpunktdateipaar (CFP, Checkpoint File Pair) bezeichnet. Sie stellt die Zuordnungs- und die Zuordnungsaufhebungseinheit sowie die Einheit für Zusammenführungsvorgänge dar.</span><span class="sxs-lookup"><span data-stu-id="129fb-141">This data and delta file is referred to as a Checkpoint File Pair (CFP) and it is the unit of allocation and deallocation as well as the unit for Merge operations.</span></span> <span data-ttu-id="129fb-142">Beispielsweise werden in einer Änderungsdatei, die dem Transaktionsbereich (100, 200) entspricht, gelöschte Zeilen gespeichert, die von Transaktionen im Bereich (100, 200) eingefügt wurden.</span><span class="sxs-lookup"><span data-stu-id="129fb-142">For example, a delta file corresponding to transaction range (100, 200) will store deleted rows that were inserted by transactions in the range (100, 200).</span></span> <span data-ttu-id="129fb-143">Genau wie bei Datendateien wird auf Änderungsdateien sequenziell zugegriffen.</span><span class="sxs-lookup"><span data-stu-id="129fb-143">Like data files, the delta file is accessed sequentially.</span></span>

 <span data-ttu-id="129fb-144">Wenn eine Zeile gelöscht wird, wird die Zeile nicht aus der Datendatei entfernt, sondern es wird ein Verweis auf die Zeile an die Änderungsdatei angefügt, die dem Transaktionsbereich zugeordnet ist, in dem diese Zeile eingefügt wurde.</span><span class="sxs-lookup"><span data-stu-id="129fb-144">When a row is deleted, the row is not removed from the data file but a reference to the row is appended to the delta file associated with the transaction range where this data row was inserted.</span></span> <span data-ttu-id="129fb-145">Da die zu löschende Zeile bereits in der Datendatei vorhanden ist, werden in der Änderungsdatei nur die Verweisinformationen `{inserting_tx_id, row_id, deleting_tx_id }` gespeichert, und sie folgt dabei der Reihenfolge der ursprünglichen DELETE- oder UPDATE-Vorgänge im Transaktionsprotokoll.</span><span class="sxs-lookup"><span data-stu-id="129fb-145">Since the row to be deleted already exists in the data file, the delta file only stores the reference information `{inserting_tx_id, row_id, deleting_tx_id }` and it follows the transactional log order of the originating delete or update operations.</span></span>

## <a name="populating-data-and-delta-files"></a><span data-ttu-id="129fb-146">Auffüllen von Daten- und Änderungsdateien</span><span class="sxs-lookup"><span data-stu-id="129fb-146">Populating Data and Delta Files</span></span>
 <span data-ttu-id="129fb-147">Daten- und Änderungsdateien werden von einem Hintergrundthread aufgefüllt, der Offline-Prüfpunkt genannt wird.</span><span class="sxs-lookup"><span data-stu-id="129fb-147">Data and delta file are populated by a background thread called offline checkpoint.</span></span> <span data-ttu-id="129fb-148">Dieser Thread liest die Datensätze des Transaktionsprotokolls, die von Transaktionen für speicheroptimierte Tabellen generiert wurden, für die ein Commit ausgeführt wurde. Die Informationen über die eingefügten und gelöschten Zeilen werden an die entsprechenden Daten- und Änderungsdateien angehängt.</span><span class="sxs-lookup"><span data-stu-id="129fb-148">This thread reads the transaction log records generated by committed transactions on memory-optimized tables and appends information about the inserted and deleted rows into appropriate data and delta files.</span></span> <span data-ttu-id="129fb-149">Im Gegensatz zu datenträgerbasierte Tabellen, bei denen Daten-/Indexseiten in zufälligen E/A-Vorgängen nach einem Prüfpunkt geleert werden, wird die Persistenz von speicheroptimierten Tabellen in einem kontinuierlichen Hintergrundvorgang erreicht.</span><span class="sxs-lookup"><span data-stu-id="129fb-149">Unlike disk-based tables where data/index pages are flushed with random I/O when checkpoint is done, the persistence of memory-optimized table is continuous background operation.</span></span> <span data-ttu-id="129fb-150">Es wird auf mehrere Änderungsdateien zugegriffen, da alle Zeilen, die durch beliebige vorherige Transaktionen eingefügt wurden, durch eine Transaktion gelöscht oder aktualisiert werden können.</span><span class="sxs-lookup"><span data-stu-id="129fb-150">Multiple delta files are accessed because a transaction can delete or update any row that was inserted by any previous transaction.</span></span> <span data-ttu-id="129fb-151">Löschinformationen werden immer am Ende der Änderungsdatei angefügt.</span><span class="sxs-lookup"><span data-stu-id="129fb-151">Deletion information is always appended at the end of the delta file.</span></span> <span data-ttu-id="129fb-152">Eine Transaktion mit einem Commitzeitstempel von 600 fügt eine neue Zeile ein und löscht Zeilen, die durch Transaktionen mit einem Commitzeitstempel von 150, 250 und 450 eingefügt wurden, wie in der Abbildung unten dargestellt.</span><span class="sxs-lookup"><span data-stu-id="129fb-152">For example, a transaction with a commit timestamp of 600 inserts one new row and deletes rows inserted by transactions with a commit timestamp of 150, 250 and 450 as shown in the picture below.</span></span> <span data-ttu-id="129fb-153">Alle vier Datei-E/A-Vorgänge (drei für gelöschte Zeilen und einer für neu eingefügte Zeilen) sind reine Anfügungen an die entsprechenden Änderungs- und Datendateien.</span><span class="sxs-lookup"><span data-stu-id="129fb-153">All 4 file I/O operations (three for deleted rows and 1 for the newly inserted rows), are append-only operations to the corresponding delta and data files.</span></span>

 <span data-ttu-id="129fb-154">![Protokolldatensätze für speicheroptimierte Tabellen lesen](../../database-engine/media/read-logs-hekaton.gif "Protokolldatensätze für speicheroptimierte Tabellen lesen")</span><span class="sxs-lookup"><span data-stu-id="129fb-154">![Read log records for memory-optimized tables.](../../database-engine/media/read-logs-hekaton.gif "Read log records for memory-optimized tables.")</span></span>

## <a name="accessing-data-and-delta-files"></a><span data-ttu-id="129fb-155">Zugreifen auf Daten- und Änderungsdateien</span><span class="sxs-lookup"><span data-stu-id="129fb-155">Accessing Data and Delta Files</span></span>
 <span data-ttu-id="129fb-156">Auf Daten-/Änderungsdateipaare wird in den folgenden Fällen zugegriffen:</span><span class="sxs-lookup"><span data-stu-id="129fb-156">Data and delta file pairs are accessed when the following occurs.</span></span>

 <span data-ttu-id="129fb-157">Offline-Prüf Punkt Thread dieser Thread fügt Einfügungen und Löschungen an Speicher optimierte Daten Zeilen an die entsprechenden Daten-und Änderungsdatei Paare an.</span><span class="sxs-lookup"><span data-stu-id="129fb-157">Offline checkpoint thread This thread appends inserts and deletes to memory-optimized data rows, to the corresponding data and delta file pairs.</span></span>

 <span data-ttu-id="129fb-158">Merge Operation der Vorgang führt ein oder mehrere Daten-und Änderungsdatei Paare zusammen und erstellt ein neues Daten-/Änderungsdatei Paar.</span><span class="sxs-lookup"><span data-stu-id="129fb-158">Merge operation The operation merges one or more data and delta file pairs and creates a new data and delta file pair.</span></span>

 <span data-ttu-id="129fb-159">Während der Wiederherstellung von Abstürzen [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] , wenn neu gestartet wird oder die Datenbank wieder online geschaltet wird, werden die Speicher optimierten Daten mithilfe der Daten-und Änderungsdatei Paare aufgefüllt.</span><span class="sxs-lookup"><span data-stu-id="129fb-159">During crash recovery When [!INCLUDE[ssNoVersion](../../../includes/ssnoversion-md.md)] is restarted or the database is brought back online, the memory-optimized data is populated using the data and delta file pairs.</span></span> <span data-ttu-id="129fb-160">Die Änderungsdatei dient beim Lesen der Zeilen aus der entsprechenden Datendatei als Filter für die gelöschten Zeilen.</span><span class="sxs-lookup"><span data-stu-id="129fb-160">The delta file acts as a filter for the deleted rows when reading the rows from the corresponding data file.</span></span> <span data-ttu-id="129fb-161">Da alle Daten-/Änderungsdateipaare unabhängig sind, werden diese Dateien parallel geladen, um die Zeit zum Laden der Daten in den Arbeitsspeicher zu verkürzen.</span><span class="sxs-lookup"><span data-stu-id="129fb-161">Because each data and delta file pair is independent, these files are loaded in parallel to reduce the time taken to populate data into memory.</span></span> <span data-ttu-id="129fb-162">Sobald die Daten in den Arbeitsspeicher geladen wurden, wendet die In-Memory-OLTP-Engine die aktiven, von den Prüfpunktdateien noch nicht verarbeiteten Transaktionsprotokolldatensätze an, um die speicheroptimierten Daten zu vervollständigen.</span><span class="sxs-lookup"><span data-stu-id="129fb-162">Once the data has been loaded into memory, the In-Memory OLTP engine applies the active transaction log records not yet covered by the checkpoint files so that the memory-optimized data is complete.</span></span>

 <span data-ttu-id="129fb-163">Während des Wiederherstellungs Vorgangs werden die in-Memory-OLTP-Prüf Punkt Dateien aus der Datenbanksicherung erstellt. Anschließend wird mindestens eine Transaktionsprotokoll Sicherung angewendet.</span><span class="sxs-lookup"><span data-stu-id="129fb-163">During restore operation The In-Memory OLTP checkpoint files are created from the database backup, and then one or more transaction log backups are applied.</span></span> <span data-ttu-id="129fb-164">Wie bei der Wiederherstellung nach einem Systemabsturz lädt die In-Memory-OLTP-Engine Daten parallel in den Arbeitsspeicher, um die Auswirkungen auf die Wiederherstellungszeit zu minimieren.</span><span class="sxs-lookup"><span data-stu-id="129fb-164">As with crash recovery, the In-Memory OLTP engine loads data into memory in parallel, to minimize the impact on recovery time.</span></span>

## <a name="merging-data-and-delta-files"></a><span data-ttu-id="129fb-165">Zusammenführen von Daten- und Änderungsdateien</span><span class="sxs-lookup"><span data-stu-id="129fb-165">Merging Data and Delta Files</span></span>
 <span data-ttu-id="129fb-166">Die Daten für speicheroptimierte Tabellen werden in mindestens einem Daten-/Änderungsdateipaar gespeichert (auch als Prüfpunktdateipaar oder CFP (Checkpoint File Pair) bezeichnet).</span><span class="sxs-lookup"><span data-stu-id="129fb-166">The data for memory optimized tables is stored in one or more data and delta file pairs (also called a checkpoint file pair, or CFP).</span></span> <span data-ttu-id="129fb-167">Eingefügte Zeilen werden in Datendateien gespeichert, und in Änderungsdateien werden Verweise auf gelöschte Zeilen gespeichert.</span><span class="sxs-lookup"><span data-stu-id="129fb-167">Data files store inserted rows and delta files reference deleted rows.</span></span> <span data-ttu-id="129fb-168">Während der Ausführung einer OLTP-Arbeitsauslastung werden beim Aktualisieren, Einfügen und Löschen von Zeilen durch DML-Vorgänge neue CFPs erstellt, um die neuen Zeilen persistent zu speichern, und der Verweis auf die gelöschten Zeilen wird an die Änderungsdateien angefügt.</span><span class="sxs-lookup"><span data-stu-id="129fb-168">During the execution of an OLTP workload, as the DML operations update, insert, and delete rows, new CFPs are created to persist the new rows, and the reference to the deleted rows is appended to delta files.</span></span>

 <span data-ttu-id="129fb-169">Die Metadaten aller zuvor geschlossen und derzeit aktiven CFPs werden in einer internen Arraystruktur gespeichert, die als Speicherarray bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="129fb-169">The metadata of all previously-closed and currently active CFPs is stored in an internal array structure referred to as the storage array.</span></span> <span data-ttu-id="129fb-170">Dabei handelt es sich um ein Array von CFPs mit beschränkter Größe (8.192 Einträge).</span><span class="sxs-lookup"><span data-stu-id="129fb-170">It is a finitely sized (8,192 entries) array of CFPs.</span></span> <span data-ttu-id="129fb-171">Die Reihenfolge der Einträge im Speicherarray richtet sich nach dem Transaktionsbereich.</span><span class="sxs-lookup"><span data-stu-id="129fb-171">The entries in the storage array are ordered by transaction range.</span></span> <span data-ttu-id="129fb-172">Die CFPs im Speicherarray (zusammen mit dem Protokollfragment) stellen den gesamten Status auf dem Datenträger dar, der erforderlich ist, um eine Datenbank mit speicheroptimierten Tabellen wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="129fb-172">The CFPs in the storage array (along with the tail of the log) represent all the on-disk state required to recover a database with memory-optimized tables.</span></span>

 <span data-ttu-id="129fb-173">Bei DML-Vorgängen nimmt die Anzahl der CFPs im Laufe der Zeit zu, wodurch die maximale Kapazität des Speicherarrays erreicht wird und sich folgende Herausforderungen stellen:</span><span class="sxs-lookup"><span data-stu-id="129fb-173">Over time, with DML operations, the number of CFPs grow causing the storage array to reach capacity, which introduces the following challenges:</span></span>

-   <span data-ttu-id="129fb-174">Gelöschte Zeilen.</span><span class="sxs-lookup"><span data-stu-id="129fb-174">Deleted rows.</span></span>  <span data-ttu-id="129fb-175">Gelöschte Zeilen verbleiben in der Datendatei, werden aber in der entsprechenden Änderungsdatei als gelöscht gekennzeichnet.</span><span class="sxs-lookup"><span data-stu-id="129fb-175">Deleted rows remain in the data file but are marked as deleted in the corresponding delta file.</span></span> <span data-ttu-id="129fb-176">Diese Zeilen werden nicht mehr benötigt und werden aus dem Arbeitsspeicher entfernt.</span><span class="sxs-lookup"><span data-stu-id="129fb-176">These rows are no longer needed and will be removed from the storage.</span></span> <span data-ttu-id="129fb-177">Wenn gelöschte Zeilen nicht aus CFPs entfernt werden, wird unnötigerweise Speicherplatz belegt, wodurch sich die Wiederherstellungszeit erhöhen würde.</span><span class="sxs-lookup"><span data-stu-id="129fb-177">If deleted rows were not removed from CFPs, they would use space unnecessarily and make recovery time slower.</span></span>

-   <span data-ttu-id="129fb-178">Speicherarray ist voll.</span><span class="sxs-lookup"><span data-stu-id="129fb-178">Storage array full.</span></span> <span data-ttu-id="129fb-179">Wenn im Speicherarray 8.000 Einträge zugeordnet sind (192 Arrayeinträge sind für konkurrierende, vorhandene Zusammenführungen oder manuelle Zusammenführungen reserviert), können keine neuen DML-Transaktionen für dauerhafte speicheroptimierte Tabellen ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="129fb-179">When there 8,000 entries in the storage array are allocated (192 entries in the array are reserved for existing merges to compete or to allow you to do manual merges), no new DML transactions can be executed on durable memory-optimized tables.</span></span> <span data-ttu-id="129fb-180">Nur Prüfpunkt- und MERGE-Operationen dürfen die verbleibenden Einträge verwenden.</span><span class="sxs-lookup"><span data-stu-id="129fb-180">Only checkpoint and merge operations are allowed to consume the remaining entries.</span></span> <span data-ttu-id="129fb-181">Dadurch wird sichergestellt, dass DML-Transaktionen das Array nicht füllen und dass einige Einträge im Array für die Zusammenführung vorhandener Dateien und die Freigabe von Speicherplatz im Array reserviert bleiben.</span><span class="sxs-lookup"><span data-stu-id="129fb-181">This ensures that DML transactions do not fill the array and that some entries in the array are reserved to merge existing files and to reclaim space in the array.</span></span>

-   <span data-ttu-id="129fb-182">Mehraufwand für Änderungen des Speicherarrays.</span><span class="sxs-lookup"><span data-stu-id="129fb-182">Storage array manipulation overhead.</span></span> <span data-ttu-id="129fb-183">Interne Prozesse durchsuchen das Speicherarray nach Vorgängen, z. B. um die Änderungsdatei zu finden, an die Informationen über eine gelöschte Zeile angehängt werden sollen.</span><span class="sxs-lookup"><span data-stu-id="129fb-183">Internal processes search the storage array for operations such as finding the delta file to append information about a deleted row.</span></span> <span data-ttu-id="129fb-184">Der Aufwand dieser Vorgänge steigt mit der Anzahl der Einträge.</span><span class="sxs-lookup"><span data-stu-id="129fb-184">The cost of these operations increases with the number of entries.</span></span>

 <span data-ttu-id="129fb-185">Zur Vermeidung dieser Ineffizienzen werden ältere geschlossene CFPs entsprechend der weiter unten beschriebenen Zusammenführungsrichtlinie zusammengeführt, sodass das Speicherarray komprimiert wird, um den gleichen Satz von Daten mit einer geringeren Anzahl von CFPs darzustellen.</span><span class="sxs-lookup"><span data-stu-id="129fb-185">To help prevent these inefficiencies, the older closed CFPs are merged, based on a merge policy described below, so the storage array is compacted to represent the same set of data, with a reduced number of CFPs.</span></span>

 <span data-ttu-id="129fb-186">Die Gesamtgröße aller dauerhaften Tabellen in einer Datenbank sollte im Arbeitsspeicher maximal 250 GB betragen.</span><span class="sxs-lookup"><span data-stu-id="129fb-186">The total in-memory size of all durable tables in a database should not exceed 250 GB.</span></span> <span data-ttu-id="129fb-187">Dauerhafte Tabellen, die bis zu 250 GB Arbeitsspeicher nutzen, erfordern in der Annahme, dass Einfüge-, Lösch- und Updatevorgänge stattfinden, durchschnittlich 500 GB Speicherplatz.</span><span class="sxs-lookup"><span data-stu-id="129fb-187">Durable tables that use up to 250 GB of memory will, assuming insert, delete, and update operations, require on average 500 GB of storage space.</span></span> <span data-ttu-id="129fb-188">Zur Unterstützung von 500 GB Speicherplatz sind 4.000 Daten-/Änderungsdateipaare in der speicheroptimierten Dateigruppe erforderlich.</span><span class="sxs-lookup"><span data-stu-id="129fb-188">4,000 data and delta file pairs in the memory-optimized file group are required to support the 500 GB of storage space.</span></span>

 <span data-ttu-id="129fb-189">Ein kurzfristiger Anstieg der Datenbankaktivität kann zu einer Verzögerung von Prüfpunkt- und Zusammenführungsvorgängen führen, wodurch sich die Anzahl der erforderlichen Daten-/Änderungsdateipaare erhöht.</span><span class="sxs-lookup"><span data-stu-id="129fb-189">Short-term surges in database activity may cause checkpoint and merge operations lag, which will increase the number of required data and delta file pairs.</span></span> <span data-ttu-id="129fb-190">Um kurzfristige Spitzen in der Datenbankaktivität auszugleichen, kann das Speichersystem bis zu 8.000 Daten-/Änderungsdateipaare mit einer maximalen Gesamtspeicherkapazität von 1 TB zuordnen.</span><span class="sxs-lookup"><span data-stu-id="129fb-190">To accommodate short-term surges spikes in database activity, the storage system can allocate up to 8,000 data and delta file pairs up to a total of 1TB of storage.</span></span> <span data-ttu-id="129fb-191">Nach Erreichen dieses Grenzwerts können in der Datenbank erst wieder neue Transaktionen ausgeführt werden, nachdem verzögerte Prüfpunktvorgänge aufgeholt wurden.</span><span class="sxs-lookup"><span data-stu-id="129fb-191">When that limit is reached, there will be no new transactions allowed on the database until checkpoint operations catch up.</span></span> <span data-ttu-id="129fb-192">Wenn die Größe dauerhafter Tabellen im Arbeitsspeicher längere Zeit über 250 GB liegt, kann der Grenzwert von 8.000 Dateipaaren erreicht werden.</span><span class="sxs-lookup"><span data-stu-id="129fb-192">If the size of durable tables in memory exceeds 250GB for long periods of time, there is a chance of reaching the 8,000 file pair limit.</span></span>

 <span data-ttu-id="129fb-193">Der Zusammenführungsvorgang akzeptiert als Eingabe eines oder mehrere angrenzende geschlossene CFPs (die sogenannte Zusammenführungsquelle) auf Grundlage einer intern definierten Zusammenführungsrichtlinie und erstellt ein resultierendes CFP (das sogenannte Zusammenführungsziel).</span><span class="sxs-lookup"><span data-stu-id="129fb-193">The merge operation takes as input one or more adjacent closed CFPs (called merge source) based on an internally defined merge policy, and produces one resultant CFP, called the merge target.</span></span> <span data-ttu-id="129fb-194">Die Einträge in jeder Änderungsdatei der Quell-CFPs werden zum Filtern der Zeilen aus der entsprechenden Datendatei verwendet, um die nicht benötigten Datensätze zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="129fb-194">The entries in each delta file of the source CFPs are used to filter rows from the corresponding data file to remove the data rows that are not needed.</span></span> <span data-ttu-id="129fb-195">Die verbleibenden Zeilen in den Quell-CFPs werden zu einem Ziel-CFP zusammengefasst.</span><span class="sxs-lookup"><span data-stu-id="129fb-195">The remaining rows in the source CFPs are consolidated into one target CFP.</span></span> <span data-ttu-id="129fb-196">Nach Abschluss des Zusammenführungsvorgangs werden die Quell-CFPs (Zusammenführungsquellen) durch das CFP des Zusammenführungsziels ersetzt.</span><span class="sxs-lookup"><span data-stu-id="129fb-196">After the merge is complete, the resultant merge-target CFP replaces the source CFPs (merge sources).</span></span> <span data-ttu-id="129fb-197">Die CFPs der Zusammenführungsquelle durchlaufen eine Übergangsphase, bevor sie aus dem Speicher entfernt werden.</span><span class="sxs-lookup"><span data-stu-id="129fb-197">The merge-source CFPs go through a transition phase before they are removed from storage.</span></span>

 <span data-ttu-id="129fb-198">Im Beispiel unten sind für die speicheroptimierte Tabellendateigruppe vier Daten-/Änderungsdateipaare mit Daten aus vorhergehenden Transaktionen bei Zeitstempel 500 vorhanden.</span><span class="sxs-lookup"><span data-stu-id="129fb-198">In the example below, the memory-optimized table file group has four data and delta file pairs at timestamp 500 containing data from previous transactions.</span></span> <span data-ttu-id="129fb-199">Beispielsweise entsprechen die ersten Zeilen in der Datendatei Transaktionen mit einem Zeitstempel, der größer als 100 und kleiner oder gleich 200 ist, alternativ ausgedrückt als (100, 200).</span><span class="sxs-lookup"><span data-stu-id="129fb-199">For example, the rows in the first data file correspond to transactions with timestamp greater than 100 and less than or equal to 200; alternatively represented as (100, 200].</span></span> <span data-ttu-id="129fb-200">Die zweite und dritte Datendatei werden nach Berücksichtigung der als gelöscht gekennzeichneten Zeilen zu weniger als 50 % gefüllt angezeigt.</span><span class="sxs-lookup"><span data-stu-id="129fb-200">The second and third data files are shown to be less than 50 percent full after accounting for the rows marked as deleted.</span></span> <span data-ttu-id="129fb-201">Der Zusammenführungsvorgang kombiniert diese beiden CFPs und erstellt ein neues CFP mit Transaktionen, deren Zeitstempel größer als 200 und kleiner oder gleich 400 ist. Dies entspricht dem kombinierten Bereich dieser beiden CFPs.</span><span class="sxs-lookup"><span data-stu-id="129fb-201">The merge operation combines these two CFPs and creates a new CFP containing transactions with timestamp greater than 200 and less than or equal to 400, which is the combined range of these two CFPs.</span></span> <span data-ttu-id="129fb-202">Es wird ein weiteres CFP mit dem Bereich (500, 600) angezeigt, und eine nicht leere Änderungsdatei für den Transaktionsbereich (200, 400) gibt an, dass der Zusammenführungsvorgang parallel zur Transaktionsaktivität erfolgen kann, einschließlich des Löschens mehrerer Zeilen aus den Quell-CFPs.</span><span class="sxs-lookup"><span data-stu-id="129fb-202">You see another CFP with range (500, 600] and non-empty delta file for transaction range (200, 400] shows that merge operation can be done concurrently with transactional activity including deleting more rows from the source CFPs.</span></span>

 <span data-ttu-id="129fb-203">![Diagramm der speicheroptimierten Tabellendateigruppe](../../database-engine/media/storagediagram-hekaton.png "Diagramm der speicheroptimierten Tabellendateigruppe")</span><span class="sxs-lookup"><span data-stu-id="129fb-203">![Diagram shows memory optimized table file group](../../database-engine/media/storagediagram-hekaton.png "Diagram shows memory optimized table file group")</span></span>

 <span data-ttu-id="129fb-204">In einem Hintergrundthread werden alle geschlossenen CFPs mithilfe einer Zusammenführungsrichtlinie ausgewertet und dann eine oder mehrere Zusammenführungsanforderungen für die qualifizierenden CFPs initiiert.</span><span class="sxs-lookup"><span data-stu-id="129fb-204">A background thread evaluates all closed CFPs using a merge policy and then initiates one or more merge requests for the qualifying CFPs.</span></span> <span data-ttu-id="129fb-205">Diese Zusammenführungsanforderungen werden vom Offline-Prüfpunktthread verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="129fb-205">These merge requests are processed by the offline checkpoint thread.</span></span> <span data-ttu-id="129fb-206">Die Auswertung der Zusammenführungsrichtlinie erfolgt in regelmäßigen Abständen sowie beim Schließen eines Prüfpunkts.</span><span class="sxs-lookup"><span data-stu-id="129fb-206">The evaluation of merge policy is done periodically and also when a checkpoint is closed.</span></span>

### <a name="sssql14-merge-policy"></a>[!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] <span data-ttu-id="129fb-207">-Zusammenführungsrichtlinie</span><span class="sxs-lookup"><span data-stu-id="129fb-207">Merge Policy</span></span>
 [!INCLUDE[ssSQL14](../../../includes/sssql14-md.md)] <span data-ttu-id="129fb-208">implementiert die folgende Zusammenführungsrichtlinie:</span><span class="sxs-lookup"><span data-stu-id="129fb-208">implements the following merge policy:</span></span>

-   <span data-ttu-id="129fb-209">Eine Zusammenführung wird geplant, wenn mindestens zwei aufeinanderfolgende CFPs konsolidiert werden können, nachdem gelöschte Zeilen berücksichtigt wurden, sodass die resultierenden Zeilen in einem CFP idealer Größe Platz finden.</span><span class="sxs-lookup"><span data-stu-id="129fb-209">A merge is scheduled if 2 or more consecutive CFPs can be consolidated, after accounting for deleted rows, such that the resultant rows can fit into 1 CFP of ideal size.</span></span> <span data-ttu-id="129fb-210">Die ideale CFP-Größe wird wie folgt bestimmt:</span><span class="sxs-lookup"><span data-stu-id="129fb-210">The ideal size of CFP is determined as follows:</span></span>

    -   <span data-ttu-id="129fb-211">Wenn ein Computer 16 GB Arbeitsspeicher oder weniger aufweist, beträgt die Größe der Datendatei 16 MB und der Änderungsdatei 1 MB.</span><span class="sxs-lookup"><span data-stu-id="129fb-211">If a computer has less than or equal to 16GB of memory, the data file is 16MB and delta file is 1MB.</span></span>

    -   <span data-ttu-id="129fb-212">Wenn ein Computer mehr als 16 GB Arbeitsspeicher aufweist, beträgt die Größe der Datendatei 128 MB und der Änderungsdatei 16 MB.</span><span class="sxs-lookup"><span data-stu-id="129fb-212">If a computer has greater than 16GB of memory, the data file is 128MB and delta file is 16MB.</span></span>

-   <span data-ttu-id="129fb-213">Ein einzelnes CFP kann mit sich selbst zusammengeführt werden, wenn die Datendatei 256 MB überschreitet und mehr als die Hälfte der Zeilen gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="129fb-213">A single CFP can be self-merged if the data file exceeds 256 MB and more than half of the rows are deleted.</span></span> <span data-ttu-id="129fb-214">Eine Datendatei kann beispielsweise über 128 MB anwachsen, wenn durch eine einzelne oder mehrere gleichzeitige Transaktionen eine große Datenmenge eingefügt oder aktualisiert wird und die Vergrößerung der Datendatei über die ideale Größe hinaus erzwungen wird, weil eine Transaktion nicht auf mehrere CFPs verteilt werden kann.</span><span class="sxs-lookup"><span data-stu-id="129fb-214">A data file can grow larger than 128MB if, for example, a single transaction or multiple concurrent transactions inserts or updates large amount of data, forcing the data file to grow beyond its ideal size because a transaction cannot span multiple CFPs.</span></span>

 <span data-ttu-id="129fb-215">Im Folgenden finden Sie einige Beispiele, die veranschaulichen, welche CFPs gemäß der Zusammenführungsrichtlinie zusammengeführt werden:</span><span class="sxs-lookup"><span data-stu-id="129fb-215">Here are some examples that show the CFPs that will be merged under the merge policy:</span></span>

|<span data-ttu-id="129fb-216">Angrenzende CFP-Quelldateien (% voll)</span><span class="sxs-lookup"><span data-stu-id="129fb-216">Adjacent CFPs Source Files (% full)</span></span>|<span data-ttu-id="129fb-217">Zusammenführungsauswahl</span><span class="sxs-lookup"><span data-stu-id="129fb-217">Merge Selection</span></span>|
|-------------------------------------------|---------------------|
|<span data-ttu-id="129fb-218">CFP0 (30 %), CFP1 (50 %), CFP2 (50 %), CFP3 (90 %)</span><span class="sxs-lookup"><span data-stu-id="129fb-218">CFP0 (30%), CFP1 (50%), CFP2 (50%), CFP3 (90%)</span></span>|<span data-ttu-id="129fb-219">(CFP0, CFP1)</span><span class="sxs-lookup"><span data-stu-id="129fb-219">(CFP0, CFP1)</span></span><br /><br /> <span data-ttu-id="129fb-220">CFP2 wird nicht ausgewählt, da andernfalls die resultierende Datendatei größer als 100 % der idealen Größe wird.</span><span class="sxs-lookup"><span data-stu-id="129fb-220">CFP2 is not chosen as it will make resultant data file greater than 100% of the ideal size.</span></span>|
|<span data-ttu-id="129fb-221">CFP0 (30 %), CFP1 (20 %), CFP2 (50 %), CFP3 (10 %)</span><span class="sxs-lookup"><span data-stu-id="129fb-221">CFP0 (30%), CFP1 (20%), CFP2 (50%), CFP3 (10%)</span></span>|<span data-ttu-id="129fb-222">(CFP0, CFP1, CFP2).</span><span class="sxs-lookup"><span data-stu-id="129fb-222">(CFP0, CFP1, CFP2).</span></span> <span data-ttu-id="129fb-223">Dateien werden von links nach rechts ausgewählt.</span><span class="sxs-lookup"><span data-stu-id="129fb-223">Files are chosen starting from left.</span></span><br /><br /> <span data-ttu-id="129fb-224">CTP3 wird nicht ausgewählt, da andernfalls die resultierende Datendatei größer als 100 % der idealen Größe wird.</span><span class="sxs-lookup"><span data-stu-id="129fb-224">CTP3 is not chosen as it will make resultant data file greater than 100% of the ideal size.</span></span>|
|<span data-ttu-id="129fb-225">CFP0 (80 %), CFP1 (30 %), CFP2 (10 %), CFP3 (40 %)</span><span class="sxs-lookup"><span data-stu-id="129fb-225">CFP0 (80%), CFP1 (30%), CFP2 (10%), CFP3 (40%)</span></span>|<span data-ttu-id="129fb-226">(CFP1, CFP2, CFP3).</span><span class="sxs-lookup"><span data-stu-id="129fb-226">(CFP1, CFP2, CFP3).</span></span> <span data-ttu-id="129fb-227">Dateien werden von links nach rechts ausgewählt.</span><span class="sxs-lookup"><span data-stu-id="129fb-227">Files are chosen starting from left.</span></span><br /><br /> <span data-ttu-id="129fb-228">CFP0 wird übersprungen, da die resultierende Datendatei bei Kombination mit CFP1 größer als 100 % der idealen Größe wird.</span><span class="sxs-lookup"><span data-stu-id="129fb-228">CFP0 is skipped because if combined with CFP1, the resultant data file will be greater than 100% of the ideal size.</span></span>|

 <span data-ttu-id="129fb-229">Nicht alle CFPs mit verfügbarem Speicherplatz kommen für die Zusammenführung infrage.</span><span class="sxs-lookup"><span data-stu-id="129fb-229">Not all CFPs with available space qualify for merge.</span></span> <span data-ttu-id="129fb-230">Wenn beispielsweise zwei aufeinanderfolgende CFPs zu 60 % gefüllt sind, kommen sie für eine Zusammenführung nicht infrage, und jedes dieser CFPs weist 40 % nicht genutzten Speicherplatz auf.</span><span class="sxs-lookup"><span data-stu-id="129fb-230">For example, if two adjacent CFPs are 60% full, they will not qualify for merge and each of these CFPs will have 40% storage unused.</span></span> <span data-ttu-id="129fb-231">Im ungünstigsten Fall sind alle CFPs zu 50 % gefüllt, was einer Speicherauslastung von nur 50 % entspricht.</span><span class="sxs-lookup"><span data-stu-id="129fb-231">In the worst case, all CFPs will be 50% full, a storage utilization of only 50%.</span></span> <span data-ttu-id="129fb-232">Auch wenn die gelöschten Zeilen möglicherweise im Speicher vorhanden sind, da die CFPs für eine Zusammenführung nicht infrage kommen, wurden die gelöschten Zeilen möglicherweise bereits von der In-Memory-Garbage Collection aus dem Arbeitsspeicher entfernt.</span><span class="sxs-lookup"><span data-stu-id="129fb-232">While the deleted rows may exist in storage because the CFPs don't qualify for merge, the deleted rows may have already been removed from memory by in-memory garbage collection.</span></span> <span data-ttu-id="129fb-233">Die Verwaltung des Speichers und des Arbeitsspeichers erfolgt unabhängig von der Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="129fb-233">The management of storage and the memory is independent from garbage collection.</span></span> <span data-ttu-id="129fb-234">Der Speicher, der von aktiven CFPs belegt wird (nicht alle CFPs werden aktualisiert), kann doppelt so groß wie bei dauerhaften Tabellen im Arbeitsspeicher ausfallen.</span><span class="sxs-lookup"><span data-stu-id="129fb-234">Storage taken by active CFPs (not all CFPs are being updated) can be up to 2 times larger than the size of durable tables in memory.</span></span>

 <span data-ttu-id="129fb-235">Bei Bedarf kann eine manuelle Zusammenführung explizit durch Aufrufen von [sys. sp_xtp_merge_checkpoint_files &#40;Transact-SQL-&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-xtp-merge-checkpoint-files-transact-sql)ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="129fb-235">If needed, a manual merge can be explicitly performed by calling [sys.sp_xtp_merge_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-xtp-merge-checkpoint-files-transact-sql).</span></span>

### <a name="life-cycle-of-a-cfp"></a><span data-ttu-id="129fb-236">Lebenszyklus eines CFP</span><span class="sxs-lookup"><span data-stu-id="129fb-236">Life Cycle of a CFP</span></span>
 <span data-ttu-id="129fb-237">CPFs durchlaufen mehrere Zustände, bevor ihre Zuordnung aufgehoben werden kann.</span><span class="sxs-lookup"><span data-stu-id="129fb-237">CPFs transition through several states before they can be deallocated.</span></span> <span data-ttu-id="129fb-238">CFPs können sich jeweils in einer der folgenden Phasen befinden: PRECREATED, UNDER CONSTRUCTION, ACTIVE, MERGE TARGET, MERGED SOURCE, REQUIRED FOR BACKUP/HA, IN TRANSITION TO TOMBSTONE und TOMBSTONE.</span><span class="sxs-lookup"><span data-stu-id="129fb-238">At any given time, the CFPs are in one of the following phases: PRECREATED, UNDER CONSTRUCTION, ACTIVE, MERGE TARGET, MERGED SOURCE, REQUIRED FOR BACKUP/HA, IN TRANSITION TO TOMBSTONE, and TOMBSTONE.</span></span> <span data-ttu-id="129fb-239">Eine Beschreibung dieser Phasen finden Sie unter [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="129fb-239">For a description of these phases, see [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span></span>

 <span data-ttu-id="129fb-240">Nach Berücksichtigung des von CFPs mit den verschiedenen Statusphasen belegten Speichers kann der insgesamt von dauerhaften speicheroptimierten Tabellen belegte Speicher deutlich mehr als das Doppelte der Größe der Tabellen im Arbeitsspeicher betragen.</span><span class="sxs-lookup"><span data-stu-id="129fb-240">After accounting for the storage taken by CFPs in various states, the overall storage taken by durable memory-optimized tables can be much larger than 2 times the size of the tables in memory.</span></span> <span data-ttu-id="129fb-241">Die DMV [sys. dm_db_xtp_checkpoint_files &#40;Transact-SQL-&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql) kann abgefragt werden, um alle Cfps in der Speicher optimierten Datei Gruppe einschließlich ihrer Phase aufzulisten.</span><span class="sxs-lookup"><span data-stu-id="129fb-241">The DMV [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql) can be queried to list all the CFPs in the memory-optimized filegroup, including their phase.</span></span> <span data-ttu-id="129fb-242">Der Übergang von CFPs vom MERGE SOURCE-Status zum TOMBSTONE-Status und die abschließende Garbage Collection können bis zu fünf Prüfpunkte beanspruchen, wobei auf jeden Prüfpunkt eine Transaktionsprotokollsicherung folgt, wenn die Datenbank für das vollständige oder massenprotokollierte Wiederherstellungsmodell konfiguriert ist.</span><span class="sxs-lookup"><span data-stu-id="129fb-242">Transitioning CFPs from MERGE SOURCE state to TOMBSTONE and ultimately garbage collection can take up five checkpoints, with each checkpoint followed by a transaction log backup, if the database is configured for full or bulk-logged recovery model.</span></span>

 <span data-ttu-id="129fb-243">Sie können den Prüfpunkt gefolgt von einer Protokollsicherung manuell erzwingen, um die Garbage Collection zu beschleunigen. Dadurch werden jedoch 5 leere CFPs hinzugefügt (5 Daten-/Änderungsdateipaare mit einer jeweils 128 MB großen Datendatei).</span><span class="sxs-lookup"><span data-stu-id="129fb-243">You can manually force the checkpoint followed by log backup to expedite the garbage collection but then this will add 5 empty CFPs (5 data/delta file pairs with data file of size 128MB each).</span></span> <span data-ttu-id="129fb-244">In Produktionsszenarien durchlaufen CFPs aufgrund der automatischen Prüfpunkte und Protokollsicherungen, die im Rahmen der Sicherungsstrategie ausgeführt werden, diese Phasen nahtlos, ohne dass ein manueller Eingriff erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="129fb-244">In production scenarios, the automatic checkpoints and log backups taken as part of backup strategy will seamlessly transition CFPs through these phases without requiring any manual intervention.</span></span> <span data-ttu-id="129fb-245">Als Folge des Garbage Collection-Vorgangs weisen Datenbanken mit speicheroptimierten Tabellen gegenüber ihrer Größe im Arbeitsspeicher möglicherweise eine höhere Größe im Speicher auf.</span><span class="sxs-lookup"><span data-stu-id="129fb-245">The impact of the garbage collection process is that databases with memory-optimized tables may have a larger storage size compared to its size in memory.</span></span> <span data-ttu-id="129fb-246">Es ist nicht ungewöhnlich, dass CFPs bis zu viermal so groß werden können wie die dauerhaften speicheroptimierten Tabellen im Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="129fb-246">It is not uncommon for CFPs to be up to four times the size of the durable memory-optimized tables in memory.</span></span>

## <a name="see-also"></a><span data-ttu-id="129fb-247">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="129fb-247">See Also</span></span>
 [<span data-ttu-id="129fb-248">Erstellen und Verwalten von Speicher für speicheroptimierte Objekte</span><span class="sxs-lookup"><span data-stu-id="129fb-248">Creating and Managing Storage for Memory-Optimized Objects</span></span>](creating-and-managing-storage-for-memory-optimized-objects.md)


