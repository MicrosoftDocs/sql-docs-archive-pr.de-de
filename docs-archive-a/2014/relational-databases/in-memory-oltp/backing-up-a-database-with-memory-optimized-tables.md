---
title: Sichern einer Datenbank mit speicheroptimierten Tabellen | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 83d47694-e56d-4dae-b54e-14945bf8ba31
author: CarlRabeler
ms.author: carlrab
ms.openlocfilehash: 176448aa9d4bab4101ab2db12ffc9a8a7fd1a5b5
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87609206"
---
# <a name="backing-up-a-database-with-memory-optimized-tables"></a><span data-ttu-id="a4789-102">Sichern einer Datenbank mit speicheroptimierten Tabellen</span><span class="sxs-lookup"><span data-stu-id="a4789-102">Backing Up a Database with Memory-Optimized Tables</span></span>
  <span data-ttu-id="a4789-103">Speicheroptimierte Tabellen werden im Rahmen regelmäßiger Datenbanksicherungen gesichert.</span><span class="sxs-lookup"><span data-stu-id="a4789-103">Memory-optimized tables are backed up as part of regular database backups.</span></span> <span data-ttu-id="a4789-104">Wie bei datenträgerbasierten Tabellen wird die CHECKSUM von Daten-/Änderungsdateipaaren als Teil der Datenbanksicherung überprüft, um Speicherbeschädigungen zu erkennen.</span><span class="sxs-lookup"><span data-stu-id="a4789-104">As for disk-based tables, the CHECKSUM of data and delta file pairs is validated as part of the database backup to detect storage corruption.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a4789-105">Wenn während einer Sicherung in einer oder mehreren Dateien einer speicheroptimierten Dateigruppe ein CHECKSUM-Fehler auftritt, sind Sie nicht in der Lage, die Datenbank wiederherzustellen und neu zu starten.</span><span class="sxs-lookup"><span data-stu-id="a4789-105">During a backup, if you detect a CHECKSUM error in one or more files in a memory-optimized filegroup, you will not be able to restore and restart the database.</span></span> <span data-ttu-id="a4789-106">In diesem Fall müssen Sie die Datenbank mit der letzten als fehlerfrei bekannten Sicherung wiederherstellen.</span><span class="sxs-lookup"><span data-stu-id="a4789-106">In that situation, you must, restore your database with the last known good backup.</span></span> <span data-ttu-id="a4789-107">Wenn keine Sicherung verfügbar ist, können Sie die Daten aus den speicheroptimierten und datenträgerbasierten Tabellen exportieren und erneut laden, nachdem Sie die Datenbank gelöscht und neu erstellt haben.</span><span class="sxs-lookup"><span data-stu-id="a4789-107">If you don't have a backup, you can export the data from memory-optimized tables and disk-based tables and reload after you drop and recreate the database.</span></span>  
  
 <span data-ttu-id="a4789-108">Eine vollständige Sicherung einer Datenbank mit mindestens einer speicheroptimierten Tabelle besteht aus dem zugeordneten Speicher für datenträgerbasierte Tabellen (falls vorhanden), dem aktiven Transaktionsprotokoll und den Daten-/Änderungsdateipaaren (auch als Prüfpunktdateipaare bezeichnet) für speicheroptimierte Tabellen.</span><span class="sxs-lookup"><span data-stu-id="a4789-108">A full backup of a database with one or more memory-optimized tables consists of the allocated storage for disk-based tables (if any), the active transaction log, and the data and delta file pairs (also known as checkpoint file pairs) for memory-optimized tables.</span></span> <span data-ttu-id="a4789-109">Allerdings kann der unter [Dauerhaftigkeit für speicheroptimierte Tabellen](memory-optimized-tables.md)beschriebene, von speicheroptimierten Tabellen genutzte Speicher wesentlich größer als die belegte Arbeitsspeicherkapazität sein, was sich auf die Größe der Datenbanksicherung auswirkt.</span><span class="sxs-lookup"><span data-stu-id="a4789-109">However, as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md), the storage used by memory-optimized tables can be much larger than its size in memory, and it affects the size of the database backup.</span></span>  
  
## <a name="full-database-backup"></a><span data-ttu-id="a4789-110">Vollständige Datenbanksicherung</span><span class="sxs-lookup"><span data-stu-id="a4789-110">Full Database Backup</span></span>  
 <span data-ttu-id="a4789-111">Diese Erläuterung bezieht sich auf Datenbanksicherungen für Datenbanken, die ausschließlich über dauerhafte speicheroptimierte Tabellen verfügen, da die Sicherung für datenträgerbasierte Tabellen identisch ist.</span><span class="sxs-lookup"><span data-stu-id="a4789-111">This discussion will focus on database backups for databases with just durable memory-optimized tables, because the backup for disk-based tables is the same.</span></span> <span data-ttu-id="a4789-112">Die Prüfpunktdateipaare in der speicheroptimierten Dateigruppe können unterschiedliche Statusphasen aufweisen.</span><span class="sxs-lookup"><span data-stu-id="a4789-112">The checkpoint file pairs in the memory-optimized filegroup could be in various states.</span></span> <span data-ttu-id="a4789-113">In der folgenden Tabelle wird beschrieben, welcher Teil der Dateien gesichert wird.</span><span class="sxs-lookup"><span data-stu-id="a4789-113">The table below describes what part of the files is backed.</span></span>  
  
|<span data-ttu-id="a4789-114">Status des Prüfpunktdateipaars</span><span class="sxs-lookup"><span data-stu-id="a4789-114">Checkpoint File Pair State</span></span>|<span data-ttu-id="a4789-115">Backup</span><span class="sxs-lookup"><span data-stu-id="a4789-115">Backup</span></span>|  
|--------------------------------|------------|  
|<span data-ttu-id="a4789-116">PRECREATED</span><span class="sxs-lookup"><span data-stu-id="a4789-116">PRECREATED</span></span>|<span data-ttu-id="a4789-117">Nur Dateimetadaten</span><span class="sxs-lookup"><span data-stu-id="a4789-117">File metadata only</span></span>|  
|<span data-ttu-id="a4789-118">UNDER CONSTRUCTION</span><span class="sxs-lookup"><span data-stu-id="a4789-118">UNDER CONSTRUCTION</span></span>|<span data-ttu-id="a4789-119">Nur Dateimetadaten</span><span class="sxs-lookup"><span data-stu-id="a4789-119">File metadata only</span></span>|  
|<span data-ttu-id="a4789-120">Aktiv</span><span class="sxs-lookup"><span data-stu-id="a4789-120">Active</span></span>|<span data-ttu-id="a4789-121">Dateimetadaten plus verwendete Bytes</span><span class="sxs-lookup"><span data-stu-id="a4789-121">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="a4789-122">Merge source</span><span class="sxs-lookup"><span data-stu-id="a4789-122">Merge source</span></span>|<span data-ttu-id="a4789-123">Dateimetadaten plus verwendete Bytes</span><span class="sxs-lookup"><span data-stu-id="a4789-123">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="a4789-124">Merge target</span><span class="sxs-lookup"><span data-stu-id="a4789-124">Merge target</span></span>|<span data-ttu-id="a4789-125">Nur Dateimetadaten</span><span class="sxs-lookup"><span data-stu-id="a4789-125">File metadata only</span></span>|  
|<span data-ttu-id="a4789-126">REQUIRED FOR BACKUP/HA</span><span class="sxs-lookup"><span data-stu-id="a4789-126">REQUIRED FOR BACKUP/HA</span></span>|<span data-ttu-id="a4789-127">Dateimetadaten plus verwendete Bytes</span><span class="sxs-lookup"><span data-stu-id="a4789-127">File metadata plus used bytes</span></span>|  
|<span data-ttu-id="a4789-128">IN TRANSITION TO TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="a4789-128">IN TRANSITION TO TOMBSTONE</span></span>|<span data-ttu-id="a4789-129">Nur Dateimetadaten</span><span class="sxs-lookup"><span data-stu-id="a4789-129">File metadata only</span></span>|  
|<span data-ttu-id="a4789-130">TOMBSTONE</span><span class="sxs-lookup"><span data-stu-id="a4789-130">TOMBSTONE</span></span>|<span data-ttu-id="a4789-131">Nur Dateimetadaten</span><span class="sxs-lookup"><span data-stu-id="a4789-131">File metadata only</span></span>|  
  
 <span data-ttu-id="a4789-132">Die Größe von Datenbanksicherungen mit einer oder mehreren speicheroptimierten Tabellen liegt in der Regel über deren Größe im Arbeitsspeicher jedoch unter dem auf dem Datenträger belegten Speicherplatz.</span><span class="sxs-lookup"><span data-stu-id="a4789-132">The size of database backups with one or more memory-optimized tables is typically larger than its size in memory but smaller than the on-disk storage.</span></span> <span data-ttu-id="a4789-133">Die zusätzliche Größe richtet sich nach der Anzahl gelöschter Zeilen und der Anzahl von Prüfpunktdateipaaren mit dem Status Merge sourceund REQUIRED FOR BACKUP/HA, die indirekt von der Arbeitsauslastung abhängt.</span><span class="sxs-lookup"><span data-stu-id="a4789-133">The extra size will depend upon the number of deleted rows and the number of checkpoint file pairs in the states Merge source and REQUIRED FOR BACKUP/HA which indirectly depends upon the workload.</span></span> <span data-ttu-id="a4789-134">Beschreibungen der Zustände für Prüfpunkt-Datei Paare finden Sie unter [sys. dm_db_xtp_checkpoint_files &#40;Transact-SQL-&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="a4789-134">For descriptions of the states for checkpoint file pairs, see [sys.dm_db_xtp_checkpoint_files &#40;Transact-SQL&#41;](/sql/relational-databases/system-dynamic-management-views/sys-dm-db-xtp-checkpoint-files-transact-sql).</span></span>  
  
### <a name="estimating-size-of-full-database-backup"></a><span data-ttu-id="a4789-135">Schätzen der Größe einer vollständigen Datenbanksicherung</span><span class="sxs-lookup"><span data-stu-id="a4789-135">Estimating Size of Full Database Backup</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="a4789-136">Es wird empfohlen, den BackupSizeInBytes-Wert nicht zu verwenden, um die Sicherungsgröße für In-Memory OLTP zu schätzen.</span><span class="sxs-lookup"><span data-stu-id="a4789-136">It's recommended that you not use the BackupSizeInBytes value to estimate the backup size for In-Memory OLTP.</span></span>  
  
 <span data-ttu-id="a4789-137">Das erste Arbeitsauslastungsszenario bezieht sich (hauptsächlich) auf Einfügevorgänge.</span><span class="sxs-lookup"><span data-stu-id="a4789-137">The first workload scenario is for (mostly) insert.</span></span> <span data-ttu-id="a4789-138">In diesem Szenario weisen die meisten Datendateien den Status ACTIVE und einige wenige gelöschte Zeilen auf und wurden vollständig geladen.</span><span class="sxs-lookup"><span data-stu-id="a4789-138">In this scenario, most data files will be in the Active state, fully loaded, and with very few deleted rows.</span></span> <span data-ttu-id="a4789-139">Die Größe der Datenbanksicherung entspricht in etwa der Größe der Daten im Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="a4789-139">The size of database backup up will be close to the size of data in memory.</span></span>  
  
 <span data-ttu-id="a4789-140">Das zweite Arbeitsauslastungsszenario bezieht sich auf häufige Einfüge-, Lösch- und Updatevorgänge: Im ungünstigsten Fall wurde jedes Prüfpunktdateipaar nach Berücksichtigung der gelöschten Zeilen zu 50 % geladen.</span><span class="sxs-lookup"><span data-stu-id="a4789-140">The second workload scenario is for frequent insert, delete, and update operations: In the worst case, each of the checkpoint file pairs are 50% loaded, after accounting for the deleted rows.</span></span> <span data-ttu-id="a4789-141">Daher ist die Datenbanksicherung mindestens zweimal so groß wie die Daten im Arbeitsspeicher.</span><span class="sxs-lookup"><span data-stu-id="a4789-141">So the size of the database backup will at least be 2 times the size of data in memory.</span></span> <span data-ttu-id="a4789-142">Zusätzlich wächst die Größe der Datenbanksicherung durch einige Prüfpunktdateipaare mit dem Status „Quelle zusammenführen“ und „Für Backup/HA erforderlich“ weiter an.</span><span class="sxs-lookup"><span data-stu-id="a4789-142">Additionally, there will few checkpoint file pairs in states Merge source and Required for backup/high availability that will add to the size of database backup.</span></span>  
  
## <a name="differential-backups-of-databases-with-memory-optimized-tables"></a><span data-ttu-id="a4789-143">Differenzielle Sicherungen von Datenbanken mit speicheroptimierten Tabellen</span><span class="sxs-lookup"><span data-stu-id="a4789-143">Differential Backups of Databases with Memory-Optimized Tables</span></span>  
 <span data-ttu-id="a4789-144">Der Speicher für speicheroptimierte Tabellen setzt sich zusammen aus Daten- und Änderungsdateien, wie in [Dauerhaftigkeit für speicheroptimierte Tabellen](memory-optimized-tables.md)beschrieben.</span><span class="sxs-lookup"><span data-stu-id="a4789-144">The storage for memory-optimized tables consists of data and delta files as described in [Durability for Memory-Optimized Tables](memory-optimized-tables.md).</span></span> <span data-ttu-id="a4789-145">Eine differenzielle Sicherung einer Datenbank mit speicheroptimierten Tabellen enthält die folgenden Daten:</span><span class="sxs-lookup"><span data-stu-id="a4789-145">The differential backup of a database with memory-optimized tables contains the following data:</span></span>  
  
-   <span data-ttu-id="a4789-146">Die differenzielle Sicherung für Dateigruppen, in denen datenträgerbasierte Tabellen gespeichert sind, wird durch das Vorhandensein von speicheroptimierten Tabellen nicht beeinflusst.</span><span class="sxs-lookup"><span data-stu-id="a4789-146">Differential backup for filegroups storing disk-based tables is not affected by the presence of memory-optimized tables.</span></span>  
  
-   <span data-ttu-id="a4789-147">Das aktive Transaktionsprotokoll ist dasselbe wie bei einer vollständigen Datenbanksicherung.</span><span class="sxs-lookup"><span data-stu-id="a4789-147">The active transaction log is the same as in a full database backup.</span></span>  
  
-   <span data-ttu-id="a4789-148">Für eine speicheroptimierte Datendateigruppe verwendet die differenzielle Sicherung den gleichen Algorithmus wie bei einer vollständigen Datenbanksicherung, um die Daten- und Änderungsdateien für die Sicherung identifizieren. Anschließend wird wie folgt eine Teilmenge dieser Dateien herausgefiltert:</span><span class="sxs-lookup"><span data-stu-id="a4789-148">For a memory-optimized data filegroup, the differential backup uses the same algorithm as full database backup to identify the data and delta files for backup but it then filters out the subset of files as follows:</span></span>  
  
    -   <span data-ttu-id="a4789-149">Eine Datendatei, die neu eingefügte Zeilen enthält und voll ist, wird geschlossen und als schreibgeschützt gekennzeichnet.</span><span class="sxs-lookup"><span data-stu-id="a4789-149">A data file contains newly inserted rows and when it is full, it is closed and marked read-only.</span></span> <span data-ttu-id="a4789-150">Eine Datendatei wird nur gesichert, wenn sie nach der letzten vollständigen Datenbanksicherung geschlossen wurde.</span><span class="sxs-lookup"><span data-stu-id="a4789-150">A data file is backed up only if it was closed after the last full database backup.</span></span> <span data-ttu-id="a4789-151">Die differenzielle Sicherung sichert nur Datendateien, die seit der letzten vollständigen Datenbanksicherung eingefügte Zeilen enthalten, mit Ausnahme von zusammenhängenden Update- und Löschvorgängen, bei denen einige der eingefügten Zeilen möglicherweise schon für die Garbage Collection gekennzeichnet bzw. bereits durch diese gelöscht wurden.</span><span class="sxs-lookup"><span data-stu-id="a4789-151">The differential backup only backups up data files containing the inserted rows since the last full database backup with the exception of an update and delete scenario where it is possible that some of the inserted rows may have already been either marked for garbage collection or already garbage collected.</span></span>  
  
    -   <span data-ttu-id="a4789-152">Eine Änderungsdatei speichert Verweise auf die gelöschten Datenzeilen.</span><span class="sxs-lookup"><span data-stu-id="a4789-152">A delta file stores references to the deleted data rows.</span></span> <span data-ttu-id="a4789-153">Da jede zukünftige Transaktion eine Zeile löschen kann, kann eine Änderungsdatei zu jedem Zeitpunkt innerhalb ihrer Lebensdauer geändert werden. Sie wird daher nie geschlossen.</span><span class="sxs-lookup"><span data-stu-id="a4789-153">Since any future transaction can delete a row, a delta file can be modified anytime in its life time, it is never closed.</span></span> <span data-ttu-id="a4789-154">Eine Änderungsdatei wird immer gesichert.</span><span class="sxs-lookup"><span data-stu-id="a4789-154">A delta file is always backed up.</span></span> <span data-ttu-id="a4789-155">Änderungsdateien belegen normalerweise weniger als 10 % des Speichers, sodass Änderungsdateien nur eine minimale Auswirkung auf der Größe der differenziellen Sicherung haben.</span><span class="sxs-lookup"><span data-stu-id="a4789-155">Delta files typically use less than 10% of the storage, so delta files have a minimal impact on the size of differential backup.</span></span>  
  
 <span data-ttu-id="a4789-156">Wenn speicheroptimierte Tabellen einen großen Teil der Datenbank ausmachen, kann die Größe der Datenbanksicherung durch die differenzielle Sicherung erheblich reduziert werden.</span><span class="sxs-lookup"><span data-stu-id="a4789-156">If memory-optimized tables are a significant portion of your database size, the differential backup can significantly reduce the size of your database backup.</span></span>  
  
 <span data-ttu-id="a4789-157">Bei typischen OLTP-Arbeitsauslastungen fallen differenzielle Sicherungen wesentlich kleiner als vollständige Datenbanksicherungen aus.</span><span class="sxs-lookup"><span data-stu-id="a4789-157">For typical OLTP workloads, the differential backups will be considerably smaller than the full database backups.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a4789-158">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="a4789-158">See Also</span></span>  
 [<span data-ttu-id="a4789-159">Sichern und Wiederherstellen speicheroptimierter Tabellen</span><span class="sxs-lookup"><span data-stu-id="a4789-159">Backup, Restore, and Recovery of Memory-Optimized Tables</span></span>](restore-and-recovery-of-memory-optimized-tables.md)  
  
  
