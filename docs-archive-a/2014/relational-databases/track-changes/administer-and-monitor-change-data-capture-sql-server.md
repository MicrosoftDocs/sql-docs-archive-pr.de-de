---
title: Verwalten und Überwachen von Change Data Capture (SQL Server) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data capture [SQL Server], monitoring
- change data capture [SQL Server], administering
- change data capture [SQL Server], jobs
ms.assetid: 23bda497-67b2-4e7b-8e4d-f1f9a2236685
author: rothja
ms.author: jroth
ms.openlocfilehash: 8d97929ead145d1b0de1a1f83becb15ade397683
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87619687"
---
# <a name="administer-and-monitor-change-data-capture-sql-server"></a><span data-ttu-id="7119e-102">Verwalten und Überwachen von Change Data Capture (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="7119e-102">Administer and Monitor Change Data Capture (SQL Server)</span></span>
  <span data-ttu-id="7119e-103">In diesem Thema wird beschrieben, wie Sie Change Data Capture verwalten und überwachen können.</span><span class="sxs-lookup"><span data-stu-id="7119e-103">This topic describes how to administer and monitor change data capture.</span></span>  
  
##  <a name="capture-job"></a><a name="Capture"></a> <span data-ttu-id="7119e-104">Aufzeichnungsauftrag</span><span class="sxs-lookup"><span data-stu-id="7119e-104">Capture Job</span></span>  
 <span data-ttu-id="7119e-105">Der Aufzeichnungsauftrag wird durch Ausführen der parameterlosen gespeicherten Prozedur `sp_MScdc_capture_job` initiiert.</span><span class="sxs-lookup"><span data-stu-id="7119e-105">The capture job is initiated by running the parameterless stored procedure `sp_MScdc_capture_job`.</span></span> <span data-ttu-id="7119e-106">Diese gespeicherte Prozedur beginnt mit dem Extrahieren der konfigurierten Werte für *maxtrans*, *maxscans*, *continuous*und *pollinginterval* für den Aufzeichnungsauftrag aus „msdb.dbo.cdc_jobs“.</span><span class="sxs-lookup"><span data-stu-id="7119e-106">This stored procedure starts by extracting the configured values for *maxtrans*, *maxscans*, *continuous*, and *pollinginterval* for the capture job from msdb.dbo.cdc_jobs.</span></span> <span data-ttu-id="7119e-107">Diese konfigurierten Werte werden dann als Parameter an die gespeicherte Prozedur `sp_cdc_scan` übergeben.</span><span class="sxs-lookup"><span data-stu-id="7119e-107">These configured values are then passed as parameters to the stored procedure `sp_cdc_scan`.</span></span> <span data-ttu-id="7119e-108">Diese werden verwendet, um `sp_replcmds` zum Ausführen des Protokollscans aufzurufen.</span><span class="sxs-lookup"><span data-stu-id="7119e-108">This is used to invoke `sp_replcmds` to perform the log scan.</span></span>  
  
### <a name="capture-job-parameters"></a><span data-ttu-id="7119e-109">Parameter von Aufzeichnungsaufträgen</span><span class="sxs-lookup"><span data-stu-id="7119e-109">Capture Job Parameters</span></span>  
 <span data-ttu-id="7119e-110">Um das Verhalten von Aufzeichnungsaufträgen zu verstehen, müssen Sie verstehen, wie die konfigurierbaren Parameter von `sp_cdc_scan` verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="7119e-110">To understand capture job behavior, you must understand how the configurable parameters are used by `sp_cdc_scan`.</span></span>  
  
#### <a name="maxtrans-parameter"></a><span data-ttu-id="7119e-111">maxtrans-Parameter</span><span class="sxs-lookup"><span data-stu-id="7119e-111">maxtrans Parameter</span></span>  
 <span data-ttu-id="7119e-112">Der *maxtrans* -Parameter gibt die maximale Anzahl von Transaktionen an, die während eines einzelnen Scanzyklus des Protokolls verarbeitet werden kann.</span><span class="sxs-lookup"><span data-stu-id="7119e-112">The *maxtrans* parameter specifies the maximum number of transactions that can be processed in a single scan cycle of the log.</span></span> <span data-ttu-id="7119e-113">Wenn während des Scans die Anzahl der zu verarbeitenden Transaktionen diese Grenze erreicht, werden keine zusätzlichen Transaktionen in den aktuellen Scan eingeschlossen.</span><span class="sxs-lookup"><span data-stu-id="7119e-113">If, during the scan, the number of transactions to be processed reaches this limit, no additional transactions are included in the current scan.</span></span> <span data-ttu-id="7119e-114">Wenn ein Scanzyklus abgeschlossen ist, ist die Anzahl der verarbeiteten Transaktionen immer kleiner als oder gleich *maxtrans*.</span><span class="sxs-lookup"><span data-stu-id="7119e-114">After a scan cycle is complete, the number of transactions that were processed will always be less than or equal to *maxtrans*.</span></span>  
  
#### <a name="maxscans-parameter"></a><span data-ttu-id="7119e-115">maxscans-Parameter</span><span class="sxs-lookup"><span data-stu-id="7119e-115">maxscans Parameter</span></span>  
 <span data-ttu-id="7119e-116">Der Parameter *maxscans* gibt die maximale Anzahl der Scanzyklen an, die vor dem Zurückkehren (kontinuierlich = 0) oder dem Ausführen einer Waitfor-Anweisung (kontinuierlich = 1) auszuführen versucht werden, um das Protokoll zu leeren.</span><span class="sxs-lookup"><span data-stu-id="7119e-116">The *maxscans* parameter specifies the maximum number of scan cycles that are attempted to drain the log before either returning (continuous = 0) or executing a waitfor (continuous = 1).</span></span>  
  
#### <a name="continuous-parameter"></a><span data-ttu-id="7119e-117">continuous-Parameter</span><span class="sxs-lookup"><span data-stu-id="7119e-117">continuous Parameter</span></span>  
 <span data-ttu-id="7119e-118">Der *fortlaufende* Parameter steuert, ob die `sp_cdc_scan` Steuerung in nach dem leeren des Protokolls oder dem Ausführen der maximalen Anzahl von Scan Zyklen (One-Shot-Modus) aufgibt.</span><span class="sxs-lookup"><span data-stu-id="7119e-118">The *continuous* parameter controls whether `sp_cdc_scan` relinquishes control in after either draining the log or executing the maximum number of scan cycles (one shot mode).</span></span> <span data-ttu-id="7119e-119">Er steuert auch, ob `sp_cdc_scan` weiter ausgeführt wird, bis er explizit beendet wird (kontinuierlicher Modus).</span><span class="sxs-lookup"><span data-stu-id="7119e-119">It also controles whether `sp_cdc_scan` continues to run until explicitly stopped (continuous mode).</span></span>  
  
##### <a name="one-shot-mode"></a><span data-ttu-id="7119e-120">Einmalmodus</span><span class="sxs-lookup"><span data-stu-id="7119e-120">One Shot Mode</span></span>  
 <span data-ttu-id="7119e-121">Im One-Shot-Modus fordert der Aufzeichnungs Auftrag `sp_cdc_scan` auf, bis zu *maxtrans* -Scans auszuführen, um zu versuchen, das Protokoll zu leeren und zurückzukehren.</span><span class="sxs-lookup"><span data-stu-id="7119e-121">In one shot mode, the capture job requests `sp_cdc_scan` to perform up to *maxtrans* scans to try to drain the log and return.</span></span> <span data-ttu-id="7119e-122">Alle Transaktionen zusätzlich zu *maxtrans* , die im Protokoll vorhanden sind, werden in späteren Scans verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="7119e-122">Any transactions in addition to *maxtrans* that are present in the log will be processed in later scans.</span></span>  
  
 <span data-ttu-id="7119e-123">Der Einmalmodus wird in gesteuerten Tests verwendet, bei denen die Anzahl der zu verarbeitenden Transaktionen bekannt ist und wo es vorteilhaft ist, dass der Auftrag nach seiner Beendigung automatisch geschlossen wird.</span><span class="sxs-lookup"><span data-stu-id="7119e-123">One shot mode is used in controlled tests, where the volume of transactions to be processed is known, and there are advantages to the fact that the job closes automatically on when it is finished.</span></span> <span data-ttu-id="7119e-124">Der Einmalmodus wird nicht für die Verwendung im Produktionsbereich empfohlen.</span><span class="sxs-lookup"><span data-stu-id="7119e-124">One shot mode is not recommended for production use.</span></span> <span data-ttu-id="7119e-125">Der Grund dafür ist, dass er für das Verwalten der Anzahl der Scanzyklen auf den Auftragszeitplan zurückgreift.</span><span class="sxs-lookup"><span data-stu-id="7119e-125">This is because t relies on the job schedule to manage how frequently the scan cycle is run.</span></span>  
  
 <span data-ttu-id="7119e-126">Bei der Ausführung im Einmalmodus können Sie mithilfe der folgenden Berechnung eine Obergrenze des erwarteten Durchsatzes für den Aufzeichnungsauftrag, angegeben in Transaktionen pro Sekunde, berechnen:</span><span class="sxs-lookup"><span data-stu-id="7119e-126">When running in one shot mode, you can compute an upper bound on expected throughput of the capture job, expressed in transactions per second by using the following computation:</span></span>  
  
 `(maxtrans * maxscans) / number of seconds between scans`  
  
 <span data-ttu-id="7119e-127">Selbst wenn die Zeit, die zum Durchsuchen des Protokolls und zum Füllen der Änderungstabellen nicht erheblich von 0 abweicht, kann der durchschnittliche Durchsatz des Auftrags nicht den Wert überschreiten, der durch Dividieren der Höchstzahl der erlaubten Transaktionen für einen einzelnen Scan multipliziert mit der Höchstzahl der erlaubten Scans durch die Anzahl der Sekunden, die die Protokollverarbeitungsvorgänge trennen, bestimmt wird.</span><span class="sxs-lookup"><span data-stu-id="7119e-127">Even if the time that is required to scan the log and populate the change tables were not significantly different from 0, the average throughput of the job could not exceed the value obtained by dividing the maximum allowed transactions for a single scan multiplied by the maximum allowed scans by the number of seconds separating log processing.</span></span>  
  
 <span data-ttu-id="7119e-128">Beim Verwenden des Einmalmodus zum Steuern von Protokollscanvorgängen müsste die Anzahl der Sekunden zwischen Protokollverarbeitungsvorgängen durch den Auftragszeitplan festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="7119e-128">If one shot mode were to be used to regulate log scanning, the number of seconds between log processing would have to be governed by the job schedule.</span></span> <span data-ttu-id="7119e-129">Wenn dieses Verhalten gewünscht wird, ist es besser, den Aufzeichnungsauftrag im kontinuierlichen Modus auszuführen, um das erneute Planen des Prokollscans zu verwalten.</span><span class="sxs-lookup"><span data-stu-id="7119e-129">When this kind of behavior is desired, running the capture job in continuous mode is a better way to manage rescheduling the log scan.</span></span>  
  
##### <a name="continuous-mode-and-the-polling-interval"></a><span data-ttu-id="7119e-130">Kontinuierlicher Modus und das Abrufintervall</span><span class="sxs-lookup"><span data-stu-id="7119e-130">Continuous Mode and the Polling Interval</span></span>  
 <span data-ttu-id="7119e-131">Im kontinuierlichen Modus wird durch den Aufzeichnungsauftrag das kontinuierliche Ausführen von `sp_cdc_scan` angefordert.</span><span class="sxs-lookup"><span data-stu-id="7119e-131">In continuous mode, the capture job requests that `sp_cdc_scan` run continuously.</span></span> <span data-ttu-id="7119e-132">Dadurch kann die gespeicherte Prozedur ihre eigene Warteschleife nicht nur durch Bereitstellen der Werte von maxtrans und maxscans, sondern auch durch Bereitstellen eines Wertes für die Anzahl der Sekunden zwischen Protokollverarbeitungsvorgängen (für das Abrufintervall) verwalten.</span><span class="sxs-lookup"><span data-stu-id="7119e-132">This lets the stored procedure manage its own wait loop by providing not only for maxtrans and maxscans but also a value for the number of seconds between log processing (the polling interval).</span></span> <span data-ttu-id="7119e-133">Beim Ausführen in diesem Modus bleibt der Aufzeichnungsauftrag aktiv und führt zwischen Protokollscanvorgängen eine `WAITFOR`-Anweisung aus.</span><span class="sxs-lookup"><span data-stu-id="7119e-133">Running in this mode, the capture job remains active, executing a `WAITFOR` between log scanning.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7119e-134">Wenn der Wert des Abrufintervalls größer als 0 ist, gilt die gleiche Obergrenze für den Durchsatz für den wiederkehrenden Einmalauftrag auch für den Auftragsvorgang im kontinuierlichen Modus.</span><span class="sxs-lookup"><span data-stu-id="7119e-134">When the value of the polling interval is greater than 0, the same upper limit on throughput for the recurring one shot job also applies to the job operation in continuous mode.</span></span> <span data-ttu-id="7119e-135">Das heißt, (*maxtrans* \* *maxscans*) geteilt durch ein Abrufintervall ungleich null legt eine Obergrenze für die durchschnittliche Anzahl der Transaktionen fest, die durch den Aufzeichnungsauftrag verarbeitet werden können.</span><span class="sxs-lookup"><span data-stu-id="7119e-135">That is, (*maxtrans* \* *maxscans*) divided by a nonzero polling interval will put an upper bound on the average number of transactions that can be processed by the capture job.</span></span>  
  
### <a name="capture-job-customization"></a><span data-ttu-id="7119e-136">Anpassen eines Aufzeichnungsauftrags</span><span class="sxs-lookup"><span data-stu-id="7119e-136">Capture Job Customization</span></span>  
 <span data-ttu-id="7119e-137">Sie können für den Aufzeichnungsauftrag statt eines festen Abrufintervalls zusätzliche Logik anwenden, um zu bestimmen, ob sofort ein neuer Scan beginnen soll oder ob vor einem neuen Scan ein Ruhezustand erzwungen wird.</span><span class="sxs-lookup"><span data-stu-id="7119e-137">For the capture job, you can apply additional logic to determine whether a new scan begins immediately or whether a sleep is imposed before it starts a new scan instead of rely on a fixed polling interval.</span></span> <span data-ttu-id="7119e-138">Die Wahl kann einfach auf der Uhrzeit basieren. Z. B. können sehr lange Ruhezustände während Spitzenzeiten erzwungen werden. Es sind auch Abrufintervalle von 0 zum Tagesende möglich, wenn die Verarbeitungsvorgänge des Tages abgeschlossen und die Vorgänge der Nacht vorbereitet werden müssen.</span><span class="sxs-lookup"><span data-stu-id="7119e-138">The choice could be based merely on time of the day, perhaps enforcing very long sleeps during peak activity times, and even moving to a polling interval of 0 at close of day when it is important to complete the days processing and prepare for nightly runs.</span></span> <span data-ttu-id="7119e-139">Der Status des Aufzeichnungsprozesses kann außerdem überwacht werden, um zu bestimmen, wann alle Transaktionen, für die bis Mitternacht ein Commit ausgeführt wurde, gescannt und in Änderungstabellen abgelegt worden sind.</span><span class="sxs-lookup"><span data-stu-id="7119e-139">Capture process progress could also be monitored to determine when all transactions committed by mid-night had been scanned and deposited in change tables.</span></span> <span data-ttu-id="7119e-140">Dies beendet den Aufzeichnungsauftrag, der durch einen geplanten täglichen Neustart neu gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="7119e-140">This lets the capture job end, to be restarted by a scheduled daily restart.</span></span> <span data-ttu-id="7119e-141">Durch Ersetzen des übermittelten Auftragsschritts, der `sp_cdc_scan` aufruft, durch einen Aufruf eines benutzerspezifischen Wrappers für `sp_cdc_scan` kann durch wenig zusätzlichen Aufwand ein hochgradig angepasstes Verhalten erzielt werden.</span><span class="sxs-lookup"><span data-stu-id="7119e-141">By replacing the delivered job step calling `sp_cdc_scan` with a call to a user written wrapper for `sp_cdc_scan`, highly customized behavior can be obtained with little additional effort.</span></span>  
  
##  <a name="cleanup-job"></a><a name="Cleanup"></a> <span data-ttu-id="7119e-142">Cleanupauftrag</span><span class="sxs-lookup"><span data-stu-id="7119e-142">Cleanup Job</span></span>  
 <span data-ttu-id="7119e-143">Dieser Abschnitt enthält Informationen darüber, wie der Change Data Capture-Cleanupauftrag funktioniert.</span><span class="sxs-lookup"><span data-stu-id="7119e-143">This section provides information about how the change data capture cleanup job works.</span></span>  
  
### <a name="structure-of-the-cleanup-job"></a><span data-ttu-id="7119e-144">Struktur des Cleanupauftrags</span><span class="sxs-lookup"><span data-stu-id="7119e-144">Structure of the Cleanup Job</span></span>  
 <span data-ttu-id="7119e-145">Change Data Capture verwendet eine beibehaltungsbasierte Cleanupstrategie zum Verwalten der Größe der Änderungstabellen.</span><span class="sxs-lookup"><span data-stu-id="7119e-145">Change data capture uses a retention based cleanup strategy to manage change table size.</span></span> <span data-ttu-id="7119e-146">Der Cleanupmechanismus besteht aus einem [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent- [!INCLUDE[tsql](../../includes/tsql-md.md)] -Auftrag, der erstellt wird, wenn die erste Datenbanktabelle aktiviert wird.</span><span class="sxs-lookup"><span data-stu-id="7119e-146">The cleanup mechanism consists of a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent [!INCLUDE[tsql](../../includes/tsql-md.md)] job that is created when the first database table is enabled.</span></span> <span data-ttu-id="7119e-147">Ein einzelner Cleanupauftrag verarbeitet das Cleanup für alle Datenbankänderungstabellen und wendet denselben Beibehaltungswert auf alle definierten Aufzeichnungsinstanzen an.</span><span class="sxs-lookup"><span data-stu-id="7119e-147">A single cleanup job handles cleanup for all database change tables and applies the same retention value to all defined capture instances.</span></span>  
  
 <span data-ttu-id="7119e-148">Der Cleanupauftrag wird durch Ausführen der parameterlosen gespeicherten Prozedur `sp_MScdc_cleanup_job` initiiert.</span><span class="sxs-lookup"><span data-stu-id="7119e-148">The cleanup job is initiated by running the parameterless stored procedure `sp_MScdc_cleanup_job`.</span></span> <span data-ttu-id="7119e-149">Diese gespeicherte Prozedur beginnt mit dem Extrahieren der konfigurierten Beibehaltungs- und Schwellenwerte für den Cleanupauftrag aus `msdb.dbo.cdc_jobs`.</span><span class="sxs-lookup"><span data-stu-id="7119e-149">This stored procedure starts by extracting the configured retention and threshold values for the cleanup job from `msdb.dbo.cdc_jobs`.</span></span> <span data-ttu-id="7119e-150">Der Beibehaltungswert wird verwendet, um eine neue Untergrenzenmarkierung für die Änderungstabellen zu berechnen.</span><span class="sxs-lookup"><span data-stu-id="7119e-150">The retention value is used to compute a new low watermark for the change tables.</span></span> <span data-ttu-id="7119e-151">Die angegebene Anzahl von Minuten wird von der maximalen *tran_end_time* Wert aus der-Tabelle subtrahiert `cdc.lsn_time_mapping` , um die neue Untergrenzenmarkierung, ausgedrückt als DateTime-Wert, zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="7119e-151">The specified number of minutes is subtracted from the maximum *tran_end_time* value from the `cdc.lsn_time_mapping` table to obtain the new low water mark expressed as a datetime value.</span></span> <span data-ttu-id="7119e-152">Anschließend wird die Tabelle CDC.lsn_time_mapping verwendet, um diesen datetime-Wert in einen entsprechenden `lsn`-Wert zu konvertieren.</span><span class="sxs-lookup"><span data-stu-id="7119e-152">The CDC.lsn_time_mapping table is then used to convert this datetime value to a corresponding `lsn` value.</span></span> <span data-ttu-id="7119e-153">Wenn mehrere Werte in der Tabelle dieselbe Commitzeit verwenden, wird der `lsn`, der dem Eintrag mit dem kleinsten `lsn` entspricht, als neue Untergrenzenmarkierung bestimmt.</span><span class="sxs-lookup"><span data-stu-id="7119e-153">If the same commit time is shared by multiple entries in the table, the `lsn` that corresponds to the entry that has the smallest `lsn` is chosen as the new low watermark.</span></span> <span data-ttu-id="7119e-154">Dieser `lsn`-Wert wird an `sp_cdc_cleanup_change_tables` übergeben, um Einträge in den Änderungstabellen aus den Datenbankänderungstabellen zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="7119e-154">This `lsn` value is passed to `sp_cdc_cleanup_change_tables` to remove change table entries from the database change tables.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="7119e-155">Das Verwenden der Commitzeit der letzten Transaktion zum Berechnen der neuen Untergrenzenmarkierung hat den Vorteil, dass Änderungen in den Änderungstabellen für die angegebene Zeit erhalten bleiben.</span><span class="sxs-lookup"><span data-stu-id="7119e-155">The advantage of using the commit time of the recent transaction as the base for computing the new low watermark is that it lets the changes remain in change tables for the specified time.</span></span> <span data-ttu-id="7119e-156">Dies geschieht sogar, wenn der Aufzeichnungsprozess zurückliegt.</span><span class="sxs-lookup"><span data-stu-id="7119e-156">This happens even when the capture process is running behind.</span></span> <span data-ttu-id="7119e-157">Alle Einträge, die dieselbe Commitzeit verwenden wie die aktuelle Untergrenzenmarkierung, werden weiterhin in den Änderungstabellen durch Wählen des kleinsten `lsn` dargestellt, der die gemeinsame Commitzeit für die aktuelle Untergrenzenmarkierung aufweist.</span><span class="sxs-lookup"><span data-stu-id="7119e-157">All entries that have the same commit time as the current low watermark continue to be represented within the change tables by choosing the smallest `lsn` that has the shared commit time for the actual low watermark.</span></span>  
  
 <span data-ttu-id="7119e-158">Wenn ein Cleanup ausgeführt wird, wird die Untergrenzenmarkierung für alle Aufzeichnungsinstanzen zunächst in einer einzelnen Transaktion aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="7119e-158">When a cleanup is performed, the low watermark for all capture instances is initially updated in a single transaction.</span></span> <span data-ttu-id="7119e-159">Anschließend wird versucht, veraltete Einträge aus den Änderungstabellen und der Tabelle cdc.lsn_time_mapping zu entfernen.</span><span class="sxs-lookup"><span data-stu-id="7119e-159">It then tries to remove obsolete entries from the change tables and the cdc.lsn_time_mapping table.</span></span> <span data-ttu-id="7119e-160">Der konfigurierbare Schwellenwert begrenzt, wie viele Einträge in jeder einzelnen Anweisung gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="7119e-160">The configurable threshold value limits how many entries are deleted in any single statement.</span></span> <span data-ttu-id="7119e-161">Das Fehlschlagen des Löschvorgangs für einzelne Tabellen führt nicht dazu, dass die Ausführung des Vorgangs nicht für die übrigen Tabellen versucht wird.</span><span class="sxs-lookup"><span data-stu-id="7119e-161">Failure to perform the delete on any individual table will not prevent the operation from being attempted on the remaining tables.</span></span>  
  
### <a name="cleanup-job-customization"></a><span data-ttu-id="7119e-162">Anpassen eines Cleanupauftrags</span><span class="sxs-lookup"><span data-stu-id="7119e-162">Cleanup Job Customization</span></span>  
 <span data-ttu-id="7119e-163">Die Anpassungsmöglichkeiten für den Cleanupauftrag bestehen in der Strategie, die verwendet wird, um zu bestimmen, welche Einträge in der Änderungstabelle verworfen werden sollen.</span><span class="sxs-lookup"><span data-stu-id="7119e-163">For the cleanup job, the possibility for customization is in the strategy used to determine which change table entries are to be discarded.</span></span> <span data-ttu-id="7119e-164">Im übermittelten Cleanupauftrag wird nur eine zeitbasierte Strategie unterstützt.</span><span class="sxs-lookup"><span data-stu-id="7119e-164">The only supported strategy in the delivered cleanup job is a time-based one.</span></span> <span data-ttu-id="7119e-165">In diesem Fall wird die neue Untergrenzenmarkierung durch Subtrahieren der zulässigen Beibehaltungsdauer von der Commitzeit der letzten verarbeiteten Transaktion berechnet.</span><span class="sxs-lookup"><span data-stu-id="7119e-165">In that situation, the new low watermark is computed by subtracting the allowed retention period from the commit time of the last transaction processed.</span></span> <span data-ttu-id="7119e-166">Da die zugrunde liegenden Cleanupprozeduren auf `lsn` statt auf Zeit basieren, kann eine beliebige Anzahl von Strategien verwendet werden, um den kleinsten `lsn` zu bestimmen, der in den Änderungstabellen bewahrt werden soll.</span><span class="sxs-lookup"><span data-stu-id="7119e-166">Because the underlying cleanup procedures are based on `lsn` instead of time, any number of strategies can be used to determine the smallest `lsn` to keep in the change tables.</span></span> <span data-ttu-id="7119e-167">Nur einige von diesen sind streng zeitbasiert.</span><span class="sxs-lookup"><span data-stu-id="7119e-167">Only some of these are strictly time-based.</span></span> <span data-ttu-id="7119e-168">Es könnte z. B. Wissen über die Clients zum Bereitstellen einer Sicherung verwendet werden, wenn nachfolgende Prozesse, die Zugriff auf die Änderungstabellen erfordern, nicht ausgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="7119e-168">Knowledge about the clients, for example, could be used to provide a failsafe if downstream processes that require access to the change tables cannot run.</span></span> <span data-ttu-id="7119e-169">Obwohl die Standardstrategie denselben `lsn` für das Cleanup aller Änderungstabellen der Datenbank verwendet, kann auch die zugrunde liegende Cleanupprozedur für das Cleanup auf Aufzeichnungsinstanzebene aufgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="7119e-169">Also, although the default strategy applies the same `lsn` to clean up all the databases' change tables, the underlying cleanup procedure, can also be called to clean up at the capture instance level.</span></span>  
  
##  <a name="monitor-the-change-data-capture-process"></a><a name="Monitor"></a> <span data-ttu-id="7119e-170">Überwachen des Change Data Capture-Prozesses</span><span class="sxs-lookup"><span data-stu-id="7119e-170">Monitor the Change Data Capture Process</span></span>  
 <span data-ttu-id="7119e-171">Indem Sie den Change Data Capture-Prozess überwachen, können Sie ermitteln, ob Änderungen korrekt und mit einer akzeptablen Latenzzeit in die Änderungstabellen geschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="7119e-171">Monitoring the change data capture process lets you determine if changes are being written correctly and with a reasonable latency to the change tables.</span></span> <span data-ttu-id="7119e-172">Das Überwachen kann Ihnen auch dabei helfen, jegliche Fehler zu identifizieren, die auftreten könnten.</span><span class="sxs-lookup"><span data-stu-id="7119e-172">Monitoring can also help you to identify any errors that might occur.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="7119e-173">verfügt über zwei dynamische Verwaltungssichten, womit Sie Change Data Capture überwachen können: [sys.dm_cdc_log_scan_sessions](../native-client-ole-db-data-source-objects/sessions.md) und [sys.dm_cdc_errors](../native-client-ole-db-errors/errors.md).</span><span class="sxs-lookup"><span data-stu-id="7119e-173">includes two dynamic management views to help you monitor change data capture: [sys.dm_cdc_log_scan_sessions](../native-client-ole-db-data-source-objects/sessions.md) and [sys.dm_cdc_errors](../native-client-ole-db-errors/errors.md).</span></span>  
  
### <a name="identify-sessions-with-empty-result-sets"></a><span data-ttu-id="7119e-174">Identifizieren von Sitzungen mit leeren Resultsets</span><span class="sxs-lookup"><span data-stu-id="7119e-174">Identify Sessions with Empty Result Sets</span></span>  
 <span data-ttu-id="7119e-175">Jede Zeile in sys.dm_cdc_log_scan_sessions stellt eine Protokollscansitzung (außer der Zeile mit einer ID von 0) dar.</span><span class="sxs-lookup"><span data-stu-id="7119e-175">Every row in sys.dm_cdc_log_scan_sessions represents a log scan session (except the row with an ID of 0).</span></span> <span data-ttu-id="7119e-176">Eine Protokollscansitzung entspricht einer Ausführung von [sp_cdc_scan](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-scan-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="7119e-176">A log scan session is equivalent to one execution of [sp_cdc_scan](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-scan-transact-sql).</span></span> <span data-ttu-id="7119e-177">Während einer Sitzung kann der Scan entweder Änderungen oder ein leeres Ergebnis zurückgeben.</span><span class="sxs-lookup"><span data-stu-id="7119e-177">During a session, the scan can either return changes or return an empty result.</span></span> <span data-ttu-id="7119e-178">Wenn das Resultset leer ist, wird die Spalte empty_scan_count in sys.dm_cdc_log_scan_sessions auf den Wert 1 gesetzt.</span><span class="sxs-lookup"><span data-stu-id="7119e-178">If the result set is empty, the empty_scan_count column in sys.dm_cdc_log_scan_sessions is set to 1.</span></span> <span data-ttu-id="7119e-179">Folgen noch weitere leere Resultsets, z. B. wenn der Aufzeichnungsauftrag dauerhaft ausgeführt wird, wird empty_scan_count in der letzten vorhandenen Zeile inkrementiert.</span><span class="sxs-lookup"><span data-stu-id="7119e-179">If there are consecutive empty result sets, such as if the capture job is running continuously, the empty_scan_count in the last existing row is incremented.</span></span> <span data-ttu-id="7119e-180">Wenn sys.dm_cdc_log_scan_sessions z. B. bereits 10 Zeilen für Scans enthält, die Änderungen zurückgegeben haben, und fünf leere Ergebnisse aufeinander folgen, enthält die Sicht 11 Zeilen.</span><span class="sxs-lookup"><span data-stu-id="7119e-180">For example, if sys.dm_cdc_log_scan_sessions already contains 10 rows for scans that returned changes and there are five empty results in a row, the view contains 11 rows.</span></span> <span data-ttu-id="7119e-181">Die letzte Zeile verfügt in der Spalte empty_scan_count über einen Wert von 5.</span><span class="sxs-lookup"><span data-stu-id="7119e-181">The last row has a value of 5 in the empty_scan_count column.</span></span> <span data-ttu-id="7119e-182">Führen Sie die folgende Abfrage aus, um Sitzungen zu ermitteln, die einen leeren Scan aufweisen:</span><span class="sxs-lookup"><span data-stu-id="7119e-182">To determine sessions that had an empty scan, run the following query:</span></span>  
  
```sql
SELECT * from sys.dm_cdc_log_scan_sessions where empty_scan_count <> 0
```
  
### <a name="determine-latency"></a><span data-ttu-id="7119e-183">Bestimmen von Latenzzeit</span><span class="sxs-lookup"><span data-stu-id="7119e-183">Determine Latency</span></span>  
 <span data-ttu-id="7119e-184">Die Verwaltungssicht sys.dm_cdc_log_scan_sessions enthält eine Spalte, in der die Latenzzeit für die einzelnen Aufzeichnungssitzungen erfasst wird.</span><span class="sxs-lookup"><span data-stu-id="7119e-184">The sys.dm_cdc_log_scan_sessions management view includes a column that records the latency for each capture session.</span></span> <span data-ttu-id="7119e-185">Die Latenzzeit ist als die Zeitspanne zwischen dem Ausführen des Commit für eine Transaktion in einer Quelltabelle und dem Ausführen des Commit für die letzte aufgezeichnete Transaktion in der Änderungstabelle definiert.</span><span class="sxs-lookup"><span data-stu-id="7119e-185">Latency is defined as the elapsed time between a transaction being committed on a source table and the last captured transaction being committed on the change table.</span></span> <span data-ttu-id="7119e-186">Die Latenzzeitspalte wird nur für aktive Sitzungen aufgefüllt.</span><span class="sxs-lookup"><span data-stu-id="7119e-186">The latency column is populated only for active sessions.</span></span> <span data-ttu-id="7119e-187">Für Sitzungen, die in der Spalte empty_scan_count column einen höheren Wert als 0 enthalten, wird die Latenzzeitspalte auf 0 gesetzt.</span><span class="sxs-lookup"><span data-stu-id="7119e-187">For sessions with a value greater than 0 in the empty_scan_count column, the latency column is set to 0.</span></span> <span data-ttu-id="7119e-188">Die folgende Abfrage gibt die durchschnittliche Latenzzeit für die letzten Sitzungen zurück:</span><span class="sxs-lookup"><span data-stu-id="7119e-188">The following query returns the average latency for the most recent sessions:</span></span>  
  
```sql
SELECT latency FROM sys.dm_cdc_log_scan_sessions WHERE session_id = 0
```
  
 <span data-ttu-id="7119e-189">Sie können Latenzzeitdaten verwenden, um zu ermitteln, wie schnell bzw. langsam der Aufzeichnungsprozess Transaktionen verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="7119e-189">You can use latency data to determine how fast or slow the capture process is processing transactions.</span></span> <span data-ttu-id="7119e-190">Diese Daten sind sehr hilfreich, wenn der Aufzeichnungsprozess kontinuierlich ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="7119e-190">This data is most useful when the capture process is running continuously.</span></span> <span data-ttu-id="7119e-191">Wenn der Aufzeichnungsprozess gemäß einem Zeitplan ausgeführt wird, kann die Latenzzeit u. U. lang sein. Dies liegt an der Verzögerung zwischen den Transaktionen, für die in der Quelltabelle ein Commit ausgeführt wird, und dem Aufzeichnungsprozess, der zum geplanten Zeitpunkt ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="7119e-191">If the capture process is running on a schedule, latency can be high because of the lag between transactions being committed on the source table and the capture process running at its scheduled time.</span></span>  
  
 <span data-ttu-id="7119e-192">Eine andere wichtige Kennzahl für die Effizienz des Aufzeichnungsprozesses ist der Durchsatz.</span><span class="sxs-lookup"><span data-stu-id="7119e-192">Another important measure of capture process efficiency is throughput.</span></span> <span data-ttu-id="7119e-193">Dies ist die durchschnittliche Anzahl von Befehlen pro Sekunde, die während einer Sitzung verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="7119e-193">This is the average number of commands per second that are processed during each session.</span></span> <span data-ttu-id="7119e-194">Um den Durchsatz einer Sitzung zu ermitteln, teilen Sie den Wert in der Spalte command_count durch den Wert in der Spalte mit der Dauer (duration).</span><span class="sxs-lookup"><span data-stu-id="7119e-194">To determine the throughput of a session, divide the value in the command_count column by the value in the duration column.</span></span> <span data-ttu-id="7119e-195">Die folgende Abfrage gibt den durchschnittlichen Durchsatz für die letzten Sitzungen zurück:</span><span class="sxs-lookup"><span data-stu-id="7119e-195">The following query returns the average throughput for the most recent sessions:</span></span>  
  
```sql
SELECT command_count/duration AS [Throughput] FROM sys.dm_cdc_log_scan_sessions WHERE session_id = 0
```
  
### <a name="use-data-collector-to-collect-sampling-data"></a><span data-ttu-id="7119e-196">Verwenden des Datensammlers zum Erfassen von Samplingdaten</span><span class="sxs-lookup"><span data-stu-id="7119e-196">Use Data Collector to Collect Sampling Data</span></span>  
 <span data-ttu-id="7119e-197">Mithilfe des [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Datensammlers können Sie Momentaufnahmen von Daten aus allen Tabellen oder dynamischen Verwaltungssichten erfassen und ein Data Warehouse für die Leistung erstellen.</span><span class="sxs-lookup"><span data-stu-id="7119e-197">The [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data collector lets you collect snapshots of data from any table or dynamic management view and build a performance data warehouse.</span></span> <span data-ttu-id="7119e-198">Wenn für eine Datenbank Change Data Capture aktiviert ist, sollten Sie in regelmäßigen Abständen Momentaufnahmen der Sichten sys.dm_cdc_log_scan_sessions und sys.dm_cdc_errors erstellen, um später eine Analyse durchführen zu können.</span><span class="sxs-lookup"><span data-stu-id="7119e-198">When change data capture is enabled on a database, it is useful to take snapshots of the sys.dm_cdc_log_scan_sessions view and the sys.dm_cdc_errors view at regular intervals for later analysis.</span></span> <span data-ttu-id="7119e-199">Die folgende Prozedur richtet einen Datensammler ein, der Datenstichproben aus der Verwaltungssicht sys.dm_cdc_log_scan_sessions entnimmt.</span><span class="sxs-lookup"><span data-stu-id="7119e-199">The following procedure sets up a data collector for collecting sample data from the sys.dm_cdc_log_scan_sessions management view.</span></span>  
  
 <span data-ttu-id="7119e-200">**Konfigurieren der Datensammlung**</span><span class="sxs-lookup"><span data-stu-id="7119e-200">**Configuring Data Collection**</span></span>  
  
1.  <span data-ttu-id="7119e-201">Aktivieren Sie den Datensammler, und konfigurieren Sie ein Management Data Warehouse.</span><span class="sxs-lookup"><span data-stu-id="7119e-201">Enable data collector and configure a management data warehouse.</span></span> <span data-ttu-id="7119e-202">Weitere Informationen finden Sie unter [Verwalten von Datensammlungen](../data-collection/data-collection.md).</span><span class="sxs-lookup"><span data-stu-id="7119e-202">For more information, see [Manage Data Collection](../data-collection/data-collection.md).</span></span>  
  
2.  <span data-ttu-id="7119e-203">Führen Sie den folgenden Code aus, um für Change Data Capture einen benutzerdefinierten Sammler zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="7119e-203">Execute the following code to create a custom collector for change data capture.</span></span>  
  
    ```sql  
    USE msdb;  
  
    DECLARE @schedule_uid uniqueidentifier;  
  
    -- Collect and upload data every 5 minutes  
    SELECT @schedule_uid = (  
    SELECT schedule_uid from sysschedules_localserver_view   
    WHERE name = N'CollectorSchedule_Every_5min')  
  
    DECLARE @collection_set_id int;  
  
    EXEC dbo.sp_syscollector_create_collection_set  
    @name = N' CDC Performance Data Collector',  
    @schedule_uid = @schedule_uid,          
    @collection_mode = 0,                   
    @days_until_expiration = 30,                
    @description = N'This collection set collects CDC metadata',  
    @collection_set_id = @collection_set_id output;  
  
    -- Create a collection item using statistics from   
    -- the change data capture dynamic management view.  
    DECLARE @parameters xml;  
    DECLARE @collection_item_id int;  
  
    SELECT @parameters = CONVERT(xml,   
        N'<TSQLQueryCollector>  
            <Query>  
              <Value>SELECT * FROM sys.dm_cdc_log_scan_sessions</Value>  
              <OutputTable>cdc_log_scan_data</OutputTable>  
            </Query>  
          </TSQLQueryCollector>');  
  
    EXEC dbo.sp_syscollector_create_collection_item  
    @collection_set_id = @collection_set_id,  
    @collector_type_uid = N'302E93D1-3424-4BE7-AA8E-84813ECF2419',  
    @name = ' CDC Performance Data Collector',  
    @frequency = 5,   
    @parameters = @parameters,  
    @collection_item_id = @collection_item_id output;  
  
    GO  
    ```  
  
3.  <span data-ttu-id="7119e-204">Erweitern Sie in [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]die Option **Verwaltung**und dann die Option **Datensammlung**.</span><span class="sxs-lookup"><span data-stu-id="7119e-204">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], expand **Management**, and then expand **Data Collection**.</span></span> <span data-ttu-id="7119e-205">Klicken Sie mit der rechten Maustaste auf **CDC Performance Data Collector**, und klicken Sie dann auf **Datensammlungssatz starten**.</span><span class="sxs-lookup"><span data-stu-id="7119e-205">Right click **CDC Performance Data Collector**, and then click **Start Data Collection Set**.</span></span>  
  
4.  <span data-ttu-id="7119e-206">Greifen Sie in dem Data Warehouse, das Sie in Schritt 1 konfiguriert haben, auf die Tabelle custom_snapshots.cdc_log_scan_data zu.</span><span class="sxs-lookup"><span data-stu-id="7119e-206">In the data warehouse you configured in step 1, locate the table custom_snapshots.cdc_log_scan_data.</span></span> <span data-ttu-id="7119e-207">Diese Tabelle stellt eine Verlaufs-Momentaufnahme der Daten von Protokollscansitzungen bereit.</span><span class="sxs-lookup"><span data-stu-id="7119e-207">This table provides a historical snapshot of data from log scan sessions.</span></span> <span data-ttu-id="7119e-208">Sie können diese Daten verwenden, um die Latenzzeit, den Durchsatz und andere Leistungskennzahlen in Abhängigkeit der Zeit zu analysieren.</span><span class="sxs-lookup"><span data-stu-id="7119e-208">This data can be used to analyze latency, throughput, and other performance measures over time.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7119e-209">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="7119e-209">See Also</span></span>  
 <span data-ttu-id="7119e-210">[Nachverfolgen von Datenänderungen &#40;SQL Server&#41;](track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="7119e-210">[Track Data Changes &#40;SQL Server&#41;](track-data-changes-sql-server.md) </span></span>  
 <span data-ttu-id="7119e-211">[Über Change Data Capture &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="7119e-211">[About Change Data Capture &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="7119e-212">[Aktivieren und Deaktivieren von Change Data Capture &#40;SQL Server&#41;](enable-and-disable-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="7119e-212">[Enable and Disable Change Data Capture &#40;SQL Server&#41;](enable-and-disable-change-data-capture-sql-server.md) </span></span>  
 [<span data-ttu-id="7119e-213">Arbeiten mit Änderungsdaten &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="7119e-213">Work with Change Data &#40;SQL Server&#41;</span></span>](work-with-change-data-sql-server.md)  
  
  
