---
title: Über Change Data Capture (SQL Server) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data capture [SQL Server], about
- change data capture [SQL Server]
- 22832 (Database Engine error)
ms.assetid: 7d8c4684-9eb1-4791-8c3b-0f0bb15d9634
author: rothja
ms.author: jroth
ms.openlocfilehash: cf8045ff45e7467a626bee85857ae8319f5d2649
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87619695"
---
# <a name="about-change-data-capture-sql-server"></a><span data-ttu-id="5d359-102">Über Change Data Capture (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="5d359-102">About Change Data Capture (SQL Server)</span></span>
  <span data-ttu-id="5d359-103">Change Data Capture zeichnet Einfüge-, Aktualisierungs- und Löschaktivitäten auf, die an einer [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Tabelle vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-103">Change data capture records insert, update, and delete activity that is applied to a [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] table.</span></span> <span data-ttu-id="5d359-104">Hierdurch werden die Details zu diesen Änderungen in einem leicht verwendbaren relationalen Format bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="5d359-104">This makes the details of the changes available in an easily consumed relational format.</span></span> <span data-ttu-id="5d359-105">Für die geänderten Zeilen werden die Spaltendaten sowie die Metadaten, die zur Übernahme der Änderungen in einer Zielumgebung erforderlich sind, aufgezeichnet und in Änderungstabellen gespeichert, die die Spaltenstruktur der nachverfolgten Quelltabellen widerspiegeln.</span><span class="sxs-lookup"><span data-stu-id="5d359-105">Column information and the metadata that is required to apply the changes to a target environment is captured for the modified rows and stored in change tables that mirror the column structure of the tracked source tables.</span></span> <span data-ttu-id="5d359-106">Für den systematischen Zugriff auf die Änderungsdaten durch den Consumer werden Tabellenwertfunktionen bereitgestellt.</span><span class="sxs-lookup"><span data-stu-id="5d359-106">Table-valued functions are provided to allow systematic access to the change data by consumers.</span></span>  
  
 <span data-ttu-id="5d359-107">Ein Beispiel für einen Datenconsumer, auf den diese Technologie abzielt, ist eine Anwendung zum Extrahieren, Transformieren und Laden (ETL-Anwendung).</span><span class="sxs-lookup"><span data-stu-id="5d359-107">A good example of a data consumer that is targeted by this technology is an extraction, transformation, and loading (ETL) application.</span></span> <span data-ttu-id="5d359-108">Eine ETL-Anwendung lädt Änderungsdaten inkrementell aus [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Quelltabellen in ein Data Warehouse oder Data Mart.</span><span class="sxs-lookup"><span data-stu-id="5d359-108">An ETL application incrementally loads change data from [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] source tables to a data warehouse or data mart.</span></span> <span data-ttu-id="5d359-109">Obwohl die Darstellung der Quelltabellen innerhalb des Data Warehouse Änderungen in den Quelltabellen widerspiegeln muss, sind End-to-End-Technologien, die eine Kopie der Quelle aktualisieren, ungeeignet.</span><span class="sxs-lookup"><span data-stu-id="5d359-109">Although the representation of the source tables within the data warehouse must reflect changes in the source tables, an end-to-end technology that refreshes a replica of the source is not appropriate.</span></span> <span data-ttu-id="5d359-110">Benötigt wird stattdessen ein zuverlässiger Datenstrom von Änderungsdaten, der so strukturiert ist, dass er vom Consumer problemlos auf unterschiedliche Darstellungen der Daten in einer Zielumgebung angewendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="5d359-110">Instead, you need a reliable stream of change data that is structured so that consumers can apply it to dissimilar target representations of the data.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="5d359-111">stellt diese Technologie bereit.</span><span class="sxs-lookup"><span data-stu-id="5d359-111">change data capture provides this technology.</span></span>  
  
## <a name="change-data-capture-data-flow"></a><span data-ttu-id="5d359-112">Change Data Capture &ndash; Datenfluss</span><span class="sxs-lookup"><span data-stu-id="5d359-112">Change Data Capture Data Flow</span></span>  
 <span data-ttu-id="5d359-113">Die folgende Abbildung zeigt den Hauptdatenfluss für Change Data Capture.</span><span class="sxs-lookup"><span data-stu-id="5d359-113">The following illustration shows the principal data flow for change data capture.</span></span>  
  
 <span data-ttu-id="5d359-114">![Change Data Capture – Datenfluss](../../database-engine/media/cdcdataflow.gif "Change Data Capture &ndash; Datenfluss")</span><span class="sxs-lookup"><span data-stu-id="5d359-114">![Change data capture data flow](../../database-engine/media/cdcdataflow.gif "Change data capture data flow")</span></span>  
  
 <span data-ttu-id="5d359-115">Die Quelle der Änderungsdaten ist für Change Data Capture das [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Transaktionsprotokoll.</span><span class="sxs-lookup"><span data-stu-id="5d359-115">The source of change data for change data capture is the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] transaction log.</span></span> <span data-ttu-id="5d359-116">Bei Einfügungen, Aktualisierungen und Löschungen in den nachverfolgten Quelltabellen werden diesem Protokoll entsprechende Einträge hinzugefügt, die diese Änderungen beschreiben.</span><span class="sxs-lookup"><span data-stu-id="5d359-116">As inserts, updates, and deletes are applied to tracked source tables, entries that describe those changes are added to the log.</span></span> <span data-ttu-id="5d359-117">Das Protokoll dient als Eingabe für den Erfassungsvorgang.</span><span class="sxs-lookup"><span data-stu-id="5d359-117">The log serves as input to the capture process.</span></span> <span data-ttu-id="5d359-118">Der Prozess liest das Protokoll und fügt der Änderungstabelle, die mit der nachverfolgten Tabelle verknüpft ist, Informationen über die Änderungen hinzu.</span><span class="sxs-lookup"><span data-stu-id="5d359-118">This reads the log and adds information about changes to the tracked table's associated change table.</span></span> <span data-ttu-id="5d359-119">Zur Aufzählung der Änderungen in den Änderungstabellen innerhalb eines angegebenen Bereichs werden Funktionen bereitgestellt, und die Informationen werden in Form eines gefilterten Resultsets zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="5d359-119">Functions are provided to enumerate the changes that appear in the change tables over a specified range, returning the information in the form of a filtered result set.</span></span> <span data-ttu-id="5d359-120">Das gefilterte Resultset wird typischerweise von einem Anwendungsprozess verwendet, um die Darstellung der Quelle in einer externen Umgebung zu aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="5d359-120">The filtered result set is typically used by an application process to update a representation of the source in some external environment.</span></span>  
  
## <a name="understanding-change-data-capture-and-the-capture-instance"></a><span data-ttu-id="5d359-121">Change Data Capture und die Aufzeichnungsinstanz</span><span class="sxs-lookup"><span data-stu-id="5d359-121">Understanding Change Data Capture and the Capture Instance</span></span>  
 <span data-ttu-id="5d359-122">Damit Änderungen an einzelnen Tabellen innerhalb einer Datenbank nachverfolgt werden können, muss Change Data Capture explizit für die Datenbank aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-122">Before changes to any individual tables within a database can be tracked, change data capture must be explicitly enabled for the database.</span></span> <span data-ttu-id="5d359-123">Dazu wird die gespeicherte Prozedur [sys.sp_cdc_enable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-db-transact-sql)verwendet.</span><span class="sxs-lookup"><span data-stu-id="5d359-123">This is done by using the stored procedure [sys.sp_cdc_enable_db](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-db-transact-sql).</span></span> <span data-ttu-id="5d359-124">Wenn die Datenbank für Change Data Capture aktiviert ist, können Quelltabellen mit der gespeicherten Prozedur [sys.sp_cdc_enable_table](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql)als nachverfolgte Tabellen identifiziert werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-124">When the database is enabled, source tables can be identified as tracked tables by using the stored procedure [sys.sp_cdc_enable_table](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-enable-table-transact-sql).</span></span> <span data-ttu-id="5d359-125">Wenn eine Tabelle für Change Data Capture aktiviert ist, wird eine Aufzeichnungsinstanz erstellt und zugeordnet, die die Verteilung der Änderungsdaten in der Quelltabelle unterstützt.</span><span class="sxs-lookup"><span data-stu-id="5d359-125">When a table is enabled for change data capture, an associated capture instance is created to support the dissemination of the change data in the source table.</span></span> <span data-ttu-id="5d359-126">Die Aufzeichnungsinstanz besteht aus einer Änderungstabelle und bis zu zwei Abfragefunktionen.</span><span class="sxs-lookup"><span data-stu-id="5d359-126">The capture instance consists of a change table and up to two query functions.</span></span> <span data-ttu-id="5d359-127">Die Metadaten, mit denen die Konfigurationsdetails der Aufzeichnungsinstanz beschrieben werden, befinden sich in den Change Data Capture-Metadatentabellen `cdc.change_tables`, `cdc.index_columns` und `cdc.captured_columns`.</span><span class="sxs-lookup"><span data-stu-id="5d359-127">Metadata that describes the configuration details of the capture instance is retained in the change data capture metadata tables `cdc.change_tables`, `cdc.index_columns`, and `cdc.captured_columns`.</span></span> <span data-ttu-id="5d359-128">Diese Informationen können mit der gespeicherten Prozedur [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql)abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-128">This information can be retrieved by using the stored procedure [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql).</span></span>  
  
 <span data-ttu-id="5d359-129">Alle einer Aufzeichnungsinstanz zugeordneten Objekte werden im Change Data Capture-Schema der aktivierten Datenbank erstellt.</span><span class="sxs-lookup"><span data-stu-id="5d359-129">All objects that are associated with a capture instance are created in the change data capture schema of the enabled database.</span></span> <span data-ttu-id="5d359-130">Der Name der Aufzeichnungsinstanz muss ein gültiger Objektname sein, der innerhalb aller Aufzeichnungsinstanzen der Datenbank eindeutig ist.</span><span class="sxs-lookup"><span data-stu-id="5d359-130">The requirements for the capture instance name is that it be a valid object name, and that it be unique across the database capture instances.</span></span> <span data-ttu-id="5d359-131">Standardmäßig ist der Name der \<*schema name*_*table name*> der Quelltabelle.</span><span class="sxs-lookup"><span data-stu-id="5d359-131">By default, the name is \<*schema name*_*table name*> of the source table.</span></span> <span data-ttu-id="5d359-132">Zur Benennung der zugeordneten Änderungstabelle wird dem Namen der Aufzeichnungsinstanz `_CT` angehängt.</span><span class="sxs-lookup"><span data-stu-id="5d359-132">Its associated change table is named by appending `_CT` to the capture instance name.</span></span> <span data-ttu-id="5d359-133">Zur Benennung der Funktion zur Abfrage aller Änderungen wird dem Namen der Aufzeichnungsinstanz `fn_cdc_get_all_changes_` vorangestellt.</span><span class="sxs-lookup"><span data-stu-id="5d359-133">The function that is used to query for all changes is named by prepending `fn_cdc_get_all_changes_` to the capture instance name.</span></span> <span data-ttu-id="5d359-134">Wenn die Aufzeichnungs Instanz zur Unterstützung von konfiguriert ist `net changes` , `net_changes` wird die Abfragefunktion auch erstellt und benannt, **indem \_ fn_cdc_get_net_changes** dem Aufzeichnungs Instanznamen vorangestellt wird.</span><span class="sxs-lookup"><span data-stu-id="5d359-134">If the capture instance is configured to support `net changes`, the `net_changes` query function is also created and named by prepending **fn_cdc_get_net_changes\_** to the capture instance name.</span></span>  
  
## <a name="change-table"></a><span data-ttu-id="5d359-135">Änderungstabelle</span><span class="sxs-lookup"><span data-stu-id="5d359-135">Change Table</span></span>  
 <span data-ttu-id="5d359-136">Die ersten fünf Spalten einer Change Data Capture-Änderungstabelle sind Metadatenspalten.</span><span class="sxs-lookup"><span data-stu-id="5d359-136">The first five columns of a change data capture change table are metadata columns.</span></span> <span data-ttu-id="5d359-137">Diese enthalten zusätzliche Informationen zu den aufgezeichneten Änderungen.</span><span class="sxs-lookup"><span data-stu-id="5d359-137">These provide additional information that is relevant to the recorded change.</span></span> <span data-ttu-id="5d359-138">Die Namen und in der Regel auch der Typ der restlichen Spalten entsprechen den identifizierten nachverfolgten Spalten aus der Quelltabelle.</span><span class="sxs-lookup"><span data-stu-id="5d359-138">The remaining columns mirror the identified captured columns from the source table in name and, typically, in type.</span></span> <span data-ttu-id="5d359-139">Diese Spalten enthalten die aus der Quelltabelle erfassten Spaltendaten.</span><span class="sxs-lookup"><span data-stu-id="5d359-139">These columns hold the captured column data that is gathered from the source table.</span></span>  
  
 <span data-ttu-id="5d359-140">Jeder auf die Quelltabelle angewendete Einfüge- oder Löschvorgang erscheint als einzelne Zeile in der Änderungstabelle.</span><span class="sxs-lookup"><span data-stu-id="5d359-140">Each insert or delete operation that is applied to a source table appears as a single row within the change table.</span></span> <span data-ttu-id="5d359-141">Die Datenspalten der Zeile, die sich aus einem Einfügevorgang ergibt, enthalten die Spaltenwerte nach dem Einfügevorgang.</span><span class="sxs-lookup"><span data-stu-id="5d359-141">The data columns of the row that results from an insert operation contain the column values after the insert.</span></span> <span data-ttu-id="5d359-142">Die Datenspalten der Zeile, die sich aus einem Löschvorgang ergibt, enthalten die Spaltenwerte vor dem Löschvorgang.</span><span class="sxs-lookup"><span data-stu-id="5d359-142">The data columns of the row that results from a delete operation contain the column values before the delete.</span></span> <span data-ttu-id="5d359-143">Ein Updatevorgang erfordert einen Zeileneintrag, der die Spaltenwerte vor dem Updatevorgang angibt, und einen Zeileneintrag, der die Spaltenwerte nach dem Updatevorgang angibt.</span><span class="sxs-lookup"><span data-stu-id="5d359-143">An update operation requires one row entry to identify the column values before the update, and a second row entry to identify the column values after the update.</span></span>  
  
 <span data-ttu-id="5d359-144">Darüber hinaus enthält jede Zeile in einer Änderungstabelle zusätzliche Metadaten, die eine Interpretation der Änderungsaktivitäten erlauben.</span><span class="sxs-lookup"><span data-stu-id="5d359-144">Each row in a change table also contains additional metadata to allow interpretation of the change activity.</span></span> <span data-ttu-id="5d359-145">Die Spalte __$start_lsn identifiziert die Commit-Protokollfolgenummer (Log Sequence Number, LSN), die der Änderung zugewiesen wurde.</span><span class="sxs-lookup"><span data-stu-id="5d359-145">The column __$start_lsn identifies the commit log sequence number (LSN) that was assigned to the change.</span></span> <span data-ttu-id="5d359-146">Die Commit-LSN identifiziert sowohl die Änderungen, die innerhalb der gleichen Transaktion ausgeführt wurden, als auch die Reihenfolge der Transaktionen.</span><span class="sxs-lookup"><span data-stu-id="5d359-146">The commit LSN both identifies changes that were committed within the same transaction, and orders those transactions.</span></span> <span data-ttu-id="5d359-147">Die Spalte \_\_$seqval kann verwendet werden, um die Reihenfolge weiterer Änderungen festzulegen, die innerhalb der gleichen Transaktion ausgeführt wurden.</span><span class="sxs-lookup"><span data-stu-id="5d359-147">The column \_\_$seqval can be used to order more changes that occur in the same transaction.</span></span> <span data-ttu-id="5d359-148">Die Spalte „\_\_$operation“ zeichnet den Vorgang auf, der der Änderung zugeordnet ist: 1 = löschen, 2 = einfügen, 3 = aktualisieren (vor dem Image) und 4 = aktualisieren (nach dem Image).</span><span class="sxs-lookup"><span data-stu-id="5d359-148">The column \_\_$operation records the operation that is associated with the change: 1 = delete, 2 = insert, 3 = update (before image), and 4 = update (after image).</span></span> <span data-ttu-id="5d359-149">Die Spalte \_\_$update_mask ist eine variable Bitmaske mit einem definierten Bit für jede aufgezeichnete Spalte.</span><span class="sxs-lookup"><span data-stu-id="5d359-149">The column \_\_$update_mask is a variable bit mask with one defined bit for each captured column.</span></span> <span data-ttu-id="5d359-150">Bei Einträgen für Einfüge- und Löschvorgänge werden alle Bits in der Updatemaske gesetzt.</span><span class="sxs-lookup"><span data-stu-id="5d359-150">For insert and delete entries, the update mask will always have all bits set.</span></span> <span data-ttu-id="5d359-151">Bei Einträgen für Updatevorgänge sind dagegen nur jene Bits gesetzt, die den geänderten Spalten entsprechen.</span><span class="sxs-lookup"><span data-stu-id="5d359-151">Update rows, however, will only have those bits set that correspond to changed columns.</span></span>  
  
## <a name="change-data-capture-validity-interval-for-a-database"></a><span data-ttu-id="5d359-152">Change Data Capture-Gültigkeitsintervall für eine Datenbank</span><span class="sxs-lookup"><span data-stu-id="5d359-152">Change Data Capture Validity Interval for a Database</span></span>  
 <span data-ttu-id="5d359-153">Beim Change Data Capture-Gültigkeitsintervall für eine Datenbank handelt es sich um dem Zeitraum, in dem Änderungsdaten für Aufzeichnungsinstanzen verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="5d359-153">The change data capture validity interval for a database is the time during which change data is available for capture instances.</span></span> <span data-ttu-id="5d359-154">Das Gültigkeitsintervall beginnt mit der Erstellung der ersten Aufzeichnungsinstanz für eine Datenbanktabelle und dauert bis zum aktuellen Zeitpunkt.</span><span class="sxs-lookup"><span data-stu-id="5d359-154">The validity interval begins when the first capture instance is created for a database table, and continues to the present time.</span></span>  
  
 <span data-ttu-id="5d359-155">Damit die Datenmenge in Änderungstabellen nicht auf eine unüberschaubare Größe anwächst, müssen die Daten regelmäßig und systematisch gekürzt werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-155">Data that is deposited in change tables will grow unmanageably if you do not periodically and systematically prune the data.</span></span> <span data-ttu-id="5d359-156">Der Change Data Capture-Cleanupprozess dient zur Erzwingung der beibehaltungsbasierten Cleanuprichtlinie.</span><span class="sxs-lookup"><span data-stu-id="5d359-156">The change data capture cleanup process is responsible for enforcing the retention-based cleanup policy.</span></span> <span data-ttu-id="5d359-157">Zunächst wird der untere Endpunkt des Gültigkeitsintervalls verschoben, um die Zeitbeschränkung festzulegen.</span><span class="sxs-lookup"><span data-stu-id="5d359-157">First, it moves the low endpoint of the validity interval to satisfy the time restriction.</span></span> <span data-ttu-id="5d359-158">Anschließend werden die abgelaufenen Einträge aus der Änderungstabelle entfernt.</span><span class="sxs-lookup"><span data-stu-id="5d359-158">Then, it removes expired change table entries.</span></span> <span data-ttu-id="5d359-159">Standardmäßig werden die Daten drei Tage beibehalten.</span><span class="sxs-lookup"><span data-stu-id="5d359-159">By default, three days of data is retained.</span></span>  
  
 <span data-ttu-id="5d359-160">Am oberen Endpunkt werden bei jedem Commit neuer Änderungsdaten durch den Aufzeichnungsprozess für jede Transaktion, die Änderungstabelleneinträge beinhaltet, neue Einträge zu `cdc.lsn_time_mapping` hinzugefügt.</span><span class="sxs-lookup"><span data-stu-id="5d359-160">At the high end, as the capture process commits each new batch of change data, new entries are added to `cdc.lsn_time_mapping` for each transaction that has change table entries.</span></span> <span data-ttu-id="5d359-161">In der Zuordnungstabelle werden sowohl die Commit-Protokollfolgenummern als auch die Commitzeitpunkte der Transaktion (Spalten start_lsn und tran_end_time) beibehalten.</span><span class="sxs-lookup"><span data-stu-id="5d359-161">Within the mapping table, both a commit Log Sequence Number (LSN) and a transaction commit time (columns start_lsn and tran_end_time, respectively) are retained.</span></span> <span data-ttu-id="5d359-162">Der maximale LSN-Wert in `cdc.lsn_time_mapping` entspricht der Obergrenzenmarkierung des Datenbank-Gültigkeitsfensters.</span><span class="sxs-lookup"><span data-stu-id="5d359-162">The maximum LSN value that is found in `cdc.lsn_time_mapping` represents the high water mark of the database validity window.</span></span> <span data-ttu-id="5d359-163">Die entsprechende Commitzeit wird als Basis für die Berechnung einer neuen Untergrenzenmarkierung durch die beibehaltungsbasierte Cleanuprichtlinie verwendet.</span><span class="sxs-lookup"><span data-stu-id="5d359-163">Its corresponding commit time is used as the base from which retention based cleanup computes a new low water mark.</span></span>  
  
 <span data-ttu-id="5d359-164">Da der Aufzeichnungsprozess Änderungsdaten aus dem Transaktionsprotokoll extrahiert, entsteht eine Latenzzeit zwischen dem Commitzeitpunkt einer Änderung in einer Quelltabelle und dem Zeitpunkt, an dem die Änderung in der zugeordneten Änderungstabelle angezeigt wird.</span><span class="sxs-lookup"><span data-stu-id="5d359-164">Because the capture process extracts change data from the transaction log, there is a built in latency between the time that a change is committed to a source table and the time that the change appears within its associated change table.</span></span> <span data-ttu-id="5d359-165">Diese Latenzzeit ist in der Regel sehr kurz, vergessen Sie jedoch nicht, dass die Änderungsdaten erst verfügbar sind, nachdem der Aufzeichnungsprozess die verbundenen Protokolleinträge verarbeitet hat.</span><span class="sxs-lookup"><span data-stu-id="5d359-165">While this latency is typically small, it is nevertheless important to remember that change data is not available until the capture process has processed the related log entries.</span></span>  
  
## <a name="change-data-capture-validity-interval-for-a-capture-instance"></a><span data-ttu-id="5d359-166">Change Data Capture-Gültigkeitsintervall für eine Aufzeichnungsinstanz</span><span class="sxs-lookup"><span data-stu-id="5d359-166">Change Data Capture Validity Interval for a Capture Instance</span></span>  
 <span data-ttu-id="5d359-167">In der Regel stimmt das Gültigkeitsintervall einzelner Aufzeichnungsinstanzen mit dem Gültigkeitsintervall für die Datenbank überein, dies ist jedoch nicht immer so.</span><span class="sxs-lookup"><span data-stu-id="5d359-167">Although it is common for the database validity interval and the validity interval of individual capture instance to coincide, this is not always true.</span></span> <span data-ttu-id="5d359-168">Das Gültigkeitsintervall der Aufzeichnungsinstanz beginnt zu dem Zeitpunkt, an dem der Aufzeichnungsprozess die Aufzeichnungsinstanz erkennt und die Protokollierung zugeordneter Änderungen in der Änderungstabelle startet.</span><span class="sxs-lookup"><span data-stu-id="5d359-168">The validity interval of the capture instance starts when the capture process recognizes the capture instance and starts to log associated changes to its change table.</span></span> <span data-ttu-id="5d359-169">Wenn also Aufzeichnungsinstanzen zu verschiedenen Zeiten erstellt werden, weisen diese unterschiedliche untere Endpunkte auf.</span><span class="sxs-lookup"><span data-stu-id="5d359-169">As a result, if capture instances are created at different times, each will initially have a different low endpoint.</span></span> <span data-ttu-id="5d359-170">Die Spalte „start_lsn“ des von [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql) zurückgegebenen Resultsets zeigt den aktuellen unteren Endpunkt für jede definierte Aufzeichnungsinstanz.</span><span class="sxs-lookup"><span data-stu-id="5d359-170">The start_lsn column of the result set that is returned by [sys.sp_cdc_help_change_data_capture](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-change-data-capture-transact-sql) shows the current low endpoint for each defined capture instance.</span></span> <span data-ttu-id="5d359-171">Bei der Bereinigung von Änderungstabelleneinträgen durch den Cleanupprozess werden die start_lsn-Werte für alle Aufzeichnungsinstanzen angepasst, sodass sie die neue Untergrenzenmarkierung für verfügbare Änderungsdaten widerspiegeln.</span><span class="sxs-lookup"><span data-stu-id="5d359-171">When the cleanup process cleans up change table entries, it adjusts the start_lsn values for all capture instances to reflect the new low water mark for available change data.</span></span> <span data-ttu-id="5d359-172">Dabei werden nur die Aufzeichnungsinstanzen angepasst, deren start_lsn-Werte kleiner sind als die neue Untergrenzenmarkierung.</span><span class="sxs-lookup"><span data-stu-id="5d359-172">Only those capture instances that have start_lsn values that are currently less than the new low water mark are adjusted.</span></span> <span data-ttu-id="5d359-173">Nach einer gewissen Zeit stimmen also die Gültigkeitsintervalle aller einzelnen Instanzen mit dem Gültigkeitsintervall der Datenbank überein, vorausgesetzt, es werden keine neuen Aufzeichnungsinstanzen erstellt.</span><span class="sxs-lookup"><span data-stu-id="5d359-173">Over time, if no new capture instances are created, the validity intervals for all individual instances will tend to coincide with the database validity interval.</span></span>  
  
 <span data-ttu-id="5d359-174">Für Consumer von Änderungsdaten ist das Gültigkeitsintervall wichtig, da das Extrahierungsintervall einer Anforderung vollständig von dem aktuellen Change Data Capture-Gültigkeitsintervall für die Aufzeichnungsinstanz abgedeckt werden muss.</span><span class="sxs-lookup"><span data-stu-id="5d359-174">The validity interval is important to consumers of change data because the extraction interval for a request must be fully covered by the current change data capture validity interval for the capture instance.</span></span> <span data-ttu-id="5d359-175">Wenn der untere Endpunkt des Extrahierungsintervalls links vom unteren Endpunkt des Gültigkeitsintervalls liegt, kann es bei einem umfassenden Cleanup zu fehlenden Änderungsdaten kommen.</span><span class="sxs-lookup"><span data-stu-id="5d359-175">If the low endpoint of the extraction interval is to the left of the low endpoint of the validity interval, there could be missing change data due to aggressive cleanup.</span></span> <span data-ttu-id="5d359-176">Wenn der obere Endpunkt des Extrahierungsintervalls rechts vom oberen Endpunkt des Gültigkeitsintervalls liegt, wird der Aufzeichnungsprozess vor dem Ende des Extrahierungsintervalls beendet, was ebenfalls zu fehlenden Daten führen kann.</span><span class="sxs-lookup"><span data-stu-id="5d359-176">If the high endpoint of the extraction interval is to the right of the high endpoint of the validity interval, the capture process has not yet processed through the time period that is represented by the extraction interval, and change data could also be missing.</span></span>  
  
 <span data-ttu-id="5d359-177">Mit der Funktion [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) können Sie den aktuellen kleinsten LSN-Wert und mit der Funktion [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) den aktuellen größten LSN-Wert für eine Aufzeichnungsinstanz abrufen.</span><span class="sxs-lookup"><span data-stu-id="5d359-177">The function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) is used to retrieve the current minimum LSN for a capture instance, while [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) is used to retrieve the current maximum LSN value.</span></span> <span data-ttu-id="5d359-178">Wenn bei der Abfrage von Änderungsdaten der angegebene LSN-Bereich nicht innerhalb der beiden LSN-Werte liegt, schlagen die Change Data Capture-Abfragefunktionen fehl.</span><span class="sxs-lookup"><span data-stu-id="5d359-178">When querying for change data, if the specified LSN range does not lie within these two LSN values, the change data capture query functions will fail.</span></span>  
  
## <a name="handling-changes-to-source-tables"></a><span data-ttu-id="5d359-179">Handhabung von Änderungen an Quelltabellen</span><span class="sxs-lookup"><span data-stu-id="5d359-179">Handling Changes to Source Tables</span></span>  
 <span data-ttu-id="5d359-180">Die Berücksichtigung von Spaltenänderungen in den nachverfolgten Quelltabellen ist für Downstreamconsumer schwierig.</span><span class="sxs-lookup"><span data-stu-id="5d359-180">To accommodate column changes in the source tables that are being tracked is a difficult issue for downstream consumers.</span></span> <span data-ttu-id="5d359-181">Durch die Aktivierung von Change Data Capture für eine Quelltabelle werden solche DDL-Änderungen zwar nicht verhindert, mit Change Data Capture können die Auswirkungen für den Consumer jedoch minimiert werden, indem erlaubt wird, dass die über die API zurückgegebenen Resultsets unverändert bleiben, auch wenn die Spaltenstruktur der zugrunde liegenden Quelltabelle geändert wird.</span><span class="sxs-lookup"><span data-stu-id="5d359-181">Although enabling change data capture on a source table does not prevent such DDL changes from occurring, change data capture helps to mitigate the effect on consumers by allowing the delivered result sets that are returned through the API to remain unchanged even as the column structure of the underlying source table changes.</span></span> <span data-ttu-id="5d359-182">Diese feste Spaltenstruktur gilt auch für die zugrunde liegende Änderungstabelle, auf die die definierten Abfragefunktionen zugreifen.</span><span class="sxs-lookup"><span data-stu-id="5d359-182">This fixed column structure is also reflected in the underlying change table that the defined query functions access.</span></span>  
  
 <span data-ttu-id="5d359-183">Um eine Änderungstabelle mit fester Spaltenstruktur zu berücksichtigen, ignoriert der Aufzeichnungsprozess, mit dem Werte in die Änderungstabelle eingefügt werden, alle neuen Spalten, die bei der Aktivierung der Quelltabelle für Change Data Capture nicht zur Aufzeichnung identifiziert wurden.</span><span class="sxs-lookup"><span data-stu-id="5d359-183">To accommodate a fixed column structure change table, the capture process responsible for populating the change table will ignore any new columns that are not identified for capture when the source table was enabled for change data capture.</span></span> <span data-ttu-id="5d359-184">Wenn eine nachverfolgte Spalte gelöscht wird, werden in den nachfolgenden Änderungseinträgen NULL-Werte für die Spalte angegeben.</span><span class="sxs-lookup"><span data-stu-id="5d359-184">If a tracked column is dropped, null values will be supplied for the column in the subsequent change entries.</span></span> <span data-ttu-id="5d359-185">Wenn sich jedoch der Datentyp einer vorhandenen Spalte ändert, wird diese Änderung in die Änderungstabelle übernommen, um sicherzustellen, dass durch den Aufzeichnungsmechanismus keine Datenverluste für nachverfolgte Spalten entstehen.</span><span class="sxs-lookup"><span data-stu-id="5d359-185">However, if an existing column undergoes a change in its data type, the change is propagated to the change table to ensure that the capture mechanism does not introduce data loss to tracked columns.</span></span> <span data-ttu-id="5d359-186">Außerdem sendet der Aufzeichnungsprozess alle erkannten Änderungen an der Spaltenstruktur nachverfolgter Tabellen an die Tabelle cdc.ddl_history.</span><span class="sxs-lookup"><span data-stu-id="5d359-186">The capture process also posts any detected changes to the column structure of tracked tables to the cdc.ddl_history table.</span></span> <span data-ttu-id="5d359-187">Consumer, die über notwendige Anpassungen von Downstreamanwendungen informiert werden möchten, verwenden die gespeicherte Prozedur [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="5d359-187">Consumers wishing to be alerted of adjustments that might have to be made in downstream applications, use the stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span></span>  
  
 <span data-ttu-id="5d359-188">In der Regel wird die Form der aktuellen Aufzeichnungsinstanz beibehalten, wenn DDL-Änderungen an der verbundenen Quelltabelle vorgenommen werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-188">Typically, the current capture instance will continue to retain its shape when DDL changes are applied to its associated source table.</span></span> <span data-ttu-id="5d359-189">Es besteht jedoch die Möglichkeit, eine zweite Aufzeichnungsinstanz für die Tabelle zu erstellen, die die neue Spaltenstruktur widerspiegelt.</span><span class="sxs-lookup"><span data-stu-id="5d359-189">However, it is possible to create a second capture instance for the table that reflects the new column structure.</span></span> <span data-ttu-id="5d359-190">Hierdurch wird die Aufzeichnung von Änderungen an derselben Quelltabelle in zwei unterschiedliche Änderungstabellen mit zwei verschiedenen Spaltenstrukturen ermöglicht.</span><span class="sxs-lookup"><span data-stu-id="5d359-190">This allows the capture process to make changes to the same source table into two distinct change tables having two different column structures.</span></span> <span data-ttu-id="5d359-191">Eine dieser Änderungstabellen kann für aktuelle Betriebsprogramme und die andere für eine Entwicklungsumgebung verwendet werden, in der versucht wird, die neuen Spaltendaten aufzunehmen.</span><span class="sxs-lookup"><span data-stu-id="5d359-191">Thus, while one change table can continue to feed current operational programs, the second one can drive a development environment that is trying to incorporate the new column data.</span></span> <span data-ttu-id="5d359-192">Da der Aufzeichnungsmechanismus gleichzeitig Werte in beide Änderungstabellen einfügen kann, ist ein Übergang zwischen den Tabellen ohne Datenverlust möglich.</span><span class="sxs-lookup"><span data-stu-id="5d359-192">Allowing the capture mechanism to populate both change tables in tandem means that a transition from one to the other can be accomplished without loss of change data.</span></span> <span data-ttu-id="5d359-193">Dies kann immer der Fall sein, wenn die beiden Change Data Capture-Zeitachsen überlappen.</span><span class="sxs-lookup"><span data-stu-id="5d359-193">This can happen any time the two change data capture timelines overlap.</span></span> <span data-ttu-id="5d359-194">Wenn der Übergang erfolgt, kann die überflüssige Aufzeichnungsinstanz entfernt werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-194">When the transition is effected, the obsolete capture instance can be removed.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5d359-195">Einer Quelltabelle können maximal zwei Aufzeichnungsinstanzen gleichzeitig zugeordnet werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-195">The maximum number of capture instances that can be concurrently associated with a single source table is two.</span></span>  
  
## <a name="relationship-between-the-capture-job-and-the-transactional-replication-logreader"></a><span data-ttu-id="5d359-196">Beziehung zwischen dem Aufzeichnungsauftrag und dem Protokollleser der Transaktionsreplikation</span><span class="sxs-lookup"><span data-stu-id="5d359-196">Relationship Between the Capture Job and the Transactional Replication Logreader</span></span>  
 <span data-ttu-id="5d359-197">Die Logik für den Change Data Capture-Prozess ist in die gespeicherte Prozedur [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql)eingebettet. Hierbei handelt es sich um eine als Teil von „sqlservr.exe“ erstellte interne Serverfunktion, die auch bei der Transaktionsreplikation verwendet wird, um Änderungen aus dem Transaktionsprotokoll zu sammeln.</span><span class="sxs-lookup"><span data-stu-id="5d359-197">The logic for change data capture process is embedded in the stored procedure [sp_replcmds](/sql/relational-databases/system-stored-procedures/sp-replcmds-transact-sql), an internal server function built as part of sqlservr.exe and also used by transactional replication to harvest changes from the transaction log.</span></span> <span data-ttu-id="5d359-198">Wenn für eine Datenbank nur Change Data Capture aktiviert wurde, erstellen Sie den Change Data Capture-Aufzeichnungsauftrag des SQL Server-Agents als Mittel zum Aufrufen von sp_replcmds.</span><span class="sxs-lookup"><span data-stu-id="5d359-198">When change data capture alone is enabled for a database, you create the change data capture SQL Server Agent capture job as the vehicle for invoking sp_replcmds.</span></span> <span data-ttu-id="5d359-199">Wenn die Replikation ebenfalls aktiviert ist, wird für die Änderungsdatenanforderungen beider Consumer nur der Transaktions-Protokollleser verwendet.</span><span class="sxs-lookup"><span data-stu-id="5d359-199">When replication is also present, the transactional logreader alone is used to satisfy the change data needs for both of these consumers.</span></span> <span data-ttu-id="5d359-200">Mit dieser Strategie werden Protokollkonflikte erheblich reduziert, wenn sowohl die Replikation als auch Change Data Capture für eine Datenbank aktiviert sind.</span><span class="sxs-lookup"><span data-stu-id="5d359-200">This strategy significantly reduces log contention when both replication and change data capture are enabled for the same database.</span></span>  
  
 <span data-ttu-id="5d359-201">Der Wechsel zwischen diesen beiden Betriebsmodi zur Aufzeichnung von Änderungsdaten erfolgt automatisch, wenn sich der Replikationsstatus einer Datenbank ändert, für die Change Data Capture aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="5d359-201">The switch between these two operational modes for capturing change data occurs automatically whenever there is a change in the replication status of a change data capture enabled database.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="5d359-202">Für beide Instanzen der Aufzeichnungslogik muss der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent ausgeführt werden, damit der Prozess ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="5d359-202">Both instances of the capture logic require [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent to be running for the process to execute.</span></span>  
  
 <span data-ttu-id="5d359-203">Die Hauptaufgabe des Capture-Prozesses besteht darin, das Protokoll zu durchsuchen und Spaltendaten und transaktionsrelevante Informationen in die Change Data Capture-Änderungstabellen zu schreiben.</span><span class="sxs-lookup"><span data-stu-id="5d359-203">The principal task of the capture process is to scan the log and write column data and transaction related information to the change data capture change tables.</span></span> <span data-ttu-id="5d359-204">Um eine transaktionskonsistente Begrenzung über alle von Change Data Capture aufgefüllten Änderungstabellen hinweg sicherzustellen, öffnet der Aufzeichnungsprozess bei jedem Scanzyklus eine eigene Transaktion und führt dafür einen Commit aus.</span><span class="sxs-lookup"><span data-stu-id="5d359-204">To ensure a transactionally consistent boundary across all the change data capture change tables that it populates, the capture process opens and commits its own transaction on each scan cycle.</span></span> <span data-ttu-id="5d359-205">Der Prozess erkennt neu für Change Data Capture aktivierte Tabellen und nimmt diese automatisch in die Gruppe von Tabellen auf, die aktiv auf Änderungseinträge im Protokoll überwacht werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-205">It detects when tables are newly enabled for change data capture, and automatically includes them in the set of tables that are actively monitored for change entries in the log.</span></span> <span data-ttu-id="5d359-206">Auch die Deaktivierung von Change Data Capture wird erkannt. In diesem Fall wird die Quelltabelle aus der Gruppe von Tabellen, die aktiv auf Änderungseinträge überwacht werden, entfernt.</span><span class="sxs-lookup"><span data-stu-id="5d359-206">Similarly, disabling change data capture will also be detected, causing the source table to be removed from the set of tables actively monitored for change data.</span></span> <span data-ttu-id="5d359-207">Wenn die Verarbeitung für einen Protokollabschnitt beendet ist, sendet der Aufzeichnungsprozess ein Signal an die Serverprotokoll-Kürzungslogik, die anhand dieser Informationen für die Kürzung geeignete Protokolleinträge auswählt.</span><span class="sxs-lookup"><span data-stu-id="5d359-207">When processing for a section of the log is finished, the capture process signals the server log truncation logic, which uses this information to identify log entries eligible for truncation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5d359-208">Wenn eine Datenbank für Change Data Capture aktiviert ist, wird, auch wenn als Wiederherstellungsmodus die einfache Wiederherstellung festgelegt ist, der Protokollkürzungspunkt nicht weiter verschoben, bevor alle für die Aufzeichnung markierten Änderungen vom Aufzeichnungsprozess erfasst wurden.</span><span class="sxs-lookup"><span data-stu-id="5d359-208">When a database is enabled for change data capture, even if the recovery mode is set to simple recovery the log truncation point will not advance until all the changes that are marked for capture have been gathered by the capture process.</span></span> <span data-ttu-id="5d359-209">Falls der Aufzeichnungsprozess nicht ausgeführt wird und Änderungen erfasst werden müssen, wird das Protokoll beim Ausführen von CHECKPOINT nicht gekürzt.</span><span class="sxs-lookup"><span data-stu-id="5d359-209">If the capture process is not running and there are changes to be gathered, executing CHECKPOINT will not truncate the log.</span></span>  
  
 <span data-ttu-id="5d359-210">Der Aufzeichnungsprozess wird auch zur Speicherung des Verlaufs der an nachverfolgten Tabellen vorgenommenen DDL-Änderungen verwendet.</span><span class="sxs-lookup"><span data-stu-id="5d359-210">The capture process is also used to maintain history on the DDL changes to tracked tables.</span></span> <span data-ttu-id="5d359-211">Die mit Change Data Capture verknüpften DDL-Anweisungen nehmen Einträge im Transaktionsprotokoll der Datenbank vor, wenn eine für Change Data Capture aktivierte Datenbank oder Tabelle gelöscht wird und wenn Spalten einer für Change Data Capture aktivierten Tabelle hinzugefügt, geändert oder gelöscht werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-211">The DDL statements that are associated with change data capture make entries to the database transaction log whenever a change data capture-enabled database or table is dropped or columns of a change data capture-enabled table are added, modified, or dropped.</span></span> <span data-ttu-id="5d359-212">Diese Protokolleinträge werden vom Aufzeichnungsprozess verarbeitet, der die zugehörigen DDL-Ereignisse an die Tabelle cdc.ddl_history sendet.</span><span class="sxs-lookup"><span data-stu-id="5d359-212">These log entries are processed by the capture process, which then posts the associated DDL events to the cdc.ddl_history table.</span></span> <span data-ttu-id="5d359-213">Sie können Informationen über DDL-Ereignisse mit Auswirkungen auf nachverfolgte Tabellen mit der gespeicherten Prozedur [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql)abrufen.</span><span class="sxs-lookup"><span data-stu-id="5d359-213">You can obtain information about DDL events that affect tracked tables by using the stored procedure [sys.sp_cdc_get_ddl_history](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-get-ddl-history-transact-sql).</span></span>  
  
## <a name="change-data-capture-agent-jobs"></a><span data-ttu-id="5d359-214">Change Data Capture-Agentaufträge</span><span class="sxs-lookup"><span data-stu-id="5d359-214">Change Data Capture Agent Jobs</span></span>  
 <span data-ttu-id="5d359-215">Einer Datenbank, für die Change Data Capture aktiviert ist, werden in der Regel zwei [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agentaufträge zugeordnet: ein Aufzeichnungsauftrag zur Auffüllung der Datenbank-Änderungstabellen und ein Cleanupauftrag für die Bereinigung der Änderungstabellen.</span><span class="sxs-lookup"><span data-stu-id="5d359-215">Two [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs are typically associated with a change data capture enabled database: one that is used to populate the database change tables, and one that is responsible for change table cleanup.</span></span> <span data-ttu-id="5d359-216">Beide Aufträge bestehen aus einem Einzelschritt, der einen [!INCLUDE[tsql](../../includes/tsql-md.md)] -Befehl ausführt.</span><span class="sxs-lookup"><span data-stu-id="5d359-216">Both jobs consist of a single step that runs a [!INCLUDE[tsql](../../includes/tsql-md.md)] command.</span></span> <span data-ttu-id="5d359-217">Bei dem aufgerufenen [!INCLUDE[tsql](../../includes/tsql-md.md)] -Befehl handelt es sich um eine in Change Data Capture definierte gespeicherte Prozedur zur Implementierung der Auftragslogik.</span><span class="sxs-lookup"><span data-stu-id="5d359-217">The [!INCLUDE[tsql](../../includes/tsql-md.md)] command that is invoked is a change data capture defined stored procedure that implements the logic of the job.</span></span> <span data-ttu-id="5d359-218">Die Aufträge werden erstellt, wenn die erste Tabelle der Datenbank für Change Data Capture aktiviert wird.</span><span class="sxs-lookup"><span data-stu-id="5d359-218">The jobs are created when the first table of the database is enabled for change data capture.</span></span> <span data-ttu-id="5d359-219">Der Cleanupauftrag wird immer erstellt.</span><span class="sxs-lookup"><span data-stu-id="5d359-219">The Cleanup Job is always created.</span></span> <span data-ttu-id="5d359-220">Der Aufzeichnungsauftrag wird nur erstellt, wenn für die Datenbank keine Transaktionsveröffentlichungen definiert wurden.</span><span class="sxs-lookup"><span data-stu-id="5d359-220">The capture job will only be created if there are no defined transactional publications for the database.</span></span> <span data-ttu-id="5d359-221">Der Aufzeichnungsauftrag wird auch dann erstellt, wenn sowohl Change Data Capture als auch die Transaktionsreplikation für eine Datenbank aktiviert sind und der Transaktions-Protokollleserauftrag entfernt wird, da die Datenbank über keine definierten Veröffentlichungen mehr verfügt.</span><span class="sxs-lookup"><span data-stu-id="5d359-221">The capture job is also created when both change data capture and transactional replication are enabled for a database, and the transactional logreader job is removed because the database no longer has defined publications.</span></span>  
  
 <span data-ttu-id="5d359-222">Sowohl Aufzeichnungs- als auch Cleanupaufträge werden mit Standardparametern erstellt.</span><span class="sxs-lookup"><span data-stu-id="5d359-222">Both the capture and cleanup jobs are created by using default parameters.</span></span> <span data-ttu-id="5d359-223">Der Aufzeichnungsauftrag wird sofort gestartet.</span><span class="sxs-lookup"><span data-stu-id="5d359-223">The capture job is started immediately.</span></span> <span data-ttu-id="5d359-224">Er wird kontinuierlich ausgeführt und verarbeitet maximal 1000 Transaktionen pro Scanzyklus mit einer Wartezeit von 5 Sekunden.</span><span class="sxs-lookup"><span data-stu-id="5d359-224">It runs continuously, processing a maximum of 1000 transactions per scan cycle with a wait of 5 seconds between cycles.</span></span> <span data-ttu-id="5d359-225">Der Cleanupauftrag wird täglich um 2 Uhr morgens ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="5d359-225">The cleanup job runs daily at 2 A.M.</span></span> <span data-ttu-id="5d359-226">Änderungstabelleneinträge werden 4320 Minuten bzw. 3 Tage beibehalten, und mit einer Löschanweisung werden maximal 5000 Einträge entfernt.</span><span class="sxs-lookup"><span data-stu-id="5d359-226">It retains change table entries for 4320 minutes or 3 days, removing a maximum of 5000 entries with a single delete statement.</span></span>  
  
 <span data-ttu-id="5d359-227">Die Change Data Capture-Agentaufträge werden entfernt, wenn Change Data Capture für eine Datenbank deaktiviert wird.</span><span class="sxs-lookup"><span data-stu-id="5d359-227">The change data capture agent jobs are removed when change data capture is disabled for a database.</span></span> <span data-ttu-id="5d359-228">Der Aufzeichnungsauftrag kann auch entfernt werden, wenn einer Datenbank die erste Veröffentlichung hinzugefügt wird und sowohl Change Data Capture als auch die Transaktionsreplikation aktiviert sind.</span><span class="sxs-lookup"><span data-stu-id="5d359-228">The capture job can also be removed when the first publication is added to a database, and both change data capture and transactional replication are enabled.</span></span>  
  
 <span data-ttu-id="5d359-229">Intern werden Change Data Capture-Agentaufträge mit den gespeicherten Prozeduren [sys.sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) und [sys.sp_cdc_drop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-drop-job-transact-sql)erstellt bzw. gelöscht.</span><span class="sxs-lookup"><span data-stu-id="5d359-229">Internally, change data capture agent jobs are created and dropped by using the stored procedures [sys.sp_cdc_add_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-add-job-transact-sql) and [sys.sp_cdc_drop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-drop-job-transact-sql), respectively.</span></span> <span data-ttu-id="5d359-230">Diese gespeicherten Prozeduren werden ebenfalls verfügbar gemacht, sodass Administratoren die Erstellung und Entfernung dieser Aufträge kontrollieren können.</span><span class="sxs-lookup"><span data-stu-id="5d359-230">These stored procedures are also exposed so that administrators can control the creation and removal of these jobs.</span></span>  
  
 <span data-ttu-id="5d359-231">Die Standardkonfiguration der Change Data Capture-Agentaufträge wird nicht explizit von Administratoren gesteuert.</span><span class="sxs-lookup"><span data-stu-id="5d359-231">An administrator has no explicit control over the default configuration of the change data capture agent jobs.</span></span> <span data-ttu-id="5d359-232">Mit der gespeicherten Prozedur [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) können die Standardkonfigurationsparameter geändert werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-232">The stored procedure [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) is provided to allow the default configuration parameters to be modified.</span></span> <span data-ttu-id="5d359-233">Darüber hinaus ermöglicht die gespeicherte Prozedur [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) das Anzeigen der aktuellen Konfigurationsparameter.</span><span class="sxs-lookup"><span data-stu-id="5d359-233">In addition, the stored procedure [sys.sp_cdc_help_jobs](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-help-jobs-transact-sql) allows current configuration parameters to be viewed.</span></span> <span data-ttu-id="5d359-234">Sowohl der Aufzeichnungsauftrag als auch der Cleanupauftrag extrahieren Konfigurationsparameter aus der Tabelle msdb.dbo.cdc_jobs, wenn sie gestartet werden.</span><span class="sxs-lookup"><span data-stu-id="5d359-234">Both the capture job and the cleanup job extract configuration parameters from the table msdb.dbo.cdc_jobs on startup.</span></span> <span data-ttu-id="5d359-235">Änderungen, die mit [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) an diesen Werten vorgenommen werden, treten ersten in Kraft, wenn der Auftrag beendet und neu gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="5d359-235">Any changes made to these values by using [sys.sp_cdc_change_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-change-job-transact-sql) will not take effect until the job is stopped and restarted.</span></span>  
  
 <span data-ttu-id="5d359-236">Zwei zusätzliche gespeicherte Prozeduren ermöglichen das Starten und Beenden der Change Data Capture-Agentaufträge: [sys.sp_cdc_start_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-start-job-transact-sql) und [sys.sp_cdc_stop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-stop-job-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="5d359-236">Two additional stored procedures are provided to allow the change data capture agent jobs to be started and stopped: [sys.sp_cdc_start_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-start-job-transact-sql) and [sys.sp_cdc_stop_job](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-stop-job-transact-sql).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="5d359-237">Beim Starten und Beenden des Aufzeichnungsauftrags gehen keine Änderungsdaten verloren.</span><span class="sxs-lookup"><span data-stu-id="5d359-237">Starting and stopping the capture job does not result in a loss of change data.</span></span> <span data-ttu-id="5d359-238">Es wird lediglich verhindert, dass der Aufzeichnungsprozess das Protokoll aktiv nach Änderungseinträgen durchsucht, die in die Änderungstabellen eingefügt werden können.</span><span class="sxs-lookup"><span data-stu-id="5d359-238">It only prevents the capture process from actively scanning the log for change entries to deposit in the change tables.</span></span> <span data-ttu-id="5d359-239">Um die zusätzliche Last durch die Protokollscanvorgänge während der Spitzenlastzeiten zu vermeiden, können Sie den Aufzeichnungsauftrag beenden und dann wieder starten, wenn der Ressourcenbedarf sinkt.</span><span class="sxs-lookup"><span data-stu-id="5d359-239">A reasonable strategy to prevent log scanning from adding load during periods of peak demand is to stop the capture job and restart it when demand is reduced.</span></span>  
  
 <span data-ttu-id="5d359-240">Beide [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agentaufträge wurden mit genügend Flexibilität und Konfigurationsmöglichkeiten konzipiert, um die grundlegenden Anforderungen von Change Data Capture-Umgebungen zu erfüllen.</span><span class="sxs-lookup"><span data-stu-id="5d359-240">Both [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent jobs were designed to be flexible enough and sufficiently configurable to meet the basic needs of change data capture environments.</span></span> <span data-ttu-id="5d359-241">In beiden Fällen wurden jedoch die zugrunde liegenden gespeicherten Prozeduren, die die Kernfunktionalität bereitstellen, verfügbar gemacht, um eine weitere Anpassung zu ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="5d359-241">In both cases, however, the underlying stored procedures that provide the core functionality have been exposed so that further customization is possible.</span></span>  
  
 <span data-ttu-id="5d359-242">Change Data Capture kann nicht ordnungsgemäß ausgeführt werden, wenn der Datenbank-Engine-Dienst oder der SQL Server-Agent-Dienst unter dem NETWORK SERVICE-Konto ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="5d359-242">Change data capture cannot function properly when the Database Engine service or the SQL Server Agent service is running under the NETWORK SERVICE account.</span></span> <span data-ttu-id="5d359-243">Dies kann zu Fehler 22832 führen.</span><span class="sxs-lookup"><span data-stu-id="5d359-243">This can result in error 22832.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5d359-244">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="5d359-244">See Also</span></span>  
 <span data-ttu-id="5d359-245">[Nachverfolgen von Datenänderungen &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="5d359-245">[Track Data Changes &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span></span>  
 <span data-ttu-id="5d359-246">[Aktivieren und Deaktivieren von Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="5d359-246">[Enable and Disable Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="5d359-247">[Arbeiten mit Änderungsdaten &#40;SQL Server&#41;](../track-changes/work-with-change-data-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="5d359-247">[Work with Change Data &#40;SQL Server&#41;](../track-changes/work-with-change-data-sql-server.md) </span></span>  
 [<span data-ttu-id="5d359-248">Verwalten und Überwachen von Change Data Capture &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="5d359-248">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
  
