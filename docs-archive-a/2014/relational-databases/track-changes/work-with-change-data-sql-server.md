---
title: Arbeiten mit Änderungsdaten (SQL Server) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ''
ms.topic: conceptual
helpviewer_keywords:
- change data [SQL Server]
- change data capture [SQL Server], query function scenarios
- change data capture [SQL Server], LSN boundaries
- change data capture [SQL Server], query functions
ms.assetid: 5346b852-1af8-4080-b278-12efb9b735eb
author: rothja
ms.author: jroth
ms.openlocfilehash: 018d5add95e5d0936f6055e1c6710b6a8ddabdab
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87619678"
---
# <a name="work-with-change-data-sql-server"></a><span data-ttu-id="a2ac5-102">Arbeiten mit Änderungsdaten (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="a2ac5-102">Work with Change Data (SQL Server)</span></span>
  <span data-ttu-id="a2ac5-103">Änderungsdaten werden über Tabellenwertfunktionen (Table Valued Function, TVF) für Change Data Capture-Consumer verfügbar gemacht.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-103">Change data is made available to change data capture consumers through table-valued functions (TVFs).</span></span> <span data-ttu-id="a2ac5-104">Für alle Abfragen dieser Funktionen sind zwei Parameter erforderlich, um den Bereich der Protokollfolgenummern (Log Sequence Number, LSN) zu definieren, die bei der Entwicklung des zurückgegebenen Resultsets ausgewählt werden können.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-104">All queries of these functions require two parameters to define the range of Log Sequence Numbers (LSNs) that are eligible for consideration when developing the returned result set.</span></span> <span data-ttu-id="a2ac5-105">Sowohl der untere als auch der obere LSN-Wert, die das Intervall begrenzen, werden in das Intervall eingeschlossen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-105">Both the upper and lower LSN values that bound the interval are considered to be included within the interval.</span></span>  
  
 <span data-ttu-id="a2ac5-106">Zur Unterstützung bei der Ermittlung der geeigneten LSN-Werte für die Abfrage einer TVF stehen mehrere Funktionen zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-106">Several functions are provided to help determine appropriate LSN values for use in querying a TVF.</span></span> <span data-ttu-id="a2ac5-107">Die Funktion [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) gibt die kleinste LSN des Gültigkeitsintervalls einer Aufzeichnungsinstanz zurück.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-107">The function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) returns the smallest LSN that is associated with a capture instance validity interval.</span></span> <span data-ttu-id="a2ac5-108">Beim Gültigkeitsintervall handelt es sich um das Zeitintervall, in dem Änderungsdaten aktuell für Aufzeichnungsinstanzen verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-108">The validity interval is the time interval for which change data is currently available for its capture instances.</span></span> <span data-ttu-id="a2ac5-109">Die Funktion [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) gibt die größte LSN im Gültigkeitsintervall zurück.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-109">The function [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) returns the largest LSN in the validity interval.</span></span> <span data-ttu-id="a2ac5-110">Mit den Funktionen [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) und [sys.fn_cdc_map_lsn_to_time](/sql/relational-databases/system-functions/sys-fn-cdc-map-lsn-to-time-transact-sql) können LSN-Werte auf einer konventionellen Zeitachse dargestellt werden.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-110">The functions [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) and [sys.fn_cdc_map_lsn_to_time](/sql/relational-databases/system-functions/sys-fn-cdc-map-lsn-to-time-transact-sql) are available to help place LSN values on a conventional timeline.</span></span> <span data-ttu-id="a2ac5-111">Da Change Data Capture geschlossene Abfrageintervalle verwendet, ist es in einigen Fällen erforderlich, den nächsten LSN-Wert in einer Folge zu generieren, um sicherzustellen, dass Änderungen in aufeinander folgenden Abfragefenstern nicht doppelt vorkommen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-111">Because change data capture uses closed query intervals, it is sometimes necessary to generate the next LSN value in a sequence to ensure that changes are not duplicated in consecutive query windows.</span></span> <span data-ttu-id="a2ac5-112">Die Funktionen [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) und [sys.fn_cdc_decrement_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-decrement-lsn-transact-sql) sind nützlich, wenn ein LSN-Wert inkrementell angepasst werden soll.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-112">The functions [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) and [sys.fn_cdc_decrement_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-decrement-lsn-transact-sql) are useful when an incremental adjustment to an LSN value is required.</span></span>  
  
##  <a name="validating-lsn-boundaries"></a><a name="LSN"></a> <span data-ttu-id="a2ac5-113">Überprüfen von LSN-Grenzwerten</span><span class="sxs-lookup"><span data-stu-id="a2ac5-113">Validating LSN Boundaries</span></span>  
 <span data-ttu-id="a2ac5-114">Es wird empfohlen, die LSN-Grenzwerte zu überprüfen, bevor sie in einer TVF-Abfrage verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-114">We recommend validating the LSN boundaries that are to be used in a TVF query before their use.</span></span> <span data-ttu-id="a2ac5-115">Bei NULL-Endpunkten oder Endpunkten, die außerhalb des Gültigkeitsintervalls einer Aufzeichnungsinstanz liegen, gibt eine Change Data Capture-TVF einen Fehler zurück.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-115">Null endpoints or endpoints that lie outside the validity interval for a capture instance will force an error to be returned by a change data capture TVF.</span></span>  
  
 <span data-ttu-id="a2ac5-116">Beispielsweise wird der folgende Fehler für alle Änderungen einer Abfrage zurückgegeben, wenn ein das Abfrageintervall definierender Parameter ungültig ist, außerhalb des gültigen Bereichs liegt oder die Zeilenfilteroption ungültig ist.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-116">For example, the following error is returned for a query for all changes when a parameter that is used to define the query interval is not valid, or is out of range, or the row filter option is invalid.</span></span>  
  
 `Msg 313, Level 16, State 3, Line 1`  
  
 `An insufficient number of arguments were supplied for the procedure or function cdc.fn_cdc_get_all_changes_ ...`  
  
 <span data-ttu-id="a2ac5-117">Für eine `net changes`-Abfrage wird der folgende entsprechende Fehler zurückgegeben:</span><span class="sxs-lookup"><span data-stu-id="a2ac5-117">The corresponding error returned for a `net changes` query is the following:</span></span>  
  
 `Msg 313, Level 16, State 3, Line 1`  
  
 `An insufficient number of arguments were supplied for the procedure or function cdc.fn_cdc_get_net_changes_ ...`  
  
> [!NOTE]  
>  <span data-ttu-id="a2ac5-118">Es ist uns bekannt, dass die Meldung 313 irreführend ist und die eigentliche Ursache des Fehlers nicht wiedergibt.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-118">It is recognized that the message for Msg 313 is misleading and does not convey the actual cause of the failure.</span></span> <span data-ttu-id="a2ac5-119">Der Grund für diese umständliche Verwendung ist, dass aus einer TVF kein expliziter Fehler ausgelöst werden kann.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-119">This awkward usage stems from the inability to raise an explicit error from within a TVF.</span></span> <span data-ttu-id="a2ac5-120">Es wurde jedoch als sinnvoller erachtet, den Wert einer erkennbaren, wenn auch nicht aussagekräftigen Fehlermeldung zurückzugeben als ein leeres Ergebnis.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-120">Nevertheless, the value of returning a recognizable, if inaccurate, error was deemed preferable to simply returning an empty result.</span></span> <span data-ttu-id="a2ac5-121">Ein leeres Resultset wäre von einer gültigen Abfrage nicht unterscheidbar, die keine Änderungen zurückgibt.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-121">An empty result set would not be distinguishable from a valid query returning no changes.</span></span>  
  
 <span data-ttu-id="a2ac5-122">Bei der Abfrage aller Änderungen werden bei Autorisierungsfehlern Fehlermeldungen zurückgegeben, wie z. B. folgende:</span><span class="sxs-lookup"><span data-stu-id="a2ac5-122">Authorization failures will return failures when querying for all changes, as shown:</span></span>  
  
 `Msg 229, Level 14, State 5, Line 1`  
  
 `The SELECT permission was denied on the object 'fn_cdc_get_all_changes_...', database 'MyDB', schema 'cdc'.`  
  
 <span data-ttu-id="a2ac5-123">Dasselbe gilt für Abfragen von Nettoänderungen:</span><span class="sxs-lookup"><span data-stu-id="a2ac5-123">The same is true when querying for net changes:</span></span>  
  
 `Msg 229, Level 14, State 5, Line 1`  
  
 `The SELECT permission was denied on the object fn_cdc_get_net_changes_...', database 'MyDB', schema 'cdc'.`  
  
 <span data-ttu-id="a2ac5-124">Die Vorlage "Enumerate Net Changes Using TRY CATCH" zeigt, wie Sie diese bekannten TVF-Fehler abfangen und aussagekräftigere Fehlerinformationen zurückgeben können.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-124">See the template Enumerate Net Changes Using TRY CATCH for a demonstration of how to intercept these known TVF errors and return more meaningful information about the failure.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a2ac5-125">Um Change Data Capture-Vorlagen in SQL Server Management Studio aufzurufen, öffnen Sie das Menü **Ansicht** , klicken Sie auf **Vorlagen-Explorer**, erweitern Sie **SQL Server-Vorlagen** , und erweitern Sie anschließend den Ordner **Change Data Capture** .</span><span class="sxs-lookup"><span data-stu-id="a2ac5-125">To locate change data capture templates in SQL Server Management Studio, on the **View** menu, click **Template Explorer**, expand **SQL Server Templates** and then expand the **Change Data Capture** folder.</span></span>  
  
##  <a name="query-functions"></a><a name="Functions"></a> <span data-ttu-id="a2ac5-126">Abfragefunktionen</span><span class="sxs-lookup"><span data-stu-id="a2ac5-126">Query Functions</span></span>  
 <span data-ttu-id="a2ac5-127">Abhängig von den Eigenschaften der nachverfolgten Quelltabelle und der Konfiguration der Aufzeichnungsinstanz werden entweder eine oder zwei TVFs für die Abfrage von Änderungsdaten generiert.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-127">Depending on the characteristics of the source table being tracked and the way in which its capture instance is configured, either one or two TVFs for querying change data are generated.</span></span>  
  
-   <span data-ttu-id="a2ac5-128">Die Funktion [cdc.fn_cdc_get_all_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql) gibt alle Änderungen zurück, die für das angegebene Intervall aufgetreten sind.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-128">The function [cdc.fn_cdc_get_all_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-all-changes-capture-instance-transact-sql) returns all changes that occurred for the specified interval.</span></span> <span data-ttu-id="a2ac5-129">Diese Funktion wird immer generiert.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-129">This function is always generated.</span></span> <span data-ttu-id="a2ac5-130">Die zurückgegebenen Einträge werden immer sortiert, zunächst nach der LSN des Transaktionscommits der Änderung und dann nach einem Wert, mit dem innerhalb der Transaktion eine Reihenfolge für die Änderung festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-130">Entries are always returned sorted, first by the transaction commit LSN of the change, and then by a value that sequences the change within its transaction.</span></span> <span data-ttu-id="a2ac5-131">Abhängig von der gewählten Zeilenfilteroption werden bei Updates die Endzeile (Zeilenfilteroption "all") oder der neue und der alte Wert (Zeilenfilteroption "all update old") zurückgegeben.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-131">Depending on the row filter option chosen, either the final row is returned on update (row filter option "all") or both the new and old values are returned on update (row filter option "all update old"').</span></span>  
  
-   <span data-ttu-id="a2ac5-132">Die Funktion [cdc.fn_cdc_get_net_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql) wird generiert, wenn der Parameter @supports_net_changes bei aktivierter Quelltabelle auf den Wert 1 festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-132">The function [cdc.fn_cdc_get_net_changes_<capture_instance>](/sql/relational-databases/system-functions/cdc-fn-cdc-get-net-changes-capture-instance-transact-sql) is generated when the parameter @supports_net_changes is set to 1 when the source table is enabled.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="a2ac5-133">Diese Option wird nur unterstützt, wenn für die Quelltabelle ein Primärschlüssel definiert ist oder wenn der Parameter @index_name zur Identifizierung eines eindeutigen Indexes verwendet wurde.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-133">This option is only supported if the source table has a defined primary key or if the parameter @index_name has been used to identify a unique index.</span></span>  
  
     <span data-ttu-id="a2ac5-134">Die **netchanges** -Funktion gibt eine Änderung pro geänderte Quelltabellenzeile zurück.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-134">The **netchanges** function returns one change per modified source table row.</span></span> <span data-ttu-id="a2ac5-135">Wenn im angegebenen Intervall mehrere Änderungen für die Zeile aufgezeichnet wurden, geben die Spaltenwerte den endgültigen Inhalt der Zeile wieder.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-135">If more than one change is logged for the row during the specified interval, the column values will reflect the final contents of the row.</span></span> <span data-ttu-id="a2ac5-136">Zur korrekten Ermittlung des Vorgangs, der für das Update der Zielumgebung erforderlich ist, muss die TVF sowohl den Anfangsvorgang als auch den Endvorgang für die Zeile berücksichtigen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-136">To correctly identify the operation that is necessary to update the target environment, the TVF must consider both the initial operation on the row during the interval and the final operation on the row.</span></span> <span data-ttu-id="a2ac5-137">Wird die Zeilenfilteroption 'all' angegeben, umfassen die von der `net changes`-Abfrage zurückgegebenen Vorgänge entweder Einfüge-, Lösch- oder Aktualisierungsvorgänge (neue Werte).</span><span class="sxs-lookup"><span data-stu-id="a2ac5-137">When the row filter option 'all' is specified, the operations that are returned by a `net changes` query will either be insert, delete, or update (new values).</span></span> <span data-ttu-id="a2ac5-138">Diese Option gibt die Updatemaske immer als NULL zurück, da mit der Berechnung einer aggregierten Maske ein gewisser Aufwand verbunden ist.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-138">This option always returns the update mask as null because there is a cost associated with computing an aggregate mask.</span></span> <span data-ttu-id="a2ac5-139">Wenn Sie eine aggregierte Maske benötigen, die alle Änderungen einer Zeile wiedergibt, verwenden Sie die Option 'all with mask'.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-139">If you require an aggregate mask that reflects all changes to a row, use the 'all with mask' option.</span></span> <span data-ttu-id="a2ac5-140">Wenn für die Downstreamverarbeitung die Unterscheidung zwischen Einfüge- und Updatevorgängen nicht erforderlich ist, verwenden Sie die Option 'all with merge'.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-140">If downstream processing does not require inserts and updates to be distinguished, use the 'all with merge' option.</span></span> <span data-ttu-id="a2ac5-141">In diesem Fall ist der Vorgangswert auf zwei Werte festgelegt: 1 für einen Löschvorgang und 5 für einen Vorgang, der ein Einfüge- oder ein Updatevorgang sein kann.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-141">In this case, the operation value will only take on two values: 1 for delete and 5 for an operation that could be either an insert or an update.</span></span> <span data-ttu-id="a2ac5-142">Diese Option vermeidet den zusätzlichen Aufwand, der notwendig ist, um zu ermitteln, ob der abgeleitete Vorgang ein Einfüge- oder ein Updatevorgang sein sollte. Die Leistung der Abfrage kann steigen, wenn diese Unterscheidung nicht notwendig ist.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-142">This option eliminates the additional processing needed to determine whether the derived operation should be an insert or an update, and can improve the performance of the query when this differentiation is not necessary.</span></span>  
  
 <span data-ttu-id="a2ac5-143">Die von einer Abfragefunktion zurückgegebene Updatemaske ist eine kompakte Darstellung aller mit einer Zeile der Änderungsdaten verbundenen Spaltenänderungen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-143">The update mask that is returned from a query function is a compact representation that identifies all columns that changed in a row of change data.</span></span> <span data-ttu-id="a2ac5-144">In der Regel werden diese Informationen nur für eine kleine Teilmenge der aufgezeichneten Spalten benötigt.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-144">Typically, this information is only required for a small subset of the captured columns.</span></span> <span data-ttu-id="a2ac5-145">Es stehen Funktionen zur Verfügung, die helfen, Informationen aus der Maske in einer Form zu extrahieren, die direkt von Anwendungen verwendet werden kann.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-145">Functions are available to assist in extracting information from the mask in a form that is more directly usable by applications.</span></span> <span data-ttu-id="a2ac5-146">Die Funktion [sys.fn_cdc_get_column_ordinal](/sql/relational-databases/system-functions/sys-fn-cdc-get-column-ordinal-transact-sql) gibt die Ordnungsposition einer benannten Spalte für eine gegebene Aufzeichnungsinstanz zurück, während die Funktion [sys.fn_cdc_is_bit_set](/sql/relational-databases/system-functions/sys-fn-cdc-is-bit-set-transact-sql) die Parität des Bits in der angegebenen Maske zurückgibt, basierend auf der Ordnungsposition, die im Funktionsaufruf übergeben wurde.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-146">The function [sys.fn_cdc_get_column_ordinal](/sql/relational-databases/system-functions/sys-fn-cdc-get-column-ordinal-transact-sql) returns the ordinal position of a named column for a given capture instance, whereas the function [sys.fn_cdc_is_bit_set](/sql/relational-databases/system-functions/sys-fn-cdc-is-bit-set-transact-sql) returns the parity of the bit in the provided mask based on the ordinal that was passed in the function call.</span></span> <span data-ttu-id="a2ac5-147">Zusammen ermöglichen diese Funktionen, Informationen effizient aus der Updatemaske zu extrahieren und sie mit der Anforderung von Änderungsdaten zurückzugeben.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-147">Together, these two functions allow information from the update mask to be efficiently extracted and returned with the request for change data.</span></span> <span data-ttu-id="a2ac5-148">Die Verwendung dieser Funktionen wird in der Vorlage "Enumerate Net Changes Using All With Mask" veranschaulicht.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-148">See the template Enumerate Net Changes Using All With Mask for a demonstration of how these functions are used.</span></span>  
  
##  <a name="query-function-scenarios"></a><a name="Scenarios"></a> <span data-ttu-id="a2ac5-149">Szenarios für Abfragefunktionen</span><span class="sxs-lookup"><span data-stu-id="a2ac5-149">Query Function Scenarios</span></span>  
 <span data-ttu-id="a2ac5-150">In den folgenden Abschnitten werden häufige Szenarios für die Abfrage von Change Data Capture-Daten beschrieben, die die Verwendung der Abfragefunktionen "cdc.fn_cdc_get_all_changes_<capture_instance>" und "cdc.fn_cdc_get_net_changes_<capture_instance>" erläutern.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-150">The following sections describe common scenarios for querying change data capture data by using the query functions cdc.fn_cdc_get_all_changes_<capture_instance> and cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span>  
  
### <a name="querying-for-all-changes-within-the-capture-instance-validity-interval"></a><span data-ttu-id="a2ac5-151">Abfragen aller Änderungen im Gültigkeitsintervall der Aufzeichnungsinstanz</span><span class="sxs-lookup"><span data-stu-id="a2ac5-151">Querying for All Changes Within the Capture Instance Validity Interval</span></span>  
 <span data-ttu-id="a2ac5-152">Das einfachste Anforderungsszenario für Änderungsdaten ist die Rückgabe aller aktuellen Änderungsdaten im Gültigkeitsintervall einer Aufzeichnungsinstanz.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-152">The most straightforward request for change data is one that returns all of the current change data in a capture instance's validity interval.</span></span> <span data-ttu-id="a2ac5-153">Bestimmen Sie für eine solche Anforderung zuerst die unteren und oberen LSN-Grenzwerte des Gültigkeitsintervalls.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-153">To make this request, first determine the lower and upper LSN boundaries of the validity interval.</span></span> <span data-ttu-id="a2ac5-154">Verwenden Sie anschließend diese Werte, um die Parameter @from_lsn und @to_lsn zu ermitteln, die an die Abfragefunktion „cdc.fn_cdc_get_all_changes_<capture_instance>“ oder „cdc.fn_cdc_get_net_changes_<capture_instance>“ übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-154">Then, use these values to identify the parameters @from_lsn and @to_lsn passed to the query function cdc.fn_cdc_get_all_changes_<capture_instance> or cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span> <span data-ttu-id="a2ac5-155">Verwenden Sie die Funktion [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) , um die Untergrenze zu erhalten, und [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) , um die Obergrenze zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-155">Use the function [sys.fn_cdc_get_min_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-min-lsn-transact-sql) to obtain the lower bound, and [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) to obtain the upper bound.</span></span> <span data-ttu-id="a2ac5-156">Die Vorlage "Enumerate All Changes for the Valid Range" enthält einen Beispielcode zum Abfragen aller aktuellen, gültigen Änderungen mit der Abfragefunktion "cdc.fn_cdc_get_all_changes_<capture_instance>".</span><span class="sxs-lookup"><span data-stu-id="a2ac5-156">See the template Enumerate All Changes for the Valid Range for sample code to query for all current valid changes by using the query function cdc.fn_cdc_get_all_changes_<capture_instance>.</span></span> <span data-ttu-id="a2ac5-157">Die Vorlage "Enumerate Net Changes for the Valid Range" enthält ein ähnliches Beispiel zur Verwendung der Abfragefunktion "cdc.fn_cdc_get_net_changes_<capture_instance>".</span><span class="sxs-lookup"><span data-stu-id="a2ac5-157">See the template Enumerate Net Changes for the Valid Range for a similar example of using the function cdc.fn_cdc_get_net_changes_<capture_instance>.</span></span>  
  
### <a name="querying-for-all-new-changes-since-the-last-set-of-changes"></a><span data-ttu-id="a2ac5-158">Abfragen aller neuen Änderungen seit dem letzten Änderungssatz</span><span class="sxs-lookup"><span data-stu-id="a2ac5-158">Querying for All New Changes Since the Last Set of Changes</span></span>  
 <span data-ttu-id="a2ac5-159">In vielen Anwendungen werden Änderungsdaten regelmäßig oder ständig abgefragt, sodass periodisch alle Änderungen seit der letzten Anforderung abgefragt werden.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-159">For typical applications, querying for change data will be an ongoing process, making periodic requests for all of the changes that occurred since the last request.</span></span> <span data-ttu-id="a2ac5-160">Für solche Abfragen können Sie die Funktion [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) verwenden, die die untere Grenze der aktuellen Abfrage aus der oberen Grenze der vorhergehenden Abfrage herleitet.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-160">For such queries, you can use the function [sys.fn_cdc_increment_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-increment-lsn-transact-sql) to derive the lower bound of the current query from the upper bound of the previous query.</span></span> <span data-ttu-id="a2ac5-161">Mit dieser Methode wird gewährleistet, dass Zeilen nicht wiederholt werden, da das Abfrageintervall immer als geschlossenes Intervall behandelt wird, bei dem beide Endpunkte in das Intervall eingeschlossen sind.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-161">This method ensures that no rows are repeated because the query interval is always treated as a closed interval where both end-points are included in the interval.</span></span> <span data-ttu-id="a2ac5-162">Verwenden Sie anschließend die Funktion [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) , um den oberen Endpunkt für das neue Anforderungsintervall zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-162">Then, use the function [sys.fn_cdc_get_max_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-get-max-lsn-transact-sql) to obtain the high end-point for the new request interval.</span></span> <span data-ttu-id="a2ac5-163">Die Vorlage "Enumerate All Changes Since Previous Request" beinhaltet einen Beispielcode, mit dem das Abfragefenster systematisch verschoben wird, um alle Änderungen seit der letzten Anforderung abzurufen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-163">See the template Enumerate All Changes Since Previous Request for sample code to systematically move the query window to obtain all changes since the last request.</span></span>  
  
### <a name="querying-for-all-new-changes-up-until-now"></a><span data-ttu-id="a2ac5-164">Abfragen aller neuen Änderungen bis zum jetzigen Zeitpunkt</span><span class="sxs-lookup"><span data-stu-id="a2ac5-164">Querying for all New Changes Up Until Now</span></span>  
 <span data-ttu-id="a2ac5-165">Eine typische Einschränkung beim Zurückgeben von Änderungen mit einer Abfragefunktion ist es, nur die Änderungen einzubeziehen, die zwischen der vorhergehenden Anforderung und der aktuellen Uhrzeit und dem aktuellen Datum aufgetreten sind.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-165">A typical constraint that is placed on the changes returned by a query function is to include only the changes that occurred between the previous request until the current date and time.</span></span> <span data-ttu-id="a2ac5-166">Für eine solche Abfrage können Sie die Funktion „sys.fn_cdc_increment_lsn“ auf den Wert @from_lsn aus der vorhergehenden Anforderung anwenden, um die untere Grenze zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-166">For this query, apply the function sys.fn_cdc_increment_lsn to the @from_lsn value that was used in the previous request to determine the lower bound.</span></span> <span data-ttu-id="a2ac5-167">Da die obere Grenze des Zeitintervalls als spezifischer Zeitpunkt angegeben wird, muss dieser Wert vor der Verwendung in einer Abfragefunktion in einen LSN-Wert umgewandelt werden.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-167">Because the upper bound on the time interval is expressed as a specific point in time, it must be converted to an LSN value before it can be used by a query function.</span></span> <span data-ttu-id="a2ac5-168">Bevor der datetime-Wert in einen entsprechenden LSN-Wert umgewandelt werden kann, müssen Sie sicherstellen, dass der Aufzeichnungsprozess alle Änderungen verarbeitet hat, für die mit der angegebenen oberen Grenze ein Commit ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-168">Before the datetime value can be converted to a corresponding LSN value, you must ensure that the capture process has processed all changes that were committed through the specified upper bound.</span></span> <span data-ttu-id="a2ac5-169">Dies ist erforderlich, um zu gewährleisten, dass alle qualifizierenden Änderungen an die Änderungstabelle weitergegeben wurden.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-169">This is required to ensure that all the qualifying changes have been propagated to the change table.</span></span> <span data-ttu-id="a2ac5-170">Eine Möglichkeit ist das Erstellen einer Warteschleife, die regelmäßig überprüft, ob der aktuelle maximale Commit-LSN für eine der Datenbankänderungstabellen den gewünschten Endzeitpunkt des Anforderungsintervalls überschreitet.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-170">One way to do this is to structure a wait loop that periodically checks to see if the current maximum commit lsn recorded for any database change table exceeds the desired end time of the request interval.</span></span>  
  
 <span data-ttu-id="a2ac5-171">Nachdem die Verzögerungsschleife bestätigt hat, dass der Aufzeichnungsprozess alle relevanten Protokolleinträge verarbeitet hat, können Sie die Funktion [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) verwenden, um den LSN-Wert für den neuen oberen Endpunkt zu ermitteln.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-171">After the delay loop verifies that the capture process has already processed all the relevant log entries, use the function [sys.fn_cdc_map_time_to_lsn](/sql/relational-databases/system-functions/sys-fn-cdc-map-time-to-lsn-transact-sql) to determine the new high end-point expressed as an LSN value.</span></span> <span data-ttu-id="a2ac5-172">Um sicherzustellen, dass alle Einträge abgerufen werden, für die in der angegebenen Zeit ein Commit ausgeführt wurde, rufen Sie die Funktion "sys.fn_cdc_map_time_to_lsn" und verwenden hierbei die Option 'largest less than or equal'.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-172">To ensure that all entries that were committed through the specified time are retrieved, call the function sys.fn_cdc_map_time_to_lsn, and use the option 'largest less than or equal'.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="a2ac5-173">In Zeiten ohne Aktivität wird der Tabelle "cdc.lsn_time_mapping" ein Platzhaltereintrag hinzugefügt, um anzuzeigen, dass der Aufzeichnungsprozess die Änderungen bis zu einem bestimmten Commitzeitpunkt verarbeitet hat.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-173">In periods of inactivity, a dummy entry is added to the table cdc.lsn_time_mapping to mark the fact that the capture process has processed the changes up to a given commit time.</span></span> <span data-ttu-id="a2ac5-174">Dies soll verhindern, dass der Eindruck entsteht, der Aufzeichnungsprozess wäre mit der Verarbeitung im Rückstand, wenn aktuell keine Änderungen zu verarbeiten sind.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-174">This prevents it from appearing that the capture process has fallen behind when there are simply no recent changes to process.</span></span>  
  
 <span data-ttu-id="a2ac5-175">Die Vorlage "Enumerate All Changes Up Until Now" veranschaulicht, wie Änderungsdaten gemäß der zuvor beschriebenen Strategie abgefragt werden können.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-175">The template Enumerate All Changes Up Until Now demonstrates how to use the previous strategy to query for change data.</span></span>  
  
### <a name="adding-a-commit-time-to-an-all-changes-result-set"></a><span data-ttu-id="a2ac5-176">Hinzufügen einer Commitzeit zu einem Resultset mit allen Änderungen</span><span class="sxs-lookup"><span data-stu-id="a2ac5-176">Adding a Commit Time to an All Changes Result Set</span></span>  
 <span data-ttu-id="a2ac5-177">Die Commitzeit jeder Transaktion, der ein Eintrag in einer Datenbankänderungstabelle zugeordnet ist, kann aus der Tabelle [cdc.lsn_time_mapping](/sql/relational-databases/system-tables/cdc-lsn-time-mapping-transact-sql)abgerufen werden.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-177">The commit time of each transaction with an associated entry in a database change table is available in the table [cdc.lsn_time_mapping](/sql/relational-databases/system-tables/cdc-lsn-time-mapping-transact-sql).</span></span> <span data-ttu-id="a2ac5-178">Wenn der __$start_lsn-Wert, der bei einer Anforderung aller Änderungen zurückgegeben wird, mit dem start_lsn-Wert eines cdc.lsn_time_mapping-Tabelleneintrags verknüpft wird, können Sie den tran_end_time-Wert zusammen mit den Änderungsdaten zurückgeben, um die Änderung mit der Commitzeit aus der Transaktionsquelle zu kennzeichnen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-178">By joining the __$start_lsn value returned in a request for all changes with the start_lsn value of a cdc.lsn_time_mapping table entry, you can return the tran_end_time along with the change data to stamp the change with the commit time of the transaction at the source.</span></span> <span data-ttu-id="a2ac5-179">Die Vorlage "Append Commit Time to All Changes Result Set" zeigt, wie Sie diesen Join ausführen können.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-179">The template Append Commit Time to All Changes Result Set demonstrates how to perform this join.</span></span>  
  
### <a name="joining-change-data-with-other-data-from-the-same-transaction"></a><span data-ttu-id="a2ac5-180">Verknüpfen von Änderungsdaten mit anderen Daten derselben Transaktion</span><span class="sxs-lookup"><span data-stu-id="a2ac5-180">Joining Change Data with Other Data from the Same Transaction</span></span>  
 <span data-ttu-id="a2ac5-181">In einigen Fällen ist es von Vorteil, Änderungsdaten mit anderen Informationen zu verknüpfen, die beim Commit in der Quelle über die Transaktion gesammelt wurden.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-181">Occasionally, it is useful to join change data with other information gathered about the transaction when it committed at the source.</span></span> <span data-ttu-id="a2ac5-182">Die tran_begin_lsn-Spalte in der cdc.lsn_time_mapping-Tabelle enthält die für einen solchen Join erforderlichen Informationen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-182">The tran_begin_lsn column in the table cdc.lsn_time_mapping provides the information needed to perform such a join.</span></span> <span data-ttu-id="a2ac5-183">Sobald das Update der Quelle stattfindet, muss der Wert für database_transaction_begin_lsn aus der dynamischen Systemsicht [sys.dm_tran_database_transactions](/sql/relational-databases/system-dynamic-management-views/sys-dm-tran-database-transactions-transact-sql) zusammen mit allen anderen Informationen gespeichert werden, die später mit den Änderungsdaten verknüpft werden sollen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-183">When the update of the source occurs, the value for database_transaction_begin_lsn from the system dynamic view [sys.dm_tran_database_transactions](/sql/relational-databases/system-dynamic-management-views/sys-dm-tran-database-transactions-transact-sql) must be saved along with any other information to be joined with the change data.</span></span> <span data-ttu-id="a2ac5-184">Verwenden Sie die Funktion fn_convertnumericlsntobinary, um den database_transaction_begin_lsn-Wert und den tran_begin_lsn-Wert zu vergleichen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-184">Use the function fn_convertnumericlsntobinary to compare the database_transaction_begin_lsn and tran_begin_lsn values.</span></span> <span data-ttu-id="a2ac5-185">Der Code zum Erstellen dieser Funktion ist in der Vorlage "Create Function fn_convertnumericlsntobinary" enthalten.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-185">The code to create this function is available in the template Create Function fn_convertnumericlsntobinary.</span></span> <span data-ttu-id="a2ac5-186">Die Vorlage "Return All Changes with a Given tran_begin_lsn" veranschaulicht die Durchführung des Joins.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-186">The template Return All Changes with a Given tran_begin_lsn demonstrates how to effect the join.</span></span>  
  
### <a name="querying-using-datetime-wrapper-functions"></a><span data-ttu-id="a2ac5-187">Abfragen mit Datetime-Wrapperfunktionen</span><span class="sxs-lookup"><span data-stu-id="a2ac5-187">Querying Using Datetime Wrapper Functions</span></span>  
 <span data-ttu-id="a2ac5-188">Ein typisches Anwendungsszenario für die Abfrage von Änderungsdaten ist das periodische Anfordern von Änderungsdaten in einem gleitenden Fenster, das durch datetime-Werte definiert wird.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-188">A typical application scenario for querying for change data is to periodically request change data by using a sliding window bounded by datetime values.</span></span> <span data-ttu-id="a2ac5-189">Für diese Klasse von Consumern stellt Change Data Capture die gespeicherte Prozedur [sys.sp_cdc_generate_wrapper_function](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql) bereit, die Skripts zum Erstellen benutzerdefinierter Wrapperfunktionen für die Abfragefunktionen von Change Data Capture generiert.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-189">For this class of consumers, change data capture provides the stored procedure [sys.sp_cdc_generate_wrapper_function](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql) that generates scripts to create custom wrapper functions for the change data capture query functions.</span></span> <span data-ttu-id="a2ac5-190">Mit diesen benutzerdefinierten Wrappern kann das Abfrageintervall als datetime-Paar ausgedrückt werden.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-190">These custom wrappers allow the query interval to be expressed as a datetime pair.</span></span>  
  
 <span data-ttu-id="a2ac5-191">Die Aufrufoptionen für die gespeicherte Prozedur gestatten es, Wrapper für alle Aufzeichnungsinstanzen, auf die der Aufrufer Zugriff hat, oder nur für eine bestimmte Aufzeichnungsinstanz zu generieren.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-191">Calling options for the stored procedure allow for wrappers to be generated for all capture instances that the caller has access to, or only a specified capture instance.</span></span> <span data-ttu-id="a2ac5-192">Mit den unterstützten Optionen kann auch angegeben werden, ob der obere Endpunkt des Aufzeichnungsintervalls offen oder geschlossen sein soll, welche der verfügbaren aufgezeichneten Spalten in das Resultset aufgenommen werden sollen und welchen der enthaltenen Spalten Updateflags zugeordnet werden sollen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-192">Supported options also include the ability to specify whether the high end-point of the capture interval should be open or closed, which of the available captured columns should be included in the result set and which of the included columns should have associated update flags.</span></span> <span data-ttu-id="a2ac5-193">Die Prozedur gibt ein Resultset mit zwei Spalten zurück: dem Namen der generierten Funktion, der vom Namen der Aufzeichnungsinstanz abgeleitet werden kann, und der Erstellungsanweisung für die gespeicherte Wrapperprozedur.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-193">The procedure returns a result set with two columns: the generated function name, which is derivable from the capture instance name, and the create statement for the wrapper stored procedure.</span></span> <span data-ttu-id="a2ac5-194">Die Wrapperfunktion für die Abfrage aller Änderungen wird immer generiert.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-194">The function to wrap the all changes query is always generated.</span></span> <span data-ttu-id="a2ac5-195">Wenn der @supports_net_changes-Parameter beim Erstellen der Aufzeichnungsinstanz festgelegt wurde, wird auch die Wrapperfunktion für die Funktion für Nettoänderungen generiert.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-195">If the @supports_net_changes parameter was set when the capture instance was created, the function to wrap the net changes function is also generated.</span></span>  
  
 <span data-ttu-id="a2ac5-196">Der Anwendungsentwickler muss sicherstellen, dass die gespeicherte Prozedur für die Skriptgenerierung aufgerufen wird und damit die Erstellungsanweisungen für die gespeicherten Wrapperprozeduren generiert werden. Der Entwickler muss außerdem die generierten Erstellungsskripts ausführen, um die Funktionen zu erstellen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-196">It is the responsibility of the application designer to call the script generation stored procedure to generate the create statements for the wrapper stored procedures, and to execute the resulting create scripts to create the functions.</span></span> <span data-ttu-id="a2ac5-197">Diese Vorgänge werden beim Erstellen einer Aufzeichnungsinstanz nicht automatisch ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-197">This does not occur automatically when a capture instance is created.</span></span>  
  
 <span data-ttu-id="a2ac5-198">Datetime-Wrapper befinden sich im Besitz des Benutzers und werden nicht im Standardschema des Aufrufers erstellt.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-198">Datetime wrappers are owned by the user, and not are created in the default schema of the caller.</span></span> <span data-ttu-id="a2ac5-199">Die generierte Funktion ist ohne Änderungen für die meisten Benutzer geeignet.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-199">The generated function is suitable without modification for most users.</span></span> <span data-ttu-id="a2ac5-200">Dennoch können jederzeit weitere Anpassungen am generierten Skript vorgenommen werden, bevor die Funktion erstellt wird.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-200">However, further customization can always be applied to the generated script prior to creating the function.</span></span>  
  
 <span data-ttu-id="a2ac5-201">Der Name der Wrapperfunktion für die Abfrage aller Änderungen ist "fn_all_changes_", gefolgt vom Namen der Aufzeichnungsinstanz.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-201">The name of the function to wrap the all changes query is fn_all_changes_ followed by the capture instance name.</span></span> <span data-ttu-id="a2ac5-202">Das Präfix, das für die Wrapperfunktion für Nettoänderungen verwendet wird, lautet "fn_net_changes_".</span><span class="sxs-lookup"><span data-stu-id="a2ac5-202">The prefix that is used for the net changes wrapper is fn_net_changes_.</span></span> <span data-ttu-id="a2ac5-203">Beide Funktionen erwarten wie die zugehörigen Change Data Capture-TVFs drei Argumente.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-203">Both functions take three arguments, just as their associated change data capture TVFs do.</span></span> <span data-ttu-id="a2ac5-204">Das Abfrageintervall für die Wrapper wird jedoch durch zwei datetime-Werte anstelle zweier LSN-Werte festgelegt.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-204">However, the query interval for the wrappers is bounded by two datetime values instead of than by two LSN values.</span></span> <span data-ttu-id="a2ac5-205">Der @row_filter_option-Parameter für beide Funktionssätze ist identisch.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-205">The @row_filter_option parameter for both sets of functions are the same.</span></span>  
  
 <span data-ttu-id="a2ac5-206">Die generierten Wrapperfunktionen unterstützen die folgende Konvention zum systematischen Durchlaufen der Change Data Capture-Zeitachse: Es wird davon ausgegangen, dass der @end_time-Parameter des vorhergehenden Intervalls als @start_time-Parameter des nachfolgenden Intervalls verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-206">The generated wrapper functions support the following convention for systematically walking the change data capture timeline: It is expected that the @end_time parameter of the previous interval be used as the @start_time parameter of the subsequent interval.</span></span> <span data-ttu-id="a2ac5-207">Die Wrapperfunktion übernimmt die Zuordnung der datetime-Werte zu den LSN-Werten und stellt sicher, dass keine Daten verloren gehen oder wiederholt werden, sofern diese Konvention eingehalten wird.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-207">The wrapper function takes care of mapping the datetime values to LSN values and ensuring that no data is lost or repeated if this convention is followed.</span></span>  
  
 <span data-ttu-id="a2ac5-208">Beim Generieren der Wrapper kann angegeben werden, ob die Wrapper im angegebenen Abfragefenster eine geschlossene oder eine offene obere Grenze unterstützen sollen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-208">The wrappers can be generated to support either a closed upper bound or an open upper bound on the specified query window.</span></span> <span data-ttu-id="a2ac5-209">Das heißt, der Aufrufer kann festlegen, ob Einträge mit einer Commitzeit in das Intervall aufgenommen werden sollen, die der oberen Grenze des Extrahierungsintervalls entspricht.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-209">That is, the caller can specify whether entries having a commit time equal to the upper bound of the extraction interval are to be included within the interval.</span></span> <span data-ttu-id="a2ac5-210">Standardmäßig wird die Obergrenze aufgenommen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-210">By default, the upper bound is included.</span></span>  
  
 <span data-ttu-id="a2ac5-211">Die generierten Abfrage-TVFs geben einen Fehler zurück, wenn ein NULL-Wert im @from_lsn-Wert oder im @to_lsn-Wert übergeben wird. Die datetime-Wrapperfunktionen geben stattdessen NULL zurück, sodass die datetime-Wrapper alle aktuellen Änderungen zurückgeben können.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-211">While the generated query TVFs fail if supplied a null value for either the @from_lsn value or the @to_lsn value, the datetime wrapper functions use null to allow the datetime wrappers to return all current changes.</span></span> <span data-ttu-id="a2ac5-212">Wenn NULL als unterer Endpunkt des Abfragefensters an den Datetime-Wrapper übergeben wird, wird der untere Endpunkt des Gültigkeitsintervalls der Aufzeichnungsinstanz in der zugrunde liegenden SELECT-Anweisung auf die Abfrage-TVF angewendet.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-212">That is, if null is passed as the low end-point of the query window to the datetime wrapper, the low end point of the capture instance validity interval is used in the underlying SELECT statement that is applied to the query TVF.</span></span> <span data-ttu-id="a2ac5-213">Wenn NULL als oberer Endpunkt des Abfragefensters übergeben wird, wird entsprechend der obere Endpunkt des Gültigkeitsintervalls der Aufzeichnungsinstanz beim Auswählen aus der Abfrage-TVF verwendet.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-213">Similarly, if null is passed as the high end-point of the query window, the high end-point of the capture instance validity interval is used when selecting from the query TVF.</span></span>  
  
 <span data-ttu-id="a2ac5-214">Das von einer Wrapperfunktion zurückgegebene Resultset beinhaltet alle angeforderten Spalten, gefolgt von einer Vorgangsspalte mit einem ein oder zwei Zeichen langen Code, der den der Zeile zugeordneten Vorgang identifiziert.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-214">The result set returned by a wrapper function includes all the requested columns followed by an operation column, recoded as one or two characters to identify the operation that is associated with the row.</span></span> <span data-ttu-id="a2ac5-215">Wenn Updateflags angefordert wurden, werden diese als Bitspalten nach dem Vorgangscode in der vom @update_flag_list-Parameter festgelegten Reihenfolge aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-215">If update flags have been requested, they appear as bit columns after the operation code, in the order specified in the @update_flag_list parameter.</span></span> <span data-ttu-id="a2ac5-216">Informationen zu den Aufrufoptionen für das Anpassen der generierten datetime-Wrapper finden Sie unter [sys.sp_cdc_generate_wrapper_function &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="a2ac5-216">For information about the calling options for customizing the generated datetime wrappers, see [sys.sp_cdc_generate_wrapper_function &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sys-sp-cdc-generate-wrapper-function-transact-sql).</span></span>  
  
 <span data-ttu-id="a2ac5-217">Die Vorlage "Instantiate a Wrapper TVF With Update Flag" zeigt, wie Sie eine generierte Wrapperfunktion anpassen können, um bei einer Abfrage der Nettoänderungen dem Resultset ein Updateflag für eine angegebene Spalte hinzuzufügen.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-217">The template Instantiate a Wrapper TVF With Update Flag shows how to customize a generated wrapper function to append an update flag for a specified column to the result set returned by a net changes query.</span></span> <span data-ttu-id="a2ac5-218">Die Vorlage "Instantiate CDC Wrapper TVFs for a Schema" zeigt, wie Sie die Datetime-Wrappers für die Abfrage-TVFs aller Aufzeichnungsinstanzen instanziieren, die für die Quelltabellen in einem bestimmten Datenbankschema erstellt wurden.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-218">The template Instantiate CDC Wrapper TVFs for a Schema shows how to instantiate the Datetime Wrappers for the Query TVFs for all of the capture instances created for the source tables in a given database schema.</span></span>  
  
 <span data-ttu-id="a2ac5-219">Ein Beispiel, in dem ein datetime-Wrapper zum Abfragen von Änderungsdaten verwendet wird, finden Sie in der Vorlage "Get Net Changes Using Wrapper With Update Flags".</span><span class="sxs-lookup"><span data-stu-id="a2ac5-219">For an example that uses a datetime wrapper to query for change data, see the template Get Net Changes Using Wrapper With Update Flags.</span></span> <span data-ttu-id="a2ac5-220">Diese Vorlage zeigt, wie Nettoänderungen mit einer Wrapperfunktion abgefragt werden, wenn der Wrapper für die Rückgabe von Aktualisierungsflags konfiguriert wurde.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-220">This template demonstrates how to query for net changes with a wrapper function when the wrapper is configured to return update flags.</span></span> <span data-ttu-id="a2ac5-221">Beachten Sie, dass die Zeilenfilteroption 'all with mask' für die zugrunde liegende Abfragefunktion benötigt wird, um bei einem Update eine Updatemakse zurückzugeben, die nicht NULL ist.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-221">Note that the row filter option 'all with mask' is required for the underlying query function to return a non-null update mask on update.</span></span> <span data-ttu-id="a2ac5-222">NULL-Werte werden sowohl für die untere als auch für die obere datetime-Intervallgrenze übergeben, um anzuzeigen, dass die Funktion bei der zugrunde liegenden LSN-basierten Abfrage den unteren und den oberen Endpunkt des Gültigkeitsintervalls für die Aufzeichnungsinstanz verwenden soll.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-222">Null values are passed for both the lower and upper datetime interval boundaries to signal the function to use the low end point and the high end point of the validity interval for the capture instance when performing the underlying LSN based query.</span></span> <span data-ttu-id="a2ac5-223">Die Abfrage gibt eine Zeile für jede Änderung an einer Quellzeile zurück, die innerhalb des gültigen Bereichs der Aufzeichnungsinstanz stattgefunden hat.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-223">The query returns one row for each modification to a source row that occurred within the valid range for the capture instance.</span></span>  
  
### <a name="using-the-datetime-wrapper-functions-to-transition-between-capture-instances"></a><span data-ttu-id="a2ac5-224">Verwenden der Datetime-Wrapperfunktionen für den Übergang zwischen Aufzeichnungsinstanzen</span><span class="sxs-lookup"><span data-stu-id="a2ac5-224">Using the Datetime Wrapper Functions to Transition Between Capture Instances</span></span>  
 <span data-ttu-id="a2ac5-225">Change Data Capture unterstützt bis zu zwei Aufzeichnungsinstanzen für eine einzelne verfolgte Quelltabelle.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-225">Change data capture supports up to two capture instances for a single tracked source table.</span></span> <span data-ttu-id="a2ac5-226">Hauptverwendungszweck für diese Funktionalität ist es, einen Übergang zwischen mehreren Aufzeichnungsinstanzen zu ermöglichen, wenn Änderungen der DDL (Data Definition Language, Datendefinitionssprache) der Quelltabelle die Anzahl der für die Verfolgung verfügbaren Spalten erweitern.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-226">The principal use of this capability is to accommodate a transition between multiple capture instances when data definition language (DDL) changes to the source table expand the set of available columns for tracking.</span></span> <span data-ttu-id="a2ac5-227">Um eventuelle Änderungen in den Namen der zugrunde liegenden Abfragefunktionen auf nachfolgenden Anwendungsebenen zu verbergen, kann beim Übergang zu einer neuen Aufzeichnungsinstanz z. B. eine Wrapperfunktion für den eigentlichen Aufruf verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-227">When transitioning to a new capture instance, one way to protect higher application levels from changes in the names of the underlying query functions is to use a wrapper function to wrap the underlying call.</span></span> <span data-ttu-id="a2ac5-228">Stellen Sie dann sicher, dass der Name der Wrapperfunktion immer gleich bleibt.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-228">Then, ensure that the name of the wrapper function remains the same.</span></span> <span data-ttu-id="a2ac5-229">Sobald der Übergang durchgeführt werden soll, kann die alte Wrapperfunktion gelöscht und eine neue mit demselben Namen erstellt werden, die dann auf die neuen Abfragefunktionen verweist.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-229">When the switch is to occur, the old wrapper function can be dropped, and a new one with the same name created that references the new query functions.</span></span> <span data-ttu-id="a2ac5-230">Indem zuerst das generierte Skript geändert wird, um eine Wrapperfunktion mit demselben Namen zu erstellen, können Sie den Wechsel zu einer neuen Aufzeichnungsinstanz durchführen, ohne dass dies Auswirkungen auf darüber liegende Anwendungsebenen hat.</span><span class="sxs-lookup"><span data-stu-id="a2ac5-230">By first modifying the generated script to create a wrapper function of the same name, you can make the switch to a new capture instance without affecting higher application layers.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="a2ac5-231">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="a2ac5-231">See Also</span></span>  
 <span data-ttu-id="a2ac5-232">[Nachverfolgen von Datenänderungen &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="a2ac5-232">[Track Data Changes &#40;SQL Server&#41;](../track-changes/track-data-changes-sql-server.md) </span></span>  
 <span data-ttu-id="a2ac5-233">[Über Change Data Capture &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="a2ac5-233">[About Change Data Capture &#40;SQL Server&#41;](../track-changes/about-change-data-capture-sql-server.md) </span></span>  
 <span data-ttu-id="a2ac5-234">[Aktivieren und Deaktivieren von Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="a2ac5-234">[Enable and Disable Change Data Capture &#40;SQL Server&#41;](../track-changes/enable-and-disable-change-data-capture-sql-server.md) </span></span>  
 [<span data-ttu-id="a2ac5-235">Verwalten und Überwachen von Change Data Capture &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="a2ac5-235">Administer and Monitor Change Data Capture &#40;SQL Server&#41;</span></span>](../track-changes/administer-and-monitor-change-data-capture-sql-server.md)  
  
  
