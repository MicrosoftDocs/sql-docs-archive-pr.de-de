---
title: Anforderungen an benutzerdefinierte CLR-Aggregate | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: clr
ms.topic: reference
helpviewer_keywords:
- aggregate functions [CLR integration]
- user-defined types [CLR integration], user-defined aggregates
- CREATE AGGREGATE statement
- SqlUserDefinedAggregate attribute
- aggregate methods [CLR integration]
- assemblies [CLR integration], user-defined aggregate functions
- custom aggregates [CLR integration]
- user-defined functions [CLR integration]
- UDTs [CLR integration], user-defined aggregates
ms.assetid: dbf9eb5a-bd99-42f7-b275-556d0def045d
author: rothja
ms.author: jroth
ms.openlocfilehash: 8123f8324d43212007857dbb596a4fc61872bd2e
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87618730"
---
# <a name="requirements-for-clr-user-defined-aggregates"></a><span data-ttu-id="e64e0-102">Anforderungen für benutzerdefinierte CLR-Aggregate</span><span class="sxs-lookup"><span data-stu-id="e64e0-102">Requirements for CLR User-Defined Aggregates</span></span>
  <span data-ttu-id="e64e0-103">Ein Typ in einer CLR-Assembly (Common Language Runtime) kann als benutzerdefinierte Aggregatfunktion registriert werden, solange der erforderliche Aggregationsvertrag implementiert wird.</span><span class="sxs-lookup"><span data-stu-id="e64e0-103">A type in a common language runtime (CLR) assembly can be registered as a user-defined aggregate function, as long as it implements the required aggregation contract.</span></span> <span data-ttu-id="e64e0-104">Dieser Vertrag besteht aus dem `SqlUserDefinedAggregate`-Attribut und den Aggregationsvertragmethoden.</span><span class="sxs-lookup"><span data-stu-id="e64e0-104">This contract consists of the `SqlUserDefinedAggregate` attribute and the aggregation contract methods.</span></span> <span data-ttu-id="e64e0-105">Der Aggregationsvertrag beinhaltet den Mechanismus zur Speicherung des Zwischenstatus der Aggregation sowie den Mechanismus zur Ansammlung neuer Werte, der sich aus den vier Methoden `Init`, `Accumulate`, `Merge` und `Terminate` zusammensetzt.</span><span class="sxs-lookup"><span data-stu-id="e64e0-105">The aggregation contract includes the mechanism to save the intermediate state of the aggregation, and the mechanism to accumulate new values, which consists of four methods: `Init`, `Accumulate`, `Merge`, and `Terminate`.</span></span> <span data-ttu-id="e64e0-106">Wenn Sie diese Anforderungen erfüllt haben, sind Sie in der Lage, benutzerdefinierte Aggregate in in vollem Umfang zu nutzen [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="e64e0-106">When you have met these requirements, you will be able to take full advantage of user-defined aggregates in [!INCLUDE[msCoName](../../includes/msconame-md.md)] [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="e64e0-107">Die folgenden Abschnitte zu diesem Thema enthalten zusätzliche Details zum Erstellen von benutzerdefinierten Aggregaten und ihrer Verwendungsweise.</span><span class="sxs-lookup"><span data-stu-id="e64e0-107">The following sections of this topic provide additional details about how to create and work with user-defined aggregates.</span></span> <span data-ttu-id="e64e0-108">Ein Beispiel finden Sie unter [Aufrufen von benutzerdefinierten CLR-Aggregatfunktionen](clr-user-defined-aggregate-invoking-functions.md).</span><span class="sxs-lookup"><span data-stu-id="e64e0-108">For an example, see [Invoking CLR User-Defined Aggregate Functions](clr-user-defined-aggregate-invoking-functions.md).</span></span>  
  
## <a name="sqluserdefinedaggregate"></a><span data-ttu-id="e64e0-109">SqlUserDefinedAggregate</span><span class="sxs-lookup"><span data-stu-id="e64e0-109">SqlUserDefinedAggregate</span></span>  
 <span data-ttu-id="e64e0-110">Weitere Informationen finden Sie unter [SqlUserDefinedAggregateAttribute](https://go.microsoft.com/fwlink/?LinkId=124626).</span><span class="sxs-lookup"><span data-stu-id="e64e0-110">For more information, see [SqlUserDefinedAggregateAttribute](https://go.microsoft.com/fwlink/?LinkId=124626).</span></span>  
  
## <a name="aggregation-methods"></a><span data-ttu-id="e64e0-111">Aggregationsmethoden</span><span class="sxs-lookup"><span data-stu-id="e64e0-111">Aggregation Methods</span></span>  
 <span data-ttu-id="e64e0-112">Die als benutzerdefiniertes Aggregat registrierte Klasse muss die folgenden Instanzmethoden unterstützen.</span><span class="sxs-lookup"><span data-stu-id="e64e0-112">The class registered as a user-defined aggregate should support the following instance methods.</span></span> <span data-ttu-id="e64e0-113">Diese Methoden werden vom Abfrageprozessor verwendet, um die Aggregation zu berechnen:</span><span class="sxs-lookup"><span data-stu-id="e64e0-113">These are the methods that the query processor uses to compute the aggregation:</span></span>  
  
|<span data-ttu-id="e64e0-114">Methode</span><span class="sxs-lookup"><span data-stu-id="e64e0-114">Method</span></span>|<span data-ttu-id="e64e0-115">Syntax</span><span class="sxs-lookup"><span data-stu-id="e64e0-115">Syntax</span></span>|<span data-ttu-id="e64e0-116">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="e64e0-116">Description</span></span>|  
|------------|------------|-----------------|  
|`Init`|<span data-ttu-id="e64e0-117">öffentliches void init ();</span><span class="sxs-lookup"><span data-stu-id="e64e0-117">public void Init();</span></span>|<span data-ttu-id="e64e0-118">Der Abfrageprozessor verwendet diese Methode, um die Berechnung der Aggregation zu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="e64e0-118">The query processor uses this method to initialize the computation of the aggregation.</span></span> <span data-ttu-id="e64e0-119">Diese Methode wird einmal für jede Gruppe aufgerufen, die der Abfrageprozessor aggregiert.</span><span class="sxs-lookup"><span data-stu-id="e64e0-119">This method is invoked once for each group that the query processor is aggregating.</span></span> <span data-ttu-id="e64e0-120">Der Abfrageprozessor verwendet möglicherweise dieselbe Instanz der Aggregatklasse mehrfach, um Aggregate für mehrere Gruppen zu berechnen.</span><span class="sxs-lookup"><span data-stu-id="e64e0-120">The query processor may choose to reuse the same instance of the aggregate class for computing aggregates of multiple groups.</span></span> <span data-ttu-id="e64e0-121">Die `Init`-Methode sollte alle ggf. nach der vorherigen Verwendung dieser Instanz erforderlichen Cleanups durchführen und den erneuten Start einer weiteren Aggregatberechnung ermöglichen.</span><span class="sxs-lookup"><span data-stu-id="e64e0-121">The `Init` method should perform any clean-up as necessary from previous uses of this instance, and enable it to re-start a new aggregate computation.</span></span>|  
|`Accumulate`|<span data-ttu-id="e64e0-122">öffentliches void-Akkumulations (Eingabetyp Wert [, Eingabetyp Wert,...]);</span><span class="sxs-lookup"><span data-stu-id="e64e0-122">public void Accumulate ( input-type value[, input-type value, ...]);</span></span>|<span data-ttu-id="e64e0-123">Ein oder mehrere Parameter, die die Parameter der Funktion darstellen.</span><span class="sxs-lookup"><span data-stu-id="e64e0-123">One or more parameters representing the parameters of the function.</span></span> <span data-ttu-id="e64e0-124">*INPUT_TYPE* muss der verwaltete [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Datentyp sein, der dem systemeigenen Datentyp entspricht, der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] durch *input_sqltype* in der-Anweisung angegeben wird `CREATE AGGREGATE` .</span><span class="sxs-lookup"><span data-stu-id="e64e0-124">*input_type* should be the managed [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data type equivalent to the native [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data type specified by *input_sqltype* in the `CREATE AGGREGATE` statement.</span></span> <span data-ttu-id="e64e0-125">Weitere Informationen finden Sie unter [Mapping von CLR-Parameter Daten](../clr-integration-database-objects-types-net-framework/mapping-clr-parameter-data.md).</span><span class="sxs-lookup"><span data-stu-id="e64e0-125">For more information, see [Mapping CLR Parameter Data](../clr-integration-database-objects-types-net-framework/mapping-clr-parameter-data.md).</span></span><br /><br /> <span data-ttu-id="e64e0-126">Für benutzerdefinierte Typen (User-Defined Types, UDTs) entspricht der Eingabetyp dem UDT-Typ.</span><span class="sxs-lookup"><span data-stu-id="e64e0-126">For user-defined types (UDTs), the input-type is the same as the UDT type.</span></span> <span data-ttu-id="e64e0-127">Der Abfrageprozessor verwendet diese Methode, um die Aggregatwerte zu sammeln.</span><span class="sxs-lookup"><span data-stu-id="e64e0-127">The query processor uses this method to accumulate the aggregate values.</span></span> <span data-ttu-id="e64e0-128">Sie wird einmal für jeden Wert in der zu aggregierenden Gruppe aufgerufen.</span><span class="sxs-lookup"><span data-stu-id="e64e0-128">This is invoked once for each value in the group that is being aggregated.</span></span> <span data-ttu-id="e64e0-129">Der Abfrageprozessor ruft diese Methode stets erst nach der `Init`-Methode für die jeweilige Instanz der Aggregatklasse auf.</span><span class="sxs-lookup"><span data-stu-id="e64e0-129">The query processor always calls this only after calling the `Init` method on the given instance of the aggregate-class.</span></span> <span data-ttu-id="e64e0-130">Durch die Implementierung dieser Methode wird der Instanzstatus auf den momentanen Stand der übergebenen Argumentwertansammlung aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="e64e0-130">The implementation of this method should update the state of the instance to reflect the accumulation of the argument value being passed in.</span></span>|  
|`Merge`|<span data-ttu-id="e64e0-131">öffentliches void-merge (udagg_class Wert);</span><span class="sxs-lookup"><span data-stu-id="e64e0-131">public void Merge( udagg_class value);</span></span>|<span data-ttu-id="e64e0-132">Diese Methode kann verwendet werden, um eine andere Instanz dieser Aggregatklasse mit der aktuellen Instanz zusammenzuführen.</span><span class="sxs-lookup"><span data-stu-id="e64e0-132">This method can be used to merge another instance of this aggregate class with the current instance.</span></span> <span data-ttu-id="e64e0-133">Der Abfrageprozessor verwendet diese Methode, um mehrere Teilberechnungen einer Aggregation zusammenzuführen.</span><span class="sxs-lookup"><span data-stu-id="e64e0-133">The query processor uses this method to merge multiple partial computations of an aggregation.</span></span>|  
|`Terminate`|<span data-ttu-id="e64e0-134">öffentliches return_type beenden ();</span><span class="sxs-lookup"><span data-stu-id="e64e0-134">public return_type Terminate();</span></span>|<span data-ttu-id="e64e0-135">Diese Methode schließt die Aggregatberechnung ab und gibt das Ergebnis der Aggregation zurück.</span><span class="sxs-lookup"><span data-stu-id="e64e0-135">This method completes the aggregate computation and returns the result of the aggregation.</span></span> <span data-ttu-id="e64e0-136">Der *return_type* sollte ein verwalteter [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Datentyp sein, der das verwaltete Äquivalent von *return_sqltype* ist, der in der-Anweisung angegeben ist `CREATE AGGREGATE` .</span><span class="sxs-lookup"><span data-stu-id="e64e0-136">The *return_type* should be a managed [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] data type that is the managed equivalent of *return_sqltype* specified in the `CREATE AGGREGATE` statement.</span></span> <span data-ttu-id="e64e0-137">Der *return_type* kann auch ein benutzerdefinierter Typ sein.</span><span class="sxs-lookup"><span data-stu-id="e64e0-137">The *return_type* can also be a user-defined type.</span></span>|  
  
### <a name="table-valued-parameters"></a><span data-ttu-id="e64e0-138">Tabellenwertparameter</span><span class="sxs-lookup"><span data-stu-id="e64e0-138">Table-Valued Parameters</span></span>  
 <span data-ttu-id="e64e0-139">Tabellenwertparameter (Table Valued Parameters, TVPs), benutzerdefinierte Tabellentypen, die an eine Prozedur oder Funktion übergeben werden, bieten eine effiziente Methode zum Übergeben mehrerer Datenzeilen an den Server.</span><span class="sxs-lookup"><span data-stu-id="e64e0-139">Table-valued parameters (TVPs), user-defined table types that are passed into a procedure or function, provide an efficient way to pass multiple rows of data to the server.</span></span> <span data-ttu-id="e64e0-140">TVPs verfügen über eine ähnliche Funktionalität wie Parameterarrays, bieten aber größere Flexibilität und engere Integration mit [!INCLUDE[tsql](../../includes/tsql-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e64e0-140">TVPs provide similar functionality to parameter arrays, but offer greater flexibility and closer integration with [!INCLUDE[tsql](../../includes/tsql-md.md)].</span></span> <span data-ttu-id="e64e0-141">Außerdem verfügen sie auch über ein besseres Leistungspotenzial.</span><span class="sxs-lookup"><span data-stu-id="e64e0-141">They also provide the potential for better performance.</span></span> <span data-ttu-id="e64e0-142">TVPs helfen auch, die Anzahl von Roundtrips zum Server zu reduzieren.</span><span class="sxs-lookup"><span data-stu-id="e64e0-142">TVPs also help reduce the number of round trips to the server.</span></span> <span data-ttu-id="e64e0-143">Anstatt mehrere Anforderungen an den Server zu senden, z. B. mit einer Liste von skalaren Parametern, können Daten als TVP an den Server gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="e64e0-143">Instead of sending multiple requests to the server, such as with a list of scalar parameters, data can be sent to the server as a TVP.</span></span> <span data-ttu-id="e64e0-144">Ein benutzerdefinierter Tabellentyp kann nicht als Tabellenwertparameter an eine verwaltete gespeicherte Prozedur oder Funktion übergeben werden, die im [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Prozess ausgeführt wird, oder von einer solchen Prozedur oder Funktion zurückgegeben werden.</span><span class="sxs-lookup"><span data-stu-id="e64e0-144">A user-defined table type cannot be passed as a table-valued parameter to, or be returned from, a managed stored procedure or function executing in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] process.</span></span> <span data-ttu-id="e64e0-145">Auch können TVPs nicht innerhalb des Bereichs einer Kontextverbindung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="e64e0-145">Also, TVPs cannot be used within the scope of a context connection.</span></span> <span data-ttu-id="e64e0-146">Allerdings kann ein TVP, sofern er nicht als Kontextverbindung verwendet wird, mit SqlClient in verwalteten gespeicherten Prozeduren oder Funktionen verwendet werden, die im [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]-Prozess ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="e64e0-146">However, a TVP can be used with SqlClient in managed stored procedures or functions executing in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] process, if it is used in a connection that is not a context connection.</span></span> <span data-ttu-id="e64e0-147">Die Verbindung kann zum gleichen Server erfolgen, der die verwaltete Prozedur oder Funktion ausführt.</span><span class="sxs-lookup"><span data-stu-id="e64e0-147">The connection can be to the same server that is executing the managed procedure or function.</span></span> <span data-ttu-id="e64e0-148">Weitere Informationen zu TVPs finden Sie unter [Verwenden von Tabellenwert Parametern &#40;Datenbank-Engine&#41;](../tables/use-table-valued-parameters-database-engine.md).</span><span class="sxs-lookup"><span data-stu-id="e64e0-148">For more information about TVPs, see [Use Table-Valued Parameters &#40;Database Engine&#41;](../tables/use-table-valued-parameters-database-engine.md).</span></span>  
  
## <a name="change-history"></a><span data-ttu-id="e64e0-149">Änderungsverlauf</span><span class="sxs-lookup"><span data-stu-id="e64e0-149">Change History</span></span>  
  
|<span data-ttu-id="e64e0-150">Aktualisierter Inhalt</span><span class="sxs-lookup"><span data-stu-id="e64e0-150">Updated content</span></span>|  
|---------------------|  
|<span data-ttu-id="e64e0-151">Die Beschreibung der `Accumulate`-Methode wurde aktualisiert. Es werden jetzt mehrere Parameter akzeptiert.</span><span class="sxs-lookup"><span data-stu-id="e64e0-151">Updated the description of the `Accumulate` method; it now accepts more than one parameter.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="e64e0-152">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="e64e0-152">See Also</span></span>  
 <span data-ttu-id="e64e0-153">[Benutzerdefinierte CLR-Typen](../clr-integration-database-objects-user-defined-types/clr-user-defined-types.md) </span><span class="sxs-lookup"><span data-stu-id="e64e0-153">[CLR User-Defined Types](../clr-integration-database-objects-user-defined-types/clr-user-defined-types.md) </span></span>  
 [<span data-ttu-id="e64e0-154">Aufrufen von CLR-benutzerdefinierten Aggregatfunktionen</span><span class="sxs-lookup"><span data-stu-id="e64e0-154">Invoking CLR User-Defined Aggregate Functions</span></span>](clr-user-defined-aggregate-invoking-functions.md)  
  
  
