---
title: Verfügbarkeitsgruppenlistener, Client Konnektivität und Anwendungs Failover (SQL Server) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- Availability Groups [SQL Server], listeners
- read-only routing
- read-intent connections [AlwaysOn Availability Groups]
- Availability Groups [SQL Server], configuring
- Availability Groups [SQL Server], read-only routing
- Availability Groups [SQL Server], client connectivity
ms.assetid: 76fb3eca-6b08-4610-8d79-64019dd56c44
author: rothja
ms.author: jroth
ms.openlocfilehash: f66046625ca0078904e9555d1cf586873b9f697f
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87698499"
---
# <a name="availability-group-listeners-client-connectivity-and-application-failover-sql-server"></a><span data-ttu-id="6d3f6-102">Verfügbarkeitsgruppenlistener, Clientkonnektivität und Anwendungsfailover (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="6d3f6-102">Availability Group Listeners, Client Connectivity, and Application Failover (SQL Server)</span></span>
  <span data-ttu-id="6d3f6-103">Dieses Thema enthält Informationen zu Überlegungen hinsichtlich [!INCLUDE[ssHADR](../includes/sshadr-md.md)] -Clientkonnektivität und Anwendungsfailoverfunktionalität.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-103">This topic contains information about considerations for [!INCLUDE[ssHADR](../includes/sshadr-md.md)] client connectivity and application-failover functionality.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6d3f6-104">Für den Großteil der allgemeinen Listenerkonfigurationen können Sie einfach den ersten Verfügbarkeitsgruppenlistener mit [!INCLUDE[tsql](../includes/tsql-md.md)] -Anweisungen oder PowerShell-Cmdlets erstellen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-104">For the majority of the common listener configurations, you can create the first availability group listener simply by using [!INCLUDE[tsql](../includes/tsql-md.md)] statements or PowerShell cmdlets.</span></span> <span data-ttu-id="6d3f6-105">Weitere Informationen finden Sie weiter unten in diesem Thema unter [Verwandte Aufgaben](#RelatedTasks).</span><span class="sxs-lookup"><span data-stu-id="6d3f6-105">For more information, see [Related Tasks](#RelatedTasks), later in this topic.</span></span>  
  
 
  
##  <a name="availability-group-listeners"></a><a name="AGlisteners"></a><span data-ttu-id="6d3f6-106">Verfügbarkeitsgruppenlistener</span><span class="sxs-lookup"><span data-stu-id="6d3f6-106">Availability Group Listeners</span></span>  
 <span data-ttu-id="6d3f6-107">Sie können Clientkonnektivität für die Datenbank einer angegebenen Verfügbarkeitsgruppe bereitstellen, indem Sie einen Verfügbarkeitsgruppenlistener erstellen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-107">You can provide client connectivity to the database of a given availability group by creating an availability group listener.</span></span> <span data-ttu-id="6d3f6-108">Ein Verfügbarkeitsgruppenlistener ist der Name eines virtuellen Netzwerks (Virtual Network Name, VNN), mit dem Clients eine Verbindung herstellen können, um auf eine Datenbank in einem primären oder sekundären Replikat einer AlwaysOn-Verfügbarkeitsgruppe zuzugreifen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-108">An availability group listener is a virtual network name (VNN) to which clients can connect in order to access a database in a primary or secondary replica of an AlwaysOn availability group.</span></span> <span data-ttu-id="6d3f6-109">Ein Verfügbarkeitsgruppenlistener ermöglicht es einem Client, eine Verbindung mit einem Verfügbarkeitsreplikat herzustellen, ohne dass der Name der physischen Instanz von SQL Server, mit der der Client eine Verbindung herstellt, bekannt ist.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-109">An availability group listener enables a client to connect to an availability replica without knowing the name of the physical instance of SQL Server to which the client is connecting.</span></span>  <span data-ttu-id="6d3f6-110">Die Clientverbindungszeichenfolge muss nicht geändert werden, damit eine Verbindung mit dem aktuellen Ort des aktuellen primären Replikats hergestellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-110">The client connection string does not need to be modified to connect to the current location of the current primary replica.</span></span>  
  
 <span data-ttu-id="6d3f6-111">Ein Verfügbarkeitsgruppenlistener besteht aus einem DNS (Domain Name System)-Listenernamen, einer Listenerportbezeichnung und mindestens einer IP-Adresse.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-111">An availability group listener consists of a Domain Name System (DNS) listener name, listener port designation, and one or more IP addresses.</span></span> <span data-ttu-id="6d3f6-112">Nur das TCP-Protokoll wird von Verfügbarkeitsgruppenlistenern unterstützt.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-112">Only the TCP protocol is supported by availability group listener.</span></span>  <span data-ttu-id="6d3f6-113">Der DNS-Name des Listeners muss auch in der Domäne und NetBIOS eindeutig sein.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-113">The DNS name of the listener must also be unique in the domain and in NetBIOS.</span></span>  <span data-ttu-id="6d3f6-114">Wenn Sie einen neuen Verfügbarkeitsgruppenlistener erstellen, wird er zu einer Ressource in einem Cluster mit einem zugeordneten virtuellen Netzwerknamen (VNN), einer virtuellen IP (VIP) und Verfügbarkeitsgruppenabhängigkeit.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-114">When you create a new availability group listener it becomes a resource in a cluster with an associated virtual network name (VNN), virtual IP (VIP), and availability group dependency.</span></span> <span data-ttu-id="6d3f6-115">Ein Client verwendet DNS, um den VNN in mehrere IP-Adressen aufzulösen, und versucht dann, eine Verbindung mit jeder einzelnen Adresse herzustellen, bis eine Verbindungsanforderung erfolgreich ist oder ein Timeout eintritt.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-115">A client uses DNS to resolve the VNN into multiple IP addresses and then tries to connect to each address, until a connection request succeeds or until the connection requests time out.</span></span>  
  
 <span data-ttu-id="6d3f6-116">Wenn für mindestens ein[lesbares sekundäres Replikat](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md)das schreibgeschützte Routing konfiguriert ist, werden Clientverbindungen mit Leseabsicht vom primären Replikat an ein lesbares sekundäres Replikat umgeleitet.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-116">If read-only routing is configured for one or more[readable secondary replicas](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md), read-intent client connections to the primary replica are redirected to a readable secondary replica.</span></span> <span data-ttu-id="6d3f6-117">Auch wenn das primäre Replikat auf einer Instanz von SQL Server offline geschaltet wird und auf einer anderen Instanz von SQL Server ein neues primäres Replikat online geschaltet wird, ermöglicht der Verfügbarkeitsgruppenlistener Clients Verbindungen mit dem neuen primären Replikat.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-117">Also, if the primary replica goes offline on one instance of SQL Server, and a new primary replica comes online on another instance of SQL Server, the availability group listener enables clients to connect to the new primary replica.</span></span>  
  
 <span data-ttu-id="6d3f6-118">Wichtige Informationen zu Verfügbarkeitsgruppenlistenern finden Sie unter [Erstellen oder Konfigurieren eines Verfügbarkeitsgruppenlisteners &#40;SQL Server&#41;](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="6d3f6-118">For essential information about availability group listeners, see [Create or Configure an Availability Group Listener &#40;SQL Server&#41;](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md).</span></span>  
  
 
  
###  <a name="availability-group-listener-configuration"></a><a name="AGlConfig"></a> <span data-ttu-id="6d3f6-119">Konfiguration des Verfügbarkeitsgruppenlisteners</span><span class="sxs-lookup"><span data-stu-id="6d3f6-119">Availability Group Listener Configuration</span></span>  
 <span data-ttu-id="6d3f6-120">Ein Verfügbarkeitsgruppenlistener wird definiert, indem Folgendes angegeben wird:</span><span class="sxs-lookup"><span data-stu-id="6d3f6-120">An availability group listener is defined by the following:</span></span>  
  
 <span data-ttu-id="6d3f6-121">Eindeutiger DNS-Name</span><span class="sxs-lookup"><span data-stu-id="6d3f6-121">A unique DNS name</span></span>  
 <span data-ttu-id="6d3f6-122">Dieser wird auch als virtueller Netzwerkname (Virtual Network Name, VNN) bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-122">This is also known as a Virtual Network Name (VNN).</span></span> <span data-ttu-id="6d3f6-123">Es gelten die Active Directory-Benennungsregeln für DNS-Hostnamen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-123">Active Directory naming rules for DNS host names apply.</span></span> <span data-ttu-id="6d3f6-124">Weitere Informationen finden Sie im KB-Artikel [Namenskonventionen in Active Directory für Computer, Domänen, Standorte und Organisationseinheiten](https://support.microsoft.com/kb/909264) .</span><span class="sxs-lookup"><span data-stu-id="6d3f6-124">For more information, see the [Naming conventions in Active Directory for computers, domains, sites, and OUs](https://support.microsoft.com/kb/909264) KB article.</span></span>  
  
 <span data-ttu-id="6d3f6-125">Mindestens eine virtuelle IP-Adresse (Virtual IP address, VIP)</span><span class="sxs-lookup"><span data-stu-id="6d3f6-125">One or more Virtual IP addresses (VIPs)</span></span>  
 <span data-ttu-id="6d3f6-126">VIPs werden für mindestens ein Subnetz konfiguriert, in dem ein Failover der Verfügbarkeitsgruppe erfolgen kann.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-126">VIPs are configured for one or more subnets to which the availability group can failover.</span></span>  
  
 <span data-ttu-id="6d3f6-127">IP-Adresskonfiguration</span><span class="sxs-lookup"><span data-stu-id="6d3f6-127">IP address configuration</span></span>  
 <span data-ttu-id="6d3f6-128">Für einen gegebenen Listener der Verfügbarkeitsgruppe verwendet die IP-Adresse entweder das Dynamic Host Configuration Protocol (DHCP) oder mindestens eine statische IP-Adresse.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-128">For a given availability group listener, the IP address uses either Dynamic Host Configuration Protocol (DHCP) or one or more static IP addresses.</span></span>  
  
-   <span data-ttu-id="6d3f6-129">Dynamic Host Configuration-Protokoll (DHCP)</span><span class="sxs-lookup"><span data-stu-id="6d3f6-129">Dynamic Host Configuration Protocol (DHCP)</span></span>  
  
     <span data-ttu-id="6d3f6-130">Wenn sich eine Verfügbarkeitsgruppe in einem einzelnen Subnetz befindet, können Sie alle IP-Adressen der Verfügbarkeitsgruppenlistener konfigurieren, um das DHCP zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-130">If an availability group resides on a single subnet, you can configure all the availability group listener IP addresses to use DHCP.</span></span> <span data-ttu-id="6d3f6-131">Für Vorproduktionsumgebungen bietet DHCP ein einfaches Setup für eine Verfügbarkeitsgruppe, für die keine Notfallwiederherstellung an einem Remotestandort in einem separaten Subnetz erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-131">For pre-production environments, DHCP offers an easy setup for an availability group that does not require disaster recovery to a remote site on a separate subnet.</span></span> <span data-ttu-id="6d3f6-132">Dennoch sollte DHCP nicht in Verbindung mit einem Verfügbarkeitsgruppenlistener in einer Produktionsumgebung verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-132">However, you should not use DHCP in conjunction with an availability group listener in a production environment.</span></span> <span data-ttu-id="6d3f6-133">Wenn es zu einer Ausfallzeit kommt und das DHCP-IP-Leasing abläuft, ist für die erneute Registrierung der dem DNS-Listenernamen zugeordneten neuen DHCP-IP-Adresse zusätzlich Zeit erforderlich.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-133">This is because, in the event of down time, if the DHCP IP lease expires, extra time is required to re-register the new DHCP IP address associated with the listener DNS name.</span></span> <span data-ttu-id="6d3f6-134">Dies führt zu einem Ausfall der Clientverbindung.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-134">The extra time will cause client-connection failure.</span></span>  
  
-   <span data-ttu-id="6d3f6-135">Statische IP-Adressen</span><span class="sxs-lookup"><span data-stu-id="6d3f6-135">Static IP addresses</span></span>  
  
     <span data-ttu-id="6d3f6-136">In Produktionsumgebungen wird empfohlen, dass Verfügbarkeitsgruppenlistener statische IP-Adressen verwenden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-136">In production environments, we recommend that availability group listeners use static IP addresses.</span></span> <span data-ttu-id="6d3f6-137">Wenn sich die Verfügbarkeitsgruppen jedoch in Subnetzen einer Domäne mit mehreren Subnetzen befinden, muss ein Verfügbarkeitsgruppenlistener statische IP-Adressen verwenden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-137">Furthermore, where availability groups extend across subnets in a multi-subnet domain, an availability group listener must use static IP addresses.</span></span>  
  
 <span data-ttu-id="6d3f6-138">Hybride Netzwerkkonfigurationen und DHCP in mehreren Subnetzen werden nicht für Verfügbarkeitsgruppenlistener unterstützt.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-138">Hybrid network configurations and DHCP across subnets are not supported for availability group listeners.</span></span> <span data-ttu-id="6d3f6-139">Das liegt daran, dass im Fall eines Failovers eine dynamische IP abgelaufen sein könnte oder freigegeben wird, wodurch die Hochverfügbarkeit insgesamt gefährdet wird.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-139">This is because when a failover happens, a dynamic IP might expire or be released, which jeopardizes overall high availability.</span></span>  
  
###  <a name="selecting-an-availability-group-listener-port"></a><a name="SelectListenerPort"></a> <span data-ttu-id="6d3f6-140">Auswählen eines Ports für Verfügbarkeitsgruppenlistener</span><span class="sxs-lookup"><span data-stu-id="6d3f6-140">Selecting an Availability Group Listener Port</span></span>  
 <span data-ttu-id="6d3f6-141">Wenn Sie einen Verfügbarkeitsgruppenlistener konfigurieren, müssen Sie einen Port festlegen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-141">When configuring an availability group listener, you must designate a port.</span></span>  <span data-ttu-id="6d3f6-142">Sie können den Standardport auf 1433 konfigurieren, um Clientverbindungszeichenfolgen einfach zu gestalten.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-142">You can configure the default port to 1433 in order to allow for simplicity of the client connection strings.</span></span> <span data-ttu-id="6d3f6-143">Wenn Sie 1433 verwenden, müssen Sie keine Portnummer in einer Verbindungszeichenfolge festlegen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-143">If using 1433, you do not need to designate a port number in a connection string.</span></span>   <span data-ttu-id="6d3f6-144">Da jeder Verfügbarkeitsgruppenlistener einen separaten virtuellen Netzwerknamen besitzt, kann außerdem jeder für einen WSFC-Cluster konfigurierte Verfügbarkeitsgruppenlistener für den Verweis auf Port 1433 konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-144">Also, since each availability group listener will have a separate virtual network name, each availability group listener configured on a single WSFC can be configured to reference the same default port of 1433.</span></span>  
  
 <span data-ttu-id="6d3f6-145">Sie können auch einen nicht standardmäßigen Listenerport festlegen. Dies bedeutet jedoch, dass Sie auch in der Verbindungszeichenfolge immer dann explizit einen Zielport angeben müssen, wenn Sie eine Verbindung mit dem Verfügbarkeitsgruppenlistener herstellen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-145">You can also designate a non-standard listener port; however this means that you will also need to explicitly specify a target port in your connection string whenever connecting to the availability group listener.</span></span>  <span data-ttu-id="6d3f6-146">Darüber hinaus müssen Sie die Berechtigung für die Firewall für den nicht standardmäßigen Port öffnen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-146">You will also need to open permission on the firewall for the non-standard port.</span></span>  
  
 <span data-ttu-id="6d3f6-147">Wenn Sie den Standardport 1433 für die virtuellen Netzwerknamen der Verfügbarkeitsgruppenlistener verwenden, müssen Sie dennoch sicherstellen, dass keine anderen Dienste im Clusterknoten diesen Port verwenden. Andernfalls tritt ein Portkonflikt auf.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-147">If you use the default port of 1433 for availability group listener VNNs, you will still need to ensure that no other services on the cluster node are using this port; otherwise this would cause a port conflict.</span></span>  
  
 <span data-ttu-id="6d3f6-148">Wenn eine der Instanzen von SQL Server bereits über den Instanzlistener TCP-Port 1433 überwacht und keine anderen Dienste (einschließlich weitere Instanzen von SQL Server) auf dem Computer Port 1433 überwachen, wird kein Portkonflikt mit dem Verfügbarkeitsgruppenlistener verursacht.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-148">If one of the instances of SQL Server is already listening on TCP port 1433 via the instance listener and there are no other services (including additional instances of SQL Server) on the computer listening on port 1433, this will not cause a port conflict with the availability group listener.</span></span>  <span data-ttu-id="6d3f6-149">Das liegt daran, dass der Verfügbarkeitsgruppenlistener den selben TCP-Port im gleichen Dienstprozess freigeben kann.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-149">This is because the availability group listener can share the same TCP port inside the same service process.</span></span>  <span data-ttu-id="6d3f6-150">Mehrere Instanzen von SQL Server (parallel) sollten jedoch nicht für die Überwachung desselben Ports konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-150">However multiple instances of SQL Server (side-by-side)should not be configured to listen on the same port.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-the-primary-replica"></a><a name="ConnectToPrimary"></a><span data-ttu-id="6d3f6-151">Verwenden eines Listener zum Herstellen einer Verbindung mit dem primären Replikat</span><span class="sxs-lookup"><span data-stu-id="6d3f6-151">Using a Listener to Connect to the Primary Replica</span></span>  
 <span data-ttu-id="6d3f6-152">Um mithilfe eines Verfügbarkeitsgruppenlisteners eine Verbindung mit dem primären Replikat für Lese-/Schreibzugriff herzustellen, gibt die Verbindungszeichenfolge den DNS-Namen des Verfügbarkeitsgruppenlisteners an.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-152">To use an availability group listener to connect to the primary replica for read-write access, the connection string specifies the availability group listener DNS name.</span></span>  <span data-ttu-id="6d3f6-153">Wenn ein Verfügbarkeitsgruppenreplikat zu einem neuen Replikat wird, werden vorhandene Verbindungen, für die der Netzwerkname eines Verfügbarkeitslisteners verwendet wird, unterbrochen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-153">If an availability group primary replica changes to a new replica, existing connections that use an availability group listener's network name are disconnected.</span></span>  <span data-ttu-id="6d3f6-154">Neue Verbindungen zum Verfügbarkeitsgruppenlistener werden dann an das neue primäre Replikat weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-154">New connections to the availability group listener are then directed to the new primary replica.</span></span> <span data-ttu-id="6d3f6-155">Beispiel für eine einfache Verbindungszeichenfolge für den ADO.NET-Anbieter (System.Data.SqlClient):</span><span class="sxs-lookup"><span data-stu-id="6d3f6-155">An example of a basic connection string for the ADO.NET provider (System.Data.SqlClient) is as follows:</span></span>  
  
```  
Server=tcp: AGListener,1433;Database=MyDB;IntegratedSecurity=SSPI  
```  
  
 <span data-ttu-id="6d3f6-156">Sie können dennoch direkt auf die Instanz des SQL Server-Namens der primären oder sekundären Replikate verweisen, anstatt den Servernamen des Verfügbarkeitsgruppenlisteners zu verwenden. In diesem Fall werden neue Verbindungen jedoch nicht automatisch zum aktuellen primären Replikat weitergeleitet.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-156">You can still choose to directly reference the instance of SQL Server name of the primary or secondary replicas instead of using the availability group listener server name, however if you choose to do so you will lose the benefit of new connections being directed automatically to the current primary replica.</span></span>  <span data-ttu-id="6d3f6-157">Schreibgeschütztes Routing geht ebenfalls verloren.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-157">You will also lose the benefit of read-only routing.</span></span>  
  
##  <a name="using-a-listener-to-connect-to-a-read-only-secondary-replica-read-only-routing"></a><a name="ConnectToSecondary"></a> <span data-ttu-id="6d3f6-158">Verwenden eines Listeners zum Herstellen einer Verbindung mit einem schreibgeschützten sekundären Replikat (schreibgeschütztes Routing)</span><span class="sxs-lookup"><span data-stu-id="6d3f6-158">Using a Listener to Connect to a Read-Only Secondary Replica (Read-Only Routing)</span></span>  
 <span data-ttu-id="6d3f6-159">*Schreibgeschütztes Routing* bezieht sich auf die Möglichkeit von [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] , eingehende Verbindungen für einen Verfügbarkeitsgruppenlistener an ein sekundäres Replikat weiterzuleiten, das für schreibgeschützte Arbeitslasten konfiguriert ist.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-159">*Read-only routing* refers to the ability of [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] to route incoming connections to an availability group listener to a secondary replica that is configured to allow read-only workloads.</span></span> <span data-ttu-id="6d3f6-160">Eine eingehende Verbindung, die auf den Namen eines Verfügbarkeitsgruppenlisteners verweist, kann automatisch an ein schreibgeschütztes Replikat weitergeleitet werden, wenn Folgendes zutrifft:</span><span class="sxs-lookup"><span data-stu-id="6d3f6-160">An incoming connection referencing an availability group listener name can automatically be routed to a read-only replica if the following are true:</span></span>  
  
-   <span data-ttu-id="6d3f6-161">Mindestens ein sekundäres Replikat wird auf schreibgeschützten Zugriff festgelegt, und jedes schreibgeschützte sekundäre Replikat sowie das primäre Replikat werden konfiguriert, um schreibgeschütztes Routing zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-161">At least one secondary replica is set to read-only access, and each read-only secondary replica and the primary replica are configured to support read-only routing.</span></span> <span data-ttu-id="6d3f6-162">Weitere Informationen finden Sie weiter unten in diesem Abschnitt unter [So konfigurieren Sie Verfügbarkeitsreplikate für das schreibgeschützte Routing](#ConfigureARsForROR).</span><span class="sxs-lookup"><span data-stu-id="6d3f6-162">For more information, see [To Configure Availability Replicas for Read-Only Routing](#ConfigureARsForROR), later in this section.</span></span>  
  
-   <span data-ttu-id="6d3f6-163">Die Verbindungszeichenfolge verweist auf einen Verfügbarkeitsgruppenlistener, und die Anwendungsabsicht der eingehenden Verbindung wird auf schreibgeschützt festgelegt, z. B. mithilfe des Schlüsselworts **Application Intent=ReadOnly** in den ODBC- oder OLEBD-Verbindungszeichenfolgen, -Verbindungsattributen oder -Eigenschaften.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-163">The connection string references an availability group listener, and the application intent of the incoming connection is set to read-only (for example, by using the **Application Intent=ReadOnly** keyword in the ODBC or OLEDB connection strings or connection attributes or properties).</span></span> <span data-ttu-id="6d3f6-164">Weitere Informationen finden Sie weiter unten in diesem Abschnitt unter [Schreibgeschützte Anwendungsabsicht und schreibgeschütztes Routing](#ReadOnlyAppIntent).</span><span class="sxs-lookup"><span data-stu-id="6d3f6-164">For more information, see [Read-Only Application Intent and Read-Only Routing](#ReadOnlyAppIntent), later in this section.</span></span>  
  
###  <a name="to-configure-availability-replicas-for-read-only-routing"></a><a name="ConfigureARsForROR"></a> <span data-ttu-id="6d3f6-165">So konfigurieren Sie Verfügbarkeitsreplikate für das schreibgeschützte Routing</span><span class="sxs-lookup"><span data-stu-id="6d3f6-165">To Configure Availability Replicas for Read-Only Routing</span></span>  
 <span data-ttu-id="6d3f6-166">Ein Datenbankadministrator muss die Verfügbarkeitsreplikate wie folgt konfigurieren:</span><span class="sxs-lookup"><span data-stu-id="6d3f6-166">A database administrator must configure the availability replicas as follows:</span></span>  
  
1.  <span data-ttu-id="6d3f6-167">Für jedes Verfügbarkeitsreplikat, das Sie als lesbares sekundäres Replikat konfigurieren möchten, muss ein Datenbankadministrator die folgenden Einstellungen konfigurieren, die nur unter der sekundären Rolle wirksam werden:</span><span class="sxs-lookup"><span data-stu-id="6d3f6-167">For each availability replica that you want to configure as a readable secondary replica, a database administrator must configure the following settings, which take effect only under the secondary role:</span></span>  
  
    -   <span data-ttu-id="6d3f6-168">Der Verbindungszugriff muss auf "alles" oder "schreibgeschützt" festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-168">Connection access must be set to "all" or "read only".</span></span>  
  
    -   <span data-ttu-id="6d3f6-169">Die URL für das schreibgeschützte Routing muss angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-169">The read-only routing URL must be specified.</span></span>  
  
2.  <span data-ttu-id="6d3f6-170">Für jede dieser Replikate muss eine schreibgeschützte Routingliste für die primäre Rolle angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-170">For each of these replicas, a read-only routing list must be specified for the primary role.</span></span> <span data-ttu-id="6d3f6-171">Geben Sie einen oder mehrere Servernamen als Routingziele an.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-171">Specify one or more server names as routing targets.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksROR"></a> <span data-ttu-id="6d3f6-172">Verwandte Aufgaben</span><span class="sxs-lookup"><span data-stu-id="6d3f6-172">Related Tasks</span></span>  
  
-   [<span data-ttu-id="6d3f6-173">Konfigurieren des schreibgeschützten Zugriffs auf ein Verfügbarkeitsreplikat &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6d3f6-173">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="6d3f6-174">Konfigurieren des schreibgeschützten Routing für eine Verfügbarkeitsgruppe &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6d3f6-174">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
###  <a name="read-only-application-intent-and-read-only-routing"></a><a name="ReadOnlyAppIntent"></a><span data-ttu-id="6d3f6-175">Schreibgeschützte Anwendungs Absicht und Schreib geschütztes Routing</span><span class="sxs-lookup"><span data-stu-id="6d3f6-175">Read-Only Application Intent and Read-Only Routing</span></span>  
 <span data-ttu-id="6d3f6-176">Die Eigenschaft der Verbindungszeichenfolge für die Anwendungsabsicht gibt an, dass die Anforderung der Clientanwendung direkt an die Version mit Lese-/Schreibzugriff oder die schreibgeschützte Version einer Verfügbarkeitsgruppendatenbank weitergeleitet wird.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-176">The application intent connection string property expresses the client application's request to be directed either to a read-write or read-only version of an availability group database.</span></span> <span data-ttu-id="6d3f6-177">Zum Verwenden des schreibgeschützten Routings muss ein Client beim Herstellen einer Verbindung mit dem Verfügbarkeitsgruppenlistener eine schreibgeschützte Anwendungsabsicht in der Verbindungszeichenfolge verwenden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-177">To use read-only routing, a client must use an application intent of read-only in the connection string when connecting to the availability group listener.</span></span> <span data-ttu-id="6d3f6-178">Ohne die schreibgeschützte Anwendungsabsicht werden Verbindungen zum Verfügbarkeitsgruppenlistener zur Datenbank weitergeleitet, die sich auf dem primären Replikat befindet.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-178">Without the read-only application intent, connections to the availability group listener are directed to the database on the primary replica.</span></span>  
  
 <span data-ttu-id="6d3f6-179">Das Attribut der Anwendungsabsicht wird während der Anmeldung in der Clientsitzung gespeichert. Die Instanz von SQL Server verarbeitet dann diese Absicht und ermittelt das weitere Vorgehen entsprechend der Konfiguration der Verfügbarkeitsgruppe und dem aktuellen Lese-/Schreibstatus der Zieldatenbank im sekundären Replikat.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-179">The application intent attribute is stored in the client's session during login and the instance of SQL Server will then process this intent and determine what to do according to the configuration of the availability group and the current read-write state of the target database in the secondary replica.</span></span>  
  
 <span data-ttu-id="6d3f6-180">Beispiel für eine Verbindungszeichenfolge für den ADO.NET-Anbieter (System.Data.SqlClient) mit Festlegung einer schreibgeschützten Anwendungsabsicht:</span><span class="sxs-lookup"><span data-stu-id="6d3f6-180">An example of a connection string for the ADO.NET provider (System.Data.SqlClient) that designates read-only application intent is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI;ApplicationIntent=ReadOnly  
```  
  
 <span data-ttu-id="6d3f6-181">In diesem Beispiel für eine Verbindungszeichenfolge versucht der Client, eine Verbindung mit dem Verfügbarkeitsgruppenlistener `AGListener` an Port 1433 herzustellen. Sie können den Port auch weglassen, wenn der Verfügbarkeitsgruppenlistener Port 1433 überwacht.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-181">In this connection string example, the client is attempting to connect to an availability group listener named `AGListener` on port 1433 (you may also omit the port if the availability group listener is listening on 1433).</span></span>  <span data-ttu-id="6d3f6-182">In der Verbindungs `ApplicationIntent` Zeichenfolge ist die-Eigenschaft auf festgelegt `ReadOnly` , sodass diese eine *Verbindungs Zeichenfolge*für beabsichtigte Lesevorgänge</span><span class="sxs-lookup"><span data-stu-id="6d3f6-182">The connection string has the `ApplicationIntent` property set to `ReadOnly`, making this a *read-intent connection string*.</span></span>  <span data-ttu-id="6d3f6-183">Ohne diese Einstellung hätte der Server kein schreibgeschütztes Routing der Verbindung versucht.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-183">Without this setting, the server would not have attempted a read-only routing of the connection.</span></span>  
  
 <span data-ttu-id="6d3f6-184">Die primäre Datenbank der Verfügbarkeitsgruppe verarbeitet die eingehende Anforderung für schreibgeschütztes Routing und versucht, ein schreibgeschütztes Online-Replikat zu suchen, das mit dem primären Replikat verknüpft und für schreibgeschütztes Routing konfiguriert ist.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-184">The primary database of the availability group processes the incoming read-only routing request and attempts to locate an online, read-only replica that is joined to the primary replica and is configured for read-only routing.</span></span>  <span data-ttu-id="6d3f6-185">Der Client empfängt Verbindungsinformationen vom primären Replikatserver und stellt eine Verbindung mit dem ermittelten schreibgeschützten Replikat her.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-185">The client receives back connection information from the primary replica server and connects to the identified read-only replica.</span></span>  
  
 <span data-ttu-id="6d3f6-186">Hinweis: Die Anwendungsabsicht kann von einem Clienttreiber an eine Downlevelinstanz von SQL Server gesendet werden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-186">Note that the application intent can be sent from a client driver to a down-level instance of SQL Server.</span></span>  <span data-ttu-id="6d3f6-187">In diesem Fall wird die schreibgeschützte Anwendungsabsicht ignoriert, und die Verbindung bleibt normal bestehen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-187">In this case, application intent of read-only is ignored and the connection proceeds as normal.</span></span>  
  
 <span data-ttu-id="6d3f6-188">Sie können schreibgeschütztes Routing umgehen, indem Sie die Verbindungseigenschaft der Anwendungsabsicht nicht auf `ReadOnly` festlegen (bei keiner Angabe während der Anmeldung lautet der Standard `ReadWrite`), oder indem Sie direkt eine Verbindung mit der primären Replikatinstanz von SQL Server herstellen, statt den Namen des Verfügbarkeitsgruppenlisteners zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-188">You can bypass read-only routing by not setting the application intent connection property to `ReadOnly` (when not designated, the default is `ReadWrite` during login) or by connecting directly to the primary replica instance of SQL Server instead of using the availability group listener name.</span></span>  <span data-ttu-id="6d3f6-189">Schreibgeschütztes Routing erfolgt auch dann nicht, wenn Sie eine direkte Verbindung mit einem schreibgeschützten Replikat herstellen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-189">Read-only routing will also not occur if you connect directly to a read-only replica.</span></span>  
  
####  <a name="related-tasks"></a><a name="RelatedTasksApps"></a> <span data-ttu-id="6d3f6-190">Verwandte Aufgaben</span><span class="sxs-lookup"><span data-stu-id="6d3f6-190">Related Tasks</span></span>  
  
-   [<span data-ttu-id="6d3f6-191">SQL Server Native Client-Unterstützung für hohe Verfügbarkeit, Notfallwiederherstellung</span><span class="sxs-lookup"><span data-stu-id="6d3f6-191">SQL Server Native Client Support for High Availability, Disaster Recovery</span></span>](../relational-databases/native-client/features/sql-server-native-client-support-for-high-availability-disaster-recovery.md)  
  
-   [<span data-ttu-id="6d3f6-192">Verwenden von Schlüsselwörtern für Verbindungszeichenfolgen mit SQL Server Native Client</span><span class="sxs-lookup"><span data-stu-id="6d3f6-192">Using Connection String Keywords with SQL Server Native Client</span></span>](../relational-databases/native-client/applications/using-connection-string-keywords-with-sql-server-native-client.md)  
  
##  <a name="bypassing-availability-group-listeners"></a><a name="BypassAGl"></a><span data-ttu-id="6d3f6-193">Umgehen der verfügbarkeitsgruppenlistener</span><span class="sxs-lookup"><span data-stu-id="6d3f6-193">Bypassing Availability Group Listeners</span></span>  
 <span data-ttu-id="6d3f6-194">Während Verfügbarkeitsgruppenlistener Unterstützung für Failoverumleitung und schreibgeschütztes Routing ermöglichen, müssen Clientverbindungen diese nicht verwenden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-194">While availability group listeners enable support for failover redirection and read-only routing, client connections are not required to use them.</span></span> <span data-ttu-id="6d3f6-195">Eine Clientverbindung kann auch direkt auf die Instanz von SQL Server verweisen, statt eine Verbindung mit dem Verfügbarkeitsgruppenlistener herzustellen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-195">A client connection can also directly reference the instance of SQL Server instead of connecting to the availability group listener.</span></span>  
  
 <span data-ttu-id="6d3f6-196">Es besteht kein Unterschied zur Instanz von SQL Server, unabhängig davon, ob die Verbindung mithilfe des Verfügbarkeitslisteners oder mithilfe eines anderen Instanzendpunkts angemeldet wird.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-196">To the instance of SQL Server it is irrelevant whether a connection logs in using the availability group listener or using another instance endpoint.</span></span>  <span data-ttu-id="6d3f6-197">Die Instanz von SQL Server überprüft den Status der Zieldatenbank und ermöglicht oder verweigert die Konnektivität basierend auf der Konfiguration der Verfügbarkeitsgruppe und dem aktuellen Status der Datenbank auf der Instanz.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-197">The instance of SQL Server will verify the state of the targeted database and either allow or disallow connectivity based on the configuration of the availability group and the current state of the database on the instance.</span></span>  <span data-ttu-id="6d3f6-198">Wenn z. B. eine Clientanwendung direkt eine Verbindung mit einer Instanz des SQL Server-Ports herstellt und eine Verbindung mit einer in einer Verfügbarkeitsgruppe gehosteten Zieldatenbank herstellt und die Zieldatenbank sich im primären Status befindet und online geschaltet ist, ist die Konnektivität erfolgreich.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-198">For example, if a client application connects directly to a instance of SQL Server port and connects to a target database hosted in an availability group, and the target database is in primary state and online, then connectivity will succeed.</span></span>  <span data-ttu-id="6d3f6-199">Ist die Zieldatenbank offline oder in einem Übergangsstatus, schlägt die Konnektivität zur Datenbank fehl.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-199">If the target database is offline or in a transitional state, connectivity to the database will fail.</span></span>  
  
 <span data-ttu-id="6d3f6-200">Alternativ können Anwendungen beim Migrieren von der Datenbankspiegelung zu [!INCLUDE[ssHADR](../includes/sshadr-md.md)]die Verbindungszeichenfolge für die Datenbankspiegelung angeben, sofern nur ein sekundäres Replikat vorhanden ist und Benutzerverbindungen unzulässig sind.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-200">Alternatively, while migrating from database mirroring to [!INCLUDE[ssHADR](../includes/sshadr-md.md)], applications can specify the database mirroring connection string as long as only one secondary replica exists and it disallows user connections.</span></span> <span data-ttu-id="6d3f6-201">Weitere Informationen finden Sie weiter unten in diesem Abschnitt unter [Verwenden von Verbindungszeichenfolgen für die Datenbankspiegelung mit Verfügbarkeitsgruppen](#DbmConnectionString).</span><span class="sxs-lookup"><span data-stu-id="6d3f6-201">For more information, see [Using Database-Mirroring Connection Strings with Availability Groups](#DbmConnectionString), later in this section.</span></span>  
  
###  <a name="using-database-mirroring-connection-strings-with-availability-groups"></a><a name="DbmConnectionString"></a><span data-ttu-id="6d3f6-202">Verwenden von Verbindungs Zeichenfolgen für die Daten Bank Spiegelung</span><span class="sxs-lookup"><span data-stu-id="6d3f6-202">Using Database-Mirroring Connection Strings with Availability Groups</span></span>  
 <span data-ttu-id="6d3f6-203">Wenn eine Verfügbarkeitsgruppe nur ein sekundäres Replikat besitzt und nicht konfiguriert wird, um Lesezugriff auf das sekundäre Verfügbarkeitsreplikat zuzulassen, können Clients mithilfe einer Verbindungszeichenfolge für die Datenbankspiegelung eine Verbindung mit dem primären Replikat herstellen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-203">If an availability group possesses only one secondary replica and is not configured to allow read-access to the secondary replica, clients can connect to the primary replica by using a database mirroring connection string.</span></span> <span data-ttu-id="6d3f6-204">Dieser Ansatz kann beim Migrieren einer vorhandenen Anwendung von der Datenbankspiegelung zu einer Verfügbarkeitsgruppe nützlich sein, sofern Sie die Verfügbarkeitsgruppe auf zwei Verfügbarkeitsreplikate (ein primäres und ein sekundäres Replikat) beschränken.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-204">This approach can be useful while migrating an existing application from database mirroring to an availability group, as long as you limit the availability group to two availability replicas (a primary replica and one secondary replica).</span></span> <span data-ttu-id="6d3f6-205">Wenn Sie zusätzliche sekundäre Replikate hinzufügen, müssen Sie einen Verfügbarkeitsgruppenlistener für die Verfügbarkeitsgruppe erstellen und die Anwendungen aktualisieren, damit der DNS-Name des Verfügbarkeitsgruppenlisteners verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-205">If you add additional secondary replicas, you will need to create an availability group listener for the availability group and update your applications to use the availability group listener DNS name.</span></span>  
  
 <span data-ttu-id="6d3f6-206">Wenn Sie die Verbindungszeichenfolgen der Datenbankspiegelung verwenden, kann der Client entweder [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client oder .NET Framework-Datenanbieter für [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)]verwenden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-206">When using database mirroring connection strings, the client can use either [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] Native Client or .NET Framework Data Provider for [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="6d3f6-207">Die von einem Client bereitgestellte Verbindungszeichenfolge muss mindestens den Namen einer Serverinstanz, den *ursprünglichen Partnernamen*, angeben, um die Serverinstanz zu identifizieren, auf der das Verfügbarkeitsreplikat, zu dem Sie eine Verbindung herstellen möchten, ursprünglich gehostet wird.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-207">The connection string provided by a client must minimally supply the name of one server instance, the *initial partner name*, to identify the server instance that initially hosts the availability replica to which you intend to connect.</span></span> <span data-ttu-id="6d3f6-208">Optional kann die Verbindungszeichenfolge auch den Namen einer anderen Serverinstanz, den *Failoverpartnernamen*, enthalten, um die Serverinstanz zu identifizieren, auf der das sekundäre Replikat ursprünglich gehostet wird.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-208">Optionally, the connection string can also supply the name of another server instance, the *failover partner name*, to identify the server instance that initially hosts the secondary replica as the failover partner name.</span></span>  
  
 <span data-ttu-id="6d3f6-209">Weitere Informationen zu Verbindungszeichenfolgen für die Datenbankspiegelung finden Sie unter [Verbinden von Clients mit einer Datenbank-Spiegelungssitzung &#40;SQL Server&#41;](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="6d3f6-209">For more information about database mirroring connection strings, see [Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md).</span></span>  
  
##  <a name="behavior-of-client-connections-on-failover"></a><a name="CCBehaviorOnFailover"></a><span data-ttu-id="6d3f6-210">Verhalten von Client Verbindungen beim Failover</span><span class="sxs-lookup"><span data-stu-id="6d3f6-210">Behavior of Client Connections on Failover</span></span>  
 <span data-ttu-id="6d3f6-211">Wenn ein Verfügbarkeitsgruppenfailover auftritt, werden vorhandene persistente Verbindungen zur Verfügbarkeitsgruppe beendet. Der Client muss eine neue Verbindung herstellen, um weiterhin dieselbe primäre Datenbank oder schreibgeschützte sekundäre Datenbank zu verwenden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-211">When an availability group failover occurs, existing persistent connections to the availability group are terminated and the client must establish a new connection in order to continue working with the same primary database or read-only secondary database.</span></span>  <span data-ttu-id="6d3f6-212">Während eines Failovers auf der Serverseite tritt bei der Verbindung zur Verfügbarkeitsgruppe möglicherweise ein Fehler auf, und die Clientanwendung wird gezwungen, erneut eine Verbindung herzustellen, bis die primäre Datenbank wieder vollständig online geschaltet ist.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-212">While a failover is occurring on the server side, connectivity to the availability group may fail, forcing the client application to retry connecting until the primary is brought fully back online.</span></span>  
  
 <span data-ttu-id="6d3f6-213">Wenn die Verfügbarkeitsgruppe während des Verbindungsversuchs einer Clientanwendung, jedoch vor dem Verbindungstimeout online geschaltet wird, stellt der Clienttreiber möglicherweise während einer der internen Wiederholungsversuche erfolgreich eine Verbindung her. In diesem Fall wird kein Fehler an die Anwendung ausgegeben.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-213">If the availability group comes back online during a client application's connection attempt but before the connect timeout period, the client driver may successfully connect during one of its internal retry attempts and no error will be surfaced to the application in this case.</span></span>  
  
##  <a name="supporting-availability-group-multi-subnet-failovers"></a><a name="SupportAgMultiSubnetFailover"></a> <span data-ttu-id="6d3f6-214">Unterstützen von Multisubnetz-Failovern für Verfügbarkeitsgruppen</span><span class="sxs-lookup"><span data-stu-id="6d3f6-214">Supporting Availability Group Multi-Subnet Failovers</span></span>  
 <span data-ttu-id="6d3f6-215">Wenn Sie Clientbibliotheken verwenden, die die Verbindungsoption „MultiSubnetFailover“ in der Verbindungszeichenfolge unterstützen, können Sie das Verfügbarkeitsgruppenfailover auf ein anderes Subnetz optimieren, indem Sie „MultiSubnetFailover“ je nach Syntax des verwendeten Anbieters auf „True“ oder „Yes“ festlegen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-215">If you are using client libraries that support the MultiSubnetFailover connection option in the connection string, you can optimize availability group failover to a different subnet by setting MultiSubnetFailover to "True" or "Yes", depending on the syntax of the provider you are using.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="6d3f6-216">Diese Einstellung wird für Verbindungen mit einem Subnetz und mehreren Subnetzen mit den Namen von Verfügbarkeitslistenern und SQL Server-Failoverclusterinstanzen empfohlen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-216">We recommend this setting for both single and multi-subnet connections to availability groups listeners and to SQL Server Failover Cluster Instance names.</span></span>  <span data-ttu-id="6d3f6-217">Wenn Sie diese Option aktivieren, stehen auch für Szenarien mit einem Subnetz weitere Optimierungen zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-217">Enabling this option adds additional optimizations, even for single-subnet scenarios.</span></span>  
  
 <span data-ttu-id="6d3f6-218">Die `MultiSubnetFailover`-Verbindungsoption funktioniert nur mit dem TCP-Netzwerkprotokoll und wird nur beim Herstellen einer Verbindung mit einem Verfügbarkeitsgruppenlistener und für beliebige virtuelle Netzwerknamen unterstützt, die eine Verbindung mit [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)] herstellen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-218">The `MultiSubnetFailover` connection option only works with the TCP network protocol and is only supported when connecting to an availability group listener and for any virtual network name connecting to [!INCLUDE[ssCurrent](../includes/sscurrent-md.md)].</span></span>  
  
 <span data-ttu-id="6d3f6-219">Beispiel für eine Verbindungszeichenfolge für den ADO.NET-Anbieter (System.Data.SqlClient) mit aktiviertem Multisubnetzfailover:</span><span class="sxs-lookup"><span data-stu-id="6d3f6-219">An example of a for the ADO.NET provider (System.Data.SqlClient) connection string that enables multi-subnet failover is as follows:</span></span>  
  
```  
Server=tcp:AGListener,1433;Database=AdventureWorks;IntegratedSecurity=SSPI; MultiSubnetFailover=True  
```  
  
 <span data-ttu-id="6d3f6-220">Die `MultiSubnetFailover`-Verbindungsoption sollte auf `True` festgelegt werden, auch wenn die Verfügbarkeitsgruppe nur ein einzelnes Subnetz umfasst.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-220">The `MultiSubnetFailover` connection option should be set to `True` even if the availability group only spans a single subnet.</span></span>  <span data-ttu-id="6d3f6-221">Dies ermöglicht es Ihnen, neue Clients vorzukonfigurieren, um künftig weitere Subnetze zu unterstützen, ohne dass die Clientverbindungszeichenfolgen geändert werden müssen. Darüber hinaus wird die Failoverleistung für Failover in einem Subnetz optimiert.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-221">This allows you to preconfigure new clients to support future spanning of subnets without any need for future client connection string changes and also optimizes failover performance for single subnet failovers.</span></span>  <span data-ttu-id="6d3f6-222">Die `MultiSubnetFailover`-Verbindungsoption ist zwar nicht erforderlich, bietet jedoch den Vorteil eines schnelleren Subnetzfailovers.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-222">While the `MultiSubnetFailover` connection option is not required, it does provide the benefit of a faster subnet failover.</span></span>  <span data-ttu-id="6d3f6-223">Das liegt daran, dass der Clienttreiber versucht, parallel ein TCP-Socket für alle der Verfügbarkeitsgruppe zugeordneten IP-Adressen zu öffnen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-223">This is because the client driver will attempt to open up a TCP socket for each IP address in parallel associated with the availability group.</span></span>  <span data-ttu-id="6d3f6-224">Der Clienttreiber wartet, bis die erste IP erfolgreich antwortet, und verwendet diese dann für die Verbindung.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-224">The client driver will wait for the first IP to respond with success and once it does, will then use it for the connection.</span></span>  
  
##  <a name="availability-group-listeners-and-ssl-certificates"></a><a name="SSLcertificates"></a> <span data-ttu-id="6d3f6-225">Verfügbarkeitsgruppenlistener und SSL-Zertifikate</span><span class="sxs-lookup"><span data-stu-id="6d3f6-225">Availability Group Listeners and SSL Certificates</span></span>  
 <span data-ttu-id="6d3f6-226">Wenn beim Herstellen einer Verbindung mit einem Verfügbarkeitsgruppenlistener die beteiligten Instanzen von SQL Server SSL-Zertifikate zusammen mit Sitzungsverschlüsselung verwenden, muss der Clienttreiber den alternativen Antragstellernamen im SSL-Zertifikat unterstützen, um die Verschlüsselung zu erzwingen.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-226">When connecting to an availability group listener, if the participating instances of SQL Server use SSL certificates in conjunction with session encryption, the connecting client driver will need to support the Subject Alternate Name in the SSL certificate in order to force encryption.</span></span>  <span data-ttu-id="6d3f6-227">SQL Server-Treiberunterstützung für den alternativen Antragstellernamen des Zertifikats ist für ADO.NET (SqlClient), Microsoft JDBC und SQL Native Client (SNAC) geplant.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-227">SQL Server driver support for certificate Subject Alternative Name is planned for ADO.NET (SqlClient), Microsoft JDBC and SQL Native Client (SNAC).</span></span>  
  
 <span data-ttu-id="6d3f6-228">Ein X.509-Zertifikat muss für alle beteiligten Serverknoten im Failovercluster mit einer Liste aller im alternativen Antragstellernamen des Zertifikats festgelegten Verfügbarkeitsgruppenlistenern konfiguriert werden.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-228">A X.509 certificate must be configured for each participating server node in the failover cluster with a list of all availability group listeners set in the Subject Alternate Name of the certificate.</span></span>  
  
 <span data-ttu-id="6d3f6-229">Wenn der WSFC z. B. drei Verfügbarkeitsgruppenlistener mit den Namen `AG1_listener.Adventure-Works.com`, `AG2_listener.Adventure-Works.com`und `AG3_listener.Adventure-Works.com`besitzt, sollte der alternative Antragstellername für das Zertifikat folgendermaßen festgelegt werden:</span><span class="sxs-lookup"><span data-stu-id="6d3f6-229">For example, if the WSFC has three availability group listeners with the names `AG1_listener.Adventure-Works.com`, `AG2_listener.Adventure-Works.com`, and `AG3_listener.Adventure-Works.com`, the Subject Alternative Name for the certificate should be set as follows:</span></span>  
  
```  
CN = ServerFQDN  
SAN = ServerFQDN,AG1_listener.Adventure-Works.com, AG2_listener.Adventure-Works.com, AG3_listener.Adventure-Works.com  
```  
  
##  <a name="availability-group-listeners-and-server-principal-names-spns"></a><a name="SPNs"></a><span data-ttu-id="6d3f6-230">Verfügbarkeitsgruppenlistener und Server Prinzipal Namen (SPNs)</span><span class="sxs-lookup"><span data-stu-id="6d3f6-230">Availability Group Listeners and Server Principal Names (SPNs)</span></span>  
 <span data-ttu-id="6d3f6-231">Ein Serverprinzipalname (SPN) muss in Active Directory von einem Domänenadministrator für alle Verfügbarkeitsgruppenlistener-Namen konfiguriert werden, um Kerberos für die Clientverbindung mit dem Verfügbarkeitsgruppenlistener zu aktivieren.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-231">A Server Principal Name (SPN) must be configured in Active Directory by a domain administrator for each availability group listener name in order to enable Kerberos for the client connection to the availability group listener.</span></span> <span data-ttu-id="6d3f6-232">Bei der Registrierung des Serverprinzipalnamens (SPN) müssen Sie das Dienstkonto derjenigen Serverinstanz verwenden, die das Verfügbarkeitsreplikat hostet.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-232">When registering the SPN, you must use the service account of the server instance that hosts the availability replica .</span></span>  <span data-ttu-id="6d3f6-233">Damit der SPN in allen Replikaten funktioniert, muss dasselbe Dienstkonto für alle Instanzen im WSFC-Cluster verwendet werden, der die Verfügbarkeitsgruppe hostet.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-233">For the SPN to work across all replicas, the same service account must be used for all instances in the WSFC cluster that hosts the availability group.</span></span>  
  
 <span data-ttu-id="6d3f6-234">Konfigurieren Sie den SPN mithilfe des `setspn` Windows-Befehlszeilentools.</span><span class="sxs-lookup"><span data-stu-id="6d3f6-234">Use the `setspn` Windows command line tool to configure the SPN.</span></span>  <span data-ttu-id="6d3f6-235">Beispiel für die Konfiguration eines Serverprinzipalnamens für die Verfügbarkeitsgruppe `AG1listener.Adventure-Works.com` , die auf einer Reihe von SQL Server-Instanzen gehostet wird und zur Ausführung unter dem Domänenkonto `corp/svclogin2`konfiguriert ist:</span><span class="sxs-lookup"><span data-stu-id="6d3f6-235">For example to configure an SPN for an availability group named `AG1listener.Adventure-Works.com` hosted on a set of instances of SQL Server all configured to run under the domain account `corp/svclogin2`:</span></span>  
  
```cmd
setspn -A MSSQLSvc/AG1listener.Adventure-Works.com:1433 corp/svclogin2  
```  
  
 <span data-ttu-id="6d3f6-236">Weitere Informationen zur manuellen Registrierung eines SPN für SQL Server finden Sie unter [Registrieren eines Dienstprinzipalnamens für Kerberos-Verbindungen](configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span><span class="sxs-lookup"><span data-stu-id="6d3f6-236">For more information about manual registration of a SPN for SQL Server, see [Register a Service Principal Name for Kerberos Connections](configure-windows/register-a-service-principal-name-for-kerberos-connections.md).</span></span>  
  
##  <a name="related-tasks"></a><a name="RelatedTasks"></a> <span data-ttu-id="6d3f6-237">Verwandte Aufgaben</span><span class="sxs-lookup"><span data-stu-id="6d3f6-237">Related Tasks</span></span>  
  
-   [<span data-ttu-id="6d3f6-238">AlwaysOn-Client Konnektivität &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6d3f6-238">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)
  
-   [<span data-ttu-id="6d3f6-239">Erstellen oder Konfigurieren eines Verfügbarkeitsgruppenlisteners &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6d3f6-239">Create or Configure an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/create-or-configure-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="6d3f6-240">Anzeigen von Eigenschaften des Verfügbarkeitsgruppenlisteners &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6d3f6-240">View Availability Group Listener Properties &#40;SQL Server&#41;</span></span>](availability-groups/windows/view-availability-group-listener-properties-sql-server.md)  
  
-   [<span data-ttu-id="6d3f6-241">Entfernen eines Verfügbarkeitsgruppenlisteners &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6d3f6-241">Remove an Availability Group Listener &#40;SQL Server&#41;</span></span>](availability-groups/windows/remove-an-availability-group-listener-sql-server.md)  
  
-   [<span data-ttu-id="6d3f6-242">Konfigurieren des schreibgeschützten Zugriffs auf ein Verfügbarkeitsreplikat &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6d3f6-242">Configure Read-Only Access on an Availability Replica &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-access-on-an-availability-replica-sql-server.md)  
  
-   [<span data-ttu-id="6d3f6-243">Konfigurieren des schreibgeschützten Routing für eine Verfügbarkeitsgruppe &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6d3f6-243">Configure Read-Only Routing for an Availability Group &#40;SQL Server&#41;</span></span>](availability-groups/windows/configure-read-only-routing-for-an-availability-group-sql-server.md)  
  
##  <a name="related-content"></a><a name="RelatedContent"></a> <span data-ttu-id="6d3f6-244">Verwandte Inhalte</span><span class="sxs-lookup"><span data-stu-id="6d3f6-244">Related Content</span></span>  
  
-   [<span data-ttu-id="6d3f6-245">Microsoft SQL Server AlwaysOn-Lösungshandbuch zu hoher Verfügbarkeit und Notfallwiederherstellung</span><span class="sxs-lookup"><span data-stu-id="6d3f6-245">Microsoft SQL Server AlwaysOn Solutions Guide for High Availability and Disaster Recovery</span></span>](https://go.microsoft.com/fwlink/?LinkId=227600)  
  
-   <span data-ttu-id="6d3f6-246">[Einführung in den Verfügbarkeitsgruppenlistener](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (SQL Server AlwaysOn-Teamblog)</span><span class="sxs-lookup"><span data-stu-id="6d3f6-246">[Introduction to the Availability Group Listener](https://blogs.msdn.com/b/sqlalwayson/archive/2012/01/16/introduction-to-the-availability-group-listener.aspx) (a SQL Server AlwaysOn team blog)</span></span>  
  
-   [<span data-ttu-id="6d3f6-247">SQL Server AlwaysOn-Teamblog: Der offizielle SQL Server AlwaysOn-Teamblog</span><span class="sxs-lookup"><span data-stu-id="6d3f6-247">SQL Server AlwaysOn Team Blog: The official SQL Server AlwaysOn Team Blog</span></span>](https://blogs.msdn.com/b/sqlalwayson/)  
  
## <a name="see-also"></a><span data-ttu-id="6d3f6-248">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="6d3f6-248">See Also</span></span>  
 <span data-ttu-id="6d3f6-249">[Übersicht über AlwaysOn-Verfügbarkeitsgruppen &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="6d3f6-249">[Overview of AlwaysOn Availability Groups &#40;SQL Server&#41;](availability-groups/windows/overview-of-always-on-availability-groups-sql-server.md) </span></span>  
 [<span data-ttu-id="6d3f6-250">AlwaysOn-Client Konnektivität &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6d3f6-250">AlwaysOn Client Connectivity &#40;SQL Server&#41;</span></span>](availability-groups/windows/always-on-client-connectivity-sql-server.md)  
 <span data-ttu-id="6d3f6-251">[Informationen zum Clientverbindungszugriff auf Verfügbarkeitsreplikate &#40;SQL Server&#41;](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="6d3f6-251">[About Client Connection Access to Availability Replicas &#40;SQL Server&#41;](availability-groups/windows/about-client-connection-access-to-availability-replicas-sql-server.md) </span></span>  
 <span data-ttu-id="6d3f6-252">[Aktive sekundäre Replikate: lesbare sekundäre Replikate &#40;AlwaysOn-Verfügbarkeitsgruppen&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span><span class="sxs-lookup"><span data-stu-id="6d3f6-252">[Active Secondaries: Readable Secondary Replicas &#40;AlwaysOn Availability Groups&#41;](availability-groups/windows/active-secondaries-readable-secondary-replicas-always-on-availability-groups.md) </span></span>  
 [<span data-ttu-id="6d3f6-253">Verbinden von Clients mit einer Datenbank-Spiegelungssitzung &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="6d3f6-253">Connect Clients to a Database Mirroring Session &#40;SQL Server&#41;</span></span>](database-mirroring/connect-clients-to-a-database-mirroring-session-sql-server.md)
