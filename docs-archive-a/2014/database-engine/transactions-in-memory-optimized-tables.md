---
title: Transaktionen in Speicher optimierten Tabellen | Microsoft-Dokumentation
ms.custom: ''
ms.date: 03/06/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: in-memory-oltp
ms.topic: conceptual
ms.assetid: 2cd07d26-a1f1-4034-8d6f-f196eed1b763
author: stevestein
ms.author: sstein
ms.openlocfilehash: bc9109c7243e609e5ddd820b61386183761167bf
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87726153"
---
# <a name="transactions-in-memory-optimized-tables"></a><span data-ttu-id="98769-102">Transaktionen in speicheroptimierten Tabellen</span><span class="sxs-lookup"><span data-stu-id="98769-102">Transactions in Memory-Optimized Tables</span></span>
  <span data-ttu-id="98769-103">Die Zeilenversionsverwaltung für datenträgerbasierte Tabellen (mit SNAPSHOT-Isolation oder READ_COMMITTED_SNAPSHOT) bietet eine Form der optimistischen Nebenläufigkeitssteuerung.</span><span class="sxs-lookup"><span data-stu-id="98769-103">Row versioning on disk-based tables (using SNAPSHOT isolation or READ_COMMITTED_SNAPSHOT) provides a form of optimistic concurrency control.</span></span> <span data-ttu-id="98769-104">Lese- und Schreibvorgänge blockieren sich nicht.</span><span class="sxs-lookup"><span data-stu-id="98769-104">Readers and writers do not block each other.</span></span> <span data-ttu-id="98769-105">Bei speicheroptimierten Tabellen blockieren sich Schreibvorgänge nicht gegenseitig.</span><span class="sxs-lookup"><span data-stu-id="98769-105">With memory-optimized tables, writers do not block writers.</span></span> <span data-ttu-id="98769-106">Bei der Zeilenversionsverwaltung für datenträgerbasierte Tabellen wird die Zeile durch eine Transaktion gesperrt, während gleichzeitige Transaktionen, die die Zeile zu aktualisieren versuchen, blockiert werden.</span><span class="sxs-lookup"><span data-stu-id="98769-106">With row versioning on disk-based tables, one transaction locks the row and concurrent transactions attempting to update the row are blocked.</span></span> <span data-ttu-id="98769-107">Bei speicheroptimierten Tabellen werden keine Sperren festgelegt.</span><span class="sxs-lookup"><span data-stu-id="98769-107">There is no locking with memory-optimized tables.</span></span> <span data-ttu-id="98769-108">Stattdessen führt der Versuch von zwei Transaktionen, dieselbe Zeile zu aktualisieren, zu einem Schreibkonflikt (Fehler 41302).</span><span class="sxs-lookup"><span data-stu-id="98769-108">Instead, if two transactions attempt to update the same row, a write/write conflict (error 41302) will occur.</span></span>

 <span data-ttu-id="98769-109">Im Gegensatz zu datenträgerbasierten Tabellen ermöglichen speicheroptimierte Tabellen die optimistische Nebenläufigkeitssteuerung mit den höheren Isolationsstufen REPEATABLE READ und SERIALIZABLE.</span><span class="sxs-lookup"><span data-stu-id="98769-109">Unlike disk-based tables, memory-optimized tables allow optimistic concurrency control with the higher isolation levels, REPEATABLE READ and SERIALIZABLE.</span></span> <span data-ttu-id="98769-110">Isolationsstufen werden nicht mit Sperren erzwungen.</span><span class="sxs-lookup"><span data-stu-id="98769-110">Locks are not taken to enforce the isolation levels.</span></span> <span data-ttu-id="98769-111">Stattdessen werden bei Transaktionsende mit einer Überprüfung die REPEATABLE READ- oder SERIALIZABLE-Annahmen sichergestellt.</span><span class="sxs-lookup"><span data-stu-id="98769-111">Instead, at the end of the transaction validation ensures the repeatable read or serializability assumptions.</span></span> <span data-ttu-id="98769-112">Wenn ein Verstoß gegen die Annahmen ermittelt wird, wird die Transaktion beendet.</span><span class="sxs-lookup"><span data-stu-id="98769-112">If the assumptions are violated, the transaction is terminated.</span></span> <span data-ttu-id="98769-113">Weitere Informationen finden Sie unter [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md).</span><span class="sxs-lookup"><span data-stu-id="98769-113">For more information, see [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md).</span></span>

 <span data-ttu-id="98769-114">Die relevanten Transaktionssemantiken für speicheroptimierte Tabellen lauten:</span><span class="sxs-lookup"><span data-stu-id="98769-114">The important transaction semantics for memory-optimized tables are:</span></span>

-   <span data-ttu-id="98769-115">Multiversionsverwaltung</span><span class="sxs-lookup"><span data-stu-id="98769-115">Multi-versioning</span></span>

-   <span data-ttu-id="98769-116">Transaktionsisolation auf Basis einer Momentaufnahme</span><span class="sxs-lookup"><span data-stu-id="98769-116">Snapshot-based transaction isolation</span></span>

-   <span data-ttu-id="98769-117">Optimistisch</span><span class="sxs-lookup"><span data-stu-id="98769-117">Optimistic</span></span>

-   <span data-ttu-id="98769-118">Konflikterkennung</span><span class="sxs-lookup"><span data-stu-id="98769-118">Conflict detection</span></span>

 <span data-ttu-id="98769-119">Diese Semantiken werden in den folgenden Abschnitten im einzelnen erklärt.</span><span class="sxs-lookup"><span data-stu-id="98769-119">Each of these semantics is explained in the following sections.</span></span>

## <a name="multi-versioning-in-memory-optimized-tables"></a><span data-ttu-id="98769-120">Multiversionsverwaltung in speicheroptimierten Tabellen</span><span class="sxs-lookup"><span data-stu-id="98769-120">Multi-Versioning in Memory-Optimized Tables</span></span>
 <span data-ttu-id="98769-121">Zeilen in speicheroptimierten Tabellen können verschiedene Versionen enthalten.</span><span class="sxs-lookup"><span data-stu-id="98769-121">Rows in memory-optimized tables can have different versions.</span></span> <span data-ttu-id="98769-122">Gleichzeitige Transaktionen greifen auf unterschiedliche Versionen derselben Zeile zu.</span><span class="sxs-lookup"><span data-stu-id="98769-122">Concurrent transactions access potentially different versions of the same row.</span></span>

 <span data-ttu-id="98769-123">Speicheroptimierte Tabellendaten sind versionsbasiert.</span><span class="sxs-lookup"><span data-stu-id="98769-123">Memory-optimized table data is version-based.</span></span> <span data-ttu-id="98769-124">Für jede Zeile kann es unterschiedliche Versionen geben, die zu unterschiedlichen Zeitpunkten gültig sind.</span><span class="sxs-lookup"><span data-stu-id="98769-124">For any row there may be different row versions that are valid at different points in time.</span></span> <span data-ttu-id="98769-125">Wenn READ_COMMITTED_SNAPSHOT oder ALLOW_SNAPSHOT_ISOLATION auf ON festgelegt ist, werden in datenträgerbasierten Tabellen unterschiedliche Zeilenversionen verwaltet.</span><span class="sxs-lookup"><span data-stu-id="98769-125">Disk-based tables maintain different row versions when READ_COMMITTED_SNAPSHOT or ALLOW_SNAPSHOT_ISOLATION is ON.</span></span> <span data-ttu-id="98769-126">Speicheroptimierte Tabellen verwalten selbst dann unterschiedliche Zeilenversionen, wenn READ_COMMITTED_SNAPSHOT und ALLOW_SNAPSHOT_ISOLATION auf OFF festgelegt sind.</span><span class="sxs-lookup"><span data-stu-id="98769-126">Memory-optimized tables maintain different row versions, even if READ_COMMITTED_SNAPSHOT and ALLOW_SNAPSHOT_ISOLATION are OFF.</span></span> <span data-ttu-id="98769-127">Die Zeilenversionen aus speicheroptimierten Tabellen werden nicht in tempdb verwaltet.</span><span class="sxs-lookup"><span data-stu-id="98769-127">The row versions of memory-optimized tables are not maintained in tempdb.</span></span> <span data-ttu-id="98769-128">Stattdessen werden die Zeilenversionen inline als Teil der speicheroptimierten Datenstrukturen verwaltet, in denen die Zeilen im Arbeitsspeicher gespeichert werden.</span><span class="sxs-lookup"><span data-stu-id="98769-128">Instead, the row versions are maintained in-line, as part of the memory-optimized data structures storing the rows in memory.</span></span>

## <a name="snapshot-based-transaction-isolation-for-memory-optimized-tables"></a><span data-ttu-id="98769-129">Transaktionsisolation auf Basis einer Momentaufnahme für speicheroptimierte Tabellen</span><span class="sxs-lookup"><span data-stu-id="98769-129">Snapshot-Based Transaction Isolation for Memory-Optimized Tables</span></span>
 <span data-ttu-id="98769-130">Alle Vorgänge in einer einzelnen Transaktion verwenden dieselbe im Hinblick auf Transaktionen konsistente Momentaufnahme der speicheroptimierten Tabellen.</span><span class="sxs-lookup"><span data-stu-id="98769-130">All operations in a single transaction use the same transactionally-consistent snapshot of the memory-optimized tables.</span></span> <span data-ttu-id="98769-131">Jegliche Transaktionsisolation für speicheroptimierte Tabellen beruht auf einer Momentaufnahme.</span><span class="sxs-lookup"><span data-stu-id="98769-131">All transaction isolation for memory-optimized tables is snapshot-based.</span></span> <span data-ttu-id="98769-132">Beispielsweise führt eine Transaktion, die die Serializable-Isolationsstufe für den Zugriff auf speicheroptimierte Tabellen nutzt, alle Vorgänge auf Grundlage ein und derselben, in der Transaktionen konsistenten Momentaufnahme durch.</span><span class="sxs-lookup"><span data-stu-id="98769-132">For example, a transaction using the serializable isolation level to access memory-optimized tables will perform all operations on the same transactionally consistent snapshot.</span></span>

 <span data-ttu-id="98769-133">Transaktionen, die auf speicheroptimierte Tabellen zugreifen, verwenden die Zeilenversionsverwaltung, um eine transaktionskonsistente Momentaufnahme der Zeilen in den Tabellen zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="98769-133">Transactions that access memory-optimized tables use this row versioning to obtain a transactionally consistent snapshot of the rows in the tables.</span></span> <span data-ttu-id="98769-134">Alle Anweisungen in einer Transaktion lesen eine transaktionskonsistente Version der Daten, wie sie zu Transaktionsbeginn vorlagen.</span><span class="sxs-lookup"><span data-stu-id="98769-134">The data read by any statement in the transaction will be the transactionally consistent version of the data that existed at the time the transaction started.</span></span> <span data-ttu-id="98769-135">Daher sind Änderungen durch gleichzeitig ausgeführte Transaktionen für Anweisungen in der aktuellen Transaktion nicht sichtbar.</span><span class="sxs-lookup"><span data-stu-id="98769-135">Therefore, any modifications made by concurrently running transactions are not visible to statements in the current transaction.</span></span>

## <a name="optimistic-concurrency-control-for-memory-optimized-tables"></a><span data-ttu-id="98769-136">Optimistische Nebenläufigkeitssteuerung bei speicheroptimierten Tabellen</span><span class="sxs-lookup"><span data-stu-id="98769-136">Optimistic Concurrency Control for Memory-Optimized Tables</span></span>
 <span data-ttu-id="98769-137">Konflikte und Fehler sind selten, und bei Transaktionen für speicheroptimierte Tabellen wird davon ausgegangen, dass keine Konflikte bei gleichzeitigen Transaktionen auftreten und die Ausführung erfolgreich ist.</span><span class="sxs-lookup"><span data-stu-id="98769-137">Conflicts and failures are rare and transactions on memory-optimized tables assume there are no conflicts with concurrent transactions and operations succeed.</span></span> <span data-ttu-id="98769-138">Transaktionen verwenden keine Sperren oder Latches für speicheroptimierte Tabellen, um Transaktionsisolation zu gewährleisten.</span><span class="sxs-lookup"><span data-stu-id="98769-138">Transactions do not take locks or latches on memory-optimized table to guarantee transaction isolation.</span></span> <span data-ttu-id="98769-139">Lesevorgänge werden nicht durch Schreibvorgänge blockiert.</span><span class="sxs-lookup"><span data-stu-id="98769-139">Writers do not block readers.</span></span> <span data-ttu-id="98769-140">Schreibvorgänge blockieren sich nicht gegenseitig.</span><span class="sxs-lookup"><span data-stu-id="98769-140">Writers do not block writers.</span></span> <span data-ttu-id="98769-141">Stattdessen werden die Transaktionen unter der (optimistischen) Annahme ausgeführt, dass keine Konflikte mit anderen Transaktionen bestehen.</span><span class="sxs-lookup"><span data-stu-id="98769-141">Instead, transactions proceed under the (optimistic) assumption that there will be no conflicts with other transactions.</span></span> <span data-ttu-id="98769-142">Da keine Sperren und Latches verwendet werden und nicht darauf gewartet wird, dass andere Transaktionen die Verarbeitung derselben Zeilen abschließen, verbessert sich die Leistung.</span><span class="sxs-lookup"><span data-stu-id="98769-142">Not using locks and latches and not waiting for other transactions to finish processing the same rows improves performance.</span></span>

 <span data-ttu-id="98769-143">Wenn darüber hinaus von einer Transaktion (TxA) Zeilen gelesen werden, die von einer anderen Transaktion (TxB) eingefügt oder bearbeitet wurden und für die gerade ein Commit ausgeführt wird, wartet die Transaktion nicht auf den Commit, sondern geht optimistisch davon aus, dass die andere Transaktion einen Commit ausführen wird.</span><span class="sxs-lookup"><span data-stu-id="98769-143">In addition, if a transaction (TxA) reads rows that have been inserted or modified by another transaction (TxB) that is in the process of committing, it will optimistically assume the other transaction will commit rather than wait for the commit to occur.</span></span> <span data-ttu-id="98769-144">In diesem Fall übernimmt Transaktion TxA eine Abhängigkeit vom Commit der Transaktion TxB.</span><span class="sxs-lookup"><span data-stu-id="98769-144">In this case, transaction TxA will take a commit dependency on transaction TxB.</span></span>

## <a name="conflict-detection-validation-and-commit-dependency-checks"></a><span data-ttu-id="98769-145">Konflikterkennung, Überprüfung und Commitabhängigkeitsüberprüfungen</span><span class="sxs-lookup"><span data-stu-id="98769-145">Conflict Detection, Validation, and Commit Dependency Checks</span></span>
 [!INCLUDE[ssNoVersion](../includes/ssnoversion-md.md)] <span data-ttu-id="98769-146">erkennt Konflikte zwischen gleichzeitigen Transaktionen sowie Verletzungen der Isolationsstufe und verwirft eine der in Konflikt stehenden Transaktionen.</span><span class="sxs-lookup"><span data-stu-id="98769-146">detects conflicts between concurrent transactions, as well as isolation level violations, and will doom one of the conflicting transactions.</span></span> <span data-ttu-id="98769-147">Diese Transaktion muss erneut ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="98769-147">This transaction will need to be retried.</span></span> <span data-ttu-id="98769-148">(Weitere Informationen finden Sie unter [Richtlinien für Wiederholungs Logik für Transaktionen in Speicher optimierten Tabellen](../relational-databases/in-memory-oltp/memory-optimized-tables.md).)</span><span class="sxs-lookup"><span data-stu-id="98769-148">(For more information, see [Guidelines for Retry Logic for Transactions on Memory-Optimized Tables](../relational-databases/in-memory-oltp/memory-optimized-tables.md).)</span></span>

 <span data-ttu-id="98769-149">Das System nimmt optimistisch an, dass keine Konflikte und keine Verstöße gegen die Transaktionsisolation vorliegen.</span><span class="sxs-lookup"><span data-stu-id="98769-149">The system optimistically assumes there are no conflicts and no violations of transaction isolation.</span></span> <span data-ttu-id="98769-150">Falls Konflikte auftreten, die Inkonsistenzen in der Datenbank verursachen oder die Transaktionsisolation verletzen könnten, werden diese Konflikte ermittelt und die Transaktion beendet.</span><span class="sxs-lookup"><span data-stu-id="98769-150">If any conflicts occur that may cause inconsistencies in the database or that may violate transaction isolation, these conflicts are detected, and the transaction is terminated.</span></span>

 <span data-ttu-id="98769-151">Wenn ein Konflikt erkannt wird, wird die Transaktion beendet und muss vom Client wiederholt werden.</span><span class="sxs-lookup"><span data-stu-id="98769-151">If a conflict is detected, the transaction is terminated and the client needs to retry.</span></span>

 <span data-ttu-id="98769-152">In der folgenden Tabelle werden Fehlerbedingungen für Transaktionen zusammengefasst, die auf speicheroptimierte Tabellen zugreifen.</span><span class="sxs-lookup"><span data-stu-id="98769-152">The following table summarizes the error conditions for transactions that accesses memory-optimized tables.</span></span>

### <a name="error-conditions-for-transactions-accessing-memory-optimized-tables"></a><span data-ttu-id="98769-153">Fehlerbedingungen für Transaktionen, die auf speicheroptimierte Tabellen zugreifen.</span><span class="sxs-lookup"><span data-stu-id="98769-153">Error conditions for transactions accessing memory-optimized tables.</span></span>

|<span data-ttu-id="98769-154">Fehler</span><span class="sxs-lookup"><span data-stu-id="98769-154">Error</span></span>|<span data-ttu-id="98769-155">Szenario</span><span class="sxs-lookup"><span data-stu-id="98769-155">Scenario</span></span>|
|-----------|--------------|
|<span data-ttu-id="98769-156">Schreibkonflikt.</span><span class="sxs-lookup"><span data-stu-id="98769-156">Write conflict.</span></span> <span data-ttu-id="98769-157">Es wurde versucht, einen Datensatz zu aktualisieren, der seit Transaktionsbeginn geändert wurde.</span><span class="sxs-lookup"><span data-stu-id="98769-157">Attempting to update a record that has been updated since the transaction started.</span></span>|<span data-ttu-id="98769-158">Für eine Zeile, die durch eine gleichzeitige Transaktion aktualisiert oder gelöscht wurde, werden die Befehle UPDATE oder DELETE ausgegeben.</span><span class="sxs-lookup"><span data-stu-id="98769-158">UPDATE or DELETE a row that has been updated or deleted by a concurrent transaction.</span></span>|
|<span data-ttu-id="98769-159">REPEATABLE READ-Überprüfungsfehler.</span><span class="sxs-lookup"><span data-stu-id="98769-159">Repeatable read validation failure.</span></span>|<span data-ttu-id="98769-160">Eine von der Transaktion gelesene Zeile wurde nach Transaktionsbeginn geändert (aktualisiert oder gelöscht).</span><span class="sxs-lookup"><span data-stu-id="98769-160">A row that was read by the transaction has changed (updated or deleted) since the transaction started.</span></span> <span data-ttu-id="98769-161">Die REPEATABLE READ-Überprüfung tritt in der Regel bei Verwendung der Transaktionsisolationsstufen REPEATABLE READ und SERIALIZABLE auf.</span><span class="sxs-lookup"><span data-stu-id="98769-161">Repeatable read validation is typically occurs when using REPEATABLE READ and SERIALIZABLE transaction isolation levels.</span></span>|
|<span data-ttu-id="98769-162">SERIALIZABLE-Überprüfungsfehler.</span><span class="sxs-lookup"><span data-stu-id="98769-162">Serializable validation failure.</span></span>|<span data-ttu-id="98769-163">Eine neue (Phantom-)Zeile wurde nach Transaktionsbeginn in einen der Scanbereiche der Transaktion eingefügt.</span><span class="sxs-lookup"><span data-stu-id="98769-163">A new (phantom) row has been inserted in one of the scan ranges in the transaction, since the transaction started.</span></span> <span data-ttu-id="98769-164">Die Zeile wäre für die Transaktion sichtbar gewesen, wenn für diese vor Transaktionsbeginn in der Datenbank ein Commit ausgeführt worden wäre.</span><span class="sxs-lookup"><span data-stu-id="98769-164">The row would have been visible to the transaction if the row had been committed to the database before the transaction started.</span></span> <span data-ttu-id="98769-165">Die SERIALIZABLE-Überprüfung tritt in der Regel bei Verwendung der SERIALIZABLE-Isolation und Überprüfung von PRIMARY KEY-Einschränkungen auf.</span><span class="sxs-lookup"><span data-stu-id="98769-165">SERIALIZABLE validation typically occurs when using SERIALIZABLE isolation and validating PRIMARY KEY constraints.</span></span>|
|<span data-ttu-id="98769-166">Commitabhängigkeitsfehler.</span><span class="sxs-lookup"><span data-stu-id="98769-166">Commit dependency failure.</span></span>|<span data-ttu-id="98769-167">Die Transaktion hat eine Abhängigkeit von einer anderen Transaktion übernommen, für die kein Commit ausgeführt werden konnte, entweder wegen eines Fehlers in dieser Tabelle, weil nicht genügend Arbeitsspeicher verfügbar war oder weil der Commit im Transaktionsprotokoll fehlgeschlagen ist.</span><span class="sxs-lookup"><span data-stu-id="98769-167">The transaction took a dependency on another transaction that failed to commit, either due to one of the failures in this table, an out-of-memory condition, or due to failure to commit to the transaction log.</span></span> <span data-ttu-id="98769-168">Ein derartiger Fehler kann bei Transaktionen mit Lese-/Schreibzugriff wie auch bei schreibgeschützten Transaktionen auftreten.</span><span class="sxs-lookup"><span data-stu-id="98769-168">This failure can occur with both read/write and read-only transactions.</span></span>|

### <a name="transaction-lifetime"></a><span data-ttu-id="98769-169">Lebensdauer von Transaktionen</span><span class="sxs-lookup"><span data-stu-id="98769-169">Transaction Lifetime</span></span>
 <span data-ttu-id="98769-170">Die in der vorherigen Tabelle beschriebenen Fehler können zu unterschiedlichen Zeitpunkten während einer Transaktion auftreten.</span><span class="sxs-lookup"><span data-stu-id="98769-170">The failures mentioned in the previous table can occur at different points during a transaction.</span></span> <span data-ttu-id="98769-171">In der folgenden Abbildung werden die Phasen einer Transaktion dargestellt, die auf speicheroptimierte Tabellen zugreift.</span><span class="sxs-lookup"><span data-stu-id="98769-171">The following figure illustrates the phases of a transaction that accesses memory-optimized tables.</span></span>

 <span data-ttu-id="98769-172">![Lebensdauer einer Transaktion.](../../2014/database-engine/media/hekaton-transactions.gif "Lebensdauer einer Transaktion.")</span><span class="sxs-lookup"><span data-stu-id="98769-172">![Lifetime of a transaction.](../../2014/database-engine/media/hekaton-transactions.gif "Lifetime of a transaction.")</span></span>
<span data-ttu-id="98769-173">Lebensdauer einer Transaktion, die auf speicheroptimierte Tabellen zugreift.</span><span class="sxs-lookup"><span data-stu-id="98769-173">Lifetime of a transaction that accesses memory-optimized tables.</span></span>

#### <a name="regular-processing"></a><span data-ttu-id="98769-174">Reguläre Verarbeitung</span><span class="sxs-lookup"><span data-stu-id="98769-174">Regular Processing</span></span>
 <span data-ttu-id="98769-175">Während dieser Phase werden die durch den Benutzer ausgegebenen [!INCLUDE[tsql](../includes/tsql-md.md)]-Anweisungen ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="98769-175">During this phase, the user-issued [!INCLUDE[tsql](../includes/tsql-md.md)] statements are executed.</span></span> <span data-ttu-id="98769-176">Zeilen werden aus den Tabellen gelesen, und neue Zeilenversionen werden in die Datenbank geschrieben.</span><span class="sxs-lookup"><span data-stu-id="98769-176">Rows are read from the tables, and new row versions are written to the database.</span></span> <span data-ttu-id="98769-177">Die Transaktion wird von allen anderen gleichzeitigen Transaktionen isoliert.</span><span class="sxs-lookup"><span data-stu-id="98769-177">The transaction is isolated from all other concurrent transactions.</span></span> <span data-ttu-id="98769-178">Die Transaktion verwendet die Momentaufnahme der speicheroptimierten Tabellen, die zu Transaktionsbeginn vorhanden ist.</span><span class="sxs-lookup"><span data-stu-id="98769-178">The transaction uses the snapshot of the memory-optimized tables that exists at the start of the transaction.</span></span>

 <span data-ttu-id="98769-179">Schreibvorgänge, die in dieser Phase der Transaktion in den Tabellen ausgeführt werden, sind für andere Transaktionen noch nicht sichtbar. Eine Ausnahme hiervon bilden Zeilenupdates und -löschungen, die für Update- und Löschvorgänge in anderen Transaktionen sichtbar sind, damit Schreibkonflikte erkannt werden können.</span><span class="sxs-lookup"><span data-stu-id="98769-179">Writes to the tables in this phase of the transaction are not yet visible to other transactions, with one exception: row updates and deletes are visible to update and delete operations in other transactions, in order to detect write conflicts.</span></span>

 <span data-ttu-id="98769-180">Wenn bei einem Update- oder Löschvorgang festgestellt wird, dass eine Zeile seit dem logischen Beginn der Transaktion aktualisiert oder gelöscht wurde, schlägt der Vorgang mit Fehler 41302 fehl.</span><span class="sxs-lookup"><span data-stu-id="98769-180">If an update or delete operation sees that a row has been updated or deleted since the logical start of the transaction, the operation will fail with error 41302.</span></span> <span data-ttu-id="98769-181">Die Fehlermeldung 41302 lautet: "Für die aktuelle Transaktion wurde versucht, einen Datensatz in der Tabelle X zu aktualisieren, der aktualisiert wurde, nachdem diese Transaktion gestartet wurde.</span><span class="sxs-lookup"><span data-stu-id="98769-181">The message for error 41302 is "The current transaction attempted to update a record in table X that has been updated since this transaction started.</span></span> <span data-ttu-id="98769-182">Die Anweisung wurde abgebrochen."</span><span class="sxs-lookup"><span data-stu-id="98769-182">The transaction was aborted."</span></span>

 <span data-ttu-id="98769-183">Dieser Fehler führt zu einem Transaktionsabbruch (selbst wenn XACT_ABORT auf OFF festgelegt ist). Dies bedeutet, dass bei Beendigung der Benutzersitzung ein Rollback für die Transaktion ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="98769-183">This error dooms the transaction (even if XACT_ABORT is OFF), meaning that the transaction will be rolled back when the user session ends.</span></span> <span data-ttu-id="98769-184">Für fehlgeschlagene Transaktionen kann kein Commit ausgeführt werden, und sie unterstützen nur Lesevorgänge, durch die nicht in das Protokoll geschrieben und auf speicheroptimierte Tabellen zugegriffen wird.</span><span class="sxs-lookup"><span data-stu-id="98769-184">Doomed transactions cannot be committed and only support read operations that do not write to the log and do not access memory-optimized tables.</span></span>

#####  <a name="commit-dependencies"></a><a name="cd"></a><span data-ttu-id="98769-185">Commit-Abhängigkeiten</span><span class="sxs-lookup"><span data-stu-id="98769-185">Commit Dependencies</span></span>
 <span data-ttu-id="98769-186">Während der regulären Verarbeitung kann eine Transaktion Zeilen von anderen Transaktionen lesen, die sich in der Überprüfungs- oder Commitphase befinden, deren Commit jedoch noch nicht abgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="98769-186">During regular processing, a transaction can read rows written by other transactions that are in the validation or commit phase, but have not yet committed.</span></span> <span data-ttu-id="98769-187">Die Zeilen sind sichtbar, da der logische Endzeitpunkt der Transaktionen beim Start der Überprüfungsphase zugewiesen wurde.</span><span class="sxs-lookup"><span data-stu-id="98769-187">The rows are visible because the logical end time of the transactions has been assigned at the start of the validation phase.</span></span>

 <span data-ttu-id="98769-188">Wenn Zeilen, für die kein Commit ausgeführt wurde, von einer Transaktion gelesen werden, übernimmt sie eine Commitabhängigkeit von dieser Transaktion.</span><span class="sxs-lookup"><span data-stu-id="98769-188">If a transaction reads such uncommitted rows, it will take a commit dependency on that transaction.</span></span> <span data-ttu-id="98769-189">Dies hat zwei wesentliche Auswirkungen:</span><span class="sxs-lookup"><span data-stu-id="98769-189">This has two main implications:</span></span>

-   <span data-ttu-id="98769-190">Für eine Transaktion kann erst ein Commit ausgeführt werden, nachdem für die Transaktionen, von denen sie abhängt, ein Commit ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="98769-190">A transaction cannot commit until the transactions it depends on have committed.</span></span> <span data-ttu-id="98769-191">Dies bedeutet, das sie die Commitphase erst erreicht, wenn alle Abhängigkeiten aufgelöst sind.</span><span class="sxs-lookup"><span data-stu-id="98769-191">In other words, it cannot enter the commit phase, until all dependencies have cleared.</span></span>

-   <span data-ttu-id="98769-192">Außerdem werden keine Resultsets an den Client zurückgegeben, bis alle Abhängigkeiten aufgelöst sind.</span><span class="sxs-lookup"><span data-stu-id="98769-192">In addition, result sets are not returned to the client until all dependencies have cleared.</span></span> <span data-ttu-id="98769-193">Dies stellt sicher, dass der Client keine Daten beachtet, für die noch kein Commit ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="98769-193">This prevents the client from observing uncommitted data.</span></span>

 <span data-ttu-id="98769-194">Wenn für eine der abhängigen Transaktionen kein Commit ausgeführt wird, liegt ein Commitabhängigkeitsfehler vor.</span><span class="sxs-lookup"><span data-stu-id="98769-194">If any of the dependent transactions fails to commit, there is a commit dependency failure.</span></span> <span data-ttu-id="98769-195">Dies bedeutet, dass für die Transaktion mit Fehler 41301 kein Commit ausgeführt werden kann. ("Eine vorherige Transaktion, von der die aktuelle Transaktion abhängig ist, wurde abgebrochen, sodass für die aktuelle Transaktion kein Commit mehr ausgeführt werden kann.")</span><span class="sxs-lookup"><span data-stu-id="98769-195">This means the transaction will fail to commit with error 41301 ("A previous transaction that the current transaction took a dependency on has aborted, and the current transaction can no longer commit.").</span></span>

#### <a name="validation-phase"></a><span data-ttu-id="98769-196">Überprüfungsphase</span><span class="sxs-lookup"><span data-stu-id="98769-196">Validation Phase</span></span>
 <span data-ttu-id="98769-197">Während der Überprüfungsphase überprüft das System, ob die für die angeforderte Transaktionsisolationsstufe erforderlichen Annahmen zwischen dem logischen Start und dem logischen Ende der Transaktion zutreffend waren.</span><span class="sxs-lookup"><span data-stu-id="98769-197">During the validation phase, the system validates that the assumptions necessary for the requested transaction isolation level were true between the logical start and logical end of the transaction.</span></span>

 <span data-ttu-id="98769-198">Zu Beginn der Überprüfungsphase wird der Transaktion ein logischer Endzeitpunkt zugewiesen.</span><span class="sxs-lookup"><span data-stu-id="98769-198">At the start of the validation phase, the transaction is assigned a logical end time.</span></span> <span data-ttu-id="98769-199">Die in die Datenbank geschriebenen Zeilenversionen werden für andere Transaktionen zum logischen Endzeitpunkt sichtbar.</span><span class="sxs-lookup"><span data-stu-id="98769-199">The row versions written in the database become visible to other transactions at the logical end time.</span></span> <span data-ttu-id="98769-200">Weitere Informationen finden Sie unter [Commit-Abhängigkeiten](#cd).</span><span class="sxs-lookup"><span data-stu-id="98769-200">For more information, see [Commit Dependencies](#cd).</span></span>

##### <a name="repeatable-read-validation"></a><span data-ttu-id="98769-201">REPEATABLE READ-Überprüfung</span><span class="sxs-lookup"><span data-stu-id="98769-201">Repeatable Read Validation</span></span>
 <span data-ttu-id="98769-202">Wenn die Isolationsstufe der Transaktion REPEATABLE READ oder serialisierbar ist oder wenn auf Tabellen mit REPEATABLE READ-oder serialisierbaren Isolation zugegriffen wird (Weitere Informationen finden Sie im Abschnitt zur Isolierung einzelner Vorgänge in [Transaktions Isolations Stufen](../../2014/database-engine/transaction-isolation-levels.md)), überprüft das System, ob die Lesevorgänge wiederholbar sind.</span><span class="sxs-lookup"><span data-stu-id="98769-202">If the isolation level of the transaction is REPEATABLE READ or SERIALIZABLE, or if tables are accessed under REPEATABLE READ or SERIALIZABLE isolation (for more information, see the section on Isolation of Individual Operations in [Transaction Isolation Levels](../../2014/database-engine/transaction-isolation-levels.md)), the system validates that the reads are repeatable.</span></span> <span data-ttu-id="98769-203">Das System überprüft also, ob die von der Transaktion gelesenen Zeilenversionen beim logischen Endzeitpunkt der Transaktion weiterhin gültig sind.</span><span class="sxs-lookup"><span data-stu-id="98769-203">This means it validates that the versions of the rows read by the transaction are still valid row versions at the logical end time of the transaction.</span></span>

 <span data-ttu-id="98769-204">Wenn eine Zeile aktualisiert oder geändert wurde, schlägt das Transaktionscommit mit Fehler 41305 fehl ("Fehler beim Ausführen eines Commits für die aktuelle Transaktion aufgrund eines REPEATABLE READ-Überprüfungsfehlers").</span><span class="sxs-lookup"><span data-stu-id="98769-204">If any of the rows have been updated or changed, the transaction fails to commit with error 41305 ("The current transaction failed to commit due to a repeatable read validation failure.").</span></span>

 <span data-ttu-id="98769-205">Dieser Fehler kann auch auftreten, wenn eine Tabelle nach einem Einfüge-, Update- oder Löschvorgang und vor dem Transaktionscommit gelöscht wird.</span><span class="sxs-lookup"><span data-stu-id="98769-205">This error can also occur if a table is dropped after an insert, update, or delete operation and before the transaction commits.</span></span> <span data-ttu-id="98769-206">Dies gilt nur für Einfüge-, Update- oder Löschvorgänge in systemintern kompilierten gespeicherten Prozeduren.</span><span class="sxs-lookup"><span data-stu-id="98769-206">This applies only to insert, update, or delete operations in natively compiled stored procedures.</span></span> <span data-ttu-id="98769-207">Schreibvorgänge, die mit interpretiertem [!INCLUDE[tsql](../includes/tsql-md.md)] durchgeführt werden, verursachen eine Blockierung der DROP TABLE-Anweisung, die dann bis zum Commit der Transaktion warten muss.</span><span class="sxs-lookup"><span data-stu-id="98769-207">Such write operations performed through interpreted [!INCLUDE[tsql](../includes/tsql-md.md)] cause the DROP TABLE statement to block and wait until the transaction commits.</span></span>

##### <a name="serializable-validation"></a><span data-ttu-id="98769-208">SERIALIZABLE-Überprüfung</span><span class="sxs-lookup"><span data-stu-id="98769-208">Serializable Validation</span></span>
 <span data-ttu-id="98769-209">Die SERIALIZABLE-Überprüfung wird in zwei Fällen ausgeführt:</span><span class="sxs-lookup"><span data-stu-id="98769-209">Serializable validation is performed in two cases:</span></span>

-   <span data-ttu-id="98769-210">Wenn die Isolationsstufe der Transaktion SERIALIZABLE lautet oder wenn auf Tabellen unter SERIALIZABLE-Isolation zugegriffen wird.</span><span class="sxs-lookup"><span data-stu-id="98769-210">If the isolation level of the transaction is SERIALIZABLE or tables are accessed under SERIALIZABLE isolation.</span></span>

-   <span data-ttu-id="98769-211">Wenn Zeilen in einen eindeutigen Index eingefügt werden, etwa den für eine PRIMARY KEY-Einschränkung erstellten Index.</span><span class="sxs-lookup"><span data-stu-id="98769-211">If rows are inserted in a unique index, such as the index created for a PRIMARY KEY constraint.</span></span> <span data-ttu-id="98769-212">Das System stellt sicher, dass keine Zeilen mit demselben Schlüssel gleichzeitig eingefügt wurden.</span><span class="sxs-lookup"><span data-stu-id="98769-212">The system validates that no rows with the same key have been concurrently inserted.</span></span>

 <span data-ttu-id="98769-213">Das System überprüft, dass keine Phantomzeilen in die Datenbank geschrieben wurden.</span><span class="sxs-lookup"><span data-stu-id="98769-213">The system validates that no phantom rows have been written to the database.</span></span> <span data-ttu-id="98769-214">Die durch die Transaktion ausgeführten Lesevorgänge werden ausgewertet, um zu sicherzustellen, dass keine neuen Zeilen in die Scanbereiche dieser Lesevorgänge eingefügt wurden.</span><span class="sxs-lookup"><span data-stu-id="98769-214">The read operations performed by the transaction are evaluated to determine that no new rows were inserted in the scan ranges of these read operations.</span></span>

 <span data-ttu-id="98769-215">Das Einfügen eines Schlüssels in einen eindeutigen Index umfasst einen impliziten Lesevorgang, mit dem sichergestellt wird, dass der Schlüssel kein Duplikat darstellt.</span><span class="sxs-lookup"><span data-stu-id="98769-215">Insertion of a key in a unique index includes an implicit read operation, to determine that the key is not a duplicate.</span></span> <span data-ttu-id="98769-216">Die SERIALIZABLE-Überprüfung auf eindeutige Indizes stellt sicher, dass diese Indizes keine Duplikate aufweisen können, falls zwei Transaktionen gleichzeitig denselben Schlüssel einfügen.</span><span class="sxs-lookup"><span data-stu-id="98769-216">Serializable validation for unique indexes ensures these indexes cannot have duplicates in case two transactions concurrently insert the same key.</span></span>

 <span data-ttu-id="98769-217">Wenn Phantomzeilen erkannt werden, schlägt das Transaktionscommit mit Fehler 41325 fehl ("Fehler beim Ausführen eines Commits für die aktuelle Transaktion aufgrund eines SERIALIZABLE-Überprüfungsfehlers").</span><span class="sxs-lookup"><span data-stu-id="98769-217">If phantom rows are detected, the transaction fails to commit with error 41325 ("The current transaction failed to commit due to a serializable validation failure.").</span></span>

#### <a name="commit-processing"></a><span data-ttu-id="98769-218">Verarbeiten des Commits</span><span class="sxs-lookup"><span data-stu-id="98769-218">Commit Processing</span></span>
 <span data-ttu-id="98769-219">Wenn die Überprüfung erfolgreich ist und alle Transaktionsabhängigkeiten aufgelöst sind, geht die Transaktion in die Commitverarbeitungsphase über.</span><span class="sxs-lookup"><span data-stu-id="98769-219">If validation succeeds and all transaction dependencies clear, the transaction enters the commit processing phase.</span></span> <span data-ttu-id="98769-220">Während dieser Phase werden die Änderungen an dauerhaften Tabellen in das Protokoll und das Protokoll auf den Datenträger geschrieben, um Dauerhaftigkeit sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="98769-220">During this phase the changes to durable tables are written to the log, and the log is written to disk, to ensure durability.</span></span> <span data-ttu-id="98769-221">Sobald der Protokolldatensatz der Transaktion auf einen Datenträger geschrieben wurde, geht die Steuerung wieder auf den Client über.</span><span class="sxs-lookup"><span data-stu-id="98769-221">Once the log record for the transaction has been written to disk, control is returned to the client.</span></span>

 <span data-ttu-id="98769-222">Alle Commitabhängigkeiten für diese Transaktion werden gelöscht, und alle Transaktionen, die auf den Commit dieser Transaktion gewartet haben, können fortgesetzt werden.</span><span class="sxs-lookup"><span data-stu-id="98769-222">All commit dependencies on this transaction are cleared, and all transactions that had been waiting for this transaction to commit can proceed.</span></span>

## <a name="limitations"></a><span data-ttu-id="98769-223">Einschränkungen</span><span class="sxs-lookup"><span data-stu-id="98769-223">Limitations</span></span>

-   <span data-ttu-id="98769-224">Datenbankübergreifende Transaktionen werden in Verbindung mit speicheroptimierten Tabellen nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="98769-224">Cross-database transactions are not supported with memory-optimized tables.</span></span> <span data-ttu-id="98769-225">Transaktionen, die auf speicheroptimierte Tabellen zugreifen, können nicht auf mehrere Datenbanken zugreifen. Davon ausgenommen sind der Lese-/Schreibzugriff auf tempdb und der schreibgeschützte Zugriff auf die master-Systemdatenbank.</span><span class="sxs-lookup"><span data-stu-id="98769-225">Every transaction that accesses memory-optimized tables cannot access more than one database, with the exception of read-write access to tempdb and read-only access to the system database master.</span></span>

-   <span data-ttu-id="98769-226">Verteilte Transaktionen werden in Verbindung mit speicheroptimierten Tabellen nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="98769-226">Distributed transactions are not supported with memory-optimized tables.</span></span> <span data-ttu-id="98769-227">Mit BEGIN DISTRIBUTED TRANSACTION gestartete verteilte Transaktionen können nicht auf speicheroptimierte Tabellen zugreifen.</span><span class="sxs-lookup"><span data-stu-id="98769-227">Distributed transactions started with BEGIN DISTRIBUTED TRANSACTION cannot access memory-optimized tables.</span></span>

-   <span data-ttu-id="98769-228">Speicher optimierte Tabellen unterstützen keine Sperren.</span><span class="sxs-lookup"><span data-stu-id="98769-228">Memory-optimized tables do not support locking.</span></span> <span data-ttu-id="98769-229">Explizite Sperren nach Sperrhinweisen (wie TABLOCK, XLOCK, ROWLOCK) werden in Verbindung mit speicheroptimierten Tabellen nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="98769-229">Explicit locks through locking hints (such as TABLOCK, XLOCK, ROWLOCK) are not supported with memory-optimized tables.</span></span>

## <a name="see-also"></a><span data-ttu-id="98769-230">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="98769-230">See Also</span></span>
 [<span data-ttu-id="98769-231">Grundlegendes zu Transaktionen in speicheroptimierten Tabellen</span><span class="sxs-lookup"><span data-stu-id="98769-231">Understanding Transactions on Memory-Optimized Tables</span></span>](../../2014/database-engine/understanding-transactions-on-memory-optimized-tables.md)


