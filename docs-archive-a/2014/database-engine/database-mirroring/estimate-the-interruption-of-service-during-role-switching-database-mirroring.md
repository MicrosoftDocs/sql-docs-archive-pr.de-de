---
title: Einschätzen der Dienst Unterbrechung während des Rollenwechsels (Daten Bank Spiegelung) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- parallel redo [SQL Server]
- role switching [SQL Server]
- database mirroring [SQL Server], queues
- failover [SQL Server], database mirroring
- redo [database mirroring]
- database mirroring [SQL Server], failover
ms.assetid: 586a6f25-672b-491b-bc2f-deab2ccda6e2
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: 283c0dfad8d9f91693ab92ed415b4368dd3f0396
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87609405"
---
# <a name="estimate-the-interruption-of-service-during-role-switching-database-mirroring"></a><span data-ttu-id="fdd0a-102">Einschätzen der Unterbrechung des Diensts während des Rollenwechsels (Datenbankspiegelung)</span><span class="sxs-lookup"><span data-stu-id="fdd0a-102">Estimate the Interruption of Service During Role Switching (Database Mirroring)</span></span>
  <span data-ttu-id="fdd0a-103">Während eines Rollenwechsels ist der Zeitraum, für den die Datenbankspiegelung außer Dienst ist, abhängig von der Art des Rollenwechsels und vom Grund für den Rollenwechsel.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-103">During a role switch, the amount of time that database mirroring will be out of service depends on the type of role switching and the cause of the role switch.</span></span>

-   <span data-ttu-id="fdd0a-104">Beim automatischen Failover tragen zwei Faktoren zur Dauer der Dienstunterbrechung bei: zum einen die benötigte Zeit, bis der Spiegelserver erkennt, dass in der Prinzipalserverinstanz ein Fehler aufgetreten ist, also die Fehlererkennungszeit, zum anderen die Zeit, die für das Failover der Datenbank benötigt wird, also die Failoverzeit.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-104">For automatic failover, two factors contribute to the time service is interrupted: the time required for the mirror server to recognize that the principal server instance has failed, that is error detection, plus the time required to fail over the database, that is failover time.</span></span>

-   <span data-ttu-id="fdd0a-105">Obwohl ein Fehler aufgetreten ist, ist bei einem Erzwingen des Diensts das Erkennen des Fehlers und das Reagieren darauf abhängig von der menschlichen Reaktionszeit.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-105">For a forced-service operation, though a failure has occurred, detecting and responding to the failure depends on human responsiveness.</span></span> <span data-ttu-id="fdd0a-106">Das Schätzen der potenziellen Dienstunterbrechung ist jedoch beschränkt auf das Schätzen der Zeit, die der Spiegelserver für den Rollenwechsel benötigt, nachdem der Befehl für den erzwungenen Dienst ausgegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-106">However, estimating the potential interruption of service is limited to estimating the time for the mirror server to switch roles after the forced service command is issued.</span></span>

    > [!NOTE]
    >  <span data-ttu-id="fdd0a-107">Um die zum Erkennen bestimmter Bedingungen, z. B. einiger Fehlertypen, erforderliche Zeit zu reduzieren, können Sie Warnungen für diese Bedingungen definieren.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-107">To reduce the time required to detect specific conditions such as some types of errors, you can define alerts for those conditions.</span></span>

-   <span data-ttu-id="fdd0a-108">Bei einem manuellen Failover wird nur die für das Failover der Datenbank erforderliche Zeit nach dem Failoverbefehl ausgegeben.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-108">For a manual failover, only the time required to fail over the database after the failover command is issued.</span></span>

## <a name="error-detection"></a><span data-ttu-id="fdd0a-109">Fehlererkennung</span><span class="sxs-lookup"><span data-stu-id="fdd0a-109">Error detection</span></span>
 <span data-ttu-id="fdd0a-110">Die Zeit, die das System zum Erkennen eines Fehlers benötigt, hängt von der Art des Fehlers ab. Beispielsweise wird ein Netzwerkfehler nahezu sofort bemerkt, während es 10 Sekunden dauert, um festzustellen, dass ein Server nicht reagiert (bei Standardtimeout).</span><span class="sxs-lookup"><span data-stu-id="fdd0a-110">The time for the system to notice an error depends on the type of error; for example, a network error is noticed almost instantly, while noticing a server that is not responding takes 10 seconds (with the default timeout).</span></span>

 <span data-ttu-id="fdd0a-111">Informationen zu Fehlern, die während einer Datenbank-Spiegelungssitzung zu Problemen führen können, und zur Timeouterkennung im Modus für hohe Sicherheit mit automatischem Failover finden Sie unter [Mögliche Fehler während der Datenbankspiegelung](possible-failures-during-database-mirroring.md).</span><span class="sxs-lookup"><span data-stu-id="fdd0a-111">For information on errors that can cause a failure during a database mirroring session and timeout detection in high-safety mode with automatic failover, see [Possible Failures During Database Mirroring](possible-failures-during-database-mirroring.md)).</span></span>

## <a name="failover-time"></a><span data-ttu-id="fdd0a-112">Failoverzeit</span><span class="sxs-lookup"><span data-stu-id="fdd0a-112">Failover time</span></span>
 <span data-ttu-id="fdd0a-113">Die Failoverzeit setzt sich hauptsächlich aus der Zeit zusammen, die der frühere Spiegelserver benötigt, um ein Rollforward für Protokolle in der Wiederholungswarteschlange auszuführen, sowie einem kurzen zusätzlichen Zeitraum (weitere Informationen zur Verarbeitung von Protokolldatensätzen durch den Spiegelserver finden Sie unter [Datenbankspiegelung &#40;SQL Server&#41;](database-mirroring-sql-server.md)).</span><span class="sxs-lookup"><span data-stu-id="fdd0a-113">Failover time consists mainly of the time that the former mirror server requires to roll forward any log remaining in its redo queue, plus a short additional time (for more information about how the mirror server processes log records, see [Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md)).</span></span> <span data-ttu-id="fdd0a-114">Informationen zum Schätzen der Failoverzeit finden Sie unter "Schätzen der Rollforwardrate für das Failover" weiter unten in diesem Thema.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-114">For information on estimating failover time, see Estimating Your Failover Redo Rate, later in this topic.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="fdd0a-115">Wenn ein Failover während einer Transaktion auftritt, in der ein Index oder eine Tabelle erstellt und anschließend geändert wird, kann das Failover mehr Zeit als gewöhnlich in Anspruch nehmen.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-115">If failover occurs during a transaction in which an index or table is created and then changed, failover might take longer than usual.</span></span>  <span data-ttu-id="fdd0a-116">So kann ein Failover während der folgenden Folge von Operationen die Failoverzeit verlängern: BEGIN TRANSACTION, CREATE INDEX in einer Tabelle und SELECT INTO für die Tabelle.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-116">For example, failing over during the following series of operations might increase failover time:  BEGIN TRANSACTION, CREATE INDEX on a table, and SELECT INTO the table.</span></span> <span data-ttu-id="fdd0a-117">Die Möglichkeit einer erhöhten Failoverzeit während einer solchen Transaktion bleibt bis zu ihrem Abschluss durch eine COMMIT TRANSACTION- oder ROLLBACK TRANSACTION-Anweisung bestehen.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-117">The possibility of increased failover time during such a transaction remains until it is completed with either a COMMIT TRANSACTION or ROLLBACK TRANSACTION statement.</span></span>

### <a name="the-redo-queue"></a><span data-ttu-id="fdd0a-118">Wiederholungswarteschlange</span><span class="sxs-lookup"><span data-stu-id="fdd0a-118">The Redo Queue</span></span>
 <span data-ttu-id="fdd0a-119">Um ein Rollforward für die Datenbank auszuführen, müssen die Protokolldatensätze angewandt werden, die sich derzeit in der Wiederholungswarteschlange auf dem Spiegelserver befinden.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-119">Rolling forward the database involves applying whatever log records are currently in the redo queue on the mirror server.</span></span> <span data-ttu-id="fdd0a-120">Die *Wiederholungswarteschlange* besteht aus den Protokolldatensätzen, die auf den Datenträger des Spiegelservers geschrieben wurden, für die aber noch kein Rollforward in der Spiegeldatenbank ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-120">The *redo queue* consists of the log records that have been written to disk on the mirror server but not yet rolled forward on the mirror database.</span></span>

 <span data-ttu-id="fdd0a-121">Die Failoverzeit für die Datenbank hängt davon ab, wie schnell der Spiegelserver ein Rollforward für das Protokoll in der Wiederholungswarteschlange ausführen kann. Dies wird wiederum in erster Linie durch die Systemhardware und die aktuelle Arbeitsauslastung bestimmt.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-121">Failover time for the database depends on how fast the mirror server can roll forward the log in the redo queue, which, in turn, is determined primarily by the system hardware and the current work load.</span></span> <span data-ttu-id="fdd0a-122">Eine Prinzipaldatenbank kann potenziell so stark ausgelastet sein, dass der Prinzipalserver den Protokollversand zum Spiegelserver wesentlich schneller als ein Rollforward des Protokolls ausführen kann.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-122">Potentially, a principal database can become so busy that the principal server ships log to the mirror server much faster than it can roll the log forward.</span></span> <span data-ttu-id="fdd0a-123">In dieser Situation kann das Failover viel Zeit in Anspruch nehmen, während der Spiegelserver ein Rollforward für das Protokoll in der Wiederholungswarteschlange ausführt.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-123">In this situation, failover might take significant time while the mirror server rolls forward the log in the redo queue.</span></span> <span data-ttu-id="fdd0a-124">Um die aktuelle Größe der Wiederholungswarteschlange festzustellen, verwenden Sie den Leistungsindikator **Wiederholungswarteschlange** im Datenbankspiegelungs-Leistungsobjekt.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-124">To learn the current size of the redo queue, use the **Redo Queue** counter in the database mirroring performance object.</span></span> <span data-ttu-id="fdd0a-125">Weitere Informationen finden Sie unter [SQL Server, Database Mirroring Object](../../relational-databases/performance-monitor/sql-server-database-mirroring-object.md).</span><span class="sxs-lookup"><span data-stu-id="fdd0a-125">For more information, see [SQL Server, Database Mirroring Object](../../relational-databases/performance-monitor/sql-server-database-mirroring-object.md).</span></span>

### <a name="estimating-the-failover-redo-rate"></a><span data-ttu-id="fdd0a-126">Schätzen der Rollforwardrate für das Failover</span><span class="sxs-lookup"><span data-stu-id="fdd0a-126">Estimating the Failover Redo Rate</span></span>
 <span data-ttu-id="fdd0a-127">Sie können die erforderliche Zeitdauer für ein Rollforward von Protokolldatensätzen (die *Rollforwardrate*) mithilfe einer Testkopie der Produktionsdatenbank messen.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-127">You can measure the amount of time required to roll forward log records-the *redo rate*-by using a test copy of the production database.</span></span>

 <span data-ttu-id="fdd0a-128">Die Methode zum Schätzen der Rollforwardzeit hängt von der Anzahl von Threads ab, die vom Spiegelserver während der Rollforwardphase verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-128">The method for estimating roll forward time during failover depends on the number of threads the mirror server uses during the redo phase.</span></span> <span data-ttu-id="fdd0a-129">Die Anzahl von Threads hängt von folgendem Faktoren ab:</span><span class="sxs-lookup"><span data-stu-id="fdd0a-129">The number of threads depends on the following:</span></span>

-   <span data-ttu-id="fdd0a-130">In [!INCLUDE[ssStandard](../../includes/ssstandard-md.md)]verwendet der Spiegelserver immer einen einzigen Thread für das Rollforward der Datenbank.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-130">In [!INCLUDE[ssStandard](../../includes/ssstandard-md.md)], the mirror server always uses a single thread to roll forward the database.</span></span>

-   <span data-ttu-id="fdd0a-131">In [!INCLUDE[ssEnterprise](../../includes/ssenterprise-md.md)]verwenden Spiegelserver auf Computern mit weniger als fünf CPUs ebenfalls nur einen einzigen Thread.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-131">In [!INCLUDE[ssEnterprise](../../includes/ssenterprise-md.md)], mirror servers on computers with fewer than five CPUs also use only a single thread.</span></span> <span data-ttu-id="fdd0a-132">Bei mindestens fünf CPUs verteilt ein Spiegelserver während eines Failovers die Rollforwardvorgänge auf mehrere Threads (dies wird als *paralleles Rollforward*bezeichnet).</span><span class="sxs-lookup"><span data-stu-id="fdd0a-132">With five or more CPUs, a mirror server distributes its roll forward operations among multiple threads during a failover (this is known as *parallel redo*).</span></span> <span data-ttu-id="fdd0a-133">Das parallele Rollforward ist für die Verwendung eines Threads für jeweils vier CPUs optimiert.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-133">Parallel redo is optimized to use one thread for every four CPUs.</span></span>

#### <a name="estimating-the-single-threaded-redo-rate"></a><span data-ttu-id="fdd0a-134">Schätzen der Rollforwardrate für Rollforwards mit einem einzelnen Thread</span><span class="sxs-lookup"><span data-stu-id="fdd0a-134">Estimating the Single-Threaded Redo Rate</span></span>
 <span data-ttu-id="fdd0a-135">Bei einem Rollforward mit einem einzelnen Thread dauert das Rollforward der Spiegeldatenbank während des Failovers etwa genauso lange wie eine Wiederherstellung einer Protokollsicherung benötigt, um ein Rollforward für den gleichen Protokollumfang auszuführen.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-135">For single-threaded redo, roll forward of the mirror database during failover takes approximately the same amount of time as a restore of a log backup takes to roll forward the same amount of log.</span></span> <span data-ttu-id="fdd0a-136">Um die Failoverzeit zu schätzen, erstellen Sie eine Testdatenbank in der Umgebung, in der Sie die Spiegelung ausführen möchten.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-136">To estimate failover time, create a test database in the environment under which you intend to run mirroring.</span></span> <span data-ttu-id="fdd0a-137">Anschließend verwenden Sie eine Protokollsicherung aus der Produktionsdatenbank.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-137">Then take a log backup from the production database.</span></span> <span data-ttu-id="fdd0a-138">Um die Rollforwardrate für diese Protokollsicherung zu schätzen, messen Sie, wie lange Sie benötigen, um die Protokollsicherung mit WITH NORECOVERY in der Testdatenbank wiederherzustellen.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-138">To measure the redo rate for that log backup, time how long it takes you to restore the log backup WITH NORECOVERY onto the test database.</span></span>

 <span data-ttu-id="fdd0a-139">Sobald Sie die Rollforwardrate des Spiegelservers kennen, können Sie den Zeitaufwand für das Failover der Datenbank zu einem bestimmten Zeitpunkt schätzen, indem Sie den aktuellen Protokollumfang auf dem Spiegelserver, für den ein Rollforward ausgeführt werden muss (gemessen mithilfe des **Wiederholungswarteschlange** -Leistungsindikators) durch die Rollforwardrate dividieren.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-139">Once you know the redo rate of your mirror server, you can estimate the time to fail over the database at a given point in time by dividing the amount of current log to be redone on the mirror (as measured by the **Redo Queue** performance counter) by the redo rate.</span></span> <span data-ttu-id="fdd0a-140">Wenn der Spiegelserver unter normalen Bedingungen mit der Arbeitsauslastung vom Prinzipalserver Schritt halten kann, ist der Wert für **Wiederholungswarteschlange** niedrig oder liegt bei Null, und ein Failover dauert deshalb nur wenige Sekunden.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-140">Under normal conditions, if the mirror server can keep up with the load from the principal, the **Redo Queue** is small or close to zero, and a failover only takes a few seconds.</span></span>

#### <a name="estimating-the-parallel-redo-rate"></a><span data-ttu-id="fdd0a-141">Schätzen der Rollforwardrate für parallele Rollforwards</span><span class="sxs-lookup"><span data-stu-id="fdd0a-141">Estimating the Parallel Redo Rate</span></span>
 <span data-ttu-id="fdd0a-142">In [!INCLUDE[ssEnterprise](../../includes/ssenterprise-md.md)]ist die parallele Wiederholung für die Verwendung eines Threads für jeweils vier CPUs optimiert.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-142">In [!INCLUDE[ssEnterprise](../../includes/ssenterprise-md.md)], parallel redo is optimized to use one thread for every four CPUs.</span></span> <span data-ttu-id="fdd0a-143">Um die Rollforwardzeit für das parallele Rollforward zu schätzen, stellt der Zugriff auf ein laufendes Testsystem genauere Ergebnisse bereit als lediglich eine Testdatenbank.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-143">To estimate roll forward time for parallel redo, it is more accurate to access a running test system than a test database.</span></span> <span data-ttu-id="fdd0a-144">Erhöhen Sie beim Überwachen der Wiederholungswarteschlange auf dem Spiegelserver die Arbeitsauslastung auf dem Prinzipalserver.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-144">While monitoring the redo queue on the mirror server, increase the load on the principal server.</span></span> <span data-ttu-id="fdd0a-145">Im Normalbetrieb liegt der Wert der Wiederholungswarteschlange bei Null.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-145">In normal operation, the redo queue is close to zero.</span></span> <span data-ttu-id="fdd0a-146">Erhöhen Sie die Arbeitsauslastung auf dem Prinzipalserver, bis die Größe der Wiederholungswarteschlange ständig zunimmt. Das System hat dann seine maximale Rollforwardrate erreicht, und der **Bytes wiederholen/Sekunde** -Leistungsindikator repräsentiert dann die maximale Rollforwardrate.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-146">Increase the load on the principal server until the Redo Queue starts to grow continuously; the system is then at its maximum redo rate, and the **Redo Bytes/sec** performance counter at this point represents the maximum redo rate.</span></span> <span data-ttu-id="fdd0a-147">Weitere Informationen finden Sie unter [SQL Server, Database Mirroring Object](../../relational-databases/performance-monitor/sql-server-database-mirroring-object.md).</span><span class="sxs-lookup"><span data-stu-id="fdd0a-147">For more information, see [SQL Server, Database Mirroring Object](../../relational-databases/performance-monitor/sql-server-database-mirroring-object.md).</span></span>

## <a name="estimating-interruption-of-service-during-automatic-failover"></a><span data-ttu-id="fdd0a-148">Schätzen der Dienstunterbrechung beim automatischen Failover</span><span class="sxs-lookup"><span data-stu-id="fdd0a-148">Estimating Interruption of Service During Automatic Failover</span></span>
 <span data-ttu-id="fdd0a-149">In der folgende Abbildung wird veranschaulicht, wie die Fehlererkennung und die Failoverzeit zur Gesamtzeit beitragen, die zum Abschließen eines automatischen Failovers auf **Partner_B**erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-149">The following figure illustrates how error detection and failover time contribute to the overall time required for an automatic failover to complete on **Partner_B**.</span></span> <span data-ttu-id="fdd0a-150">Das Failover benötigt Zeit zum Ausführen des Rollforwards für die Datenbank (die Rollforwardphase) sowie zusätzlich ein wenig Zeit, um die Datenbank online zu schalten.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-150">Failover requires time to roll forward the database (the redo phase) plus a small amount of time to bring the database online.</span></span> <span data-ttu-id="fdd0a-151">In der Rollbackphase wird ein Rollback für Transaktionen ohne Commit ausgeführt wird. Diese Phase erfolgt, nachdem die Prinzipaldatenbank online geschaltet wurde, und wird nach dem Failover fortgesetzt.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-151">The undo phase, which involves rolling back any uncommitted transactions, occurs after the new principal database goes online and continues after fail over.</span></span> <span data-ttu-id="fdd0a-152">Die Datenbank ist während der Rollbackphase verfügbar.</span><span class="sxs-lookup"><span data-stu-id="fdd0a-152">The database is available during the undo phase.</span></span>

 <span data-ttu-id="fdd0a-153">![Fehlererkennung und Failoverzeit](../media/dbm-failovauto-time.gif "Fehlererkennung und Failoverzeit")</span><span class="sxs-lookup"><span data-stu-id="fdd0a-153">![Error detection and failover time](../media/dbm-failovauto-time.gif "Error detection and failover time")</span></span>

## <a name="see-also"></a><span data-ttu-id="fdd0a-154">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="fdd0a-154">See Also</span></span>
 <span data-ttu-id="fdd0a-155">[Daten Bank Spiegelung Betriebsmodi](database-mirroring-operating-modes.md) [Rollenwechsel während einer Datenbank-Spiegelungs Sitzung &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) über [Wachen der Daten Bank Spiegelung &#40;SQL Server&#41;](monitoring-database-mirroring-sql-server.md)</span><span class="sxs-lookup"><span data-stu-id="fdd0a-155">[Database Mirroring Operating Modes](database-mirroring-operating-modes.md) [Role Switching During a Database Mirroring Session &#40;SQL Server&#41;](role-switching-during-a-database-mirroring-session-sql-server.md) [Monitoring Database Mirroring &#40;SQL Server&#41;](monitoring-database-mirroring-sql-server.md)</span></span>


