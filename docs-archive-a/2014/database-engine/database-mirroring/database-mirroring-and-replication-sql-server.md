---
title: Datenbankspiegelung und Replikation (SQL Server) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- database mirroring [SQL Server], interoperability
- replication [SQL Server], database mirroring and
ms.assetid: 82796217-02e2-4bc5-9ab5-218bae11a2d6
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: b126aeb8ccd24932706b8798ebfe7088308918e2
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87721741"
---
# <a name="database-mirroring-and-replication-sql-server"></a><span data-ttu-id="f988e-102">Datenbankspiegelung und Replikation (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="f988e-102">Database Mirroring and Replication (SQL Server)</span></span>
  <span data-ttu-id="f988e-103">Die Datenbankspiegelung kann in Verbindung mit der Replikation verwendet werden, um die Verfügbarkeit der Veröffentlichungsdatenbank zu verbessern.</span><span class="sxs-lookup"><span data-stu-id="f988e-103">Database mirroring can be used in conjunction with replication to improve availability for the publication database.</span></span> <span data-ttu-id="f988e-104">Bei der Datenbankspiegelung sind zwei Kopien einer einzigen Datenbank vorhanden, die normalerweise auf verschiedenen Computern gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="f988e-104">Database mirroring involves two copies of a single database that typically reside on different computers.</span></span> <span data-ttu-id="f988e-105">Für die Clients ist immer nur eine Kopie der Datenbank verfügbar.</span><span class="sxs-lookup"><span data-stu-id="f988e-105">At any given time, only one copy of the database is currently available to clients.</span></span> <span data-ttu-id="f988e-106">Diese Kopie wird als Prinzipaldatenbank bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="f988e-106">This copy is known as the principal database.</span></span> <span data-ttu-id="f988e-107">Updates, die Clients an der Prinzipaldatenbank vornehmen, werden in der anderen Kopie der Datenbank angewendet, die als Spiegeldatenbank bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="f988e-107">Updates made by clients to the principal database are applied on the other copy of the database, known as the mirror database.</span></span> <span data-ttu-id="f988e-108">Beim Spiegeln wird das Transaktionsprotokoll von jedem Einfüge-, Update- oder Löschvorgang, der an der Prinzipaldatenbank vorgenommen wird, auf die Spiegeldatenbank angewandt.</span><span class="sxs-lookup"><span data-stu-id="f988e-108">Mirroring involves applying the transaction log from every insertion, update, or deletion made on the principal database onto the mirror database.</span></span>  
  
 <span data-ttu-id="f988e-109">Ein Failover der Replikation zu einer Spiegeldatenbank wird vollständig für Veröffentlichungsdatenbanken unterstützt, und zwar mit einer eingeschränkten Unterstützung für Verteilungs- oder Abonnementdatenbanken.</span><span class="sxs-lookup"><span data-stu-id="f988e-109">Replication failover to a mirror is fully supported for publication databases, with limited support for subscription databases.</span></span> <span data-ttu-id="f988e-110">Die Datenbankspiegelung wird für die Verteilerdatenbank nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="f988e-110">Database mirroring is not supported for the distribution database.</span></span> <span data-ttu-id="f988e-111">Informationen zum Wiederherstellen einer Verteilungsdatenbank oder einer Abonnementdatenbank, ohne dass dazu die Replikation neu konfiguriert werden muss, finden Sie unter [Sichern und Wiederherstellen von replizierten Datenbanken](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span><span class="sxs-lookup"><span data-stu-id="f988e-111">For information about recovering a distribution database or subscription database without any need to reconfigure replication, see [Back Up and Restore Replicated Databases](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span></span> <span data-ttu-id="f988e-112">Informationen zum Spiegeln der Abonnentendatenbank finden im entsprechenden Thema.</span><span class="sxs-lookup"><span data-stu-id="f988e-112">For information about mirroring the subscriber database, see the</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="f988e-113">Nach einem Failover wird die Spiegeldatenbank zur Prinzipaldatenbank.</span><span class="sxs-lookup"><span data-stu-id="f988e-113">After a failover, the mirror becomes the principal.</span></span> <span data-ttu-id="f988e-114">In diesem Thema bezeichnen die Begriffe "Prinzipal" und "Spiegel" immer die ursprüngliche Prinzipal- bzw. Spiegeldatenbank.</span><span class="sxs-lookup"><span data-stu-id="f988e-114">In this topic, "principal" and "mirror" always refer to the original principal and mirror.</span></span>  
  
## <a name="requirements-and-considerations-for-using-replication-with-database-mirroring"></a><span data-ttu-id="f988e-115">Anforderungen und Überlegungen zur Verwendung von Replikation mit Datenbankspiegelung</span><span class="sxs-lookup"><span data-stu-id="f988e-115">Requirements and Considerations for Using Replication with Database Mirroring</span></span>  
 <span data-ttu-id="f988e-116">Beachten Sie die folgenden Anforderungen und Überlegungen, wenn Sie die Replikation zusammen mit der Datenbankspiegelung verwenden wollen:</span><span class="sxs-lookup"><span data-stu-id="f988e-116">Be aware of the following requirements and considerations when using replication with database mirroring:</span></span>  
  
-   <span data-ttu-id="f988e-117">Die Prinzipal- und die Spiegeldatenbank müssen einen gemeinsamen Verteiler verwenden.</span><span class="sxs-lookup"><span data-stu-id="f988e-117">The principal and mirror must share a Distributor.</span></span> <span data-ttu-id="f988e-118">Es wird empfohlen, dafür einen Remoteverteiler zu verwenden, der im Falle eines ungeplanten Failovers des Verlegers eine größere Fehlertoleranz aufweist.</span><span class="sxs-lookup"><span data-stu-id="f988e-118">We recommend that this be a remote Distributor, which provides greater fault tolerance if the Publisher has an unplanned failover.</span></span>  
  
-   <span data-ttu-id="f988e-119">Die Replikation unterstützt das Spiegeln der Veröffentlichungsdatenbank zur Mergereplikation und zur Transaktionsreplikation mit schreibgeschützten Abonnenten oder Abonnenten mit verzögertem Update über eine Warteschlange.</span><span class="sxs-lookup"><span data-stu-id="f988e-119">Replication supports mirroring the publication database for merge replication and for transactional replication with read-only Subscribers or queued updating Subscribers.</span></span> <span data-ttu-id="f988e-120">Abonnenten mit sofortigem Update, Oracle-Verleger, Verleger in einer Peer-zu-Peer-Topologie und das erneute Veröffentlichen werden nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="f988e-120">Immediate updating Subscribers, Oracle Publishers, Publishers in a peer-to-peer topology, and republishing are not supported.</span></span>  
  
-   <span data-ttu-id="f988e-121">Metadaten und Objekte, die außerhalb der Datenbank vorhanden sind, werden nicht in die Spiegeldatenbank kopiert. Das betrifft Benutzernamen, Aufträge, Verbindungsserver usw.</span><span class="sxs-lookup"><span data-stu-id="f988e-121">Metadata and objects that exist outside the database are not copied to the mirror, including logins, jobs, linked servers, and so on.</span></span> <span data-ttu-id="f988e-122">Wenn Sie die Metadaten in der Spiegeldatenbank benötigen, müssen Sie diese manuell kopieren.</span><span class="sxs-lookup"><span data-stu-id="f988e-122">If you require the metadata and objects at the mirror, you must copy them manually.</span></span> <span data-ttu-id="f988e-123">Weitere Informationen finden Sie unter [Verwaltung von Anmeldenamen und Aufträgen nach einem Rollenwechsel &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f988e-123">For more information, see [Management of Logins and Jobs After Role Switching &#40;SQL Server&#41;](../../sql-server/failover-clusters/management-of-logins-and-jobs-after-role-switching-sql-server.md).</span></span>  
  
## <a name="configuring-replication-with-database-mirroring"></a><span data-ttu-id="f988e-124">Konfigurieren der Replikation mit Datenbankspiegelung</span><span class="sxs-lookup"><span data-stu-id="f988e-124">Configuring Replication with Database Mirroring</span></span>  
 <span data-ttu-id="f988e-125">Das Konfigurieren der Replikation mit Datenbankspiegelung umfasst fünf Schritte.</span><span class="sxs-lookup"><span data-stu-id="f988e-125">Configuring replication and database mirroring involves five steps.</span></span> <span data-ttu-id="f988e-126">Jeder dieser Schritte wird im folgenden Abschnitt detailliert beschrieben.</span><span class="sxs-lookup"><span data-stu-id="f988e-126">Each step is described in more detail in the following section.</span></span>  
  
1.  <span data-ttu-id="f988e-127">Konfigurieren Sie den Verleger.</span><span class="sxs-lookup"><span data-stu-id="f988e-127">Configure the Publisher.</span></span>  
  
2.  <span data-ttu-id="f988e-128">Konfigurieren Sie die Datenbankspiegelung.</span><span class="sxs-lookup"><span data-stu-id="f988e-128">Configure database mirroring.</span></span>  
  
3.  <span data-ttu-id="f988e-129">Konfigurieren Sie die Spiegeldatenbank so, dass sie denselben Verteiler wie die Prinzipaldatenbank verwendet.</span><span class="sxs-lookup"><span data-stu-id="f988e-129">Configure the mirror to use the same Distributor as the principal.</span></span>  
  
4.  <span data-ttu-id="f988e-130">Konfigurieren Sie den Replikations-Agent für das Failover.</span><span class="sxs-lookup"><span data-stu-id="f988e-130">Configure replication agents for failover.</span></span>  
  
5.  <span data-ttu-id="f988e-131">Fügen Sie die Prinzipal- und die Spiegeldatenbank zum Replikationsmonitor hinzu.</span><span class="sxs-lookup"><span data-stu-id="f988e-131">Add the principal and mirror to Replication Monitor.</span></span>  
  
 <span data-ttu-id="f988e-132">Schritt 1 und 2 können auch in umgekehrter Reihenfolge durchgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="f988e-132">Steps 1 and 2 can also be performed in the opposite order.</span></span>  
  
#### <a name="to-configure-database-mirroring-for-a-publication-database"></a><span data-ttu-id="f988e-133">So konfigurieren Sie die Datenbankspiegelung für eine Veröffentlichungsdatenbank</span><span class="sxs-lookup"><span data-stu-id="f988e-133">To configure database mirroring for a publication database</span></span>  
  
1.  <span data-ttu-id="f988e-134">Konfigurieren Sie den Verleger:</span><span class="sxs-lookup"><span data-stu-id="f988e-134">Configure the Publisher:</span></span>  
  
    1.  <span data-ttu-id="f988e-135">Die Verwendung eines Remoteverteilers wird empfohlen.</span><span class="sxs-lookup"><span data-stu-id="f988e-135">We recommend using a remote Distributor.</span></span> <span data-ttu-id="f988e-136">Weitere Informationen zum Konfigurieren der Verteilung finden Sie unter [Konfigurieren der Verteilung](../../relational-databases/replication/configure-distribution.md).</span><span class="sxs-lookup"><span data-stu-id="f988e-136">For more information about configuring distribution, see [Configure Distribution](../../relational-databases/replication/configure-distribution.md).</span></span>  
  
    2.  <span data-ttu-id="f988e-137">Sie können eine Datenbank für die Momentaufnahme- und Transaktionsveröffentlichungen und/oder für Mergeveröffentlichungen aktivieren.</span><span class="sxs-lookup"><span data-stu-id="f988e-137">You can enable a database for snapshot and transactional publications and/or merge publications.</span></span> <span data-ttu-id="f988e-138">Bei gespiegelten Datenbanken, die mehrere Veröffentlichungstypen enthalten, müssen Sie die Datenbanken mit [sp_replicationdboption](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql)für beide Typen auf demselben Knoten aktivieren.</span><span class="sxs-lookup"><span data-stu-id="f988e-138">For mirrored databases that will contain more than one type of publication, you must enable the database for both types at the same node using [sp_replicationdboption](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span> <span data-ttu-id="f988e-139">Beispielsweise können Sie die folgenden gespeicherten Prozeduraufrufe für die Prinzipaldatenbank ausführen:</span><span class="sxs-lookup"><span data-stu-id="f988e-139">For example, you could execute the following stored procedure calls at the principal:</span></span>  
  
        ```  
        exec sp_replicationdboption @dbname='<PublicationDatabase>', @optname='publish', @value=true;  
        exec sp_replicationdboption @dbname='<PublicationDatabase>', @optname='mergepublish', @value=true;  
        ```  
  
         <span data-ttu-id="f988e-140">Weitere Informationen zum Erstellen von Veröffentlichungen finden Sie unter [Veröffentlichen von Daten und Datenbankobjekten](../../relational-databases/replication/publish/publish-data-and-database-objects.md).</span><span class="sxs-lookup"><span data-stu-id="f988e-140">For more information about creating publications, see [Publish Data and Database Objects](../../relational-databases/replication/publish/publish-data-and-database-objects.md).</span></span>  
  
2.  <span data-ttu-id="f988e-141">Konfigurieren Sie die Datenbankspiegelung.</span><span class="sxs-lookup"><span data-stu-id="f988e-141">Configure database mirroring.</span></span> <span data-ttu-id="f988e-142">Weitere Informationen finden Sie unter [Einrichten einer Datenbank-Spiegelungssitzung mithilfe der Windows-Authentifizierung &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) und [Einrichten der Datenbankspiegelung &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="f988e-142">For more information, see [Establish a Database Mirroring Session Using Windows Authentication &#40;SQL Server Management Studio&#41;](establish-database-mirroring-session-windows-authentication.md) and [Setting Up Database Mirroring &#40;SQL Server&#41;](database-mirroring-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="f988e-143">Konfigurieren Sie die Verteilung für die Spiegeldatenbank.</span><span class="sxs-lookup"><span data-stu-id="f988e-143">Configure distribution for the mirror.</span></span> <span data-ttu-id="f988e-144">Geben Sie den Namen der Spiegeldatenbank als Verleger an, und geben Sie denselben Verteiler- und Momentaufnahmeordner an, den auch die Prinzipaldatenbank verwendet.</span><span class="sxs-lookup"><span data-stu-id="f988e-144">Specify the mirror name as the Publisher, and specify the same Distributor and snapshot folder that the principal uses.</span></span> <span data-ttu-id="f988e-145">Wenn Sie z. B. eine Replikation mit gespeicherten Prozeduren konfigurieren, führen Sie auf dem Verteiler [sp_adddistpublisher](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql) aus. Führen Sie anschließend auf der Spiegeldatenbank [sp_adddistributor](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) aus.</span><span class="sxs-lookup"><span data-stu-id="f988e-145">For example, if you are configuring replication with stored procedures, execute [sp_adddistpublisher](/sql/relational-databases/system-stored-procedures/sp-adddistpublisher-transact-sql) at the Distributor; and then execute [sp_adddistributor](/sql/relational-databases/system-stored-procedures/sp-adddistributor-transact-sql) at the mirror.</span></span> <span data-ttu-id="f988e-146">Für **sp_adddistpublisher**:</span><span class="sxs-lookup"><span data-stu-id="f988e-146">For **sp_adddistpublisher**:</span></span>  
  
    -   <span data-ttu-id="f988e-147">Legen Sie den Wert des- **@publisher** Parameters auf den Netzwerknamen der Spiegel Datenbank fest.</span><span class="sxs-lookup"><span data-stu-id="f988e-147">Set the value of the **@publisher** parameter to the network name of the mirror.</span></span>  
  
    -   <span data-ttu-id="f988e-148">Legen Sie den Wert des- **@working_directory** Parameters auf den Momentaufnahme Ordner fest, der vom Prinzipal verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="f988e-148">Set the value of the **@working_directory** parameter to the snapshot folder used by the principal.</span></span>  
  
4.  <span data-ttu-id="f988e-149">Geben Sie den Spiegeldatenbanknamen für den Parameter **-PublisherFailoverPartner** des Agents an.</span><span class="sxs-lookup"><span data-stu-id="f988e-149">Specify the mirror name for the **-PublisherFailoverPartner** agent parameter.</span></span> <span data-ttu-id="f988e-150">Dieser Parameter ist für die folgenden Agents erforderlich, um die Spiegeldatenbank nach einem Failover zu identifizieren:</span><span class="sxs-lookup"><span data-stu-id="f988e-150">Agent This parameter is required for the following agents to identify the mirror after failover:</span></span>  
  
    -   <span data-ttu-id="f988e-151">Momentaufnahme-Agent (für alle Veröffentlichungen)</span><span class="sxs-lookup"><span data-stu-id="f988e-151">Snapshot Agent (for all publications)</span></span>  
  
    -   <span data-ttu-id="f988e-152">Protokolllese-Agent (für alle Transaktionsveröffentlichungen)</span><span class="sxs-lookup"><span data-stu-id="f988e-152">Log Reader Agent (for all transactional publications)</span></span>  
  
    -   <span data-ttu-id="f988e-153">Warteschlangenlese-Agent (für Transaktionsveröffentlichungen, die Abonnments mit verzögertem Update über eine Warteschlange unterstützen)</span><span class="sxs-lookup"><span data-stu-id="f988e-153">Queue Reader Agent (for transactional publications that support queued updating subscriptions)</span></span>  
  
    -   <span data-ttu-id="f988e-154">Merge-Agent (für Mergeabonnements)</span><span class="sxs-lookup"><span data-stu-id="f988e-154">Merge Agent (for merge subscriptions)</span></span>  
  
    -   [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="f988e-155">Replikationsüberwachung (replisapi.dll: für Mergeabonnements, die per Websynchronisierung synchronisiert werden)</span><span class="sxs-lookup"><span data-stu-id="f988e-155">replication listener (replisapi.dll: for merge subscriptions synchronized using Web synchronization)</span></span>  
  
    -   <span data-ttu-id="f988e-156">SQL Merge-ActiveX-Steuerelement (für Mergeabonnements, die über dieses Steuerelement synchronisiert werden)</span><span class="sxs-lookup"><span data-stu-id="f988e-156">SQL Merge ActiveX Control (for merge subscriptions synchronized with the control)</span></span>  
  
     <span data-ttu-id="f988e-157">Der Verteilungs-Agent und das Verteilungs-ActiveX-Steuerelement weisen diesen Parameter nicht auf, weil sie keine Verbindung mit dem Verleger herstellen.</span><span class="sxs-lookup"><span data-stu-id="f988e-157">The Distribution Agent and Distribution ActiveX Control do not have this parameter because they do not connect to the Publisher.</span></span>  
  
     <span data-ttu-id="f988e-158">Die Änderungen der Agentparameter treten in Kraft, wenn der Agent das nächste Mal gestartet wird.</span><span class="sxs-lookup"><span data-stu-id="f988e-158">Agent parameter changes take effect the next time the agent is started.</span></span> <span data-ttu-id="f988e-159">Wenn der Agent ständig ausgeführt wird, müssen Sie den Agent beenden und neu starten.</span><span class="sxs-lookup"><span data-stu-id="f988e-159">If the agent runs continuously, you must stop and restart the agent.</span></span> <span data-ttu-id="f988e-160">Parameter können in Agentprofilen und in der Befehlszeile angegeben werden.</span><span class="sxs-lookup"><span data-stu-id="f988e-160">Parameters can be specified in agent profiles and from the command prompt.</span></span> <span data-ttu-id="f988e-161">Weitere Informationen finden Sie unter</span><span class="sxs-lookup"><span data-stu-id="f988e-161">For more information, see:</span></span>  
  
    -   [<span data-ttu-id="f988e-162">Anzeigen und Ändern von Befehlszeilenparametern des Replikations-Agents &#40;SQL Server Management Studio&#41;</span><span class="sxs-lookup"><span data-stu-id="f988e-162">View and Modify Replication Agent Command Prompt Parameters &#40;SQL Server Management Studio&#41;</span></span>](../../relational-databases/replication/agents/view-and-modify-replication-agent-command-prompt-parameters.md)  
  
    -   [<span data-ttu-id="f988e-163">Ausführbare Konzepte für die Programmierung von Replikations-Agent</span><span class="sxs-lookup"><span data-stu-id="f988e-163">Replication Agent Executables Concepts</span></span>](../../relational-databases/replication/concepts/replication-agent-executables-concepts.md)  
  
     <span data-ttu-id="f988e-164">Es wird empfohlen, zunächst den Parameter **-PublisherFailoverPartner** zu einem Agent-Profil hinzuzufügen und anschließend den Spiegeldatenbanknamen im Profil anzugeben.</span><span class="sxs-lookup"><span data-stu-id="f988e-164">We recommend adding the **-PublisherFailoverPartner** to an agent profile, and then specifying the mirror name in the profile.</span></span> <span data-ttu-id="f988e-165">Wenn Sie z. B. die Replikation mit gespeicherten Prozeduren konfigurieren:</span><span class="sxs-lookup"><span data-stu-id="f988e-165">For example, if you are configuring replication with stored procedures:</span></span>  
  
    ```  
    -- Execute sp_help_agent_profile in the context of the distribution database to get the list of profiles.  
    -- Select the profile id of the profile that needs to be updated from the result set.  
    -- In the agent_type column returned by sp_help_agent_profile:   
    -- 1 = Snapshot Agent; 2 = Log Reader Agent; 3 = Distribution Agent; 4 = Merge Agent; 9 = Queue Reader Agent.  
  
    exec sp_help_agent_profile;  
  
    -- Setting the -PublisherFailoverPartner parameter in the default Snapshot Agent profile (profile 1).  
    -- Execute sp_add_agent_parameter in the context of the distribution database.  
    exec sp_add_agent_parameter @profile_id = 1, @parameter_name = N'-PublisherFailoverPartner', @parameter_value = N'<Failover Partner Name>';  
  
    -- Setting the -PublisherFailoverPartner parameter in the default Merge Agent profile (profile 6).  
    -- Execute sp_add_agent_parameter in the context of the distribution database.  
    exec sp_add_agent_parameter @profile_id = 6, @parameter_name = N'-PublisherFailoverPartner', @parameter_value = N'<Failover Partner Name>';  
    ```  
  
5.  <span data-ttu-id="f988e-166">Fügen Sie die Prinzipal- und die Spiegeldatenbank zum Replikationsmonitor hinzu.</span><span class="sxs-lookup"><span data-stu-id="f988e-166">Add the principal and mirror to Replication Monitor.</span></span> <span data-ttu-id="f988e-167">Weitere Informationen finden Sie unter [Hinzufügen und Entfernen von Verlegern vom Replikationsmonitor aus](../../relational-databases/replication/monitor/add-and-remove-publishers-from-replication-monitor.md).</span><span class="sxs-lookup"><span data-stu-id="f988e-167">For more information, see [Add and Remove Publishers from Replication Monitor](../../relational-databases/replication/monitor/add-and-remove-publishers-from-replication-monitor.md).</span></span>  
  
## <a name="maintaining-a-mirrored-publication-database"></a><span data-ttu-id="f988e-168">Warten einer gespiegelten Veröffentlichungsdatenbank</span><span class="sxs-lookup"><span data-stu-id="f988e-168">Maintaining a Mirrored Publication Database</span></span>  
 <span data-ttu-id="f988e-169">Das Warten einer gespiegelten Veröffentlichungsdatenbank gleicht im Wesentlichen dem Warten einer nicht gespiegelten Datenbank, wobei jedoch die folgenden Überlegungen zu berücksichtigen sind:</span><span class="sxs-lookup"><span data-stu-id="f988e-169">Maintaining a mirrored publication database is essentially the same as maintaining a non-mirrored database, with the following considerations:</span></span>  
  
-   <span data-ttu-id="f988e-170">Die Verwaltung und Überwachung muss auf dem aktiven Server erfolgen.</span><span class="sxs-lookup"><span data-stu-id="f988e-170">Administration and monitoring must occur at the active server.</span></span> <span data-ttu-id="f988e-171">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]werden Veröffentlichungen nur für den aktiven Server im Ordner **Lokale Veröffentlichungen** angezeigt.</span><span class="sxs-lookup"><span data-stu-id="f988e-171">In [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], publications appear under the **Local Publications** folder only for the active server.</span></span> <span data-ttu-id="f988e-172">Wenn z. B. ein Failover zur Spiegeldatenbank erfolgt ist, werden die Veröffentlichungen für die Spiegeldatenbank und nicht mehr für die Prinzipaldatenbank angezeigt.</span><span class="sxs-lookup"><span data-stu-id="f988e-172">For example, if you failover to the mirror, the publications are displayed at the mirror and are no longer displayed at the principal.</span></span> <span data-ttu-id="f988e-173">Wenn ein Failover der Datenbank zur Spiegeldatenbank erfolgt, müssen [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] und der Replikationsmonitor ggf. manuell aktualisiert werden, damit die Änderung berücksichtigt wird.</span><span class="sxs-lookup"><span data-stu-id="f988e-173">If the database fails over to the mirror, you might need to manually refresh [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] and Replication Monitor for the change to be reflected.</span></span>  
  
-   <span data-ttu-id="f988e-174">Der Replikationsmonitor zeigt Verlegerknoten in der Objektstruktur für die Prinzipaldatenbank und die Spiegeldatenbank an.</span><span class="sxs-lookup"><span data-stu-id="f988e-174">Replication Monitor displays Publisher nodes in the object tree for both the principal and the mirror.</span></span> <span data-ttu-id="f988e-175">Wenn der Prinzipalserver der aktive Server ist, werden die Veröffentlichungsinformationen nur unter dem Prinzipalknoten im Replikationsmonitor angezeigt.</span><span class="sxs-lookup"><span data-stu-id="f988e-175">If the principal is the active server, publication information is displayed only under the principal node in Replication Monitor.</span></span>  
  
     <span data-ttu-id="f988e-176">Wenn der Spiegelserver der aktive Server ist, geschieht Folgendes:</span><span class="sxs-lookup"><span data-stu-id="f988e-176">If the mirror is the active server:</span></span>  
  
    -   <span data-ttu-id="f988e-177">Wenn in einem Agent ein Fehler auftritt, wird der Fehler nur im Prinzipalknoten und nicht im Spiegelknoten angegeben.</span><span class="sxs-lookup"><span data-stu-id="f988e-177">If an agent has an error, the error is indicated only on the principal node, not on the mirror node.</span></span>  
  
    -   <span data-ttu-id="f988e-178">Wenn der Prinzipalserver nicht verfügbar ist, werden für den Prinzipal- und den Spiegelknoten identische Listen von Veröffentlichungen angezeigt.</span><span class="sxs-lookup"><span data-stu-id="f988e-178">If the principal is unavailable, the principal and mirror nodes display identical lists of publications.</span></span> <span data-ttu-id="f988e-179">Die Überwachung sollte für die Veröffentlichungen unter dem Spiegelknoten erfolgen.</span><span class="sxs-lookup"><span data-stu-id="f988e-179">Monitoring should be performed on the publications under the mirror node.</span></span>  
  
-   <span data-ttu-id="f988e-180">Beim Verwenden gespeicherter Prozeduren oder Replikationsverwaltungsobjekte (RMO, Replication Management Objects) zum Verwalten der Replikation in der Spiegeldatenbank müssen Sie in Fällen, in denen Sie den Verlegernamen angeben, den Namen der Instanz angeben, auf der die Datenbank für die Replikation aktiviert wurde.</span><span class="sxs-lookup"><span data-stu-id="f988e-180">When using stored procedures or Replication Management Objects (RMO) to administer replication at the mirror, for cases in which you specify the Publisher name, you must specify the name of the instance on which the database was enabled for replication.</span></span> <span data-ttu-id="f988e-181">Den entsprechenden Namen ermitteln Sie mithilfe der [publishingservername](/sql/t-sql/functions/replication-functions-publishingservername)-Funktion.</span><span class="sxs-lookup"><span data-stu-id="f988e-181">To determine the appropriate name, use the function [publishingservername](/sql/t-sql/functions/replication-functions-publishingservername).</span></span>  
  
     <span data-ttu-id="f988e-182">Wenn eine Veröffentlichungsdatenbank gespiegelt wird, sind die in der gespiegelten Datenbank gespeicherten Replikationsmetadaten identisch mit den Metadaten, die in der Prinzipaldatenbank gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="f988e-182">When a publication database is mirrored, the replication metadata stored in the mirrored database is identical to the metadata stored in the principal database.</span></span> <span data-ttu-id="f988e-183">Demzufolge entspricht für Veröffentlichungsdatenbanken, die in der Prinzipaldatenbank zur Replikation aktiviert wurden, der in den Systemtabellen gespeicherte Verlegerinstanzname dem Namen der Prinzipaldatenbank und nicht dem Namen der Spiegeldatenbank.</span><span class="sxs-lookup"><span data-stu-id="f988e-183">Consequently, for publication databases enabled for replication at the principal, the Publisher instance name stored in system tables at the mirror is the name of the principal, not the mirror.</span></span> <span data-ttu-id="f988e-184">Dies wirkt sich auf die Replikationskonfiguration und -wartung aus, wenn ein Failover der Veröffentlichungsdatenbank zur Spiegeldatenbank erfolgt.</span><span class="sxs-lookup"><span data-stu-id="f988e-184">This affects replication configuration and maintenance if the publication database fails over to the mirror.</span></span> <span data-ttu-id="f988e-185">Wenn Sie z. b. nach einem Failover die Replikation mit gespeicherten Prozeduren auf der Spiegelung konfigurieren und ein Pullabonnement zu einer Veröffentlichungs Datenbank hinzufügen möchten, die auf dem Prinzipal aktiviert wurde, müssen Sie anstelle des Spiegelungs namens für den **@publisher** Parameter von **sp_addpullsubscription** oder **sp_addmergepullsubscription**den Prinzipal Namen angeben.</span><span class="sxs-lookup"><span data-stu-id="f988e-185">For example, if you are configuring replication with stored procedures on the mirror after a failover, and you want to add a pull subscription to a publication database that was enabled at the principal, you must specify the principal name rather than the mirror name for the **@publisher** parameter of **sp_addpullsubscription** or **sp_addmergepullsubscription**.</span></span>  
  
     <span data-ttu-id="f988e-186">Wenn Sie eine Veröffentlichungs Datenbank nach einem Failover auf die Spiegelung in der Spiegelung aktivieren, ist der in den Systemtabellen gespeicherte Verlegerinstanzname der Name der Spiegelung. in diesem Fall würden Sie den Namen der Spiegelung für den Parameter verwenden **@publisher** .</span><span class="sxs-lookup"><span data-stu-id="f988e-186">If you enable a publication database at the mirror after failover to the mirror, the Publisher instance name stored in system tables is the name of the mirror; in this case, you would use the name of the mirror for the **@publisher** parameter.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="f988e-187">In einigen Fällen, z. B. bei **sp_addpublication**, wird der **@publisher** -Parameter nur für Nicht-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Verleger unterstützt. In diesen Fällen ist er nicht relevant für die [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Datenbankspiegelung.</span><span class="sxs-lookup"><span data-stu-id="f988e-187">In some cases, such as **sp_addpublication**, the **@publisher** parameter is supported only for non-[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Publishers; in these cases, it is not relevant for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] database mirroring.</span></span>  
  
-   <span data-ttu-id="f988e-188">Synchronisieren Sie die Pullabonnements vom Abonnenten und die Pushabonnements vom aktiven Verleger, um ein Abonnement in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] nach einem Failover zu synchronisieren.</span><span class="sxs-lookup"><span data-stu-id="f988e-188">To synchronize a subscription in [!INCLUDE[ssManStudio](../../includes/ssmanstudio-md.md)] after a failover: synchronize pull subscriptions from the Subscriber; and synchronize push subscriptions from the active Publisher.</span></span>  
  
### <a name="replication-behavior-if-mirroring-is-removed"></a><span data-ttu-id="f988e-189">Replikationsverhalten nach dem Entfernen der Spiegelung</span><span class="sxs-lookup"><span data-stu-id="f988e-189">Replication Behavior if Mirroring is Removed</span></span>  
 <span data-ttu-id="f988e-190">Beachten Sie beim Entfernen der Spiegelung von einer veröffentlichten Datenbank Folgendes:</span><span class="sxs-lookup"><span data-stu-id="f988e-190">Keep the following issues in mind if database mirroring is removed from a published database:</span></span>  
  
-   <span data-ttu-id="f988e-191">Wenn die Spiegelung der Veröffentlichungsdatenbank in der Prinzipaldatenbank deaktiviert wird, ist die Replikation unverändert für die ursprüngliche Prinzipaldatenbank funktionsfähig.</span><span class="sxs-lookup"><span data-stu-id="f988e-191">If the publication database at the principal is no longer mirrored, replication continues to work unchanged against the original principal.</span></span>  
  
-   <span data-ttu-id="f988e-192">Wenn ein Failover der Veröffentlichungsdatenbank von der Prinzipaldatenbank zur Spiegeldatenbank erfolgt und anschließend die Spiegelungsbeziehung deaktiviert oder entfernt wird, sind die Replikations-Agents nicht für die Spiegeldatenbank funktionsfähig.</span><span class="sxs-lookup"><span data-stu-id="f988e-192">If the publication database fails over from the principal to the mirror and the mirroring relationship is subsequently disabled or removed, replication agents will not function against the mirror.</span></span> <span data-ttu-id="f988e-193">Wenn die Prinzipaldatenbank dauerhaft verloren geht, deaktivieren Sie die Replikation, und konfigurieren Sie sie anschließend neu, wobei Sie die Spiegeldatenbank als Verleger angeben.</span><span class="sxs-lookup"><span data-stu-id="f988e-193">If the principal is permanently lost, disable and then reconfigure replication with the mirror specified as the Publisher.</span></span>  
  
-   <span data-ttu-id="f988e-194">Wenn die Datenbankspiegelung vollständig entfernt wird, befindet sich die Spiegeldatenbank in einem Wiederherstellungsstatus und muss wiederhergestellt werden, um funktionsfähig zu werden.</span><span class="sxs-lookup"><span data-stu-id="f988e-194">If database mirroring is removed completely, the mirror database is in a recovery state and must be restored in order to become functional.</span></span> <span data-ttu-id="f988e-195">Das Verhalten der wiederhergestellten Datenbank im Hinblick auf die Replikation richtet sich danach, ob die KEEP_REPLICATION-Option angegeben wurde.</span><span class="sxs-lookup"><span data-stu-id="f988e-195">The behavior of the recovered database with respect to replication depends on whether the KEEP_REPLICATION option is specified.</span></span> <span data-ttu-id="f988e-196">Diese Option weist den Wiederherstellungsvorgang an, die Replikationseinstellungen beizubehalten, wenn eine veröffentlichte Datenbank auf einem Server wiederhergestellt wird, der nicht mit dem Server identisch ist, auf dem die Datenbank erstellt wurde.</span><span class="sxs-lookup"><span data-stu-id="f988e-196">This option forces the restore operation to preserve replication settings when restoring a published database to a server other than that on which the backup was created.</span></span> <span data-ttu-id="f988e-197">Verwenden Sie die KEEP_REPLICATION-Option nur dann, wenn die andere Veröffentlichungsdatenbank nicht verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="f988e-197">Use the KEEP_REPLICATION option only when the other publication database is unavailable.</span></span> <span data-ttu-id="f988e-198">Die Option wird nicht unterstützt, wenn die andere Veröffentlichungsdatenbank noch intakt ist und weiter repliziert.</span><span class="sxs-lookup"><span data-stu-id="f988e-198">The option is not supported if the other publication database is still intact and replicating.</span></span> <span data-ttu-id="f988e-199">Weitere Informationen zu KEEP_REPLICATION finden Sie unter [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="f988e-199">For more information about KEEP_REPLICATION, see [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
## <a name="log-reader-agent-behavior"></a><span data-ttu-id="f988e-200">Verhalten des Protokolllese-Agents</span><span class="sxs-lookup"><span data-stu-id="f988e-200">Log Reader Agent Behavior</span></span>  
 <span data-ttu-id="f988e-201">Die folgende Tabelle beschreibt das Verhalten des Protokolllese-Agents für die verschiedenen Betriebsmodi der Datenbankspiegelung.</span><span class="sxs-lookup"><span data-stu-id="f988e-201">The following table describes Log Reader Agent behavior for the various operating modes of database mirroring.</span></span>  
  
|<span data-ttu-id="f988e-202">Betriebsmodus</span><span class="sxs-lookup"><span data-stu-id="f988e-202">Operating mode</span></span>|<span data-ttu-id="f988e-203">Verhalten des Protokolllese-Agents, wenn die Spiegeldatenbank nicht verfügbar ist</span><span class="sxs-lookup"><span data-stu-id="f988e-203">Log Reader Agent behavior if the mirror is unavailable</span></span>|  
|--------------------|------------------------------------------------------------|  
|<span data-ttu-id="f988e-204">Modus für hohe Sicherheit mit automatischem Failover</span><span class="sxs-lookup"><span data-stu-id="f988e-204">High-safety mode with automatic failover</span></span>|<span data-ttu-id="f988e-205">Wenn die Spiegeldatenbank nicht verfügbar ist, gibt der Protokolllese-Agent die Befehle an die Verteilungsdatenbank weiter.</span><span class="sxs-lookup"><span data-stu-id="f988e-205">If the mirror is unavailable, the Log Reader Agent propagates commands to the distribution database.</span></span> <span data-ttu-id="f988e-206">Ein Failover der Prinzipaldatenbank zur Spiegeldatenbank ist solange nicht möglich, bis die Spiegeldatenbank wieder online ist und alle Transaktionen von der Prinzipaldatenbank erhalten hat.</span><span class="sxs-lookup"><span data-stu-id="f988e-206">The principal cannot failover to the mirror until the mirror is back online and has all transactions from the principal.</span></span>|  
|<span data-ttu-id="f988e-207">Modus mit hoher Leistung</span><span class="sxs-lookup"><span data-stu-id="f988e-207">High-performance mode</span></span>|<span data-ttu-id="f988e-208">Wenn die Spiegeldatenbank nicht verfügbar ist, läuft sie ungeschützt (das heißt, sie wird nicht gespiegelt).</span><span class="sxs-lookup"><span data-stu-id="f988e-208">If the mirror is unavailable, the principal database is running exposed (that is, unmirrored).</span></span> <span data-ttu-id="f988e-209">Der Protokolllese-Agent repliziert jedoch nur solche Transaktionen, die in der Spiegeldatenbank festgeschrieben wurden.</span><span class="sxs-lookup"><span data-stu-id="f988e-209">However, the Log Reader Agent only replicates those transactions that are hardened on the mirror.</span></span> <span data-ttu-id="f988e-210">Wenn der Dienst erzwungen wird und der Spiegelserver die Rolle der Prinzipaldatenbank übernimmt, arbeitet der Protokolllese-Agent für die Spiegeldatenbank und beginnt mit dem Übernehmen der neuen Transaktionen.</span><span class="sxs-lookup"><span data-stu-id="f988e-210">If service is forced and the mirror server assumes the role of the principal, the Log Reader Agent will work against the mirror and start picking up the new transactions.</span></span><br /><br /> <span data-ttu-id="f988e-211">Beachten Sie, dass die Replikationslatenzzeit steigt, wenn die Spiegeldatenbank hinter die Prinzipaldatenbank zurückfällt.</span><span class="sxs-lookup"><span data-stu-id="f988e-211">Be aware that replication latency will increase if the mirror falls behind the principal.</span></span>|  
|<span data-ttu-id="f988e-212">Modus für hohe Sicherheit ohne automatisches Failover</span><span class="sxs-lookup"><span data-stu-id="f988e-212">High-safety mode without automatic failover</span></span>|<span data-ttu-id="f988e-213">Für alle Transaktionen, für die ein Commit ausgeführt wird, wird sichergestellt, dass sie auf dem Datenträger in der Spiegeldatenbank festgeschrieben werden.</span><span class="sxs-lookup"><span data-stu-id="f988e-213">All committed transactions are guaranteed to be hardened to disk on the mirror.</span></span> <span data-ttu-id="f988e-214">Der Protokolllese-Agent repliziert jedoch nur solche Transaktionen, die in der Spiegeldatenbank festgeschrieben wurden.</span><span class="sxs-lookup"><span data-stu-id="f988e-214">The Log Reader Agent replicates only those transactions that are hardened on the mirror.</span></span> <span data-ttu-id="f988e-215">Wenn die Spiegeldatenbank nicht verfügbar ist, deaktiviert die Prinzipaldatenbank jede weitere Aktivität in der Datenbank, weshalb der Protokolllese-Agent keine Transaktionen replizieren muss.</span><span class="sxs-lookup"><span data-stu-id="f988e-215">If the mirror is unavailable, the principal disallows further activity in the database; therefore the Log Reader Agent has no transactions to replicate.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="f988e-216">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="f988e-216">See Also</span></span>  
 <span data-ttu-id="f988e-217">[SQL Server-Replikation](../../relational-databases/replication/sql-server-replication.md) </span><span class="sxs-lookup"><span data-stu-id="f988e-217">[SQL Server Replication](../../relational-databases/replication/sql-server-replication.md) </span></span>  
 [<span data-ttu-id="f988e-218">Protokollversand und Replikation &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="f988e-218">Log Shipping and Replication &#40;SQL Server&#41;</span></span>](../log-shipping/log-shipping-and-replication-sql-server.md)  
  
  
