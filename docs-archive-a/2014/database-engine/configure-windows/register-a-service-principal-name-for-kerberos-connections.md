---
title: Registrieren eines Dienstprinzipalnamens für Kerberos-Verbindungen | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- connections [SQL Server], SPNs
- network connections [SQL Server], SPNs
- registering SPNs
- Server Principal Names
- SPNs [SQL Server]
ms.assetid: e38d5ce4-e538-4ab9-be67-7046e0d9504e
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: f4db1e8b86fca057acbce29491be9c2be91f0748
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87621177"
---
# <a name="register-a-service-principal-name-for-kerberos-connections"></a><span data-ttu-id="df72b-102">Registrieren eines Dienstprinzipalnamens für Kerberos-Verbindungen</span><span class="sxs-lookup"><span data-stu-id="df72b-102">Register a Service Principal Name for Kerberos Connections</span></span>
  <span data-ttu-id="df72b-103">Die Kerberos-Authentifizierung kann mit [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] verwendet werden, wenn die beiden folgenden Bedingungen erfüllt sind:</span><span class="sxs-lookup"><span data-stu-id="df72b-103">To use Kerberos authentication with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] requires both the following conditions to be true:</span></span>  
  
-   <span data-ttu-id="df72b-104">Der Client- und der Servercomputer müssen Teil der gleichen Windows-Domäne sein oder sich in vertrauenswürdigen Domänen befinden.</span><span class="sxs-lookup"><span data-stu-id="df72b-104">The client and server computers must be part of the same Windows domain, or in trusted domains.</span></span>  
  
-   <span data-ttu-id="df72b-105">Ein Dienstprinzipalname (Service Principal Name, SPN) muss in Active Directory registriert sein. Dieser Dienst nimmt die Rolle des Schlüsselverteilungscenters (KDC) in einer Windows-Domäne an.</span><span class="sxs-lookup"><span data-stu-id="df72b-105">A Service Principal Name (SPN) must be registered with Active Directory, which assumes the role of the Key Distribution Center in a Windows domain.</span></span> <span data-ttu-id="df72b-106">Der Dienstprinzipalname wird, wenn er registriert wurde, dem Windows-Konto zugeordnet, mit dem der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Instanzendienst gestartet wurde.</span><span class="sxs-lookup"><span data-stu-id="df72b-106">The SPN, after it is registered, maps to the Windows account that started the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance service.</span></span> <span data-ttu-id="df72b-107">Wenn die Registrierung des Dienstprinzipalnamens nicht erfolgt oder dabei ein Fehler aufgetreten ist, kann die Windows-Sicherheitsschicht nicht das Konto bestimmen, das dem Dienstprinzipalname zugewiesen ist. Das bedeutet, die Kerberos-Authentifizierung wird nicht verwendet.</span><span class="sxs-lookup"><span data-stu-id="df72b-107">If the SPN registration has not been performed or fails, the Windows security layer cannot determine the account associated with the SPN, and Kerberos authentication will not be used.</span></span>  
  
    > [!NOTE]  
    >  <span data-ttu-id="df72b-108">Wenn der Server den Dienstprinzipalnamen nicht automatisch registrieren kann, muss der Dienstprinzipalname manuell registriert werden.</span><span class="sxs-lookup"><span data-stu-id="df72b-108">If the server cannot automatically register the SPN, the SPN must be registered manually.</span></span> <span data-ttu-id="df72b-109">Siehe [Manuelle SPN-Registrierung](#Manual).</span><span class="sxs-lookup"><span data-stu-id="df72b-109">See [Manual SPN Registration](#Manual).</span></span>  
  
 <span data-ttu-id="df72b-110">Durch Abfragen der dynamischen Verwaltungssicht sys.dm_exec_connections können Sie überprüfen, ob eine Verbindung Kerberos verwendet.</span><span class="sxs-lookup"><span data-stu-id="df72b-110">You can verify that a connection is using Kerberos by querying the sys.dm_exec_connections dynamic management view.</span></span> <span data-ttu-id="df72b-111">Führen Sie die folgende Abfrage aus, und überprüfen Sie den Wert der Spalte auth_scheme, der "KERBEROS" lautet, wenn Kerberos aktiviert ist.</span><span class="sxs-lookup"><span data-stu-id="df72b-111">Run the following query and check the value of the auth_scheme column, which will be "KERBEROS" if Kerberos is enabled.</span></span>  
  
```  
SELECT auth_scheme FROM sys.dm_exec_connections WHERE session_id = @@spid ;  
```  
  
> [!TIP]  
>  <span data-ttu-id="df72b-112">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos-Konfigurations-Manager für [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** ist ein Diagnosetool zur Behebung Kerberos-bezogener Verbindungsprobleme bei [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="df72b-112">**[!INCLUDE[msCoName](../../includes/msconame-md.md)] Kerberos Configuration Manager for [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]** is a diagnostic tool that helps troubleshoot Kerberos related connectivity issues with [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="df72b-113">Weitere Informationen finden Sie unter [Microsoft Kerberos-Konfigurations-Manager für SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span><span class="sxs-lookup"><span data-stu-id="df72b-113">For more information, see [Microsoft Kerberos Configuration Manager for SQL Server](https://www.microsoft.com/download/details.aspx?id=39046).</span></span>  
  
##  <a name="the-role-of-the-spn-in-authentication"></a><a name="Role"></a> <span data-ttu-id="df72b-114">Die Rolle des Dienstprinzipalnamens bei der Authentifizierung</span><span class="sxs-lookup"><span data-stu-id="df72b-114">The Role of the SPN in Authentication</span></span>  
 <span data-ttu-id="df72b-115">Wenn eine Anwendung eine Verbindung öffnet und die Windows-Authentifizierung verwendet, übergibt der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client den [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Computernamen, -Instanznamen und optional einen SPN.</span><span class="sxs-lookup"><span data-stu-id="df72b-115">When an application opens a connection and uses Windows Authentication, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Native Client passes the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] computer name, instance name and, optionally, an SPN.</span></span> <span data-ttu-id="df72b-116">Wenn die Verbindung einen Dienstprinzipalnamen übergibt, wird dieser ohne Änderungen verwendet.</span><span class="sxs-lookup"><span data-stu-id="df72b-116">If the connection passes an SPN it is used without any changes.</span></span>  
  
 <span data-ttu-id="df72b-117">Wenn die Verbindung keinen Dienstprinzipalnamen übergibt, wird ein Standard-Dienstprinzipalname basierend auf verwendetem Protokoll, Servernamen und Instanzennamen erstellt.</span><span class="sxs-lookup"><span data-stu-id="df72b-117">If the connection does not pass an SPN, a default SPN is constructed based on the protocol used, server name, and the instance name.</span></span>  
  
 <span data-ttu-id="df72b-118">In beiden Szenarien wird der Dienstprinzipalname an das Schlüsselverteilungscenter gesendet, um ein Sicherheitstoken zum Authentifizieren der Verbindung abzurufen.</span><span class="sxs-lookup"><span data-stu-id="df72b-118">In both of the preceding scenarios, the SPN is sent to the Key Distribution Center to obtain a security token for authenticating the connection.</span></span> <span data-ttu-id="df72b-119">Wenn kein Sicherheitstoken abgerufen werden kann, verwendet die Authentifizierung NTLM.</span><span class="sxs-lookup"><span data-stu-id="df72b-119">If a security token cannot be obtained, authentication uses NTLM.</span></span>  
  
 <span data-ttu-id="df72b-120">Ein Dienstprinzipalname (SPN, Service Principal Name) ist der Name, über den ein Client eine Instanz eines Diensts eindeutig identifiziert.</span><span class="sxs-lookup"><span data-stu-id="df72b-120">A service principal name (SPN) is the name by which a client uniquely identifies an instance of a service.</span></span> <span data-ttu-id="df72b-121">Der Kerberos-Authentifizierungsdienst kann einen SPN zum Authentifizieren eines Diensts verwenden.</span><span class="sxs-lookup"><span data-stu-id="df72b-121">The Kerberos authentication service can use an SPN to authenticate a service.</span></span> <span data-ttu-id="df72b-122">Wenn ein Client eine Verbindung zu einem Dienst herstellen möchte, sucht er eine Instanz des Diensts, verfasst einen SPN für diese Instanz, stellt eine Verbindung zum Dienst her und übergibt den SPN zur Authentifizierung an den Dienst.</span><span class="sxs-lookup"><span data-stu-id="df72b-122">When a client wants to connect to a service, it locates an instance of the service, composes an SPN for that instance, connects to the service, and presents the SPN for the service to authenticate.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="df72b-123">Die Informationen in diesem Thema gelten auch für [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Konfigurationen, die Clustering verwenden.</span><span class="sxs-lookup"><span data-stu-id="df72b-123">The information that is provided in this topic also applies to [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] configurations that use clustering.</span></span>  
  
 <span data-ttu-id="df72b-124">Die bevorzugte Methode für die Authentifizierung von Benutzern bei SQL Server ist Windows-Authentifizierung.</span><span class="sxs-lookup"><span data-stu-id="df72b-124">Windows Authentication is the preferred method for users to authenticate to SQL Server.</span></span> <span data-ttu-id="df72b-125">Clients, die Windows-Authentifizierung verwenden, werden mit NTLM oder Kerberos authentifiziert.</span><span class="sxs-lookup"><span data-stu-id="df72b-125">Clients that use Windows Authentication are authenticated by either using NTLM or Kerberos.</span></span> <span data-ttu-id="df72b-126">In einer Active Directory-Umgebung wird immer zuerst Kerberos-Authentifizierung ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="df72b-126">In an Active Directory environment, Kerberos authentication is always attempted first.</span></span> <span data-ttu-id="df72b-127">Die Kerberos-Authentifizierung ist für [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] -Clients, die Named Pipes verwenden, nicht verfügbar.</span><span class="sxs-lookup"><span data-stu-id="df72b-127">Kerberos authentication is not available for [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] clients using named pipes.</span></span>  
  
##  <a name="permissions"></a><a name="Permissions"></a> <span data-ttu-id="df72b-128">Berechtigungen</span><span class="sxs-lookup"><span data-stu-id="df72b-128">Permissions</span></span>  
 <span data-ttu-id="df72b-129">Beim Starten des [!INCLUDE[ssDE](../../includes/ssde-md.md)] -Diensts versucht dieser, den Dienstprinzipalnamen (Service Principal Name, SPN) zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="df72b-129">When the [!INCLUDE[ssDE](../../includes/ssde-md.md)] service starts, it attempts to register the Service Principal Name (SPN).</span></span> <span data-ttu-id="df72b-130">Wenn das Konto, das SQL Server startet, nicht über die Berechtigung zum Registrieren eines SPN in den Active Directory-Domänendiensten verfügt, schlägt dieser Aufruf fehl, und im Anwendungsereignisprotokoll sowie im SQL Server-Fehlerprotokoll wird eine Warnmeldung protokolliert.</span><span class="sxs-lookup"><span data-stu-id="df72b-130">If the account starting SQL Server doesn't have permission to register a SPN in Active Directory Domain Services, this call will fail and a warning message will be logged in the Application event log as well as the SQL Server error log.</span></span> <span data-ttu-id="df72b-131">Um den SPN zu registrieren, muss [!INCLUDE[ssDE](../../includes/ssde-md.md)] unter einem integrierten Konto, z. B. einem lokalen System (nicht empfohlen) oder NETWORK SERVICE, oder unter einem Konto mit Berechtigung zum Registrieren eines SPN, z. B. einem Domänenadministratorkonto, ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="df72b-131">To register the SPN, the [!INCLUDE[ssDE](../../includes/ssde-md.md)] must be running under a built-in account, such as Local System (not recommended), or NETWORK SERVICE, or an account that has permission to register an SPN, such as a domain administrator account.</span></span> <span data-ttu-id="df72b-132">Wenn [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] unter dem Betriebssystem  [!INCLUDE[win7](../../includes/win7-md.md)] oder  [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] ausgeführt wird, können Sie [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] mit einem virtuellen Konto oder einem verwalteten Dienstkonto (MSA) ausführen.</span><span class="sxs-lookup"><span data-stu-id="df72b-132">When [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is running on the  [!INCLUDE[win7](../../includes/win7-md.md)] or  [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] operating system, you can run [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] using a virtual account or a managed service account (MSA).</span></span> <span data-ttu-id="df72b-133">Sowohl virtuelle Konten als auch MSAs können einen SPN registrieren.</span><span class="sxs-lookup"><span data-stu-id="df72b-133">Both virtual accounts and MSA's can register an SPN.</span></span> <span data-ttu-id="df72b-134">Wird unter [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] kein solches Konto ausgeführt, wird der SPN beim Starten nicht registriert, sodass der Domänenadministrator den SPN manuell registrieren muss.</span><span class="sxs-lookup"><span data-stu-id="df72b-134">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is not running under one of these accounts, the SPN is not registered at startup and the domain administrator must register the SPN manually.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="df72b-135">Wenn die Windows-Domäne zum Ausführen auf einer geringeren Ebene als der [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] Windows Server 2008 R2-Funktionsebene konfiguriert ist, verfügt das verwaltete Dienstkonto nicht über die notwendigen Berechtigungen zum Registrieren der SPNs für den [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] -Dienst.</span><span class="sxs-lookup"><span data-stu-id="df72b-135">When the Windows domain is configured to run at less than the [!INCLUDE[winserver2008r2](../../includes/winserver2008r2-md.md)] Windows Server 2008 R2 functional level, then the Managed Service Account will not have the necessary permissions to register the SPNs for the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] service.</span></span> <span data-ttu-id="df72b-136">Ist die Kerberos-Authentifizierung erforderlich, muss der Domänenadministrator die [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -SPNs über das verwaltete Dienstkonto manuell registrieren.</span><span class="sxs-lookup"><span data-stu-id="df72b-136">If Kerberos authentication is required, the Domain Administrator should manually register the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] SPNs on the Managed Service Account.</span></span>  
  
 <span data-ttu-id="df72b-137">Der KB-Artikel [Verwenden der Kerberos-Authentifizierung in SQL Server](https://support.microsoft.com/kb/319723)enthält Informationen zum Gewähren von Lese- und Schreibberechtigungen für einen SPN für ein Nicht-Domänenadministratorkonto.</span><span class="sxs-lookup"><span data-stu-id="df72b-137">The KB article, [How to use Kerberos authentication in SQL Server](https://support.microsoft.com/kb/319723), contains information about how to grant read or write permission to an SPN for an account that is not a Domain Administrator.</span></span>  
  
 <span data-ttu-id="df72b-138">Weitere Informationen sind unter [Implementieren von eingeschränkter Kerberos-Delegierung mit SQL Server 2008](https://technet.microsoft.com/library/ee191523.aspx)verfügbar</span><span class="sxs-lookup"><span data-stu-id="df72b-138">Additional information is available at [How to Implement Kerberos Constrained Delegation with SQL Server 2008](https://technet.microsoft.com/library/ee191523.aspx)</span></span>  
  
##  <a name="spn-formats"></a><a name="Formats"></a> <span data-ttu-id="df72b-139">SPN-Formate</span><span class="sxs-lookup"><span data-stu-id="df72b-139">SPN Formats</span></span>  
 <span data-ttu-id="df72b-140">In [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)]wurde das SPN-Format geändert, um die Kerberos-Authentifizierung unter TCP/IP, Named Pipes und Shared Memory zu unterstützen.</span><span class="sxs-lookup"><span data-stu-id="df72b-140">Beginning with [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], the SPN format is changed in order to support Kerberos authentication on TCP/IP, named pipes, and shared memory.</span></span> <span data-ttu-id="df72b-141">Die folgenden SPN-Formate für benannte und Standardinstanzen werden unterstützt.</span><span class="sxs-lookup"><span data-stu-id="df72b-141">The supported SPN formats for named and default instances are as follows.</span></span>  
  
 <span data-ttu-id="df72b-142">**Benannte Instanz**</span><span class="sxs-lookup"><span data-stu-id="df72b-142">**Named instance**</span></span>  
  
-   <span data-ttu-id="df72b-143">*MSSQLSvc/FQDN*:[_port_**|**_instancename_], wobei:</span><span class="sxs-lookup"><span data-stu-id="df72b-143">*MSSQLSvc/FQDN*:[_port_**|**_instancename_], where:</span></span>  
  
    -   <span data-ttu-id="df72b-144">*MSSQLSvc* der Dienst ist, der registriert wird.</span><span class="sxs-lookup"><span data-stu-id="df72b-144">*MSSQLSvc* is the service that is being registered.</span></span>  
  
    -   <span data-ttu-id="df72b-145">*FQDN* ist der voll qualifizierte Domänen Name des Servers.</span><span class="sxs-lookup"><span data-stu-id="df72b-145">*FQDN* is the fully qualified domain name of the server.</span></span>  
  
    -   <span data-ttu-id="df72b-146">*Port* ist die TCP-Portnummer.</span><span class="sxs-lookup"><span data-stu-id="df72b-146">*port* is the TCP port number.</span></span>  
  
    -   <span data-ttu-id="df72b-147">*instanceName* ist der Name der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Instanz.</span><span class="sxs-lookup"><span data-stu-id="df72b-147">*instancename* is the name of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
 <span data-ttu-id="df72b-148">**Standardinstanz**</span><span class="sxs-lookup"><span data-stu-id="df72b-148">**Default instance**</span></span>  
  
-   <span data-ttu-id="df72b-149">*MSSQLSvc/voll qualifizierter*Pfad:_Port_ **|** _MSSQLSvc/_ vollständig verfügbar, wobei:</span><span class="sxs-lookup"><span data-stu-id="df72b-149">*MSSQLSvc/FQDN*:_port_**|**_MSSQLSvc/FQDN_, where:</span></span>  
  
    -   <span data-ttu-id="df72b-150">*MSSQLSvc* der Dienst ist, der registriert wird.</span><span class="sxs-lookup"><span data-stu-id="df72b-150">*MSSQLSvc* is the service that is being registered.</span></span>  
  
    -   <span data-ttu-id="df72b-151">*FQDN* ist der voll qualifizierte Domänen Name des Servers.</span><span class="sxs-lookup"><span data-stu-id="df72b-151">*FQDN* is the fully qualified domain name of the server.</span></span>  
  
    -   <span data-ttu-id="df72b-152">*Port* ist die TCP-Portnummer.</span><span class="sxs-lookup"><span data-stu-id="df72b-152">*port* is the TCP port number.</span></span>  
  
 <span data-ttu-id="df72b-153">Beim neuen SPN-Format ist keine Portnummer erforderlich.</span><span class="sxs-lookup"><span data-stu-id="df72b-153">The new SPN format does not require a port number.</span></span> <span data-ttu-id="df72b-154">Somit können Server mit mehreren Ports oder Protokolle ohne Portnummern Kerberos-Authentifizierung verwenden.</span><span class="sxs-lookup"><span data-stu-id="df72b-154">This means that a multiple-port server or a protocol that does not use port numbers can use Kerberos authentication.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="df72b-155">Bei TCP/IP-Verbindungen, bei denen der TCP-Port im SPN enthalten ist, muss [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] das TCP-Protokoll für einen Benutzer aktivieren, um mithilfe der Kerberos-Authentifizierung eine Verbindung herzustellen.</span><span class="sxs-lookup"><span data-stu-id="df72b-155">In the case of a TCP/IP connection, where the TCP port is included in the SPN, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] must enable the TCP protocol for a user to connect by using Kerberos authentication.</span></span>  
  
|||  
|-|-|  
|<span data-ttu-id="df72b-156">MSSQLSvc/voll*qualifizierter Name: Port*</span><span class="sxs-lookup"><span data-stu-id="df72b-156">MSSQLSvc/*fqdn:port*</span></span>|<span data-ttu-id="df72b-157">Der vom Anbieter erstellte Standard-SPN, wenn TCP verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="df72b-157">The provider-generated, default SPN when TCP is used.</span></span> <span data-ttu-id="df72b-158">*port* ist eine TCP-Portnummer.</span><span class="sxs-lookup"><span data-stu-id="df72b-158">*port* is a TCP port number.</span></span>|  
|<span data-ttu-id="df72b-159">MSSQLSvc/*voll* ständig verfügbar</span><span class="sxs-lookup"><span data-stu-id="df72b-159">MSSQLSvc/*fqdn*</span></span>|<span data-ttu-id="df72b-160">Der vom Anbieter erstellte Standard-SPN für eine Standardinstanz, wenn ein anderes Protokoll als TCP verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="df72b-160">The provider-generated, default SPN for a default instance when a protocol other than TCP is used.</span></span> <span data-ttu-id="df72b-161">*FQDN* ist ein voll qualifizierter Domänen Name.</span><span class="sxs-lookup"><span data-stu-id="df72b-161">*fqdn* is a fully-qualified domain name.</span></span>|  
|<span data-ttu-id="df72b-162">MSSQLSvc/*FQDN: instanceName*</span><span class="sxs-lookup"><span data-stu-id="df72b-162">MSSQLSvc/*fqdn:InstanceName*</span></span>|<span data-ttu-id="df72b-163">Der vom Anbieter erstellte Standard-SPN für eine benannte Instanz, wenn ein anderes Protokoll als TCP verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="df72b-163">The provider-generated, default SPN for a named instance when a protocol other than TCP is used.</span></span> <span data-ttu-id="df72b-164">*InstanceName* ist der Name einer Instanz von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="df72b-164">*InstanceName* is the name of an instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>|  
  
##  <a name="automatic-spn-registration"></a><a name="Auto"></a> <span data-ttu-id="df72b-165">Automatische SPN-Registrierung</span><span class="sxs-lookup"><span data-stu-id="df72b-165">Automatic SPN Registration</span></span>  
 <span data-ttu-id="df72b-166">Beim Starten einer Instanz von [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] versucht [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , den SPN für den [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Dienst zu registrieren.</span><span class="sxs-lookup"><span data-stu-id="df72b-166">When an instance of the [!INCLUDE[ssDEnoversion](../../includes/ssdenoversion-md.md)] starts, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tries to register the SPN for the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] service.</span></span> <span data-ttu-id="df72b-167">Wird die Instanz beendet, versucht [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] , die Registrierung des SPN wieder aufzuheben.</span><span class="sxs-lookup"><span data-stu-id="df72b-167">When the instance is stopped, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] tries to unregister the SPN.</span></span> <span data-ttu-id="df72b-168">Bei TCP/IP-Verbindungen wird der SPN im folgenden Format registriert: *MSSQLSvc/\<FQDN>* : *\<tcpport>* . Sowohl benannte Instanzen als auch die Standardinstanz werden als *MSSQLSvc* registriert, und zur Unterscheidung der Instanzen wird der Wert *\<tcpport>* verwendet.</span><span class="sxs-lookup"><span data-stu-id="df72b-168">For a TCP/IP connection the SPN is registered in the format *MSSQLSvc/\<FQDN>*:*\<tcpport>*.Both named instances and the default instance are registered as *MSSQLSvc*, relying on the *\<tcpport>* value to differentiate the instances.</span></span>  
  
 <span data-ttu-id="df72b-169">Bei anderen Verbindungen, die Kerberos unterstützen, wird der SPN im Format *MSSQLSvc \<FQDN> /*: *\<instancename>* für eine benannte Instanz registriert.</span><span class="sxs-lookup"><span data-stu-id="df72b-169">For other connections that support Kerberos the SPN is registered in the format *MSSQLSvc/\<FQDN>*:*\<instancename>* for a named instance.</span></span> <span data-ttu-id="df72b-170">Die Standardinstanz wird im folgenden Format registriert: *MSSQLSvc/\<FQDN>* .</span><span class="sxs-lookup"><span data-stu-id="df72b-170">The format for registering the default instance is *MSSQLSvc/\<FQDN>*.</span></span>  
  
 <span data-ttu-id="df72b-171">Die Registrierung bzw. die Aufhebung der Registrierung eines SPN muss möglicherweise manuell durchgeführt werden, wenn der Dienst nicht über die Berechtigungen für diese Aktionen verfügt.</span><span class="sxs-lookup"><span data-stu-id="df72b-171">Manual intervention might be required to register or unregister the SPN if the service account lacks the permissions that are required for these actions.</span></span>  
  
##  <a name="manual-spn-registration"></a><a name="Manual"></a> <span data-ttu-id="df72b-172">Manuelle SPN-Registrierung</span><span class="sxs-lookup"><span data-stu-id="df72b-172">Manual SPN Registration</span></span>  
 <span data-ttu-id="df72b-173">Um den SPN manuell zu registrieren, muss der Administrator das Setspn.exe-Tool verwenden, das mit den Microsoft [!INCLUDE[winxpsvr](../../includes/winxpsvr-md.md)] -Supporttools geliefert wird.</span><span class="sxs-lookup"><span data-stu-id="df72b-173">To register the SPN manually, the administrator must use the Setspn.exe tool that is provided with the Microsoft [!INCLUDE[winxpsvr](../../includes/winxpsvr-md.md)] Support Tools.</span></span> <span data-ttu-id="df72b-174">Weitere Informationen finden Sie im KB-Artikel [Supporttools in Windows Server 2003 Service Pack 1](https://support.microsoft.com/kb/892777) .</span><span class="sxs-lookup"><span data-stu-id="df72b-174">For more information, see the [Windows Server 2003 Service Pack 1 Support Tools](https://support.microsoft.com/kb/892777) KB article.</span></span>  
  
 <span data-ttu-id="df72b-175">Setspn.exe ist ein Befehlszeilentool, mit dem Sie die SPN-Verzeichniseigenschaft lesen, ändern und löschen können.</span><span class="sxs-lookup"><span data-stu-id="df72b-175">Setspn.exe is a command line tool that enables you to read, modify, and delete the Service Principal Names (SPN) directory property.</span></span> <span data-ttu-id="df72b-176">Mit diesem Tool können Sie auch die aktuellen SPN anzeigen, die Standard-SPN des Kontos zurücksetzen und zusätzliche SPN hinzufügen oder löschen.</span><span class="sxs-lookup"><span data-stu-id="df72b-176">This tool also enables you to view the current SPNs, reset the account's default SPNs, and add or delete supplemental SPNs.</span></span>  
  
 <span data-ttu-id="df72b-177">Im folgenden Beispiel wird die Syntax dargestellt, mit der ein SPN für eine TCP/IP-Verbindung manuell registriert wird.</span><span class="sxs-lookup"><span data-stu-id="df72b-177">The following example illustrates the syntax used to register manually register an SPN for a TCP/IP connection.</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com:1433 accountname  
```  
  
 <span data-ttu-id="df72b-178">**Hinweis** Wenn bereits ein SPN vorhanden ist, muss er gelöscht werden, bevor er erneut registriert werden kann.</span><span class="sxs-lookup"><span data-stu-id="df72b-178">**Note** If an SPN already exists, it must be deleted before it can be reregistered.</span></span> <span data-ttu-id="df72b-179">Verwenden Sie dafür den `setspn` -Befehl und den `-D` -Schalter.</span><span class="sxs-lookup"><span data-stu-id="df72b-179">You do this by using the `setspn` command together with the `-D` switch.</span></span> <span data-ttu-id="df72b-180">In den folgenden Beispielen wird veranschaulicht, wie Sie einen neuen instanzbasierten SPN manuell registrieren können.</span><span class="sxs-lookup"><span data-stu-id="df72b-180">The following examples illustrate how to manually register a new instance-based SPN.</span></span> <span data-ttu-id="df72b-181">Verwenden Sie für die Standardinstanz Folgendes:</span><span class="sxs-lookup"><span data-stu-id="df72b-181">For a default instance, use:</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com accountname  
```  
  
 <span data-ttu-id="df72b-182">Verwenden Sie für eine benannte Instanz Folgendes:</span><span class="sxs-lookup"><span data-stu-id="df72b-182">For a named instance, use:</span></span>  
  
```  
setspn -A MSSQLSvc/myhost.redmond.microsoft.com:instancename accountname  
```  
  
##  <a name="client-connections"></a><a name="Client"></a> <span data-ttu-id="df72b-183">Clientverbindungen</span><span class="sxs-lookup"><span data-stu-id="df72b-183">Client Connections</span></span>  
 <span data-ttu-id="df72b-184">Clienttreiber unterstützen vom Benutzer angegebene SPN.</span><span class="sxs-lookup"><span data-stu-id="df72b-184">User-specified SPNs are supported in client drivers.</span></span> <span data-ttu-id="df72b-185">Wenn jedoch kein SPN angegeben wurde, wird er auf der Grundlage des Clientverbindungstyps automatisch erstellt.</span><span class="sxs-lookup"><span data-stu-id="df72b-185">However, if an SPN is not provided, it will be generated automatically based on the type of a client connection.</span></span> <span data-ttu-id="df72b-186">Bei einer TCP-Verbindung wird ein SPN im Format *MSSQLSvc*/*FQDN*:[*port*] sowohl für benannte als auch für Standardinstanzen verwendet.</span><span class="sxs-lookup"><span data-stu-id="df72b-186">For a TCP connection, an SPN in the format *MSSQLSvc*/*FQDN*:[*port*] is used for both the named and default instances.</span></span>  
  
 <span data-ttu-id="df72b-187">Für Named Pipes und Shared Memory-Verbindungen wird ein SPN im Format *MSSQLSvc* / *FQDN*:*instanceName* für eine benannte Instanz und *MSSQLSvc* / *FQDN* für die Standard Instanz verwendet.</span><span class="sxs-lookup"><span data-stu-id="df72b-187">For named pipes and shared memory connections, an SPN in the format *MSSQLSvc*/*FQDN*:*instancename* is used for a named instance and *MSSQLSvc*/*FQDN* is used for the default instance.</span></span>  
  
 <span data-ttu-id="df72b-188">**Verwenden eines Dienstkontos als SPN**</span><span class="sxs-lookup"><span data-stu-id="df72b-188">**Using a service account as an SPN**</span></span>  
  
 <span data-ttu-id="df72b-189">Dienstkonten können als SPN verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="df72b-189">Service accounts can be used as an SPN.</span></span> <span data-ttu-id="df72b-190">Sie werden durch das Verbindungsattribut für die Kerberos-Authentifizierung angegeben und liegen in den folgenden Formaten vor:</span><span class="sxs-lookup"><span data-stu-id="df72b-190">They are specified through the connection attribute for the Kerberos authentication and take the following formats:</span></span>  
  
-   <span data-ttu-id="df72b-191">**username@domain**oder Domäne **\ Benutzername** für ein Domänen Benutzerkonto</span><span class="sxs-lookup"><span data-stu-id="df72b-191">**username@domain** or **domain\username** for a domain user account</span></span>  
  
-   <span data-ttu-id="df72b-192">**Computer$@domain** oder **Host\FQDN** für ein Computerdomänenkonto, z.B. Lokales System oder NETWORK SERVICES.</span><span class="sxs-lookup"><span data-stu-id="df72b-192">**machine$@domain** or **host\FQDN** for a computer domain account such as Local System or NETWORK SERVICES.</span></span>  
  
 <span data-ttu-id="df72b-193">Um die Authentifizierungsmethode einer Verbindung zu bestimmen, führen Sie die folgende Abfrage aus.</span><span class="sxs-lookup"><span data-stu-id="df72b-193">To determine the authentication method of a connection, execute the following query.</span></span>  
  
```sql  
SELECT net_transport, auth_scheme   
FROM sys.dm_exec_connections   
WHERE session_id = @@SPID;  
```  
  
##  <a name="authentication-defaults"></a><a name="Defaults"></a> <span data-ttu-id="df72b-194">Authentifizierungsstandardwerte</span><span class="sxs-lookup"><span data-stu-id="df72b-194">Authentication Defaults</span></span>  
 <span data-ttu-id="df72b-195">In der folgenden Tabelle werden die Authentifizierungsstandardwerte beschrieben, die auf Grundlage von SPN-Registrierungsszenarios verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="df72b-195">The following table describes the authentication defaults that are used based on SPN registration scenarios.</span></span>  
  
|<span data-ttu-id="df72b-196">Szenario</span><span class="sxs-lookup"><span data-stu-id="df72b-196">Scenario</span></span>|<span data-ttu-id="df72b-197">Authentifizierungsmethode</span><span class="sxs-lookup"><span data-stu-id="df72b-197">Authentication method</span></span>|  
|--------------|---------------------------|  
|<span data-ttu-id="df72b-198">Der SPN ist dem richtigen Domänenkonto, virtuellen Konto, MSA oder integrierten Konto zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="df72b-198">The SPN maps to the correct domain account, virtual account, MSA, or built-in account.</span></span> <span data-ttu-id="df72b-199">Beispiel: Lokales System oder NETWORK SERVICE.</span><span class="sxs-lookup"><span data-stu-id="df72b-199">For example, Local System or NETWORK SERVICE.</span></span><br /><br /> <span data-ttu-id="df72b-200">Hinweis: richtig bedeutet, dass das Konto, das durch den registrierten SPN zugeordnet ist, das Konto ist, unter dem der SQL Server-Dienst ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="df72b-200">Note: Correct means that the account mapped by the registered SPN is the account that the SQL Server service is running under.</span></span>|<span data-ttu-id="df72b-201">Lokale Verbindungen verwenden NTLM, Remoteverbindungen verwenden Kerberos.</span><span class="sxs-lookup"><span data-stu-id="df72b-201">Local connections use NTLM, remote connections use Kerberos.</span></span>|  
|<span data-ttu-id="df72b-202">Der SPN entspricht dem richtigen Domänenkonto, virtuellen Konto, MSA oder integrierten Konto.</span><span class="sxs-lookup"><span data-stu-id="df72b-202">The SPN is the correct domain account, virtual account, MSA, or built-in account.</span></span><br /><br /> <span data-ttu-id="df72b-203">Hinweis: richtig bedeutet, dass das Konto, das durch den registrierten SPN zugeordnet ist, das Konto ist, unter dem der SQL Server-Dienst ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="df72b-203">Note: Correct means that the account mapped by the registered SPN is the account that the SQL Server service is running under.</span></span>|<span data-ttu-id="df72b-204">Lokale Verbindungen verwenden NTLM, Remoteverbindungen verwenden Kerberos.</span><span class="sxs-lookup"><span data-stu-id="df72b-204">Local connections use NTLM, remote connections use Kerberos.</span></span>|  
|<span data-ttu-id="df72b-205">Der SPN ist einem falschen Domänenkonto, virtuellen Konto, MSA oder integrierten Konto zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="df72b-205">The SPN maps to an incorrect domain account, virtual account, MSA, or built-in account</span></span>|<span data-ttu-id="df72b-206">Die Authentifizierung schlägt fehl.</span><span class="sxs-lookup"><span data-stu-id="df72b-206">Authentication fails.</span></span>|  
|<span data-ttu-id="df72b-207">Die SPN-Suche schlägt fehl, oder der SPN ist nicht dem richtigen Domänenkonto, virtuellen Konto, MSA oder integrierten Konto zugeordnet bzw. entspricht nicht dem richtigen Domänenkonto, virtuellen Konto, MSA oder integrierten Konto.</span><span class="sxs-lookup"><span data-stu-id="df72b-207">The SPN lookup fails or does not map to a correct domain account, virtual account, MSA, or built-in account, or is not a correct domain account, virtual account, MSA, or built-in account.</span></span>|<span data-ttu-id="df72b-208">Lokale Verbindungen und Remoteverbindungen verwenden NTLM.</span><span class="sxs-lookup"><span data-stu-id="df72b-208">Local and remote connections use NTLM.</span></span>|  
  
##  <a name="comments"></a><a name="Comments"></a> <span data-ttu-id="df72b-209">Kommentare</span><span class="sxs-lookup"><span data-stu-id="df72b-209">Comments</span></span>  
 <span data-ttu-id="df72b-210">Die dedizierte Administratorverbindung (Dedicated Administrator Connection, DAC) verwendet einen auf Instanznamen basierenden SPN.</span><span class="sxs-lookup"><span data-stu-id="df72b-210">The Dedicated Administrator Connection (DAC) uses an instance name based SPN.</span></span> <span data-ttu-id="df72b-211">Die Kerberos-Authentifizierung kann mit einer DAC verwendet werden, wenn dieser SPN erfolgreich registriert wurde.</span><span class="sxs-lookup"><span data-stu-id="df72b-211">Kerberos authentication can be used with a DAC if that SPN is registered successfully.</span></span> <span data-ttu-id="df72b-212">Alternativ kann ein Benutzer den Kontonamen als SPN festlegen.</span><span class="sxs-lookup"><span data-stu-id="df72b-212">As an alternative a user can specify the account name as an SPN.</span></span>  
  
 <span data-ttu-id="df72b-213">Wenn die SPN-Registrierung beim Starten fehlschlägt, wird dieser Fehler im Fehlerprotokoll von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] aufgezeichnet, und der Startvorgang wird fortgesetzt.</span><span class="sxs-lookup"><span data-stu-id="df72b-213">If SPN registration fails during startup, this failure is recorded in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, and startup continues.</span></span>  
  
 <span data-ttu-id="df72b-214">Wenn die Aufhebung der SPN-Registrierung beim Herunterfahren fehlschlägt, wird dieser Fehler im Fehlerprotokoll von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] aufgezeichnet, und das Herunterfahren wird fortgesetzt.</span><span class="sxs-lookup"><span data-stu-id="df72b-214">If SPN de-registration fails during shutdown, this failure is recorded in the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, and shutdown continues.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="df72b-215">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="df72b-215">See Also</span></span>  
 <span data-ttu-id="df72b-216">[Unterstützung von Dienstprinzipalnamen &#40;SPN&#41; in Clientverbindungen](../../relational-databases/native-client/features/service-principal-name-spn-support-in-client-connections.md) </span><span class="sxs-lookup"><span data-stu-id="df72b-216">[Service Principal Name &#40;SPN&#41; Support in Client Connections](../../relational-databases/native-client/features/service-principal-name-spn-support-in-client-connections.md) </span></span>  
 <span data-ttu-id="df72b-217">[Dienstprinzipalnamen (SPN) in Clientverbindungen (OLE DB)](../../relational-databases/native-client/ole-db/service-principal-names-spns-in-client-connections-ole-db.md) </span><span class="sxs-lookup"><span data-stu-id="df72b-217">[Service Principal Names &#40;SPNs&#41; in Client Connections &#40;OLE DB&#41;](../../relational-databases/native-client/ole-db/service-principal-names-spns-in-client-connections-ole-db.md) </span></span>  
 <span data-ttu-id="df72b-218">[Dienstprinzipalnamen (SPN) in Clientverbindungen (ODBC)](../../relational-databases/native-client/odbc/service-principal-names-spns-in-client-connections-odbc.md) </span><span class="sxs-lookup"><span data-stu-id="df72b-218">[Service Principal Names &#40;SPNs&#41; in Client Connections &#40;ODBC&#41;](../../relational-databases/native-client/odbc/service-principal-names-spns-in-client-connections-odbc.md) </span></span>  
 <span data-ttu-id="df72b-219">[SQL Server Native Client-Funktionen](../../relational-databases/native-client/features/sql-server-native-client-features.md) </span><span class="sxs-lookup"><span data-stu-id="df72b-219">[SQL Server Native Client Features](../../relational-databases/native-client/features/sql-server-native-client-features.md) </span></span>  
 [<span data-ttu-id="df72b-220">Behandeln von Problemen mit der Kerberos-Authentifizierung in einer Reporting Services-Umgebung</span><span class="sxs-lookup"><span data-stu-id="df72b-220">Manage Kerberos Authentication Issues in a Reporting Services Environment</span></span>](https://technet.microsoft.com/library/ff679930.aspx)  
  
  
