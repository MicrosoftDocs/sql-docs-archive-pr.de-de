---
title: Affinitätsmaske (Serverkonfigurationsoption) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 10/20/2016
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: configuration
ms.topic: conceptual
helpviewer_keywords:
- default affinity mask option
- reloading processor cache
- processor cache [SQL Server]
- CPU [SQL Server], licensing
- deferred process call
- affinity mask option
- processor affinity [SQL Server]
- SMP
- DPC
ms.assetid: 5823ba29-a75d-4b3e-ba7b-421c07ab3ac1
author: MikeRayMSFT
ms.author: mikeray
ms.openlocfilehash: dfebde8a9431026e8faedb2a1e76eb2f2d82e207
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87619352"
---
# <a name="affinity-mask-server-configuration-option"></a><span data-ttu-id="940e7-102">Affinitätsmaske (Serverkonfigurationsoption)</span><span class="sxs-lookup"><span data-stu-id="940e7-102">affinity mask Server Configuration Option</span></span>
    
> [!NOTE]  
>  [!INCLUDE[ssNoteDepFutureDontUse](../../includes/ssnotedepfuturedontuse-md.md)] <span data-ttu-id="940e7-103">Verwenden Sie stattdessen [ALTER SERVER CONFIGURATION (Transact-SQL)](/sql/t-sql/statements/alter-server-configuration-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="940e7-103">Use [ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;](/sql/t-sql/statements/alter-server-configuration-transact-sql) instead.</span></span>  
  
 <span data-ttu-id="940e7-104">Zum Ausführen von Multitasking verschiebt [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows gelegentlich Prozessthreads zwischen verschiedenen Prozessoren.</span><span class="sxs-lookup"><span data-stu-id="940e7-104">To carry out multitasking, [!INCLUDE[msCoName](../../includes/msconame-md.md)] Windows sometimes move process threads among different processors.</span></span> <span data-ttu-id="940e7-105">Obwohl dies aus der Sicht des Betriebssystems effizient ist, kann diese Aktivität die Leistung von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] bei starker Systemauslastung reduzieren, da jeder Prozessorcache wiederholt mit Daten geladen wird.</span><span class="sxs-lookup"><span data-stu-id="940e7-105">Although efficient from an operating system point of view, this activity can reduce [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] performance under heavy system loads, as each processor cache is repeatedly reloaded with data.</span></span> <span data-ttu-id="940e7-106">Durch das Zuweisen von Prozessoren für bestimmte Threads kann unter diesen Bedingungen die Leistung verbessert werden, weil das erneute Laden von Daten in den Prozessor entfällt und die Threadmigration zwischen Prozessen reduziert wird (wodurch der Kontextwechsel reduziert wird). Diese Zuordnung zwischen einem Thread und einem Prozessor wird als Prozessoraffinität bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="940e7-106">Assigning processors to specific threads can improve performance under these conditions by eliminating processor reloads and reducing thread migration across processors (thereby reducing context switching); such an association between a thread and a processor is called processor affinity.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]<span data-ttu-id="940e7-107">unterstützt die Prozessor Affinität durch zwei Affinitäts Masken Optionen: Affinitäts Maske (auch als **CPU-Affinitäts Maske**bezeichnet) und Affinitäts-e/a-Maske.</span><span class="sxs-lookup"><span data-stu-id="940e7-107">supports processor affinity by means of two affinity mask options: affinity mask (also known as **CPU affinity mask**) and affinity I/O mask.</span></span> <span data-ttu-id="940e7-108">Weitere Informationen zur Option Affinity I/O Mask finden Sie unter [Affinity I/O Mask (Serverkonfigurationsoption)](affinity-input-output-mask-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="940e7-108">For more information on the affinity I/O maskoption, see [affinity Input-Output mask Server Configuration Option](affinity-input-output-mask-server-configuration-option.md).</span></span> <span data-ttu-id="940e7-109">CPU- und E/A-Affinitätsunterstützung für Server mit 33–64 Prozessoren erfordert die zusätzliche Verwendung von [affinity64 mask (Serverkonfigurationsoption)](affinity64-mask-server-configuration-option.md) bzw. [affinity64 Input-Output mask (Serverkonfigurationsoption)](affinity64-input-output-mask-server-configuration-option.md).</span><span class="sxs-lookup"><span data-stu-id="940e7-109">CPU and I/O affinity support for servers with 33 to 64 processors requires the additional use of the [affinity64 mask Server Configuration Option](affinity64-mask-server-configuration-option.md) and [affinity64 Input-Output mask Server Configuration Option](affinity64-input-output-mask-server-configuration-option.md), respectively.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="940e7-110">Affinitätsunterstützung für Server mit 33 bis 64 Prozessoren steht nur auf 64-Bit-Betriebssystemen zur Verfügung.</span><span class="sxs-lookup"><span data-stu-id="940e7-110">Affinity support for servers with 33 to 64 processors is only available on 64-bit operating systems.</span></span>  
  
 <span data-ttu-id="940e7-111">Mit der Option Affinity Mask aus früheren Versionen von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]wird die CPU-Affinität dynamisch gesteuert.</span><span class="sxs-lookup"><span data-stu-id="940e7-111">The affinity mask option, which existed in earlier releases of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], dynamically controls CPU affinity.</span></span>  
  
 <span data-ttu-id="940e7-112">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]kann die Option Affinity Mask konfiguriert werden, ohne dass ein Neustart der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]-Instanz erforderlich ist.</span><span class="sxs-lookup"><span data-stu-id="940e7-112">In [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)], the affinity mask option can be configured without requiring a restart of the instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="940e7-113">Wenn Sie sp_configure verwenden, müssen Sie nach dem Festlegen einer Konfigurationsoption entweder RECONFIGURE oder RECONFIGURE WITH OVERRIDE ausführen.</span><span class="sxs-lookup"><span data-stu-id="940e7-113">When you are using sp_configure, you must run either RECONFIGURE or RECONFIGURE WITH OVERRIDE after setting a configuration option.</span></span> <span data-ttu-id="940e7-114">Wenn Sie [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)]verwenden, ist ein Neustart erforderlich, falls Sie die Option affinity mask ändern.</span><span class="sxs-lookup"><span data-stu-id="940e7-114">When you are using [!INCLUDE[ssExpress](../../includes/ssexpress-md.md)], changing the affinity mask option does require a restart.</span></span>  
  
 <span data-ttu-id="940e7-115">Änderungen an den Affinitätsmasken erfolgen dynamisch. Dies ermöglicht das bedarfsgesteuerte Starten und Herunterfahren der CPU-Zeitplanungsmodule, die Prozessthreads in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]binden.</span><span class="sxs-lookup"><span data-stu-id="940e7-115">Changes to the affinity masks occur dynamically, allowing for on-demand startup and shutdown of the CPU schedulers that bind process threads within [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="940e7-116">Dies kann der Fall sein, wenn sich Bedingungen auf dem Server ändern.</span><span class="sxs-lookup"><span data-stu-id="940e7-116">This can occur as conditions change on the server.</span></span> <span data-ttu-id="940e7-117">Wenn dem Server z. B. eine neue Instanz von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] hinzugefügt wird, müssen Sie möglicherweise die Option Affinity Mask anpassen, um die Prozessorauslastung neu zu verteilen.</span><span class="sxs-lookup"><span data-stu-id="940e7-117">For example, if a new instance of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is added to the server, it may be necessary to make adjustments to the affinity mask option to redistribute processor load.</span></span>  
  
 <span data-ttu-id="940e7-118">Für Änderungen an den Affinitätsbitmasken muss [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ein neues CPU-Zeitplanungsmodul aktivieren und das vorhandene CPU-Zeitplanungsmodul deaktivieren.</span><span class="sxs-lookup"><span data-stu-id="940e7-118">Modifications to the affinity bitmasks require [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] to enable a new CPU scheduler and disable the existing CPU scheduler.</span></span> <span data-ttu-id="940e7-119">Neue Batches können dann im neuen oder alten CPU-Zeitplanungsmodul verarbeitet werden.</span><span class="sxs-lookup"><span data-stu-id="940e7-119">New batches can then be processed on the new or remaining schedulers.</span></span>  
  
 <span data-ttu-id="940e7-120">Um ein neues CPU-Zeitplanungsmodul zu starten, erstellt [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ein neues CPU-Zeitplanungsmodul und fügt es der Liste der Standard-Zeitplanungsmodule hinzu.</span><span class="sxs-lookup"><span data-stu-id="940e7-120">To start a new CPU scheduler, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] creates a new scheduler and adds it to the list of its standard schedulers.</span></span> <span data-ttu-id="940e7-121">Das neue Zeitplanungsmodul wird nur für die neuen eingehenden Batches verwendet.</span><span class="sxs-lookup"><span data-stu-id="940e7-121">The new scheduler is considered only for the new incoming batches.</span></span> <span data-ttu-id="940e7-122">Die vorhandenen Batches werden weiterhin mit demselben Zeitplanungsmodul ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="940e7-122">Current batches continue to run on the same scheduler.</span></span> <span data-ttu-id="940e7-123">Die Arbeitsthreads werden nach dem neuen Zeitplanungsmodul migriert, wenn sie freigegeben werden oder wenn neue Arbeitsthreads erstellt werden.</span><span class="sxs-lookup"><span data-stu-id="940e7-123">The workers migrate to the new scheduler as they free up, or as new workers are created.</span></span>  
  
 <span data-ttu-id="940e7-124">Zum Herunterfahren eines Zeitplanungsmoduls müssen alle Batches im Zeitplanungsmodul ihre Aktivitäten abschließen und beendet werden.</span><span class="sxs-lookup"><span data-stu-id="940e7-124">Shutting down a scheduler requires all batches on the scheduler to complete their activities and exit.</span></span> <span data-ttu-id="940e7-125">Ein heruntergefahrenes Zeitplanungsmodul wird als offline gekennzeichnet, damit kein neuer Batch damit geplant wird.</span><span class="sxs-lookup"><span data-stu-id="940e7-125">A scheduler that has been shut down is marked as offline so that no new batch is scheduled on it.</span></span>  
  
 <span data-ttu-id="940e7-126">Unabhängig davon, ob ein neues Zeitplanungsmodul hinzugefügt oder entfernt wird, werden die permanenten Systemtasks wie z. B. lockmonitor, checkpoint, system task thread (processing DTC) und signal process weiterhin im Zeitplanungsmodul ausgeführt, während der Server betriebsbereit ist.</span><span class="sxs-lookup"><span data-stu-id="940e7-126">Whether a new scheduler is added or removed, the permanent system tasks such as lockmonitor, checkpoint, system task thread (processing DTC), and signal process continue to run on the scheduler while the server is operational.</span></span> <span data-ttu-id="940e7-127">Diese permanenten Systemtasks werden nicht dynamisch migriert.</span><span class="sxs-lookup"><span data-stu-id="940e7-127">These permanent system tasks do not dynamically migrate.</span></span> <span data-ttu-id="940e7-128">Um die Prozessorauslastung für diese Systemtasks auf die Zeitplanungsmodule zu verteilen, muss die [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Instanz neu gestartet werden.</span><span class="sxs-lookup"><span data-stu-id="940e7-128">To redistribute processor load for these system tasks across schedulers, it is necessary to restart the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span> <span data-ttu-id="940e7-129">Falls [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] versucht, ein Zeitplanungsmodul für einen permanenten Systemtask herunterzufahren, wird der Task weiterhin im Offline-Zeitplanungsmodul ausgeführt (keine Migration).</span><span class="sxs-lookup"><span data-stu-id="940e7-129">If [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] attempts to shut down a scheduler associated with a permanent system task, the task continues to run on the offline scheduler (no migration).</span></span> <span data-ttu-id="940e7-130">Dieses Zeitplanungsmodul ist an die Prozessoren in der geänderten Affinitätsmaske gebunden und sollte den Prozessor nicht auslasten, dem es vor der Änderung zugeordnet war.</span><span class="sxs-lookup"><span data-stu-id="940e7-130">This scheduler is bound to the processors in the modified affinity mask and should not put any load on the processor it was affinitized with before the change.</span></span> <span data-ttu-id="940e7-131">Zusätzliche Offline-Zeitplanungsmodule sollten keine signifikanten Auswirkungen auf die Arbeitsauslastung des Systems haben.</span><span class="sxs-lookup"><span data-stu-id="940e7-131">Having extra offline schedulers, should not significantly affect the load of the system.</span></span> <span data-ttu-id="940e7-132">Falls dies nicht der Fall ist, muss der Datenbankserver neu gestartet werden, um diese Tasks neu zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="940e7-132">If this is not the case, a database server reboot is required to reconfigure these tasks.</span></span>  
  
 <span data-ttu-id="940e7-133">Die E/A-Affinitätsmaske hat direkte Auswirkungen auf die E/-A-Affinitätstasks (z. B. verzögertes Schreiben und Schreiben von Protokollen).</span><span class="sxs-lookup"><span data-stu-id="940e7-133">The I/O affinity tasks (such as lazywriter and logwriter) are directly affected by the I/O affinity mask.</span></span> <span data-ttu-id="940e7-134">Falls die Tasks für verzögertes Schreiben und das Schreiben von Protokollen nicht an eine Affinität gebunden sind, gelten dieselben Regeln, die für die anderen permanenten Tasks wie z. B. lockmonitor oder checkpoint definiert sind.</span><span class="sxs-lookup"><span data-stu-id="940e7-134">If the lazywriter and logwriter tasks are not affinitized, they follow the same rules defined for the other permanent tasks such as lockmonitor or checkpoint.</span></span>  
  
 <span data-ttu-id="940e7-135">Um sicherzustellen, dass die neue Affinitätsmaske gültig ist, wird mit dem Befehl RECONFIGURE überprüft, ob sich die normalen CPU- und E/A-Affinitäten gegenseitig ausschließen.</span><span class="sxs-lookup"><span data-stu-id="940e7-135">To ensure that the new affinity mask is valid, the RECONFIGURE command verifies that the normal CPU and I/O affinities are mutually exclusive.</span></span> <span data-ttu-id="940e7-136">Falls dies nicht der Fall ist, wird eine Fehlermeldung an die Clientsitzung und an das [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Fehlerprotokoll gesendet. Diese Fehlermeldung besagt, dass eine solche Einstellung nicht empfohlen wird.</span><span class="sxs-lookup"><span data-stu-id="940e7-136">If this is not the case, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, indicating that such a setting is not recommended.</span></span> <span data-ttu-id="940e7-137">Das Ausführen von RECONFIGURE WITH OVERRIDE ermöglicht CPU- und E/A-Affinitäten, die sich nicht gegenseitig ausschließen.</span><span class="sxs-lookup"><span data-stu-id="940e7-137">Running RECONFIGURE WITH OVERRIDE options allows CPU and I/O affinities that are not mutually exclusive.</span></span>  
  
 <span data-ttu-id="940e7-138">Wenn Sie eine Affinitätsmaske angeben, die eine nicht vorhandene CPU zuzuordnen versucht, sendet der Befehl RECONFIGURE eine Fehlermeldung an die Clientsitzung und an das [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Fehlerprotokoll.</span><span class="sxs-lookup"><span data-stu-id="940e7-138">If you specify an affinity mask that attempts to map to a nonexistent CPU, the RECONFIGURE command reports an error message to both the client session and the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span> <span data-ttu-id="940e7-139">Die Verwendung der Option RECONFIGURE WITH OVERRIDE hat in diesem Fall keine Auswirkung, und der gleiche Konfigurationsfehler wird wiederum gemeldet.</span><span class="sxs-lookup"><span data-stu-id="940e7-139">Using the RECONFIGURE WITH OVERRIDE option has no effect in this case, and the same configuration error is reported again.</span></span>  
  
 <span data-ttu-id="940e7-140">Sie können [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Aktivitäten auch von Prozessoren fernhalten, denen eine bestimmte Arbeitsauslastung durch das Betriebssystem Windows 2000 oder Windows Server 2003 zugewiesen wurde.</span><span class="sxs-lookup"><span data-stu-id="940e7-140">You can also exclude [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] activity from processors assigned specific workload assignments by the Windows 2000 or Windows Server 2003 operating system.</span></span> <span data-ttu-id="940e7-141">Wird ein Bit, das einen Prozessor darstellt, auf 1 festgelegt, wird dieser Prozessor von der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]-Datenbank-Engine für die Threadzuweisung ausgewählt.</span><span class="sxs-lookup"><span data-stu-id="940e7-141">If you set a bit representing a processor to 1, that processor is selected by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Database Engine for thread assignment.</span></span> <span data-ttu-id="940e7-142">Wenn Sie `affinity mask` auf 0 (Standardeinstellung) festlegen, legen die Planungs Algorithmen von Microsoft Windows 2000 oder Windows Server 2003 die Thread Affinität fest.</span><span class="sxs-lookup"><span data-stu-id="940e7-142">When you set `affinity mask` to 0 (the default), the Microsoft Windows 2000 or Windows Server 2003 scheduling algorithms set the thread's affinity.</span></span> <span data-ttu-id="940e7-143">Wenn Sie `affinity mask` auf einen Wert ungleich Null festlegen, legt die [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]-Affinität den Wert als Bitmaske aus, die die infrage kommenden Prozessoren angibt.</span><span class="sxs-lookup"><span data-stu-id="940e7-143">When you set `affinity mask` to any nonzero value, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] affinity interprets the value as a bitmask that specifies those processors eligible for selection.</span></span>  
  
 <span data-ttu-id="940e7-144">Durch das Ausschließen der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Threads von der Ausführung auf bestimmten Prozessoren kann Microsoft Windows 2000 oder Windows Server 2003 die Verarbeitung von Windows-spezifischen Prozessen durch das System besser auswerten.</span><span class="sxs-lookup"><span data-stu-id="940e7-144">By segregating [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] threads from running on particular processors, Microsoft Windows 2000 or Windows Server 2003 can better evaluate the system's handling of processes specific to Windows.</span></span> <span data-ttu-id="940e7-145">Beispielsweise könnte der Systemadministrator auf einem Server mit 8 CPUs und zwei Instanzen von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (Instanz A und B) mithilfe der Option Affinity Mask die ersten 4 CPUs der Instanz A sowie die nächsten 4 CPUs der Instanz B zuweisen. Um mehr als 32 Prozessoren zu konfigurieren, legen Sie die Optionen Affinity Mask und Affinity64 Mask fest.</span><span class="sxs-lookup"><span data-stu-id="940e7-145">For example, on an 8-CPU server running two instances of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] (instance A and B), the system administrator could use the affinity mask option to assign the first set of 4 CPUs to instance A and the second set of 4 to instance B. To configure more than 32 processors, set both the affinity mask and the affinity64 mask.</span></span> <span data-ttu-id="940e7-146">Für `affinity mask` gelten folgende Werte:</span><span class="sxs-lookup"><span data-stu-id="940e7-146">The values for `affinity mask` are as follows:</span></span>  
  
-   <span data-ttu-id="940e7-147">Eine aus einem Byte bestehende `affinity mask` deckt bis zu 8 CPUs in einem Computer mit mehreren Prozessoren ab.</span><span class="sxs-lookup"><span data-stu-id="940e7-147">A one-byte `affinity mask` covers up to 8 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="940e7-148">Eine aus zwei Byte bestehende `affinity mask` deckt bis zu 16 CPUs in einem Computer mit mehreren Prozessoren ab.</span><span class="sxs-lookup"><span data-stu-id="940e7-148">A two-byte `affinity mask` covers up to 16 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="940e7-149">Eine aus drei Byte bestehende `affinity mask` deckt bis zu 24 CPUs in einem Computer mit mehreren Prozessoren ab.</span><span class="sxs-lookup"><span data-stu-id="940e7-149">A three-byte `affinity mask` covers up to 24 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="940e7-150">Eine aus vier Byte bestehende `affinity mask` deckt bis zu 32 CPUs in einem Computer mit mehreren Prozessoren ab.</span><span class="sxs-lookup"><span data-stu-id="940e7-150">A four-byte `affinity mask` covers up to 32 CPUs in a multiprocessor computer.</span></span>  
  
-   <span data-ttu-id="940e7-151">Für einen Computer mit mehr als 32 CPUs konfigurieren Sie eine aus vier Bytes bestehende affinity mask für die ersten 32 CPUs und eine aus bis zu vier Bytes bestehende affinity64 mask für die restlichen CPUs.</span><span class="sxs-lookup"><span data-stu-id="940e7-151">To cover more than 32 CPUs, configure a four-byte affinity mask for the first 32 CPUs and up to a four-byte affinity64 mask for the remaining CPUs.</span></span>  
  
 <span data-ttu-id="940e7-152">Da es sich beim Festlegen der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Prozessoraffinität um einen spezialisierten Vorgang handelt, sollten Sie diesen nur bei Bedarf verwenden.</span><span class="sxs-lookup"><span data-stu-id="940e7-152">Because setting [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] processor affinity is a specialized operation, it is recommended that it be used only when necessary.</span></span> <span data-ttu-id="940e7-153">In den meisten Fällen kann eine optimale Leistung durch die standardmäßige Affinität von Microsoft Windows 2000 oder Windows Server 2003 erzielt werden.</span><span class="sxs-lookup"><span data-stu-id="940e7-153">In most cases, the Microsoft Windows 2000 or Windows Server 2003 default affinity provides the best performance.</span></span> <span data-ttu-id="940e7-154">Sie sollten auch die CPU-Anforderungen für andere Anwendungen berücksichtigen, wenn Sie die Affinitätsmasken festlegen.</span><span class="sxs-lookup"><span data-stu-id="940e7-154">You should also consider the CPU requirements for other applications when setting the affinity masks.</span></span> <span data-ttu-id="940e7-155">Weitere Informationen finden Sie in der Dokumentation zu Ihrem Windows-Betriebssystem.</span><span class="sxs-lookup"><span data-stu-id="940e7-155">For more information, see your Windows operating system documentation.</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="940e7-156">Sie können den Windows-Systemmonitor zum Anzeigen und Analysieren der Auslastung einzelner Prozessoren verwenden.</span><span class="sxs-lookup"><span data-stu-id="940e7-156">You can use the Windows System Monitor to view and analyze individual processor usage.</span></span>  
  
 <span data-ttu-id="940e7-157">Bei Angabe der Option Affinity I/O Mask muss diese in Verbindung mit der Konfigurationsoption Affinity Mask verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="940e7-157">When specifying the affinity I/O mask option, you must use it in connection with the affinity mask configuration option.</span></span> <span data-ttu-id="940e7-158">Aktivieren Sie für den Schalter `affinity mask` und in der Option Affinity I/O Mask nicht dieselbe CPU.</span><span class="sxs-lookup"><span data-stu-id="940e7-158">Do not enable the same CPU in both the `affinity mask` switch and the affinity I/O mask option.</span></span> <span data-ttu-id="940e7-159">Die Bits, die jeder CPU entsprechen, sollten einen der folgenden drei Status aufweisen:</span><span class="sxs-lookup"><span data-stu-id="940e7-159">The bits corresponding to each CPU should be in one of these three states:</span></span>  
  
-   <span data-ttu-id="940e7-160">0 für die Optionen Affinity Mask und Affinity I/O Mask.</span><span class="sxs-lookup"><span data-stu-id="940e7-160">0 in both the affinity mask option and the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="940e7-161">1 für die Option Affinity Mask und 0 für die Option Affinity I/O Mask.</span><span class="sxs-lookup"><span data-stu-id="940e7-161">1 in the affinity mask option and 0 in the affinity I/O mask option.</span></span>  
  
-   <span data-ttu-id="940e7-162">1 für die Option Affinity Mask und 1 für die Option Affinity I/O Mask.</span><span class="sxs-lookup"><span data-stu-id="940e7-162">0 in the affinity mask option and 1 in the affinity I/O mask option.</span></span>  
  
> [!CAUTION]  
>  <span data-ttu-id="940e7-163">Konfigurieren Sie nicht die CPU-Affinität im Windows-Betriebssystem und gleichzeitig die Affinitätsmaske in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="940e7-163">Do not configure CPU affinity in the Windows operating system and also configure the affinity mask in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="940e7-164">Diese Einstellungen zielen auf dasselbe Ergebnis. Wenn die Konfigurationen inkonsistent sind, kann dies zu unvorhersehbaren Ergebnissen führen.</span><span class="sxs-lookup"><span data-stu-id="940e7-164">These settings are attempting to achieve the same result, and if the configurations are inconsistent, you may have unpredictable results.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="940e7-165">Die CPU-Affinität wird am besten mit der Option sp_configure in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]konfiguriert.</span><span class="sxs-lookup"><span data-stu-id="940e7-165">CPU affinity is best configured using the sp_configure option in [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>  
  
## <a name="example"></a><span data-ttu-id="940e7-166">Beispiel</span><span class="sxs-lookup"><span data-stu-id="940e7-166">Example</span></span>  
 <span data-ttu-id="940e7-167">Wenn z. B. zum Festlegen der Option Affinity Mask die Prozessoren 1, 2 und 5 als verfügbar ausgewählt wurden und dabei die Bits 1, 2 und 5 auf 1 sowie die Bits 0, 3, 4, 6 und 7 auf 0 festgelegt sind, wird der hexadezimale Wert 0x26 bzw. die Dezimalzahl `38` angegeben.</span><span class="sxs-lookup"><span data-stu-id="940e7-167">As an example of setting the affinity mask option, if processors 1, 2, and 5 are selected as available with bits 1, 2, and 5 set to 1 and bits 0, 3, 4, 6, and 7 set to 0, a hexadecimal value of 0x26 or the decimal equivalent of `38` is specified.</span></span> <span data-ttu-id="940e7-168">Nummerieren Sie die Bits von rechts nach links.</span><span class="sxs-lookup"><span data-stu-id="940e7-168">Number the bits from right to left.</span></span> <span data-ttu-id="940e7-169">Die Option Affinity Mask zählt die Prozessoren von 0 bis 31 durch. Im folgenden Beispiel steht deshalb der Zähler `1` für den zweiten Prozessor auf dem Server.</span><span class="sxs-lookup"><span data-stu-id="940e7-169">The affinity mask option starts counting processors from 0 to 31, so that in the following example the counter `1` represents the second processor on the server.</span></span>  
  
```  
sp_configure 'show advanced options', 1;  
RECONFIGURE;  
GO  
sp_configure 'affinity mask', 38;  
RECONFIGURE;  
GO  
```  
  
 <span data-ttu-id="940e7-170">Nachfolgend werden die `affinity mask`-Werte für ein System mit 8 CPUs aufgeführt.</span><span class="sxs-lookup"><span data-stu-id="940e7-170">These are `affinity mask` values for an 8-CPU system.</span></span>  
  
|<span data-ttu-id="940e7-171">Dezimalzahl</span><span class="sxs-lookup"><span data-stu-id="940e7-171">Decimal value</span></span>|<span data-ttu-id="940e7-172">Binäre Bitmaske</span><span class="sxs-lookup"><span data-stu-id="940e7-172">Binary bit mask</span></span>|<span data-ttu-id="940e7-173">Ermöglicht SQL Server-Threads auf Prozessoren</span><span class="sxs-lookup"><span data-stu-id="940e7-173">Allow SQL Server threads on processors</span></span>|  
|-------------------|---------------------|--------------------------------------------|  
|<span data-ttu-id="940e7-174">1</span><span class="sxs-lookup"><span data-stu-id="940e7-174">1</span></span>|<span data-ttu-id="940e7-175">00000001</span><span class="sxs-lookup"><span data-stu-id="940e7-175">00000001</span></span>|<span data-ttu-id="940e7-176">0</span><span class="sxs-lookup"><span data-stu-id="940e7-176">0</span></span>|  
|<span data-ttu-id="940e7-177">3</span><span class="sxs-lookup"><span data-stu-id="940e7-177">3</span></span>|<span data-ttu-id="940e7-178">00000011</span><span class="sxs-lookup"><span data-stu-id="940e7-178">00000011</span></span>|<span data-ttu-id="940e7-179">0 und 1</span><span class="sxs-lookup"><span data-stu-id="940e7-179">0 and 1</span></span>|  
|<span data-ttu-id="940e7-180">7</span><span class="sxs-lookup"><span data-stu-id="940e7-180">7</span></span>|<span data-ttu-id="940e7-181">00000111</span><span class="sxs-lookup"><span data-stu-id="940e7-181">00000111</span></span>|<span data-ttu-id="940e7-182">0, 1 und 2</span><span class="sxs-lookup"><span data-stu-id="940e7-182">0, 1, and 2</span></span>|  
|<span data-ttu-id="940e7-183">15</span><span class="sxs-lookup"><span data-stu-id="940e7-183">15</span></span>|<span data-ttu-id="940e7-184">00001111</span><span class="sxs-lookup"><span data-stu-id="940e7-184">00001111</span></span>|<span data-ttu-id="940e7-185">0, 1, 2 und 3</span><span class="sxs-lookup"><span data-stu-id="940e7-185">0, 1, 2, and 3</span></span>|  
|<span data-ttu-id="940e7-186">31</span><span class="sxs-lookup"><span data-stu-id="940e7-186">31</span></span>|<span data-ttu-id="940e7-187">00011111</span><span class="sxs-lookup"><span data-stu-id="940e7-187">00011111</span></span>|<span data-ttu-id="940e7-188">0, 1, 2, 3 und 4</span><span class="sxs-lookup"><span data-stu-id="940e7-188">0, 1, 2, 3, and 4</span></span>|  
|<span data-ttu-id="940e7-189">63</span><span class="sxs-lookup"><span data-stu-id="940e7-189">63</span></span>|<span data-ttu-id="940e7-190">00111111</span><span class="sxs-lookup"><span data-stu-id="940e7-190">00111111</span></span>|<span data-ttu-id="940e7-191">0, 1, 2, 3, 4 und 5</span><span class="sxs-lookup"><span data-stu-id="940e7-191">0, 1, 2, 3, 4, and 5</span></span>|  
|<span data-ttu-id="940e7-192">127</span><span class="sxs-lookup"><span data-stu-id="940e7-192">127</span></span>|<span data-ttu-id="940e7-193">01111111</span><span class="sxs-lookup"><span data-stu-id="940e7-193">01111111</span></span>|<span data-ttu-id="940e7-194">0, 1, 2, 3, 4, 5 und 6</span><span class="sxs-lookup"><span data-stu-id="940e7-194">0, 1, 2, 3, 4, 5, and 6</span></span>|  
|<span data-ttu-id="940e7-195">255</span><span class="sxs-lookup"><span data-stu-id="940e7-195">255</span></span>|<span data-ttu-id="940e7-196">11111111</span><span class="sxs-lookup"><span data-stu-id="940e7-196">11111111</span></span>|<span data-ttu-id="940e7-197">0, 1, 2, 3, 4, 5, 6 und 7</span><span class="sxs-lookup"><span data-stu-id="940e7-197">0, 1, 2, 3, 4, 5, 6, and 7</span></span>|  
  
 <span data-ttu-id="940e7-198">Bei Affinity Mask handelt es sich um eine erweiterte Option.</span><span class="sxs-lookup"><span data-stu-id="940e7-198">The affinity mask option is an advanced option.</span></span> <span data-ttu-id="940e7-199">Wenn Sie die Einstellung mithilfe der gespeicherten System Prozedur sp_configure ändern, können Sie nur ändern, `affinity mask` Wenn **Erweiterte Optionen anzeigen** auf 1 festgelegt ist.</span><span class="sxs-lookup"><span data-stu-id="940e7-199">If you are using the sp_configure system stored procedure to change the setting, you can change `affinity mask` only when **show advanced options** is set to 1.</span></span> <span data-ttu-id="940e7-200">Die neue Einstellung wird nach Ausführung des [!INCLUDE[tsql](../../includes/tsql-md.md)] -Befehls RECONFIGURE sofort wirksam, ohne dass die [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Instanz neu gestartet werden muss.</span><span class="sxs-lookup"><span data-stu-id="940e7-200">After executing the [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, the new setting takes effect immediately without requiring a restart of the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance.</span></span>  
  
## <a name="non-uniform-memory-access-numa"></a><span data-ttu-id="940e7-201">Non-Uniform Memory Access (NUMA)</span><span class="sxs-lookup"><span data-stu-id="940e7-201">Non-uniform Memory Access (NUMA)</span></span>  
 <span data-ttu-id="940e7-202">Wenn hardwarebasierter NUMA (Non-Uniform Memory Access, nicht einheitlicher Speicherzugriff) verwendet wird und die Affinitätsmaske festgelegt ist, wird jedes Zeitplanungsmodul in einem Knoten seiner eigenen CPU zugeordnet.</span><span class="sxs-lookup"><span data-stu-id="940e7-202">When using hardware based non-uniform memory access (NUMA) and the affinity mask is set, every scheduler in a node will be affinitized to its own CPU.</span></span> <span data-ttu-id="940e7-203">Wenn die Affinitätsmaske nicht festgelegt ist, wird jedes Zeitplanungsmodul der Gruppe von CPUs innerhalb des NUMA-Knotens zugeordnet, und ein Zeitplanungsmodul, das dem NUMA-Knoten N1 zugeordnet ist, kann Vorgänge auf jeder CPU im Knoten planen, jedoch nicht auf CPUs, die einem anderen Knoten zugeordnet sind.</span><span class="sxs-lookup"><span data-stu-id="940e7-203">When the affinity mask is not set, each scheduler is affinitized to the group of CPUs within the NUMA node and a scheduler mapped to NUMA node N1 can schedule work on any CPU in the node, but not on CPUs associated with another node.</span></span>  
  
 <span data-ttu-id="940e7-204">Jeder Vorgang, der auf einem einzelnen NUMA-Knoten ausgeführt wird, kann nur Pufferseiten von diesem Knoten verwenden.</span><span class="sxs-lookup"><span data-stu-id="940e7-204">Any operation running on a single NUMA node can only use buffer pages from that node.</span></span> <span data-ttu-id="940e7-205">Wenn ein Vorgang parallel auf CPUs von mehreren Knoten ausgeführt wird, kann Arbeitsspeicher von jedem beteiligten Knoten verwendet werden.</span><span class="sxs-lookup"><span data-stu-id="940e7-205">When an operation is run in parallel on CPUs from multiple nodes, memory can be used from any node involved.</span></span>  
  
## <a name="licensing-issues"></a><span data-ttu-id="940e7-206">Lizenzierungsprobleme</span><span class="sxs-lookup"><span data-stu-id="940e7-206">Licensing Issues</span></span>  
 <span data-ttu-id="940e7-207">Die dynamische Affinität wird durch die CPU-Lizenzierung streng reguliert.</span><span class="sxs-lookup"><span data-stu-id="940e7-207">Dynamic affinity is tightly constrained by CPU licensing.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="940e7-208">sind keine Konfigurationen von Affinitätsmaskenoptionen zulässig, die gegen die Lizenzierungsrichtlinien verstoßen.</span><span class="sxs-lookup"><span data-stu-id="940e7-208">does not allow any configuration of affinity mask options that violates the licensing policy.</span></span>  
  
### <a name="startup"></a><span data-ttu-id="940e7-209">Start</span><span class="sxs-lookup"><span data-stu-id="940e7-209">Startup</span></span>  
 <span data-ttu-id="940e7-210">Wenn eine angegebene Affinitätsmaske während des Starts von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] oder während des Anfügens einer Datenbank gegen die Lizenzierungsrichtlinien verstößt, führt die Engine-Schicht den Startprozess oder das Anfügen einer Datenbank bzw. den Wiederherstellungsvorgang aus. Anschließend wird der Wert von sp_configure für die Affinitätsmaske auf 0 zurückgesetzt, wodurch eine Fehlermeldung an das [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Fehlerprotokoll ausgegeben wird.</span><span class="sxs-lookup"><span data-stu-id="940e7-210">If a specified affinity mask violates the licensing policy during [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] startup or during database attach, the engine layer will complete the startup process or database attach/restore operation, and then it will reset the sp_configure run value for the affinity mask to zero, issuing an error message to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log.</span></span>  
  
### <a name="reconfigure"></a><span data-ttu-id="940e7-211">Neu konfigurieren</span><span class="sxs-lookup"><span data-stu-id="940e7-211">Reconfigure</span></span>  
 <span data-ttu-id="940e7-212">Wenn eine angegebene Affinitätsmaske beim Ausführen des [!INCLUDE[tsql](../../includes/tsql-md.md)] -Befehls RECONFIGURE gegen die Lizenzierungsrichtlinien verstößt, wird eine Fehlermeldung an die Clientsitzung und an das [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Fehlerprotokoll gesendet. Der Datenbankadministrator muss dann die Affinitätsmaske neu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="940e7-212">If a specified affinity mask violates the licensing policy when running [!INCLUDE[tsql](../../includes/tsql-md.md)] RECONFIGURE command, an error message is reported to the client session and to the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] error log, requiring the database administrator to reconfigure the affinity mask.</span></span> <span data-ttu-id="940e7-213">In diesem Fall ist der Befehl RECONFIGURE WITH OVERRIDE nicht zulässig.</span><span class="sxs-lookup"><span data-stu-id="940e7-213">No RECONFIGURE WITH OVERRIDE command is accepted in this case.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="940e7-214">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="940e7-214">See Also</span></span>  
 <span data-ttu-id="940e7-215">[Überwachen der Ressourcenverwendung &#40;Systemmonitor&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span><span class="sxs-lookup"><span data-stu-id="940e7-215">[Monitor Resource Usage &#40;System Monitor&#41;](../../relational-databases/performance-monitor/monitor-resource-usage-system-monitor.md) </span></span>  
 <span data-ttu-id="940e7-216">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="940e7-216">[RECONFIGURE &#40;Transact-SQL&#41;](/sql/t-sql/language-elements/reconfigure-transact-sql) </span></span>  
 <span data-ttu-id="940e7-217">[Serverkonfigurationsoptionen &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="940e7-217">[Server Configuration Options &#40;SQL Server&#41;](server-configuration-options-sql-server.md) </span></span>  
 <span data-ttu-id="940e7-218">[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span><span class="sxs-lookup"><span data-stu-id="940e7-218">[sp_configure &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-configure-transact-sql) </span></span>  
 [<span data-ttu-id="940e7-219">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="940e7-219">ALTER SERVER CONFIGURATION &#40;Transact-SQL&#41;</span></span>](/sql/t-sql/statements/alter-server-configuration-transact-sql)  
  
  
