---
title: Überwachen des Protokollversands (Transact-SQL) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- log shipping [SQL Server], status
- history tables [SQL Server]
- historical information [SQL Server], log shipping
- log shipping [SQL Server], monitoring
- alerts [SQL Server], log shipping
- status information [SQL Server], log shipping
- monitoring log shipping [SQL Server]
ms.assetid: acf3cd99-55f7-4287-8414-0892f830f423
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 0ab87d5d8aa08b7b2860fe52fd097f33af327a94
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87615534"
---
# <a name="monitor-log-shipping-transact-sql"></a><span data-ttu-id="68251-102">Überwachen des Protokollversands (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="68251-102">Monitor Log Shipping (Transact-SQL)</span></span>
  <span data-ttu-id="68251-103">Nach der Konfiguration des Protokollversands können Sie Informationen zum Status aller Protokollversandserver überwachen.</span><span class="sxs-lookup"><span data-stu-id="68251-103">After you have configured log shipping, you can monitor information about the status of all the log shipping servers.</span></span> <span data-ttu-id="68251-104">Der Verlauf und der Status von Protokollversandvorgängen werden immer lokal durch die Protokollversandaufträge gespeichert.</span><span class="sxs-lookup"><span data-stu-id="68251-104">The history and status of log shipping operations are always saved locally by the log shipping jobs.</span></span> <span data-ttu-id="68251-105">Der Verlauf und der Status des Sicherungsvorgangs werden auf dem primären Server gespeichert, und der Verlauf und der Status von Kopier- und Wiederherstellungsvorgängen werden auf dem sekundären Server gespeichert.</span><span class="sxs-lookup"><span data-stu-id="68251-105">The history and status of the backup operation are stored at the primary server, and the history and status of the copy and restore operations are stored at the secondary server.</span></span> <span data-ttu-id="68251-106">Falls Sie einen Remoteüberwachungsserver implementiert haben, werden diese Informationen auch auf dem Überwachungsserver gespeichert.</span><span class="sxs-lookup"><span data-stu-id="68251-106">If you have implemented a remote monitor server, this information is also stored on the monitor server.</span></span>  
  
 <span data-ttu-id="68251-107">Sie können Warnungen konfigurieren, die ausgelöst werden, falls Protokollversandvorgänge nicht wie geplant ausgeführt werden können.</span><span class="sxs-lookup"><span data-stu-id="68251-107">You can configure alerts that will fire if log shipping operations fail to occur as scheduled.</span></span> <span data-ttu-id="68251-108">Fehler werden durch einen Warnungsauftrag ausgelöst, der den Status der Sicherungs- und Wiederherstellungsvorgänge überwacht.</span><span class="sxs-lookup"><span data-stu-id="68251-108">Errors are raised by an alert job that watches the status of the backup and restore operations.</span></span> <span data-ttu-id="68251-109">Sie können Warnungen definieren, mit denen ein Operator benachrichtigt wird, wenn diese Fehler ausgelöst werden.</span><span class="sxs-lookup"><span data-stu-id="68251-109">You can define alerts that notify an operator when these errors are raised.</span></span> <span data-ttu-id="68251-110">Falls ein Überwachungsserver konfiguriert ist, wird ein Warnungsauftrag auf dem Überwachungsserver ausgeführt, der Fehler für alle Vorgänge in der Protokollversandkonfiguration auslöst.</span><span class="sxs-lookup"><span data-stu-id="68251-110">If a monitor server is configured, one alert job runs on the monitor server that raises errors for all operations in the log shipping configuration.</span></span> <span data-ttu-id="68251-111">Falls kein Überwachungsserver angegeben ist, wird ein Warnungsauftrag in der primären Serverinstanz ausgeführt, die den Sicherungsvorgang überwacht.</span><span class="sxs-lookup"><span data-stu-id="68251-111">If a monitor server is not specified, an alert job runs on the primary server instance, which monitors the backup operation.</span></span> <span data-ttu-id="68251-112">Falls kein Überwachungsserver angegeben ist, wird außerdem ein Warnungsauftrag in jeder sekundären Serverinstanz ausgeführt, um die lokalen Kopier- und Wiederherstellungsvorgänge zu überwachen.</span><span class="sxs-lookup"><span data-stu-id="68251-112">If a monitor server is not specified, an alert job also runs on each secondary server instance to monitor the local copy and restore operations.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="68251-113">Zum Überwachen einer Protokollversandkonfiguration müssen Sie den Überwachungsserver hinzufügen, wenn Sie den Protokollversand aktivieren.</span><span class="sxs-lookup"><span data-stu-id="68251-113">To monitor a log shipping configuration, you must add the monitor server when you enable log shipping.</span></span> <span data-ttu-id="68251-114">Wenn Sie später einen Überwachungsserver hinzufügen, müssen Sie die Protokollversandkonfiguration entfernen und sie anschließend durch eine Konfiguration ersetzen, die einen Überwachungsserver enthält.</span><span class="sxs-lookup"><span data-stu-id="68251-114">If you add a monitor server later, you must remove the log shipping configuration and then replace it with a new configuration that includes a monitor server.</span></span> <span data-ttu-id="68251-115">Weitere Informationen finden Sie unter [Konfigurieren des Protokollversands &#40;SQL Server&#41;](configure-log-shipping-sql-server.md)eingeführt.</span><span class="sxs-lookup"><span data-stu-id="68251-115">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span> <span data-ttu-id="68251-116">Nach dem Konfigurieren des Überwachungsservers kann dieser zudem nicht ohne vorhergehendes Entfernen des Protokollversands geändert werden.</span><span class="sxs-lookup"><span data-stu-id="68251-116">Furthermore, after the monitor server has been configured, it cannot be changed without removing log shipping first.</span></span>  
  
## <a name="history-tables-containing-monitoring-information"></a><span data-ttu-id="68251-117">Verlaufstabellen mit Überwachungsinformationen</span><span class="sxs-lookup"><span data-stu-id="68251-117">History Tables Containing Monitoring Information</span></span>  
 <span data-ttu-id="68251-118">Die Überwachungsverlaufstabellen enthalten Metadaten, die auf dem Überwachungsserver gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="68251-118">The monitoring history tables contain metadata that is stored on the monitor server.</span></span> <span data-ttu-id="68251-119">Eine Kopie der Informationen für einen bestimmten primären oder sekundären Server wird außerdem lokal gespeichert.</span><span class="sxs-lookup"><span data-stu-id="68251-119">A copy of information specific to a given primary or secondary server is also stored locally.</span></span>  
  
 <span data-ttu-id="68251-120">Sie können diese Tabellen abfragen, um den Status einer Protokollversandsitzung zu überwachen.</span><span class="sxs-lookup"><span data-stu-id="68251-120">You can query these tables to monitor the status of a log shipping session.</span></span> <span data-ttu-id="68251-121">Um z. B. den Status des Protokollversands abzurufen, überprüfen Sie den Status und den Verlauf des Sicherungsauftrags, des Kopierauftrags und des Wiederherstellungsauftrags.</span><span class="sxs-lookup"><span data-stu-id="68251-121">For example, to learn status of log shipping, check the status and history of the backup job, copy job, and restore job.</span></span> <span data-ttu-id="68251-122">Sie können spezifische Details zum Protokollversandverlauf und zu Fehlern anzeigen, indem Sie die folgenden Überwachungstabellen abfragen.</span><span class="sxs-lookup"><span data-stu-id="68251-122">You can view specific log shipping history and error details by querying the following monitoring tables.</span></span>  
  
|<span data-ttu-id="68251-123">Tabelle</span><span class="sxs-lookup"><span data-stu-id="68251-123">Table</span></span>|<span data-ttu-id="68251-124">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="68251-124">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="68251-125">log_shipping_monitor_alert</span><span class="sxs-lookup"><span data-stu-id="68251-125">log_shipping_monitor_alert</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-alert-transact-sql)|<span data-ttu-id="68251-126">Speichert die Warnungsauftrags-ID.</span><span class="sxs-lookup"><span data-stu-id="68251-126">Stores alert job ID.</span></span>|  
|[<span data-ttu-id="68251-127">log_shipping_monitor_error_detail</span><span class="sxs-lookup"><span data-stu-id="68251-127">log_shipping_monitor_error_detail</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-error-detail-transact-sql)|<span data-ttu-id="68251-128">Speichert Fehlerdetails für Protokollversandaufträge.</span><span class="sxs-lookup"><span data-stu-id="68251-128">Stores error details for log shipping jobs.</span></span> <span data-ttu-id="68251-129">Sie können diese Tabelle abfragen, um die Fehler für eine Agentsitzung anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="68251-129">You can query this table see the errors for an agent session.</span></span> <span data-ttu-id="68251-130">Optional können Sie die Fehler nach dem Datum und der Uhrzeit der Protokollierung sortieren.</span><span class="sxs-lookup"><span data-stu-id="68251-130">Optionally, you can sort the errors by the date and time at which each was logged.</span></span> <span data-ttu-id="68251-131">Jeder Fehler wird als Abfolge von Ausnahmen protokolliert, und mehrere Fehler (Sequenzen) können pro Agentsitzung protokolliert werden.</span><span class="sxs-lookup"><span data-stu-id="68251-131">Each error is logged as a sequence of exceptions, and multiple errors (sequences) can per agent session.</span></span>|  
|[<span data-ttu-id="68251-132">log_shipping_monitor_history_detail</span><span class="sxs-lookup"><span data-stu-id="68251-132">log_shipping_monitor_history_detail</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-history-detail-transact-sql)|<span data-ttu-id="68251-133">Enthält Verlaufsdetails für Protokollversand-Agents.</span><span class="sxs-lookup"><span data-stu-id="68251-133">Contains history details for log shipping agents.</span></span> <span data-ttu-id="68251-134">Sie können diese Tabelle abfragen, um die Verlaufsdetails für eine Agentsitzung anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="68251-134">You can query this table to see the history detail for an agent session.</span></span>|  
|[<span data-ttu-id="68251-135">log_shipping_monitor_primary</span><span class="sxs-lookup"><span data-stu-id="68251-135">log_shipping_monitor_primary</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-primary-transact-sql)|<span data-ttu-id="68251-136">Speichert einen Überwachungsdatensatz für die primäre Datenbank in jeder Protokollversandkonfiguration, einschließlich Informationen zur letzten Sicherungsdatei und zur letzten wiederhergestellten Datei, die für die Überwachung hilfreich sind.</span><span class="sxs-lookup"><span data-stu-id="68251-136">Stores one monitor record for the primary database in each log shipping configuration, including information about the last backup file and last restored file that is useful for monitoring.</span></span>|  
|[<span data-ttu-id="68251-137">log_shipping_monitor_secondary</span><span class="sxs-lookup"><span data-stu-id="68251-137">log_shipping_monitor_secondary</span></span>](/sql/relational-databases/system-tables/log-shipping-monitor-secondary-transact-sql)|<span data-ttu-id="68251-138">Speichert einen Überwachungsdatensatz für jede sekundäre Datenbank, einschließlich Informationen zur letzten Sicherungsdatei und zur letzten wiederhergestellten Datei, die für die Überwachung hilfreich sind.</span><span class="sxs-lookup"><span data-stu-id="68251-138">Stores one monitor record for each secondary database, including information about the last backup file and last restored file that is useful for monitoring.</span></span>|  
  
## <a name="stored-procedures-for-monitoring-log-shipping"></a><span data-ttu-id="68251-139">Gespeicherte Prozeduren für die Überwachung des Protokollversands</span><span class="sxs-lookup"><span data-stu-id="68251-139">Stored Procedures for Monitoring Log Shipping</span></span>  
 <span data-ttu-id="68251-140">Überwachungs- und Verlaufsinformationen werden in Tabellen in der **msdb**-Datenbank gespeichert, auf die mithilfe gespeicherter Prozeduren für den Protokollversand zugegriffen werden kann.</span><span class="sxs-lookup"><span data-stu-id="68251-140">Monitoring and history information is stored in tables in **msdb**, which can be accessed using log shipping stored procedures.</span></span> <span data-ttu-id="68251-141">Führen Sie diese gespeicherten Prozeduren auf den in der folgenden Tabelle angegebenen Servern aus.</span><span class="sxs-lookup"><span data-stu-id="68251-141">Run these stored procedures on the servers indicated in the following table.</span></span>  
  
|<span data-ttu-id="68251-142">Gespeicherte Prozedur</span><span class="sxs-lookup"><span data-stu-id="68251-142">Stored procedure</span></span>|<span data-ttu-id="68251-143">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="68251-143">Description</span></span>|<span data-ttu-id="68251-144">Ausführen dieser Prozedur auf</span><span class="sxs-lookup"><span data-stu-id="68251-144">Run this procedure on</span></span>|  
|----------------------|-----------------|---------------------------|  
|[<span data-ttu-id="68251-145">sp_help_log_shipping_monitor_primary</span><span class="sxs-lookup"><span data-stu-id="68251-145">sp_help_log_shipping_monitor_primary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-primary-transact-sql)|<span data-ttu-id="68251-146">Gibt Überwachungsdatensätze für die angegebene primäre Datenbank aus der **log_shipping_monitor_primary** -Tabelle zurück.</span><span class="sxs-lookup"><span data-stu-id="68251-146">Returns monitor records for the specified primary database from the **log_shipping_monitor_primary** table.</span></span>|<span data-ttu-id="68251-147">Überwachungsserver oder primärer Server</span><span class="sxs-lookup"><span data-stu-id="68251-147">Monitor server or primary server</span></span>|  
|[<span data-ttu-id="68251-148">sp_help_log_shipping_monitor_secondary</span><span class="sxs-lookup"><span data-stu-id="68251-148">sp_help_log_shipping_monitor_secondary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-secondary-transact-sql)|<span data-ttu-id="68251-149">Gibt Überwachungsdatensätze für die angegebene sekundäre Datenbank aus der **log_shipping_monitor_secondary** -Tabelle zurück.</span><span class="sxs-lookup"><span data-stu-id="68251-149">Returns monitor records for the specified secondary database from the **log_shipping_monitor_secondary** table.</span></span>|<span data-ttu-id="68251-150">Überwachungsserver oder sekundärer Server</span><span class="sxs-lookup"><span data-stu-id="68251-150">Monitor server or secondary server</span></span>|  
|[<span data-ttu-id="68251-151">sp_help_log_shipping_alert_job</span><span class="sxs-lookup"><span data-stu-id="68251-151">sp_help_log_shipping_alert_job</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-alert-job-transact-sql)|<span data-ttu-id="68251-152">Gibt die Auftrags-ID des Warnungsauftrags zurück.</span><span class="sxs-lookup"><span data-stu-id="68251-152">Returns the job ID of the alert job.</span></span>|<span data-ttu-id="68251-153">Überwachungsserver oder primärer bzw. sekundärer Server, falls kein Überwachungsserver definiert ist.</span><span class="sxs-lookup"><span data-stu-id="68251-153">Monitor server, or primary or secondary server if no monitor is defined</span></span>|  
|[<span data-ttu-id="68251-154">sp_help_log_shipping_primary_database</span><span class="sxs-lookup"><span data-stu-id="68251-154">sp_help_log_shipping_primary_database</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-primary-database-transact-sql)|<span data-ttu-id="68251-155">Ruft Einstellungen der primären Datenbank ab und zeigt die Werte aus den Tabellen **log_shipping_primary_databases** und **log_shipping_monitor_primary** an.</span><span class="sxs-lookup"><span data-stu-id="68251-155">Retrieves primary database settings and displays the values from the **log_shipping_primary_databases** and **log_shipping_monitor_primary** tables.</span></span>|<span data-ttu-id="68251-156">Primärer Server</span><span class="sxs-lookup"><span data-stu-id="68251-156">Primary server</span></span>|  
|[<span data-ttu-id="68251-157">sp_help_log_shipping_primary_secondary</span><span class="sxs-lookup"><span data-stu-id="68251-157">sp_help_log_shipping_primary_secondary</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-primary-secondary-transact-sql)|<span data-ttu-id="68251-158">Ruft die Namen sekundärer Datenbanken für eine primäre Datenbank ab.</span><span class="sxs-lookup"><span data-stu-id="68251-158">Retrieves secondary database names for a primary database.</span></span>|<span data-ttu-id="68251-159">Primärer Server</span><span class="sxs-lookup"><span data-stu-id="68251-159">Primary server</span></span>|  
|[<span data-ttu-id="68251-160">sp_help_log_shipping_secondary_database</span><span class="sxs-lookup"><span data-stu-id="68251-160">sp_help_log_shipping_secondary_database</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-secondary-database-transact-sql)|<span data-ttu-id="68251-161">Ruft Einstellungen der sekundären Datenbank aus den Tabellen **log_shipping_secondary**, **log_shipping_secondary_databases** und **log_shipping_monitor_secondary** ab.</span><span class="sxs-lookup"><span data-stu-id="68251-161">Retrieves secondary-database settings from the **log_shipping_secondary**, **log_shipping_secondary_databases** and **log_shipping_monitor_secondary** tables.</span></span>|<span data-ttu-id="68251-162">Sekundärer Server</span><span class="sxs-lookup"><span data-stu-id="68251-162">Secondary server</span></span>|  
|[<span data-ttu-id="68251-163">sp_help_log_shipping_secondary_primary &#40;Transact-SQL&#41;</span><span class="sxs-lookup"><span data-stu-id="68251-163">sp_help_log_shipping_secondary_primary &#40;Transact-SQL&#41;</span></span>](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-secondary-primary-transact-sql)|<span data-ttu-id="68251-164">Diese gespeicherte Prozedur ruft die Einstellungen einer angegebenen primären Datenbank auf dem sekundären Server ab.</span><span class="sxs-lookup"><span data-stu-id="68251-164">This stored procedure retrieves the settings for a given primary database on the secondary server.</span></span>|<span data-ttu-id="68251-165">Sekundärer Server</span><span class="sxs-lookup"><span data-stu-id="68251-165">Secondary server</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="68251-166">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="68251-166">See Also</span></span>  
 <span data-ttu-id="68251-167">[Anzeigen des Protokollversandberichts &#40;SQL Server Management Studio&#41;](view-the-log-shipping-report-sql-server-management-studio.md) </span><span class="sxs-lookup"><span data-stu-id="68251-167">[View the Log Shipping Report &#40;SQL Server Management Studio&#41;](view-the-log-shipping-report-sql-server-management-studio.md) </span></span>  
 [<span data-ttu-id="68251-168">Gespeicherte Prozeduren und Tabellen für den Protokollversand</span><span class="sxs-lookup"><span data-stu-id="68251-168">Log Shipping Stored Procedures and Tables</span></span>](log-shipping-tables-and-stored-procedures.md)  
  
  
