---
title: Aktualisieren des Protokoll Versands auf SQL Server 2014 (Transact-SQL) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- log shipping [SQL Server], upgrading
ms.assetid: b1289cc3-f5be-40bb-8801-0e3eed40336e
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: 80330d03853c984cfd26100b02918eb218705085
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87622827"
---
# <a name="upgrade-log-shipping-to-sql-server-2014-transact-sql"></a><span data-ttu-id="1f359-102">Aktualisieren des Protokollversands auf SQL Server 2014 (Transact-SQL)</span><span class="sxs-lookup"><span data-stu-id="1f359-102">Upgrade Log Shipping to SQL Server 2014 (Transact-SQL)</span></span>
  <span data-ttu-id="1f359-103">Beim Aktualisieren von [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)]oder [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] auf [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]ist es möglich, die Protokollversandkonfigurationen beizubehalten.</span><span class="sxs-lookup"><span data-stu-id="1f359-103">It is possible to preserve log shipping configurations when upgrading from [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], [!INCLUDE[ssKatmai](../../includes/sskatmai-md.md)], [!INCLUDE[ssKilimanjaro](../../includes/sskilimanjaro-md.md)], or [!INCLUDE[ssSQL11](../../includes/sssql11-md.md)] to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span> <span data-ttu-id="1f359-104">In diesem Thema werden alternative Szenarien und bewährte Methoden zum Aktualisieren einer Protokollversandkonfiguration beschrieben.</span><span class="sxs-lookup"><span data-stu-id="1f359-104">This topic describes alternative scenarios and best practices for upgrading a log shipping configuration.</span></span>

> [!NOTE]
>  <span data-ttu-id="1f359-105">Die[Sicherungskomprimierung](../../relational-databases/backup-restore/backup-compression-sql-server.md) wurde in [!INCLUDE[ssEnterpriseEd10](../../includes/ssenterpriseed10-md.md)]eingeführt.</span><span class="sxs-lookup"><span data-stu-id="1f359-105">[Backup compression](../../relational-databases/backup-restore/backup-compression-sql-server.md) was introduced in [!INCLUDE[ssEnterpriseEd10](../../includes/ssenterpriseed10-md.md)].</span></span> <span data-ttu-id="1f359-106">In einer aktualisierten Protokollversandkonfiguration wird durch die Serverkonfigurationsoption **Komprimierungsstandard für Sicherung** bestimmt, ob die Transaktionsprotokoll-Sicherungsdateien mithilfe der Sicherungskomprimierung komprimiert werden.</span><span class="sxs-lookup"><span data-stu-id="1f359-106">An upgraded log shipping configuration uses the **backup compression default** server-level configuration option to control whether backup compression is used for the transaction log backup files.</span></span> <span data-ttu-id="1f359-107">Das Verhalten für die Sicherungskomprimierung der Protokollsicherung kann für jede Protokollversandkonfiguration festgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="1f359-107">The backup compression behavior of log backups can be specified for each log shipping configuration.</span></span> <span data-ttu-id="1f359-108">Weitere Informationen finden Sie unter [Konfigurieren des Protokollversands &#40;SQL Server&#41;](configure-log-shipping-sql-server.md)eingeführt.</span><span class="sxs-lookup"><span data-stu-id="1f359-108">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>


##  <a name="protect-your-data-before-the-upgrade"></a><a name="ProtectData"></a> <span data-ttu-id="1f359-109">Datensicherung vor dem Upgrade</span><span class="sxs-lookup"><span data-stu-id="1f359-109">Protect Your Data Before the Upgrade</span></span>
 <span data-ttu-id="1f359-110">Als bewährte Methode wird empfohlen, dass Sie die Daten vor einem Protokollversandupgrade schützen.</span><span class="sxs-lookup"><span data-stu-id="1f359-110">As a best practice, we recommend that you protect your data before a log shipping upgrade.</span></span>

 <span data-ttu-id="1f359-111">**So schützen Sie die Daten**</span><span class="sxs-lookup"><span data-stu-id="1f359-111">**To protect your data**</span></span>

1.  <span data-ttu-id="1f359-112">Führen Sie für jede primäre Datenbank eine vollständige Datenbanksicherung aus.</span><span class="sxs-lookup"><span data-stu-id="1f359-112">Perform a full database backup on every primary database.</span></span>

     <span data-ttu-id="1f359-113">Weitere Informationen finden Sie unter [Erstellen einer vollständigen Datenbanksicherung &#40;SQL Server&#41;](../../relational-databases/backup-restore/create-a-full-database-backup-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1f359-113">For more information, see [Create a Full Database Backup &#40;SQL Server&#41;](../../relational-databases/backup-restore/create-a-full-database-backup-sql-server.md).</span></span>

2.  <span data-ttu-id="1f359-114">Führen Sie den [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) -Befehl für jede primäre Datenbank aus.</span><span class="sxs-lookup"><span data-stu-id="1f359-114">Run the [DBCC CHECKDB](/sql/t-sql/database-console-commands/dbcc-checkdb-transact-sql) command on every primary database.</span></span>

##  <a name="upgrading-the-monitor-server-instance"></a><a name="UpgradeMonitor"></a><span data-ttu-id="1f359-115">Aktualisieren der Überwachungs Server Instanz</span><span class="sxs-lookup"><span data-stu-id="1f359-115">Upgrading the Monitor Server Instance</span></span>
 <span data-ttu-id="1f359-116">Die Überwachungsserverinstanz, sofern vorhanden, kann jederzeit aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="1f359-116">The monitor server instance, if any, can be upgraded at any time.</span></span>

 <span data-ttu-id="1f359-117">Während der Aktualisierung des Überwachungsservers ist die Protokollversandkonfiguration weiterhin in Betrieb, ihr Status wird allerdings nicht in den Tabellen auf dem Überwachungsserver aufgezeichnet.</span><span class="sxs-lookup"><span data-stu-id="1f359-117">While the monitor server is being upgraded, the log shipping configuration continues to work, but its status is not recorded in the tables on the monitor.</span></span> <span data-ttu-id="1f359-118">Warnungen, die ggf. konfiguriert wurden, werden während der Aktualisierung des Überwachungsservers nicht ausgelöst.</span><span class="sxs-lookup"><span data-stu-id="1f359-118">Any alerts that have been configured will not be triggered while the monitor server is being upgraded.</span></span> <span data-ttu-id="1f359-119">Nach der Aktualisierung können Sie die Überwachungstabellen aktualisieren, indem Sie die gespeicherte Systemprozedur [sp_refresh_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-refresh-log-shipping-monitor-transact-sql) ausführen.</span><span class="sxs-lookup"><span data-stu-id="1f359-119">After the upgrade, you can update the information in the monitor tables by executing the [sp_refresh_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-refresh-log-shipping-monitor-transact-sql) system stored procedure.</span></span>

##  <a name="upgrading-log-shipping-configurations-with-a-single-secondary-server"></a><a name="UpgradeSingleSecondary"></a><span data-ttu-id="1f359-120">Aktualisieren von Protokoll Versand Konfigurationen mit einem einzelnen sekundären Server</span><span class="sxs-lookup"><span data-stu-id="1f359-120">Upgrading Log Shipping Configurations with a Single Secondary Server</span></span>
 <span data-ttu-id="1f359-121">Für den in diesem Abschnitt beschriebenen Upgradevorgang wird eine Konfiguration vorausgesetzt, die einen primären Server und nur einen sekundären Server umfasst.</span><span class="sxs-lookup"><span data-stu-id="1f359-121">The upgrade process described in this section assumes a configuration consisting of the primary server and only one secondary server.</span></span> <span data-ttu-id="1f359-122">Diese Konfiguration wird in der folgenden Abbildung dargestellt, die eine primäre Serverinstanz A und eine einzelne sekundäre Serverinstanz B zeigt.</span><span class="sxs-lookup"><span data-stu-id="1f359-122">This configuration is represented in the following illustration, which shows a primary server instance, A, and a single secondary server instance, B.</span></span>

 <span data-ttu-id="1f359-123">![Ein sekundärer Server und kein Überwachungsserver](../media/ls-2-wayconfig-nomonitor.gif "Ein sekundärer Server und kein Überwachungsserver")</span><span class="sxs-lookup"><span data-stu-id="1f359-123">![One secondary server and no monitor server](../media/ls-2-wayconfig-nomonitor.gif "One secondary server and no monitor server")</span></span>

 <span data-ttu-id="1f359-124">Informationen zur Aktualisierung mehrerer sekundärer Server finden Sie unter [Aktualisieren von mehreren sekundären Serverinstanzen](#MultipleSecondaries)weiter hinten in diesem Thema.</span><span class="sxs-lookup"><span data-stu-id="1f359-124">For information about upgrading multiple secondary servers, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>
 

###  <a name="upgrading-the-secondary-server-instance"></a><a name="UpgradeSecondary"></a><span data-ttu-id="1f359-125">Aktualisieren der sekundären Server Instanz</span><span class="sxs-lookup"><span data-stu-id="1f359-125">Upgrading the Secondary Server Instance</span></span>
 <span data-ttu-id="1f359-126">Der Upgradevorgang erfordert das Upgrade der sekundären Serverinstanzen einer [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] -Protokollversandkonfiguration (oder höher) auf [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] , bevor die primäre Serverinstanz aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="1f359-126">The upgrade process involves upgrading the secondary server instances of a [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher log shipping configuration to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] before upgrading the primary server instance.</span></span> <span data-ttu-id="1f359-127">Aktualisieren Sie immer zuerst die sekundäre Serverinstanz.</span><span class="sxs-lookup"><span data-stu-id="1f359-127">Always upgrade the secondary server instance first.</span></span> <span data-ttu-id="1f359-128">Wenn der primäre Server vor einem sekundären Server aktualisiert wird, schlägt der Protokollversand fehl, weil eine mit einer neueren Version von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] erstellte Sicherung nicht mit einer älteren Version von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]wiederhergestellt werden kann.</span><span class="sxs-lookup"><span data-stu-id="1f359-128">If the primary server were upgraded before a secondary server, log shipping would fail because a backup created on a newer version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] cannot be restored on an older version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span>

 <span data-ttu-id="1f359-129">Der Protokollversand wird während des Upgradevorgangs weiter ausgeführt, weil die aktualisierten sekundären Server die Protokollsicherungen vom primären [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] -Server (oder höher) weiterhin wiederherstellen.</span><span class="sxs-lookup"><span data-stu-id="1f359-129">Log shipping continues throughout the upgrade process because the upgraded secondary servers continue to restore the log backups from the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher primary server.</span></span> <span data-ttu-id="1f359-130">Der Upgradevorgang für die sekundären Serverinstanzen hängt teilweise davon ab, ob die Protokollversandkonfiguration mehrere sekundäre Server umfasst</span><span class="sxs-lookup"><span data-stu-id="1f359-130">The process for upgrading the secondary server instances depends partly on whether the log shipping configuration possesses multiple secondary servers.</span></span> <span data-ttu-id="1f359-131">Weitere Informationen finden Sie im Abschnitt [Aktualisieren von mehreren sekundären Serverinstanzen](#MultipleSecondaries)weiter hinten in diesem Thema.</span><span class="sxs-lookup"><span data-stu-id="1f359-131">For more information, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>

 <span data-ttu-id="1f359-132">Während des Upgrades der sekundären Serverinstanz werden die Aufträge zum Kopieren und Wiederherstellen des Protokollversands nicht ausgeführt, daher sammeln sich nicht wiederhergestellte Sicherungen von Transaktionsprotokollen an.</span><span class="sxs-lookup"><span data-stu-id="1f359-132">While the secondary server instance is being upgraded, the log shipping copy and restore jobs do not run, so unrestored transaction log backups will accumulate.</span></span> <span data-ttu-id="1f359-133">Die Menge dieser Ansammlung hängt von der Frequenz der geplanten Sicherung auf dem primären Server ab.</span><span class="sxs-lookup"><span data-stu-id="1f359-133">The amount of accumulation depends on the frequency of scheduled backup on the primary server.</span></span> <span data-ttu-id="1f359-134">Wenn ein getrennter Überwachungsserver konfiguriert wurde, werden möglicherweise Warnungen ausgegeben, die anzeigen, dass über einen längeren Zeitraum als das konfigurierte Intervall hinweg keine Wiederherstellungsvorgänge ausgeführt wurden.</span><span class="sxs-lookup"><span data-stu-id="1f359-134">Also, if a separate monitor server has been configured, alerts might be raised indicating restores have not been performed for longer than the configured interval.</span></span>

 <span data-ttu-id="1f359-135">Sobald der sekundäre Server aktualisiert wurde, werden die Protokollversandaufträge der Agents zum Kopieren und Wiederherstellen von Protokollsicherungen von der primären Serverinstanz, Server A, wieder aufgenommen und fortgesetzt. Wie lange der sekundäre Server für die Aktualisierung der sekundären Datenbank benötigt, hängt davon ab, wie lange das Upgrade des sekundären Servers dauert und wie häufig die Sicherungen auf dem primären Server ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="1f359-135">Once the secondary server has been upgraded, the log shipping agents jobs resume and continue to copy and restore log backups from the primary server instance, server A. The amount of time required for the secondary server to bring the secondary database up to date varies, depending on the time taken to upgrade the secondary server and the frequency of the backups on the primary server.</span></span>

> [!NOTE]
>  <span data-ttu-id="1f359-136">Während der Serveraktualisierung wird die sekundäre Datenbank nicht auf eine [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] -Datenbank aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="1f359-136">During the server upgrade, the secondary database is not upgraded to a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] database.</span></span> <span data-ttu-id="1f359-137">Sie wird nur aktualisiert, wenn sie online geschaltet wird.</span><span class="sxs-lookup"><span data-stu-id="1f359-137">It will get upgraded only if it is brought online.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="1f359-138">Die RESTORE WITH STANDBY-Option wird für Datenbanken, die eine Aktualisierung erfordern, nicht unterstützt.</span><span class="sxs-lookup"><span data-stu-id="1f359-138">The RESTORE WITH STANDBY option is not supported for a database that requires upgrading.</span></span> <span data-ttu-id="1f359-139">Wenn eine aktualisierte sekundäre Datenbank mithilfe von RESTORE WITH STANDBY konfiguriert wurde, können Transaktionsprotokolle nach einer Aktualisierung nicht wiederhergestellt werden.</span><span class="sxs-lookup"><span data-stu-id="1f359-139">If an upgraded secondary database has been configured by using RESTORE WITH STANDBY, transaction logs can no longer be restored after upgrade.</span></span> <span data-ttu-id="1f359-140">Um den Protokollversand auf dieser sekundären Datenbank fortzusetzen, müssen Sie ihn auf diesem Standbyserver erneut einrichten.</span><span class="sxs-lookup"><span data-stu-id="1f359-140">To resume log shipping on that secondary database, you will need to set up log shipping again on that standby server.</span></span> <span data-ttu-id="1f359-141">Weitere Informationen zur Option STANDBY finden Sie unter [Restore Arguments &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-arguments-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="1f359-141">For more information about the STANDBY option, see [RESTORE Arguments &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-arguments-transact-sql).</span></span>

###  <a name="upgrading-the-primary-server-instance"></a><a name="UpgradePrimary"></a> <span data-ttu-id="1f359-142">Aktualisieren der primären Serverinstanz</span><span class="sxs-lookup"><span data-stu-id="1f359-142">Upgrading the Primary Server Instance</span></span>
 <span data-ttu-id="1f359-143">Bei der Planung eines Upgrades ist der Zeitraum, während dessen die Datenbank nicht verfügbar sein wird, ein maßgeblicher Aspekt.</span><span class="sxs-lookup"><span data-stu-id="1f359-143">When planning an upgrade, a significant consideration is the amount of time that your database will be unavailable.</span></span> <span data-ttu-id="1f359-144">Im einfachsten Aktualisierungsszenario ist die Datenbank nicht verfügbar, während der primäre Server aktualisiert wird (Szenario 1, unten).</span><span class="sxs-lookup"><span data-stu-id="1f359-144">The simplest upgrade scenario involves the database being unavailable while you upgrade the primary server (scenario 1, below).</span></span>

 <span data-ttu-id="1f359-145">Sie können die Datenbankverfügbarkeit maximieren, indem Sie für den primären [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] -Server (oder höher) einen Failover auf einen sekundären [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] -Server durchführen, bevor Sie den ursprünglichen primären Server aktualisieren (Szenario 2, unten). Der Upgradevorgang wird dadurch allerdings komplizierter.</span><span class="sxs-lookup"><span data-stu-id="1f359-145">At the cost of a more complicated upgrade process, you can maximize your database availability by failing over the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] or higher primary server to a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] secondary server before upgrading the original primary server (scenario 2, below).</span></span> <span data-ttu-id="1f359-146">Es sind zwei Varianten des Failoverszenarios denkbar.</span><span class="sxs-lookup"><span data-stu-id="1f359-146">There are two variants of the failover scenario.</span></span> <span data-ttu-id="1f359-147">Sie können zurück zum ursprünglichen primären Server wechseln und die ursprüngliche Protokollversandkonfiguration beibehalten.</span><span class="sxs-lookup"><span data-stu-id="1f359-147">You can switch back to the original primary server and keep the original log shipping configuration.</span></span> <span data-ttu-id="1f359-148">Alternativ können Sie die ursprüngliche Protokollversandkonfiguration entfernen, bevor Sie den ursprünglichen primären Server aktualisieren, und später unter Verwendung des neuen primären Servers eine neue Konfiguration erstellen.</span><span class="sxs-lookup"><span data-stu-id="1f359-148">Alternatively, you can remove the original log shipping configuration before upgrading the original primary server and later create a new configuration using the new primary server.</span></span> <span data-ttu-id="1f359-149">In diesem Abschnitt werden diese beiden Szenarien beschrieben.</span><span class="sxs-lookup"><span data-stu-id="1f359-149">This section describes both these scenarios.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="1f359-150">Aktualisieren Sie unbedingt die sekundäre Serverinstanz vor der primären Serverinstanz.</span><span class="sxs-lookup"><span data-stu-id="1f359-150">Be sure to upgrade the secondary server instance before upgrading the primary server instance.</span></span> <span data-ttu-id="1f359-151">Weitere Informationen finden Sie im Abschnitt [Aktualisieren der sekundären Serverinstanz](#UpgradeSecondary)weiter oben in diesem Thema.</span><span class="sxs-lookup"><span data-stu-id="1f359-151">For more information, see [Upgrading the Secondary Server Instance](#UpgradeSecondary), earlier in this topic.</span></span>


####  <a name="scenario-1-upgrade-primary-server-instance-without-failover"></a><a name="Scenario1"></a><span data-ttu-id="1f359-152">Szenario 1: Aktualisieren der primären Server Instanz ohne Failover</span><span class="sxs-lookup"><span data-stu-id="1f359-152">Scenario 1: Upgrade Primary Server Instance Without Failover</span></span>
 <span data-ttu-id="1f359-153">Dies ist das einfachere Szenario, aber es verursacht eine längere Ausfallzeit als die Aktualisierung mit Failover.</span><span class="sxs-lookup"><span data-stu-id="1f359-153">This is the simpler scenario, but it causes more downtime than using failover.</span></span> <span data-ttu-id="1f359-154">Die primäre Serverinstanz wird einfach aktualisiert, und die Datenbank ist während dieses Aktualisierungsvorgangs nicht verfügbar.</span><span class="sxs-lookup"><span data-stu-id="1f359-154">The primary server instance is simply upgraded and the database is unavailable during this upgrade.</span></span>

 <span data-ttu-id="1f359-155">Sobald der Server aktualisiert wurde, wird die Datenbank automatisch online geschaltet. Daraufhin wird sie automatisch aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="1f359-155">Once the server is upgraded, the database is automatically brought back online, which causes it to be upgraded.</span></span> <span data-ttu-id="1f359-156">Nachdem die Datenbank aktualisiert wurde, werden die Protokollversandaufträge fortgesetzt.</span><span class="sxs-lookup"><span data-stu-id="1f359-156">After the database is upgraded, the log shipping jobs resume.</span></span>

#### <a name="scenario-2-upgrade-primary-server-instance-with-failover"></a><span data-ttu-id="1f359-157">Szenario 2: Aktualisieren der primären Serverinstanz mit Failover</span><span class="sxs-lookup"><span data-stu-id="1f359-157">Scenario 2: Upgrade Primary Server Instance with Failover</span></span>
 <span data-ttu-id="1f359-158">In diesem Szenario wird die Verfügbarkeit maximiert und die Ausfallzeit minimiert.</span><span class="sxs-lookup"><span data-stu-id="1f359-158">This scenario maximizes availability and minimizes downtime.</span></span> <span data-ttu-id="1f359-159">Es wird ein kontrolliertes Failover auf die sekundäre Serverinstanz durchgeführt, wodurch die Datenbank verfügbar bleibt, während die ursprüngliche primäre Serverinstanz aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="1f359-159">It utilizes a controlled failover to the secondary server instance, which keeps the database available while the original primary server instance is upgraded.</span></span> <span data-ttu-id="1f359-160">Die Ausfallzeit wird auf den relativen kurzen Zeitraum beschränkt, der zur Durchführung des Failovers erforderlich ist, statt auf den Zeitraum, der zur Aktualisierung der primären Serverinstanz benötigt wird.</span><span class="sxs-lookup"><span data-stu-id="1f359-160">Downtime is limited to the relatively short time required to fail over, rather than the time required to upgrade the primary server instance.</span></span>

 <span data-ttu-id="1f359-161">Das Aktualisieren der primären Serverinstanz mit Failover umfasst drei allgemeine Schritte: Ausführen eines kontrollierten Failovers auf den sekundären Server, Aktualisieren der ursprünglichen primären Serverinstanz auf [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]und Einrichten des Protokollversands auf einer primären Serverinstanz von [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] .</span><span class="sxs-lookup"><span data-stu-id="1f359-161">Upgrading the primary server instance with failover involves three general procedures: performing a controlled failover to the secondary server, upgrading the original primary server instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], and setting up log shipping on a [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] primary server instance.</span></span> <span data-ttu-id="1f359-162">In diesem Abschnitt werden diese Schritte beschrieben.</span><span class="sxs-lookup"><span data-stu-id="1f359-162">These procedures are described in this section.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="1f359-163">Wenn Sie die sekundäre Serverinstanz als neue primäre Serverinstanz nutzen möchten, müssen Sie die Protokollversandkonfiguration entfernen.</span><span class="sxs-lookup"><span data-stu-id="1f359-163">If you plan to have the secondary server instance as the new primary server instance, you need to remove the log shipping configuration.</span></span> <span data-ttu-id="1f359-164">Der Protokollversand muss vom neuen primären auf den neuen sekundären Server konfiguriert werden, nachdem die ursprüngliche primäre Serverinstanz aktualisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="1f359-164">Log shipping will need to be reconfigured from the new primary to the new secondary, after the original primary server instance has been upgraded.</span></span> <span data-ttu-id="1f359-165">Weitere Informationen finden Sie unter [Entfernen des Protokoll Versands &#40;SQL Server&#41;](remove-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1f359-165">For more information, see [Remove Log Shipping &#40;SQL Server&#41;](remove-log-shipping-sql-server.md).</span></span>


#####  <a name="procedure-1-perform-a-controlled-failover-to-the-secondary-server"></a><a name="Procedure1"></a><span data-ttu-id="1f359-166">Prozedur 1: Ausführen eines kontrollierten Failovers auf den sekundären Server</span><span class="sxs-lookup"><span data-stu-id="1f359-166">Procedure 1: Perform a Controlled Failover to the Secondary Server</span></span>
 <span data-ttu-id="1f359-167">Kontrollierter Failover auf den sekundären Server:</span><span class="sxs-lookup"><span data-stu-id="1f359-167">Controlled failover to the secondary server:</span></span>

1.  <span data-ttu-id="1f359-168">Führen Sie manuell [eine Sicherung des Endes](../../relational-databases/backup-restore/tail-log-backups-sql-server.md) des Transaktionsprotokolls für die primäre Datenbank unter Angabe von WITH NORECOVERY durch.</span><span class="sxs-lookup"><span data-stu-id="1f359-168">Manually perform a [tail-log backup](../../relational-databases/backup-restore/tail-log-backups-sql-server.md) of the transaction log on the primary database specifying WITH NORECOVERY.</span></span> <span data-ttu-id="1f359-169">Mit dieser Protokollsicherung werden alle bislang noch nicht gesicherten Protokolldatensätze erfasst und die Datenbank offline geschaltet.</span><span class="sxs-lookup"><span data-stu-id="1f359-169">This log backup captures any log records that have not been backed up yet and takes the database offline.</span></span> <span data-ttu-id="1f359-170">Beachten Sie Folgendes: Während die Datenbank offline ist, kann der Protokollversandsicherungsauftrag nicht ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="1f359-170">Note that while the database is offline, the log shipping backup job will fail.</span></span>

     <span data-ttu-id="1f359-171">Im folgenden Beispiel wird das Ende des Protokolls für die `AdventureWorks` -Datenbank auf dem primären Server gesichert.</span><span class="sxs-lookup"><span data-stu-id="1f359-171">The following example creates a tail log backup of the `AdventureWorks` database on the primary server.</span></span> <span data-ttu-id="1f359-172">Die Sicherungsdatei erhält den Namen `Failover_AW_20080315.trn`:</span><span class="sxs-lookup"><span data-stu-id="1f359-172">The backup file is named `Failover_AW_20080315.trn`:</span></span>

    ```
    BACKUP LOG AdventureWorks 
      TO DISK = N'\\FileServer\LogShipping\AdventureWorks\Failover_AW_20080315.trn' 
       WITH NORECOVERY;
    GO
    ```

     <span data-ttu-id="1f359-173">Es wird empfohlen, dass Sie eine eigene Dateibenennungskonvention verwenden, um manuell erstellte Sicherungsdateien von den Sicherungsdateien, die vom Protokollversandsicherungsauftrag erstellt werden, unterscheiden zu können.</span><span class="sxs-lookup"><span data-stu-id="1f359-173">We recommend that you use a distinct file naming convention to differentiate the manually-created backup file from the backup files created by the log shipping backup job.</span></span>

2.  <span data-ttu-id="1f359-174">Auf dem sekundären Server:</span><span class="sxs-lookup"><span data-stu-id="1f359-174">On the secondary server:</span></span>

    1.  <span data-ttu-id="1f359-175">Stellen Sie sicher, dass alle von Protokollversandsicherungsaufträgen durchgeführten Sicherungen automatisch übernommen wurden.</span><span class="sxs-lookup"><span data-stu-id="1f359-175">Ensure that all backups taken automatically by the log shipping backup jobs have been applied.</span></span> <span data-ttu-id="1f359-176">Welche Sicherungsaufträge übernommen wurden, können Sie mithilfe der gespeicherten Systemprozedur [sp_help_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-transact-sql) auf dem Überwachungsserver oder auf dem primären und dem sekundären Servern überprüfen.</span><span class="sxs-lookup"><span data-stu-id="1f359-176">To check which backup jobs have been applied, use the [sp_help_log_shipping_monitor](/sql/relational-databases/system-stored-procedures/sp-help-log-shipping-monitor-transact-sql) system stored procedure on the monitor server or on the primary and secondary servers.</span></span> <span data-ttu-id="1f359-177">Die gleiche Datei sollte in den Spalten **last_backup_file**, **last_copied_file**und **last_restored_file** aufgeführt sein.</span><span class="sxs-lookup"><span data-stu-id="1f359-177">The same file should be listed in the **last_backup_file**, **last_copied_file**, and **last_restored_file** columns.</span></span> <span data-ttu-id="1f359-178">Wenn eine der Sicherungsdateien nicht kopiert und wiederhergestellt wurde, starten Sie die Aufträge der Agents zum Kopieren und Wiederherstellens für die Protokollversandkonfiguration manuell.</span><span class="sxs-lookup"><span data-stu-id="1f359-178">If any of the backup files have not been copied and restored, manually invoke the agent copy and restore jobs for the log shipping configuration.</span></span>

         <span data-ttu-id="1f359-179">Informationen zum Starten eines Auftrags finden Sie unter [Start a Job](../../ssms/agent/start-a-job.md).</span><span class="sxs-lookup"><span data-stu-id="1f359-179">For information about starting a job, see [Start a Job](../../ssms/agent/start-a-job.md).</span></span>

    2.  <span data-ttu-id="1f359-180">Kopieren Sie die letzte Protokollsicherungsdatei, die Sie in Schritt 1 erstellt haben, von der Dateifreigabe an den Speicherort, der vom Protokollversand auf dem sekundären Server verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="1f359-180">Copy your the final log backup file that you created in step 1 from the file share to the local location that is used by log shipping on the secondary server.</span></span>

    3.  <span data-ttu-id="1f359-181">Stellen Sie die letzte Protokollsicherung wieder her, und geben Sie hierbei WITH RECOVERY an, um die Datenbank online zu schalten.</span><span class="sxs-lookup"><span data-stu-id="1f359-181">Restore the final log backup specifying WITH RECOVERY to bring the database online.</span></span> <span data-ttu-id="1f359-182">Die Datenbank wird im Rahmen des Onlineschaltens auf [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="1f359-182">As part of being brought online, the database will upgraded to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>

         <span data-ttu-id="1f359-183">Im folgenden Beispiel wird das Ende der Protokollsicherung für die `AdventureWorks` -Datenbank in der sekundären Datenbank wiederhergestellt.</span><span class="sxs-lookup"><span data-stu-id="1f359-183">The following example restores the tail log backup of the `AdventureWorks` database on the secondary database.</span></span> <span data-ttu-id="1f359-184">Im Beispiel wird die WITH RECOVERY-Option verwendet, mit der die Datenbank online geschaltet wird:</span><span class="sxs-lookup"><span data-stu-id="1f359-184">The example uses the WITH RECOVERY option, which brings the database online:</span></span>

        ```
        RESTORE LOG AdventureWorks 
          FROM DISK = N'c:\logshipping\Failover_AW_20080315.trn' 
           WITH RECOVERY;
        GO
        ```

        > [!NOTE]
        >  <span data-ttu-id="1f359-185">Bei einer Konfiguration, die mehr als einen sekundären Server enthält, sind weitere Aspekte zu berücksichtigen.</span><span class="sxs-lookup"><span data-stu-id="1f359-185">For a configuration that contains more than one secondary server, there are additional considerations.</span></span> <span data-ttu-id="1f359-186">Weitere Informationen finden Sie im Abschnitt [Aktualisieren von mehreren sekundären Serverinstanzen](#MultipleSecondaries)weiter hinten in diesem Thema.</span><span class="sxs-lookup"><span data-stu-id="1f359-186">For more information, see [Upgrading Multiple Secondary Server Instances](#MultipleSecondaries), later in this topic.</span></span>

    4.  <span data-ttu-id="1f359-187">Führen Sie einen Failover für die Datenbank aus, indem Sie Clients vom ursprünglichen primären Server (Server A) auf den online geschalteten sekundären Server (Server B) durchführen.</span><span class="sxs-lookup"><span data-stu-id="1f359-187">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span>

    5.  <span data-ttu-id="1f359-188">Sorgen Sie dafür, dass das Transaktionsprotokoll der zweiten Datenbank nicht gefüllt wird, während die Datenbank online ist.</span><span class="sxs-lookup"><span data-stu-id="1f359-188">Take care that the transaction log of the secondary database does not fill while the database is online.</span></span> <span data-ttu-id="1f359-189">Um das Füllen des Transaktionsprotokolls zu verhindern, müssen Sie es sichern.</span><span class="sxs-lookup"><span data-stu-id="1f359-189">To prevent the transaction log from filling, you might need to back it up.</span></span> <span data-ttu-id="1f359-190">Wenn Sie es sichern, wird die Verwendung eines gemeinsam genutzten Speicherorts, einer *Sicherungsfreigabe*, empfohlen, damit die Sicherungen zum Wiederherstellen auf der anderen Serverinstanz verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="1f359-190">If so, we recommend that you back it up to a shared location, a *backup share*, to make the backups available for restoring on the other server instance.</span></span>

#####  <a name="procedure-2-upgrade-the-original-primary-server-instance-to-sscurrent"></a><a name="Procedure2"></a><span data-ttu-id="1f359-191">Vorgehensweise 2: Aktualisieren der ursprünglichen primären Server Instanz auf[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span><span class="sxs-lookup"><span data-stu-id="1f359-191">Procedure 2: Upgrade the Original Primary Server Instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span></span>
 <span data-ttu-id="1f359-192">Auch nachdem Sie die ursprüngliche primäre Serverinstanz auf [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]aktualisiert haben, ist die Datenbank noch offline und hat dieses Format.</span><span class="sxs-lookup"><span data-stu-id="1f359-192">After you upgrade the original primary server instance to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)], the database will still be offline and in the format.</span></span>

#####  <a name="procedure-3-set-up-log-shipping-on-sscurrent"></a><a name="Procedure3"></a><span data-ttu-id="1f359-193">Vorgehensweise 3: Einrichten des Protokoll Versands auf[!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span><span class="sxs-lookup"><span data-stu-id="1f359-193">Procedure 3: Set Up Log Shipping on [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]</span></span>
 <span data-ttu-id="1f359-194">Der restliche Upgradevorgang hängt davon ab, ob der Protokollversand immer noch konfiguriert ist. Hier gilt:</span><span class="sxs-lookup"><span data-stu-id="1f359-194">The rest of the upgrade process depends on whether log shipping is still configured, as follows:</span></span>

-   <span data-ttu-id="1f359-195">Wenn Sie die [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]-Protokollversandkonfiguration (oder höher) beibehalten haben, wechseln Sie zurück zur ursprünglichen primären Serverinstanz.</span><span class="sxs-lookup"><span data-stu-id="1f359-195">If you have kept the [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]or higher log shipping configuration, switch back to the original primary server instance.</span></span> <span data-ttu-id="1f359-196">Weitere Informationen hierzu finden Sie unter [So wechseln Sie zurück zur ursprünglichen primären Serverinstanz](#SwitchToOrigPrimary)weiter hinten in diesem Thema.</span><span class="sxs-lookup"><span data-stu-id="1f359-196">For more information, see [To Switch Back to the Original Primary Server Instance](#SwitchToOrigPrimary), later in this section.</span></span>

-   <span data-ttu-id="1f359-197">Wenn Sie die Protokollversandkonfiguration vor dem Failover entfernt haben, erstellen Sie eine neue Protokollversandkonfiguration, in der die ursprüngliche sekundäre Serverinstanz die neue primäre Serverinstanz bildet.</span><span class="sxs-lookup"><span data-stu-id="1f359-197">If you removed the log shipping configuration before failing over, create a new log shipping configuration in which the original secondary server instance is the new primary server instance.</span></span> <span data-ttu-id="1f359-198">Weitere Informationen hierzu finden Sie unter [So behalten Sie die ursprüngliche sekundäre Serverinstanz als neue primäre Serverinstanz bei](#KeepOldSecondaryAsNewPrimary)weiter hinten in diesem Thema.</span><span class="sxs-lookup"><span data-stu-id="1f359-198">For more information, see [To Keep the Old Secondary Server Instance As the New Primary Server Instance](#KeepOldSecondaryAsNewPrimary), later in this section.</span></span>

######  <a name="to-switch-back-to-the-original-primary-server-instance"></a><a name="SwitchToOrigPrimary"></a><span data-ttu-id="1f359-199">So wechseln Sie zurück zur ursprünglichen primären Server Instanz</span><span class="sxs-lookup"><span data-stu-id="1f359-199">To Switch Back to the Original Primary Server Instance</span></span>

1.  <span data-ttu-id="1f359-200">Erstellen Sie auf dem zwischenzeitlichen primären Server (Server B) eine Sicherung des Endes der Protokolldatei unter Angabe von WITH NORECOVERY, um eine Sicherung des Protokollfragments zu erstellen und die Datenbank offline zu schalten.</span><span class="sxs-lookup"><span data-stu-id="1f359-200">On the interim primary server (server B), back up the tail of the log using WITH NORECOVERY to create a tail-log backup and take the database offline.</span></span> <span data-ttu-id="1f359-201">Die Sicherung des Protokollfragments hat den Namen `Switchback_AW_20080315.trn`. Beispiel:</span><span class="sxs-lookup"><span data-stu-id="1f359-201">The tail log backup is named `Switchback_AW_20080315.trn`.For example:</span></span>

    ```
    BACKUP LOG AdventureWorks 
      TO DISK = N'\\FileServer\LogShipping\AdventureWorks\Switchback_AW_20080315.trn' 
       WITH NORECOVERY;
    GO
    ```

2.  <span data-ttu-id="1f359-202">Wenn für die zwischenzeitliche primäre Datenbank Transaktionsprotokollsicherungen durchgeführt wurden, die sich von der in Schritt 1 erstellten Sicherung des Protokollfragments unterscheiden, stellen Sie diese Sicherungen unter Angabe von WITH NORECOVERY in der offline geschalteten Datenbank auf dem ursprünglichen primären Server (Server A) wieder her.</span><span class="sxs-lookup"><span data-stu-id="1f359-202">If any transaction log backups were taken on the interim primary database, other than the tail backup that you created in step 1, restore those log backups using WITH NORECOVERY to the offline database on the original primary server (server A).</span></span> <span data-ttu-id="1f359-203">Die Datenbank wird auf das [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] -Format aktualisiert, wenn die erste Protokollsicherung wiederhergestellt wird.</span><span class="sxs-lookup"><span data-stu-id="1f359-203">The database is upgraded to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)] format when the first log backup is restored.</span></span>

3.  <span data-ttu-id="1f359-204">Stellen Sie die Sicherung des Protokollfragments `Switchback_AW_20080315.trn`für die ursprüngliche primäre Datenbank (auf Server A) unter Angabe von WITH RECOVERY wieder her, um die Datenbank online zu schalten.</span><span class="sxs-lookup"><span data-stu-id="1f359-204">Restore the tail-log backup, `Switchback_AW_20080315.trn`, on the original primary database (on server A) using WITH RECOVERY to bring the database online.</span></span>

4.  <span data-ttu-id="1f359-205">Führen Sie einen Failover zur ursprünglichen primären Datenbank (auf Server A) aus, indem Sie Clients vom ursprünglichen primären Server zum online geschalteten sekundären Server umleiten.</span><span class="sxs-lookup"><span data-stu-id="1f359-205">Fail over back to the original primary database (on server A) by redirecting clients to the online secondary server from the original primary server.</span></span>

 <span data-ttu-id="1f359-206">Nachdem die Datenbank online geschaltet wurde, wird die ursprüngliche Protokollversandkonfiguration wieder aufgenommen.</span><span class="sxs-lookup"><span data-stu-id="1f359-206">After the database comes online, the original log shipping configuration will resume.</span></span>

######  <a name="to-keep-the-old-secondary-server-instance-as-the-new-primary-server-instance"></a><a name="KeepOldSecondaryAsNewPrimary"></a><span data-ttu-id="1f359-207">So behalten Sie die alte sekundäre Serverinstanz als neue primäre Serverinstanz bei</span><span class="sxs-lookup"><span data-stu-id="1f359-207">To Keep the Old Secondary Server Instance As the New Primary Server Instance</span></span>
 <span data-ttu-id="1f359-208">Richten Sie eine neue Protokollversandkonfiguration ein, in der die alte sekundäre Serverinstanz B als primärer Server und die alte primäre Serverinstanz A als neuer sekundärer Server fungiert. Beispiel:</span><span class="sxs-lookup"><span data-stu-id="1f359-208">Establish a new log shipping configuration using the old secondary server instance, B, as the primary server and the old primary server instance, A, as the new secondary server, as follows:</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="1f359-209">Die alte Protokollversandkonfiguration sollte zu Beginn dieses Schritts vom ursprünglichen primären Server entfernt worden sein, bevor die manuelle Transaktionsprotokollsicherung durchgeführt wurde, mit der die Datenbank offline geschaltet wurde.</span><span class="sxs-lookup"><span data-stu-id="1f359-209">The old log shipping configuration should have been removed from the original primary server at the start of the process before taking the manual transaction log backup that took the database offline.</span></span>

1.  <span data-ttu-id="1f359-210">Um die Ausführung einer vollständigen Sicherung und Wiederherstellung der Datenbank auf dem neuen sekundären Server (Server A) zu vermeiden, wenden Sie die Protokollsicherungen der neuen primären Datenbank auf die neue sekundäre Datenbank an.</span><span class="sxs-lookup"><span data-stu-id="1f359-210">To avoid performing a complete backup and restore of the database on the new secondary server (server A), apply the log backups from the new primary database to the new secondary database.</span></span> <span data-ttu-id="1f359-211">In der Beispielkonfiguration werden hierzu die auf Server B erstellten Protokollsicherungen in der Datenbank auf Server A wiederhergestellt.</span><span class="sxs-lookup"><span data-stu-id="1f359-211">In the example configuration, this involves restoring the log backups taken on server B to the database on server A.</span></span>

2.  <span data-ttu-id="1f359-212">Sichern Sie das Protokoll der neuen primären Datenbank (auf Server B).</span><span class="sxs-lookup"><span data-stu-id="1f359-212">Back up the log from the new primary database (on server B).</span></span>

3.  <span data-ttu-id="1f359-213">Stellen Sie die Protokollsicherungen auf der neuen sekundären Serverinstanz (Server A) unter Angabe von WITH NORECOVERY wieder her.</span><span class="sxs-lookup"><span data-stu-id="1f359-213">Restore the log backups to the new secondary server instance (server A) using WITH NORECOVERY.</span></span> <span data-ttu-id="1f359-214">Mit dem ersten Wiederherstellungsvorgang wird die Datenbank auf [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)]aktualisiert.</span><span class="sxs-lookup"><span data-stu-id="1f359-214">The first restore operation updates the database to [!INCLUDE[ssCurrent](../../includes/sscurrent-md.md)].</span></span>

4.  <span data-ttu-id="1f359-215">Konfigurieren Sie den Protokollversand so, dass der frühere sekundäre Server (Server B) die primäre Serverinstanz bildet.</span><span class="sxs-lookup"><span data-stu-id="1f359-215">Configure log shipping with the former secondary server (server B) as the primary server instance.</span></span>

    > [!IMPORTANT]
    >  <span data-ttu-id="1f359-216">Wenn Sie [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)]verwenden, geben Sie an, dass die sekundäre Datenbank bereits initialisiert wurde.</span><span class="sxs-lookup"><span data-stu-id="1f359-216">If you use [!INCLUDE[ssManStudioFull](../../includes/ssmanstudiofull-md.md)], specify that the secondary database is already initialized.</span></span>

     <span data-ttu-id="1f359-217">Weitere Informationen finden Sie unter [Konfigurieren des Protokollversands &#40;SQL Server&#41;](configure-log-shipping-sql-server.md)eingeführt.</span><span class="sxs-lookup"><span data-stu-id="1f359-217">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>

5.  <span data-ttu-id="1f359-218">Führen Sie einen Failover für die Datenbank aus, indem Sie Clients vom ursprünglichen primären Server (Server A) auf den online geschalteten sekundären Server (Server B) durchführen.</span><span class="sxs-lookup"><span data-stu-id="1f359-218">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span>

    > [!IMPORTANT]
    >  <span data-ttu-id="1f359-219">Wenn Sie einen Failover auf eine neue primäre Datenbank durchführen, sollten Sie sicherstellen, dass die Metadaten mit den Metadaten der ursprünglichen primären Datenbank übereinstimmen.</span><span class="sxs-lookup"><span data-stu-id="1f359-219">When you failover to a new primary database, you should ensure that its metadata is consistent with the metadata of the original primary database.</span></span> <span data-ttu-id="1f359-220">Weitere Informationen finden Sie unter [Verwalten von Metadaten beim Bereitstellen einer Datenbank auf einer anderen Serverinstanz &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span><span class="sxs-lookup"><span data-stu-id="1f359-220">For more information, see [Manage Metadata When Making a Database Available on Another Server Instance &#40;SQL Server&#41;](../../relational-databases/databases/manage-metadata-when-making-a-database-available-on-another-server.md).</span></span>

##  <a name="upgrading-multiple-secondary-server-instances"></a><a name="MultipleSecondaries"></a><span data-ttu-id="1f359-221">Aktualisieren von mehreren sekundären Server Instanzen</span><span class="sxs-lookup"><span data-stu-id="1f359-221">Upgrading Multiple Secondary Server Instances</span></span>
 <span data-ttu-id="1f359-222">Diese Konfiguration wird in der folgenden Abbildung dargestellt, die eine primäre Serverinstanz A und zwei einzelne sekundäre Serverinstanzen B und C zeigt.</span><span class="sxs-lookup"><span data-stu-id="1f359-222">This configuration is represented in the following illustration, which shows a primary server instance, A, and two secondary server instances, B and C.</span></span>

 <span data-ttu-id="1f359-223">![Zwei sekundäre Server und kein Überwachungsserver](../media/ls-3-wayconfig-nomonitor.gif "Zwei sekundäre Server und kein Überwachungsserver")</span><span class="sxs-lookup"><span data-stu-id="1f359-223">![Two secondary servers and no monitor server](../media/ls-3-wayconfig-nomonitor.gif "Two secondary servers and no monitor server")</span></span>

 <span data-ttu-id="1f359-224">In diesem Abschnitt wird erläutert, wie Sie eine Aktualisierung mit einem Failover durchführen können und dann zum ursprünglichen primären Server zurückwechseln können.</span><span class="sxs-lookup"><span data-stu-id="1f359-224">This section discusses how to upgrade using a failover and then switching back to the original primary server.</span></span> <span data-ttu-id="1f359-225">Wenn die primäre Serverinstanz mit Failover aktualisiert wird, ist der Upgradevorgang komplizierter, wenn mehrere sekundäre Serverinstanzen vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="1f359-225">When upgrading the primary instance with failover the process is more complex when there are multiple secondary server instances.</span></span> <span data-ttu-id="1f359-226">Im folgenden Verfahren wird nach der Aktualisierung aller sekundären Server ein Failover für den primären Server auf eine der aktualisierten sekundären Datenbanken durchgeführt.</span><span class="sxs-lookup"><span data-stu-id="1f359-226">In the following procedure, after all the secondary servers are upgraded, the primary server is failed over to one of the upgraded secondary databases.</span></span> <span data-ttu-id="1f359-227">Der ursprüngliche primäre Server wird aktualisiert, und für den Protokollversand wird ein Failover zurück zu diesem Server ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="1f359-227">The original primary server is upgraded, and log shipping is failed over back to it.</span></span>

> [!IMPORTANT]
>  <span data-ttu-id="1f359-228">Aktualisieren Sie stets sämtliche sekundäre Serverinstanzen vor der primären Serverinstanz.</span><span class="sxs-lookup"><span data-stu-id="1f359-228">Always upgrade all the secondary server instances before you upgrade the primary server.</span></span>

 <span data-ttu-id="1f359-229">**So aktualisieren Sie mit einem Failover und wechseln dann zum ursprünglichen primären Server zurück**</span><span class="sxs-lookup"><span data-stu-id="1f359-229">**To upgrade using a failover and then switching back to original primary server**</span></span>

1.  <span data-ttu-id="1f359-230">Aktualisieren Sie alle sekundären Serverinstanzen (Server B und C).</span><span class="sxs-lookup"><span data-stu-id="1f359-230">Upgrade all the secondary server instances (server B and server C).</span></span>

2.  <span data-ttu-id="1f359-231">Erstellen Sie eine Sicherung des Endes der Protokolldatei (auf Server A) unter Angabe von WITH NORECOVERY, um eine Sicherung des Protokollfragments der primären Datenbank zu erhalten und die Datenbank offline zu schalten.</span><span class="sxs-lookup"><span data-stu-id="1f359-231">Obtain the tail of the transaction log of the primary database (on server A), and take the database offline, by backing up the transaction log using WITH NORECOVERY.</span></span>

3.  <span data-ttu-id="1f359-232">Schalten Sie auf dem sekundären Server, auf den das Failover durchgeführt werden soll (Server B), die sekundäre Datenbank online, indem Sie die Protokollsicherung unter Angabe von WITH RECOVERY wiederherstellen.</span><span class="sxs-lookup"><span data-stu-id="1f359-232">On the secondary server to which you plan to fail over (server B), bring the secondary database online, by restoring the log backup using WITH RECOVERY.</span></span>

4.  <span data-ttu-id="1f359-233">Lassen Sie auf dem anderen sekundären Server (Server C) die sekundäre Datenbank offline, indem Sie die Protokollsicherung unter Angabe von WITH NORECOVERY wiederherstellen.</span><span class="sxs-lookup"><span data-stu-id="1f359-233">On every other secondary server (server C), leave the secondary database offline by restoring the log backup using WITH NORECOVERY.</span></span>

    > [!NOTE]
    >  <span data-ttu-id="1f359-234">Die Aufträge zum Kopieren und Wiederherstellen des Protokollversands werden auf den sekundären Servern ausgeführt, aber die Aufträge bewirken nichts, weil die neuen Protokollsicherungsdateien nicht in der Sicherungsfreigabe abgelegt werden.</span><span class="sxs-lookup"><span data-stu-id="1f359-234">The log shipping copy and restore jobs will run on the secondary servers, but the jobs will do nothing because new log-backup files will not be placed on the backup share.</span></span>

5.  <span data-ttu-id="1f359-235">Führen Sie einen Failover für die Datenbank aus, indem Sie Clients vom ursprünglichen primären Server (Server A) auf den online geschalteten sekundären Server (Server B) durchführen.</span><span class="sxs-lookup"><span data-stu-id="1f359-235">Fail over the database by redirecting clients from the original primary server (server A) to the online secondary server (server B).</span></span> <span data-ttu-id="1f359-236">Die online geschaltete Datenbank fungiert zwischenzeitlich als primärer Server, wodurch die Datenbank verfügbar bleibt, während die ursprüngliche primäre Serverinstanz aktualisiert wird.</span><span class="sxs-lookup"><span data-stu-id="1f359-236">The online database becomes an interim primary server, keeping the database available while the original primary server is offline (server A).</span></span>

6.  <span data-ttu-id="1f359-237">Aktualisieren Sie den ursprünglichen primären Server (Server A).</span><span class="sxs-lookup"><span data-stu-id="1f359-237">Upgrade the original primary server (server A).</span></span>

7.  <span data-ttu-id="1f359-238">Sichern Sie das Transaktionsprotokoll für die Datenbank, für die Sie ein Failover durchgeführt haben (auf Server B), manuell mithilfe von with NORECOVERY.</span><span class="sxs-lookup"><span data-stu-id="1f359-238">On the database to which you failed over-the interim primary database (on server B), manually back up the transaction log using WITH NORECOVERY.</span></span> <span data-ttu-id="1f359-239">Dadurch wird die Datenbank offline geschaltet.</span><span class="sxs-lookup"><span data-stu-id="1f359-239">This takes the database offline.</span></span>

8.  <span data-ttu-id="1f359-240">Stellen Sie alle Transaktionsprotokollsicherungen, die Sie in der zwischenzeitlichen Datenbank (auf Server B) erstellt haben, in jeder anderen sekundären Datenbank (auf Server C) unter Angabe von WITH NORECOVERY wieder her.</span><span class="sxs-lookup"><span data-stu-id="1f359-240">Restore all transaction log backups that you created on the interim primary database (on server B) to every other secondary database (on server C) using WITH NORECOVERY.</span></span> <span data-ttu-id="1f359-241">Dadurch kann der Protokollversand von der ursprünglichen primären Datenbank nach deren Aktualisierung fortgesetzt werden, ohne dass in jeder sekundären Datenbank eine komplette Datenbankwiederherstellung durchgeführt werden muss.</span><span class="sxs-lookup"><span data-stu-id="1f359-241">This allows log shipping to continue from the original primary database after its upgrade, without requiring a full database restore on each secondary database.</span></span>

9. <span data-ttu-id="1f359-242">Stellen Sie das Transaktionsprotokoll vom zwischenzeitlichen primären Server (Server B) unter Angabe von WITH RECOVERY in der ursprünglichen primären Datenbank (auf Server A) wieder her.</span><span class="sxs-lookup"><span data-stu-id="1f359-242">Restore the transaction log from the interim primary server (server B) to the original primary database (on server A) using WITH RECOVERY.</span></span>

##  <a name="redeploying-log-shipping"></a><a name="Redeploying"></a><span data-ttu-id="1f359-243">Erneute Bereitstellung des Protokoll Versands</span><span class="sxs-lookup"><span data-stu-id="1f359-243">Redeploying Log Shipping</span></span>
 <span data-ttu-id="1f359-244">Wenn Sie die Protokollversandkonfiguration nicht mit einem der oben beschriebenen Verfahren migrieren möchten, können Sie den Protokollversand neu bereitstellen, indem Sie die sekundäre Datenbank mit einer vollständigen Sicherung und Wiederherstellung der primären Datenbank neu initialisieren.</span><span class="sxs-lookup"><span data-stu-id="1f359-244">If you do not want to migrate your log shipping configuration using one of the procedures shown above, you can redeploy log shipping from scratch by reinitializing your secondary database with a full backup and restore of the primary database.</span></span> <span data-ttu-id="1f359-245">Diese Option bietet sich u. U. an, wenn es um eine kleine Datenbank geht oder wenn Hochverfügbarkeit während des Upgradevorgangs nicht wichtig ist.</span><span class="sxs-lookup"><span data-stu-id="1f359-245">This may be a desirable option if you have a small database or if high availability is not crucial during the upgrade procedure.</span></span>

 <span data-ttu-id="1f359-246">Weitere Informationen zum Aktivieren des Protokoll Versands finden Sie unter [Konfigurieren des Protokoll Versands &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="1f359-246">For information about enabling log shipping, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>

## <a name="see-also"></a><span data-ttu-id="1f359-247">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="1f359-247">See Also</span></span>
 <span data-ttu-id="1f359-248">[Transaktionsprotokoll Sicherungen &#40;SQL Server&#41;](../../relational-databases/backup-restore/transaction-log-backups-sql-server.md) [Transaktionsprotokoll Sicherungen &#40;SQL Server&#41;](../../relational-databases/backup-restore/apply-transaction-log-backups-sql-server.md) [Protokoll Versand Tabellen und gespeicherte Prozeduren](log-shipping-tables-and-stored-procedures.md) anwenden.</span><span class="sxs-lookup"><span data-stu-id="1f359-248">[Transaction Log Backups &#40;SQL Server&#41;](../../relational-databases/backup-restore/transaction-log-backups-sql-server.md) [Apply Transaction Log Backups &#40;SQL Server&#41;](../../relational-databases/backup-restore/apply-transaction-log-backups-sql-server.md) [Log Shipping Tables and Stored Procedures](log-shipping-tables-and-stored-procedures.md)</span></span>
