---
title: Protokollversand und Replikation (SQL Server) | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: high-availability
ms.topic: conceptual
helpviewer_keywords:
- replication [SQL Server], log shipping and
- log shipping [SQL Server], replication and
ms.assetid: 132bebfd-0206-4d23-829a-b38e5ed17bc9
author: MashaMSFT
ms.author: mathoma
ms.openlocfilehash: e3b1a0e08c5850b9e31202965909dfcfe1273e47
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87619331"
---
# <a name="log-shipping-and-replication-sql-server"></a><span data-ttu-id="60238-102">Protokollversand und Replikation (SQL Server)</span><span class="sxs-lookup"><span data-stu-id="60238-102">Log Shipping and Replication (SQL Server)</span></span>
  <span data-ttu-id="60238-103">Beim Protokollversand werden zwei Kopien einer einzigen Datenbank verwendet, die normalerweise auf verschiedenen Computern gespeichert sind.</span><span class="sxs-lookup"><span data-stu-id="60238-103">Log shipping involves two copies of a single database that typically reside on different computers.</span></span> <span data-ttu-id="60238-104">Für die Clients ist immer nur eine Kopie der Datenbank verfügbar.</span><span class="sxs-lookup"><span data-stu-id="60238-104">At any given time, only one copy of the database is currently available to clients.</span></span> <span data-ttu-id="60238-105">Diese Kopie wird als primäre Datenbank bezeichnet.</span><span class="sxs-lookup"><span data-stu-id="60238-105">This copy is known as the primary database.</span></span> <span data-ttu-id="60238-106">Updates, die von Clients an der primären Datenbank vorgenommen werden, werden durch den Protokollversand auf die andere Kopie der Datenbank übertragen, die als sekundäre Datenbank bezeichnet wird.</span><span class="sxs-lookup"><span data-stu-id="60238-106">Updates made by clients to the primary database are propagated by means of log shipping to the other copy of the database, known as the secondary database.</span></span> <span data-ttu-id="60238-107">Beim Protokollversand wird das Transaktionsprotokoll von jedem Einfüge-, Update- oder Löschvorgang, der an der primären Datenbank vorgenommen wird, auf die sekundäre Datenbank angewandt.</span><span class="sxs-lookup"><span data-stu-id="60238-107">Log shipping involves applying the transaction log from every insertion, update, or deletion made on the primary database onto the secondary database.</span></span>  
  
 <span data-ttu-id="60238-108">Der Protokollversand kann zusammen mit der Replikation verwendet werden, wobei das folgende Verhalten auftritt:</span><span class="sxs-lookup"><span data-stu-id="60238-108">Log shipping can be used in conjunction with replication, with the following behavior:</span></span>  
  
-   <span data-ttu-id="60238-109">Die Replikation wird nicht fortgesetzt, nachdem ein Failover des Protokollversands aufgetreten ist.</span><span class="sxs-lookup"><span data-stu-id="60238-109">Replication does not continue after a log shipping failover.</span></span> <span data-ttu-id="60238-110">Wenn ein Failover auftritt, stellen die Replikations-Agents keine Verbindung mit der sekundären Datenbank her, sodass keine Replikation der Transaktionen auf die Abonnenten erfolgt.</span><span class="sxs-lookup"><span data-stu-id="60238-110">If a failover occurs, replication agents do not connect to the secondary, so transactions are not replicated to Subscribers.</span></span> <span data-ttu-id="60238-111">Wenn ein Failback zur primären Datenbank auftritt, wird die Replikation fortgesetzt.</span><span class="sxs-lookup"><span data-stu-id="60238-111">If a failback to the primary occurs, replication resumes.</span></span> <span data-ttu-id="60238-112">Alle Transaktionen, die beim Protokollversand von der sekundären Datenbank zurück zur primären Datenbank kopiert werden, werden zu den Abonnenten repliziert.</span><span class="sxs-lookup"><span data-stu-id="60238-112">All transactions that log shipping copies from the secondary back to the primary are replicated to Subscribers.</span></span>  
  
-   <span data-ttu-id="60238-113">Wenn die primäre Datenbank dauerhaft verloren geht, kann die sekundäre Datenbank umbenannt werden, sodass die Replikation fortgesetzt werden kann.</span><span class="sxs-lookup"><span data-stu-id="60238-113">If the primary is permanently lost, the secondary can be renamed so that replication can continue.</span></span> <span data-ttu-id="60238-114">Im weiteren Verlaufs dieses Themas werden die Anforderungen und Prozeduren zur Behandlung dieses Falls beschrieben.</span><span class="sxs-lookup"><span data-stu-id="60238-114">The remainder of this topic describes the requirements and procedures for handling this case.</span></span> <span data-ttu-id="60238-115">Das bereitgestellte Beispiel bezieht sich auf die Veröffentlichungsdatenbank, weil bei dieser Datenbank der Protokollversand am häufigsten auftritt. Ein gleichartiger Prozess kann jedoch auch auf Abonnement- und Verteilungsdatenbanken angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="60238-115">The example given is the publication database, which is the most common database to log ship, but a similar process can also be applied to subscription and distribution databases.</span></span>  
  
 <span data-ttu-id="60238-116">Informationen zum Wiederherstellen von Datenbanken, die an der Replikation beteiligt sind, ohne dass dazu die Replikation neu konfiguriert werden muss, finden Sie unter [Sichern und Wiederherstellen von replizierten Datenbanken](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span><span class="sxs-lookup"><span data-stu-id="60238-116">For information about recovering databases involved in replication without any need to reconfigure replication, see [Back Up and Restore Replicated Databases](../../relational-databases/replication/administration/back-up-and-restore-replicated-databases.md).</span></span>  
  
> [!NOTE]  
>  <span data-ttu-id="60238-117">Es wird empfohlen, anstelle des Protokollversands die Datenbankspiegelung zu verwenden, um die Verfügbarkeit der Veröffentlichungsdatenbank sicherzustellen.</span><span class="sxs-lookup"><span data-stu-id="60238-117">We recommend using database mirroring, rather than log shipping, to provide availability for the publication database.</span></span> <span data-ttu-id="60238-118">Weitere Informationen finden Sie unter [Datenbankspiegelung und Replikation &#40;SQL Server&#41;](../database-mirroring/database-mirroring-and-replication-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="60238-118">For more information, see [Database Mirroring and Replication &#40;SQL Server&#41;](../database-mirroring/database-mirroring-and-replication-sql-server.md).</span></span>  
  
## <a name="requirements-and-procedures-for-replicating-from-the-secondary-if-the-primary-is-lost"></a><span data-ttu-id="60238-119">Anforderungen und Prozeduren zum Replizieren von der sekundären Datenbank beim Ausfall der primären Datenbank</span><span class="sxs-lookup"><span data-stu-id="60238-119">Requirements and Procedures for Replicating from the Secondary If the Primary Is Lost</span></span>  
 <span data-ttu-id="60238-120">Beachten Sie die folgenden Anforderungen und Überlegungen:</span><span class="sxs-lookup"><span data-stu-id="60238-120">Be aware of the following requirements and considerations:</span></span>  
  
-   <span data-ttu-id="60238-121">Wenn eine primäre Datenbank mehrere Veröffentlichungsdatenbanken enthält, muss der Protokollversand aller Veröffentlichungsdatenbanken zur selben sekundären Datenbank erfolgen.</span><span class="sxs-lookup"><span data-stu-id="60238-121">If a primary contains more than one publication database, log ship all of the publication databases to the same secondary.</span></span>  
  
-   <span data-ttu-id="60238-122">Der Installationspfad der Sekundärserverinstanz muss dem der primären Datenbank entsprechen.</span><span class="sxs-lookup"><span data-stu-id="60238-122">The installation path for the secondary server instance must be the same as the primary.</span></span> <span data-ttu-id="60238-123">Die Speicherorte der Benutzerdatenbank auf dem Sekundärserver müssen denen auf dem Primärserver entsprechen.</span><span class="sxs-lookup"><span data-stu-id="60238-123">User database locations on the secondary server must be the same as on the primary.</span></span>  
  
-   <span data-ttu-id="60238-124">Sichern Sie den Diensthauptschlüssel auf der primären Datenbank.</span><span class="sxs-lookup"><span data-stu-id="60238-124">Back up the service master key at the primary.</span></span> <span data-ttu-id="60238-125">Dieser Schlüssel wird in der sekundären Datenbank wiederhergestellt.</span><span class="sxs-lookup"><span data-stu-id="60238-125">This key will be restored at the secondary.</span></span> <span data-ttu-id="60238-126">Weitere Informationen finden Sie unter [BACKUP SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-service-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="60238-126">For more information, see [BACKUP SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/backup-service-master-key-transact-sql).</span></span>  
  
-   <span data-ttu-id="60238-127">Der Protokollversand garantiert keinen Schutz vor Datenverlust.</span><span class="sxs-lookup"><span data-stu-id="60238-127">Log shipping does not guarantee against data loss.</span></span> <span data-ttu-id="60238-128">Ein Ausfall der primären Datenbank kann zum Verlust der Daten führen, die noch nicht gesichert wurden oder deren Sicherungskopien bei dem Ausfall verloren gehen.</span><span class="sxs-lookup"><span data-stu-id="60238-128">A failure on the primary database can result in the loss of data that has not yet been backed up or for backups that are lost during the failure.</span></span>  
  
### <a name="log-shipping-with-transactional-replication"></a><span data-ttu-id="60238-129">Protokollversand mit Transaktionsreplikation</span><span class="sxs-lookup"><span data-stu-id="60238-129">Log Shipping with Transactional Replication</span></span>  
 <span data-ttu-id="60238-130">Bei der Transaktionsreplikation hängt das Verhalten des Protokollversands von der **sync with backup** -Option ab.</span><span class="sxs-lookup"><span data-stu-id="60238-130">For transactional replication, the behavior of log shipping depends on the **sync with backup** option.</span></span> <span data-ttu-id="60238-131">Diese Option kann für die Veröffentlichungsdatenbank und für die Verteilungsdatenbank festgelegt werden; beim Protokollversand für den Verleger ist nur die Einstellung für die Veröffentlichungsdatenbank relevant.</span><span class="sxs-lookup"><span data-stu-id="60238-131">This option can be set on the publication database and distribution database; in log shipping for the Publisher, only the setting on the publication database is relevant.</span></span>  
  
 <span data-ttu-id="60238-132">Wenn Sie diese Option für die Veröffentlichungsdatenbank festlegen, stellen Sie sicher, dass Transaktionen erst an die Verteilungsdatenbank übermittelt werden, wenn Sie in der Veröffentlichungsdatenbank gesichert wurden.</span><span class="sxs-lookup"><span data-stu-id="60238-132">Setting this option on the publication database ensures that transactions are not delivered to the distribution database until they are backed up at the publication database.</span></span> <span data-ttu-id="60238-133">Die neueste Sicherung der Veröffentlichungsdatenbank kann dann auf dem Sekundärserver wiederhergestellt werden, und es besteht keine Möglichkeit, dass die Verteilungsdatenbank Transaktionen enthält, die in der wiederhergestellten Veröffentlichungsdatenbank nicht vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="60238-133">The last publication database backup can then be restored at the secondary server without any possibility of the distribution database having transactions that the restored publication database does not have.</span></span> <span data-ttu-id="60238-134">Mit dieser Option wird die Konsistenz zwischen dem Verleger, dem Verteiler und den Abonnenten sichergestellt, wenn ein Failover des Verlegers zu einem Sekundärserver erfolgt.</span><span class="sxs-lookup"><span data-stu-id="60238-134">This option guarantees that if the Publisher fails over to a secondary server, consistency is maintained between the Publisher, Distributor, and Subscribers.</span></span> <span data-ttu-id="60238-135">Latenzzeit und Durchsatz sind betroffen, da Transaktionen erst an die Verteilungsdatenbank übermittelt werden können, nachdem sie auf dem Verleger gesichert wurden. Wenn Ihre Anwendung diese Latenzzeit tolerieren kann, sollten Sie diese Option für die Veröffentlichungsdatenbank festlegen.</span><span class="sxs-lookup"><span data-stu-id="60238-135">Latency and throughput are affected because transactions cannot be delivered to the distribution database until they have been backed up at the Publisher; if your application can tolerate this latency, we recommend that you set this option on the publication database.</span></span> <span data-ttu-id="60238-136">Wenn die **sync with backup** -Option nicht festgelegt ist, können Abonnenten Änderungen empfangen, die nicht mehr in der wiederhergestellten Datenbank auf dem Sekundärserver enthalten sind.</span><span class="sxs-lookup"><span data-stu-id="60238-136">If the **sync with backup** option is not set, Subscribers might receive changes that are no longer included in the recovered database at the secondary server.</span></span> <span data-ttu-id="60238-137">Weitere Informationen finden Sie unter [Strategien zum Sichern und Wiederherstellen einer Momentaufnahme- und Transaktionsreplikation](../../relational-databases/replication/transactional/transactional-replication.md).</span><span class="sxs-lookup"><span data-stu-id="60238-137">For more information, see [Strategies for Backing Up and Restoring Snapshot and Transactional Replication](../../relational-databases/replication/transactional/transactional-replication.md).</span></span>  
  
 <span data-ttu-id="60238-138">**Konfigurieren der Transaktionsreplikation und des Protokollversands mit der "sync with backup"-Option**</span><span class="sxs-lookup"><span data-stu-id="60238-138">**To configure transactional replication and log shipping with the sync with backup option**</span></span>  
  
1.  <span data-ttu-id="60238-139">Wenn die "sync with backup"-Option nicht für die Veröffentlichungsdatenbank festgelegt ist, führen Sie `sp_replicationdboption '<publicationdatabasename>', 'sync with backup', 'true'`aus.</span><span class="sxs-lookup"><span data-stu-id="60238-139">If the sync with backup option is not set on the publication database, execute `sp_replicationdboption '<publicationdatabasename>', 'sync with backup', 'true'`.</span></span> <span data-ttu-id="60238-140">Weitere Informationen finden Sie unter [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="60238-140">For more information, see [sp_replicationdboption &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replicationdboption-transact-sql).</span></span>  
  
2.  <span data-ttu-id="60238-141">Konfigurieren Sie den Protokollversand für die Veröffentlichungsdatenbank.</span><span class="sxs-lookup"><span data-stu-id="60238-141">Configure log shipping for the publication database.</span></span> <span data-ttu-id="60238-142">Weitere Informationen finden Sie unter [Konfigurieren des Protokollversands &#40;SQL Server&#41;](configure-log-shipping-sql-server.md)eingeführt.</span><span class="sxs-lookup"><span data-stu-id="60238-142">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>  
  
3.  <span data-ttu-id="60238-143">Bei einem Ausfall des Verlegers stellen Sie das letzte Protokoll der Datenbank mithilfe der Option KEEP_REPLICATION von RESTORE LOG auf dem Sekundärserver wieder her.</span><span class="sxs-lookup"><span data-stu-id="60238-143">If the Publisher fails, restore the last log of the database to the secondary server, using the KEEP_REPLICATION option of RESTORE LOG.</span></span> <span data-ttu-id="60238-144">Damit werden alle Replikationseinstellungen für die Datenbank beibehalten.</span><span class="sxs-lookup"><span data-stu-id="60238-144">This retains all replication settings for the database.</span></span> <span data-ttu-id="60238-145">Weitere Informationen finden Sie unter [Failover zu einer sekundären Datenbank für den Protokollversand &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) und [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="60238-145">For more information, see [Fail Over to a Log Shipping Secondary &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) and [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
4.  <span data-ttu-id="60238-146">Stellen Sie die **msdb** -Datenbank und die **master** -Datenbanken von der Primärdatenbank zur sekundären Datenbank wieder her.</span><span class="sxs-lookup"><span data-stu-id="60238-146">Restore the **msdb** database and **master** databases from the primary to the secondary.</span></span> <span data-ttu-id="60238-147">Weitere Informationen finden Sie unter [Sichern und Wiederherstellen von Systemdatenbanken &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="60238-147">For more information, see [Back Up and Restore of System Databases &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span></span> <span data-ttu-id="60238-148">Wenn die primäre Datenbank auch ein Verteiler war, stellen Sie die Verteilungsdatenbank von der primären zur sekundären Datenbank wieder her.</span><span class="sxs-lookup"><span data-stu-id="60238-148">If the primary was also a Distributor, restore the distribution database from the primary to the secondary.</span></span>  
  
     <span data-ttu-id="60238-149">Diese Datenbanken müssen im Hinblick auf die Replikationskonfiguration und auf die Einstellungen mit der Veröffentlichungsdatenbank auf dem Primärserver konsistent sein.</span><span class="sxs-lookup"><span data-stu-id="60238-149">These databases must be consistent with the publication database at the primary in terms of replication configuration and settings.</span></span>  
  
5.  <span data-ttu-id="60238-150">Benennen Sie auf dem Sekundärserver den Computer um, und benennen Sie dann die [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Instanz so um, dass ihr Name zum Primärservernamen passt.</span><span class="sxs-lookup"><span data-stu-id="60238-150">At the secondary server, rename the computer and then rename the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance to match the primary server name.</span></span> <span data-ttu-id="60238-151">Informationen zum Umbenennen des Computers finden Sie in der Windows-Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="60238-151">For information about renaming the computer, see the Windows documentation.</span></span> <span data-ttu-id="60238-152">Informationen zum Umbenennen des Servers finden Sie unter [Umbenennen eines Computers, der eine eigenständige Instanz von SQL Server hostet](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) und [Umbenennen einer SQL Server-Failoverclusterinstanz](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span><span class="sxs-lookup"><span data-stu-id="60238-152">For information about renaming the server, see [Rename a Computer that Hosts a Stand-Alone Instance of SQL Server](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) and [Rename a SQL Server Failover Cluster Instance](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span></span>  
  
6.  <span data-ttu-id="60238-153">Stellen Sie auf dem Sekundärserver den Diensthauptschlüssel wieder her, der von der primären Datenbank gesichert wurde.</span><span class="sxs-lookup"><span data-stu-id="60238-153">At the secondary server, restore the service master key that was backed up from the primary.</span></span> <span data-ttu-id="60238-154">Weitere Informationen finden Sie unter [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="60238-154">For more information, see [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span></span>  
  
 <span data-ttu-id="60238-155">**Konfigurieren der Transaktionsreplikation und des Protokollversands ohne die "sync with backup"-Option**</span><span class="sxs-lookup"><span data-stu-id="60238-155">**To configure transactional replication and log shipping without the sync with backup option**</span></span>  
  
1.  <span data-ttu-id="60238-156">Konfigurieren Sie den Protokollversand für die Veröffentlichungsdatenbank.</span><span class="sxs-lookup"><span data-stu-id="60238-156">Configure log shipping for the publication database.</span></span> <span data-ttu-id="60238-157">Weitere Informationen finden Sie unter [Konfigurieren des Protokollversands &#40;SQL Server&#41;](configure-log-shipping-sql-server.md)eingeführt.</span><span class="sxs-lookup"><span data-stu-id="60238-157">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="60238-158">Bei einem Ausfall des Verlegers stellen Sie das letzte Protokoll der Datenbank mithilfe der Option KEEP_REPLICATION von RESTORE LOG auf dem Sekundärserver wieder her.</span><span class="sxs-lookup"><span data-stu-id="60238-158">If the Publisher fails, restore the last log of the database to the secondary server, using the KEEP_REPLICATION option of RESTORE LOG.</span></span> <span data-ttu-id="60238-159">Damit werden alle Replikationseinstellungen für die Datenbank beibehalten.</span><span class="sxs-lookup"><span data-stu-id="60238-159">This retains all replication settings for the database.</span></span> <span data-ttu-id="60238-160">Weitere Informationen finden Sie unter [Failover zu einer sekundären Datenbank für den Protokollversand &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) und [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="60238-160">For more information, see [Fail Over to a Log Shipping Secondary &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) and [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
3.  <span data-ttu-id="60238-161">Stellen Sie die **msdb** -Datenbank und die **master** -Datenbanken von der Primärdatenbank zur sekundären Datenbank wieder her.</span><span class="sxs-lookup"><span data-stu-id="60238-161">Restore the **msdb** database and **master** databases from the primary to the secondary.</span></span> <span data-ttu-id="60238-162">Weitere Informationen finden Sie unter [Sichern und Wiederherstellen von Systemdatenbanken &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="60238-162">For more information, see [Back Up and Restore of System Databases &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span></span> <span data-ttu-id="60238-163">Wenn die primäre Datenbank auch ein Verteiler war, stellen Sie die Verteilungsdatenbank von der primären zur sekundären Datenbank wieder her.</span><span class="sxs-lookup"><span data-stu-id="60238-163">If the primary was also a Distributor, restore the distribution database from the primary to the secondary.</span></span>  
  
     <span data-ttu-id="60238-164">Diese Datenbanken müssen im Hinblick auf die Replikationskonfiguration und auf die Einstellungen mit der Veröffentlichungsdatenbank auf dem Primärserver konsistent sein.</span><span class="sxs-lookup"><span data-stu-id="60238-164">These databases must be consistent with the publication database at the primary in terms of replication configuration and settings.</span></span>  
  
4.  <span data-ttu-id="60238-165">Benennen Sie auf dem Sekundärserver den Computer um, und benennen Sie dann die [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Instanz so um, dass ihr Name zum Primärservernamen passt.</span><span class="sxs-lookup"><span data-stu-id="60238-165">At the secondary server, rename the computer and then rename the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance to match the primary server name.</span></span> <span data-ttu-id="60238-166">Informationen zum Umbenennen des Computers finden Sie in der Windows-Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="60238-166">For information about renaming the computer, see the Windows documentation.</span></span> <span data-ttu-id="60238-167">Informationen zum Umbenennen des Servers finden Sie unter [Umbenennen eines Computers, der eine eigenständige Instanz von SQL Server hostet](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) und [Umbenennen einer SQL Server-Failoverclusterinstanz](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span><span class="sxs-lookup"><span data-stu-id="60238-167">For information about renaming the server, see [Rename a Computer that Hosts a Stand-Alone Instance of SQL Server](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) and [Rename a SQL Server Failover Cluster Instance](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span></span>  
  
     <span data-ttu-id="60238-168">Sie erhalten möglicherweise eine Fehlermeldung vom Protokolllese-Agent, die besagt, dass die Veröffentlichungsdatenbank und die Verteilungsdatenbank nicht synchronisiert sind.</span><span class="sxs-lookup"><span data-stu-id="60238-168">You might receive an error message from the Log Reader Agent that the publication database and the distribution database are not synchronized.</span></span>  
  
5.  <span data-ttu-id="60238-169">Stellen Sie auf dem Sekundärserver den Diensthauptschlüssel wieder her, der von der primären Datenbank gesichert wurde.</span><span class="sxs-lookup"><span data-stu-id="60238-169">At the secondary server, restore the service master key that was backed up from the primary.</span></span> <span data-ttu-id="60238-170">Weitere Informationen finden Sie unter [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="60238-170">For more information, see [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span></span>  
  
6.  <span data-ttu-id="60238-171">Führen Sie **sp_replrestart** aus.</span><span class="sxs-lookup"><span data-stu-id="60238-171">Execute **sp_replrestart**.</span></span> <span data-ttu-id="60238-172">Diese gespeicherte Prozedur kann dazu verwendet werden, den Protokolllese-Agent zu zwingen, alle vorhergehenden replizierten Transaktionen im Protokoll der Veröffentlichungsdatenbank zu ignorieren.</span><span class="sxs-lookup"><span data-stu-id="60238-172">This stored procedure can be used to force the Log Reader Agent to ignore all the previous replicated transactions in the publication database log.</span></span> <span data-ttu-id="60238-173">Transaktionen, die nach dem Beenden der gespeicherten Prozedur angewendet werden, werden vom Protokolllese-Agent verarbeitet.</span><span class="sxs-lookup"><span data-stu-id="60238-173">Transactions applied after the completion of the stored procedure are processed by the Log Reader Agent.</span></span> <span data-ttu-id="60238-174">Weitere Informationen finden Sie unter [sp_replrestart &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="60238-174">For more information, see [sp_replrestart &#40;Transact-SQL&#41;](/sql/relational-databases/system-stored-procedures/sp-replrestart-transact-sql).</span></span>  
  
7.  <span data-ttu-id="60238-175">Starten Sie den Protokolllese-Agent nach der erfolgreichen Ausführung der gespeicherten Prozedur neu.</span><span class="sxs-lookup"><span data-stu-id="60238-175">Restart the Log Reader Agent after the stored procedure executes successfully.</span></span> <span data-ttu-id="60238-176">Weitere Informationen finden Sie unter [Starten und Beenden eines Replikations-Agents &#40;SQL Server Management Studio&#41;](../../relational-databases/replication/agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span><span class="sxs-lookup"><span data-stu-id="60238-176">For more information, see [Start and Stop a Replication Agent &#40;SQL Server Management Studio&#41;](../../relational-databases/replication/agents/start-and-stop-a-replication-agent-sql-server-management-studio.md).</span></span>  
  
8.  <span data-ttu-id="60238-177">Transaktionen, die bereits an den Abonnenten verteilt wurden, können evtl. auf dem Verleger angewendet werden.</span><span class="sxs-lookup"><span data-stu-id="60238-177">Transactions that have already been distributed to Subscriber might be applied at the Publisher.</span></span> <span data-ttu-id="60238-178">Um sicherzustellen, dass der Verteilungs-Agent nicht zu einem Fehler führt, wenn versucht wird, diese Transaktionen erneut auf einen Abonnenten anzuwenden, müssen Sie das Agentprofil **Fortsetzen bei Datenkonsistenzfehlern**angeben.</span><span class="sxs-lookup"><span data-stu-id="60238-178">To ensure that the Distribution Agent does not fail with an error when attempting to reapply these transactions at a Subscriber, specify the agent profile titled **Continue On Data Consistency Errors**.</span></span>  
  
### <a name="log-shipping-with-merge-replication"></a><span data-ttu-id="60238-179">Protokollversand mit Mergereplikation</span><span class="sxs-lookup"><span data-stu-id="60238-179">Log Shipping with Merge Replication</span></span>  
 <span data-ttu-id="60238-180">Führen Sie die Schritte in der nachstehenden Prozedur aus, um die Mergereplikation und den Protokollversand zu konfigurieren.</span><span class="sxs-lookup"><span data-stu-id="60238-180">Follow the steps in the procedure below to configure merge replication and log shipping.</span></span>  
  
 <span data-ttu-id="60238-181">**So konfigurieren Sie die Mergereplikation und den Protokollversand**</span><span class="sxs-lookup"><span data-stu-id="60238-181">**To configure merge replication and log shipping**</span></span>  
  
1.  <span data-ttu-id="60238-182">Konfigurieren Sie den Protokollversand für die Veröffentlichungsdatenbank.</span><span class="sxs-lookup"><span data-stu-id="60238-182">Configure log shipping for the publication database.</span></span> <span data-ttu-id="60238-183">Weitere Informationen finden Sie unter [Konfigurieren des Protokollversands &#40;SQL Server&#41;](configure-log-shipping-sql-server.md)eingeführt.</span><span class="sxs-lookup"><span data-stu-id="60238-183">For more information, see [Configure Log Shipping &#40;SQL Server&#41;](configure-log-shipping-sql-server.md).</span></span>  
  
2.  <span data-ttu-id="60238-184">Bei einem Ausfall des Verlegers benennen Sie den Computer auf dem Sekundärserver um, und weisen der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]-Instanz dann einen Namen zu, der dem Namen des primären Servers entspricht.</span><span class="sxs-lookup"><span data-stu-id="60238-184">If the Publisher fails, at the secondary server, rename the computer and then rename the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance to match the primary server name.</span></span> <span data-ttu-id="60238-185">Informationen zum Umbenennen des Computers finden Sie in der Windows-Dokumentation.</span><span class="sxs-lookup"><span data-stu-id="60238-185">For information about renaming the computer, see the Windows documentation.</span></span> <span data-ttu-id="60238-186">Informationen zum Umbenennen des Servers finden Sie unter [Umbenennen eines Computers, der eine eigenständige Instanz von SQL Server hostet](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) und [Umbenennen einer SQL Server-Failoverclusterinstanz](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span><span class="sxs-lookup"><span data-stu-id="60238-186">For information about renaming the server, see [Rename a Computer that Hosts a Stand-Alone Instance of SQL Server](../install-windows/rename-a-computer-that-hosts-a-stand-alone-instance-of-sql-server.md) and [Rename a SQL Server Failover Cluster Instance](../../sql-server/failover-clusters/install/rename-a-sql-server-failover-cluster-instance.md).</span></span>  
  
3.  <span data-ttu-id="60238-187">Stellen Sie das letzte Protokoll der Datenbank mithilfe der Option KEEP_REPLICATION von RESTORE LOG auf dem Sekundärserver wieder her.</span><span class="sxs-lookup"><span data-stu-id="60238-187">Restore the last log of the database to the secondary server, using the KEEP_REPLICATION option of RESTORE LOG.</span></span> <span data-ttu-id="60238-188">Damit werden alle Replikationseinstellungen für die Datenbank beibehalten.</span><span class="sxs-lookup"><span data-stu-id="60238-188">This retains all replication settings for the database.</span></span> <span data-ttu-id="60238-189">Weitere Informationen finden Sie unter [Failover zu einer sekundären Datenbank für den Protokollversand &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) und [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="60238-189">For more information, see [Fail Over to a Log Shipping Secondary &#40;SQL Server&#41;](fail-over-to-a-log-shipping-secondary-sql-server.md) and [RESTORE &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-statements-transact-sql).</span></span>  
  
4.  <span data-ttu-id="60238-190">Stellen Sie die **msdb** -Datenbank und die **master** -Datenbanken von der Primärdatenbank zur sekundären Datenbank wieder her.</span><span class="sxs-lookup"><span data-stu-id="60238-190">Restore the **msdb** database and **master** databases from the primary to the secondary.</span></span> <span data-ttu-id="60238-191">Weitere Informationen finden Sie unter [Sichern und Wiederherstellen von Systemdatenbanken &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="60238-191">For more information, see [Back Up and Restore of System Databases &#40;SQL Server&#41;](../../relational-databases/backup-restore/back-up-and-restore-of-system-databases-sql-server.md).</span></span> <span data-ttu-id="60238-192">Wenn die primäre Datenbank auch ein Verteiler war, stellen Sie die Verteilungsdatenbank von der primären zur sekundären Datenbank wieder her.</span><span class="sxs-lookup"><span data-stu-id="60238-192">If the primary was also a Distributor, restore the distribution database from the primary to the secondary.</span></span>  
  
     <span data-ttu-id="60238-193">Diese Datenbanken müssen im Hinblick auf die Replikationskonfiguration und auf die Einstellungen mit der Veröffentlichungsdatenbank auf dem Primärserver konsistent sein.</span><span class="sxs-lookup"><span data-stu-id="60238-193">These databases must be consistent with the publication database at the primary in terms of replication configuration and settings.</span></span>  
  
5.  <span data-ttu-id="60238-194">Stellen Sie auf dem Sekundärserver den Diensthauptschlüssel wieder her, der von der primären Datenbank gesichert wurde.</span><span class="sxs-lookup"><span data-stu-id="60238-194">At the secondary server, restore the service master key that was backed up from the primary.</span></span> <span data-ttu-id="60238-195">Weitere Informationen finden Sie unter [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span><span class="sxs-lookup"><span data-stu-id="60238-195">For more information, see [RESTORE SERVICE MASTER KEY &#40;Transact-SQL&#41;](/sql/t-sql/statements/restore-service-master-key-transact-sql).</span></span>  
  
6.  <span data-ttu-id="60238-196">Synchronisieren Sie die Veröffentlichungsdatenbank mit einer oder mehreren Abonnementdatenbanken.</span><span class="sxs-lookup"><span data-stu-id="60238-196">Synchronize the publication database with one or more subscription databases.</span></span> <span data-ttu-id="60238-197">Das ermöglicht Ihnen das Hochladen jener Änderungen, die zuvor in der Veröffentlichungsdatenbank zwar vorgenommen, aber in der wiederhergestellten Sicherung nicht vorhanden sind.</span><span class="sxs-lookup"><span data-stu-id="60238-197">This allows you to upload those changes made previously in the publication database, but not represented in the restored backup.</span></span> <span data-ttu-id="60238-198">Welche Daten dabei hochgeladen werden können, hängt davon ab, wie die Veröffentlichung gefiltert wird:</span><span class="sxs-lookup"><span data-stu-id="60238-198">The data that can be uploaded depends on the way in which a publication is filtered:</span></span>  
  
    -   <span data-ttu-id="60238-199">Wird die Veröffentlichung gar nicht gefiltert, sollten Sie die Veröffentlichungsdatenbank durch Synchronisieren mit einem aktuellen Abonnenten auf den neuesten Stand bringen.</span><span class="sxs-lookup"><span data-stu-id="60238-199">If the publication is not filtered, you should be able to bring the publication database up-to-date by synchronizing with the most up-to-date Subscriber.</span></span>  
  
    -   <span data-ttu-id="60238-200">Wenn die Veröffentlichung gefiltert ist, können Sie möglicherweise die Veröffentlichungsdatenbank nicht auf den aktuellen Stand bringen.</span><span class="sxs-lookup"><span data-stu-id="60238-200">If the publication is filtered, you might not be able to bring the publication database up-to-date.</span></span> <span data-ttu-id="60238-201">Angenommen, eine Tabelle ist so partitioniert, dass jedes Abonnement nur die Kundendaten für eine der folgenden Regionen erhält: Nord, Ost, Süd und West.</span><span class="sxs-lookup"><span data-stu-id="60238-201">Consider a table that is partitioned such that each subscription receives customer data only for a single region: North, East, South, and West.</span></span> <span data-ttu-id="60238-202">Wenn für jede Datenpartition mindestens ein Abonnent vorhanden ist, würde es reichen, die Veröffentlichungsdatenbank mit einem Abonnenten für jede Partition zu synchronisieren, um sie auf den neuesten Stand zu bringen.</span><span class="sxs-lookup"><span data-stu-id="60238-202">If there is at least one Subscriber for each partition of data, synchronizing with a Subscriber for each partition should bring the publication database up-to-date.</span></span> <span data-ttu-id="60238-203">Wenn aber beispielsweise die Daten in der Partition West auf keinen Abonnenten repliziert wurden, können diese Daten auf dem Verleger nicht auf den aktuellen Stand gebracht werden.</span><span class="sxs-lookup"><span data-stu-id="60238-203">However, if data in the West partition, for example, was not replicated to any Subscribers, this data at the Publisher cannot be brought up-to-date.</span></span> <span data-ttu-id="60238-204">In diesem sollten Sie alle Abonnements initialisieren, sodass die Daten auf dem Verleger und den Abonnenten zusammengeführt werden.</span><span class="sxs-lookup"><span data-stu-id="60238-204">In this case, we recommend reinitializing all subscriptions so that the data at the Publisher and Subscribers converges.</span></span> <span data-ttu-id="60238-205">Weitere Informationen finden Sie unter [Erneutes Initialisieren von Abonnements](../../relational-databases/replication/reinitialize-subscriptions.md).</span><span class="sxs-lookup"><span data-stu-id="60238-205">For more information, see [Reinitialize Subscriptions](../../relational-databases/replication/reinitialize-subscriptions.md).</span></span>  
  
     <span data-ttu-id="60238-206">Wenn Sie die Veröffentlichungsdatenbank mit einem Abonnenten synchronisieren, auf dem eine frühere Version von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] als [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)]ausgeführt wird, kann das Abonnement nicht anonym sein – es muss sich um ein Clientabonnement oder ein Serverabonnement handeln (in früheren Versionen als lokales Abonnement bzw. globales Abonnement bezeichnet).</span><span class="sxs-lookup"><span data-stu-id="60238-206">If you synchronize with a Subscriber that is running a version of [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] prior to [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)], the subscription cannot be anonymous; it must be a client subscription or server subscription (referred to as local subscriptions and global subscriptions in previous releases).</span></span> <span data-ttu-id="60238-207">Weitere Informationen finden Sie unter [Synchronisieren von Daten](../../relational-databases/replication/synchronize-data.md).</span><span class="sxs-lookup"><span data-stu-id="60238-207">For more information, see [Synchronize Data](../../relational-databases/replication/synchronize-data.md).</span></span>   
  
## <a name="see-also"></a><span data-ttu-id="60238-208">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="60238-208">See Also</span></span>  
 <span data-ttu-id="60238-209">[SQL Server-Replikation](../../relational-databases/replication/sql-server-replication.md) </span><span class="sxs-lookup"><span data-stu-id="60238-209">[SQL Server Replication](../../relational-databases/replication/sql-server-replication.md) </span></span>  
 <span data-ttu-id="60238-210">[Informationen zum Protokollversand &#40;SQL Server&#41;](about-log-shipping-sql-server.md) </span><span class="sxs-lookup"><span data-stu-id="60238-210">[About Log Shipping &#40;SQL Server&#41;](about-log-shipping-sql-server.md) </span></span>  
 [<span data-ttu-id="60238-211">Datenbankspiegelung und Replikation &#40;SQL Server&#41;</span><span class="sxs-lookup"><span data-stu-id="60238-211">Database Mirroring and Replication &#40;SQL Server&#41;</span></span>](../database-mirroring/database-mirroring-and-replication-sql-server.md)  
  
  
