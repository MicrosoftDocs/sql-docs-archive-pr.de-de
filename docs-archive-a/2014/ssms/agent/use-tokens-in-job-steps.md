---
title: Verwenden von Token in Auftragsschritten | Microsoft-Dokumentation
ms.custom: ''
ms.date: 06/13/2017
ms.prod: sql-server-2014
ms.reviewer: ''
ms.technology: ssms
ms.topic: conceptual
helpviewer_keywords:
- job steps [SQL Server Agent]
- security [SQL Server Agent], enabling alert job step tokens
- SQL Server Agent jobs, job steps
- tokens [SQL Server]
- escape macros [SQL Server Agent]
ms.assetid: 105bbb66-0ade-4b46-b8e4-f849e5fc4d43
author: stevestein
ms.author: sstein
ms.openlocfilehash: 9d90b6660dd4b65e4e1d9b832b39ffaa275c83bc
ms.sourcegitcommit: ad4d92dce894592a259721a1571b1d8736abacdb
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 08/04/2020
ms.locfileid: "87726410"
---
# <a name="use-tokens-in-job-steps"></a><span data-ttu-id="de753-102">Verwenden von Token in Auftragsschritten</span><span class="sxs-lookup"><span data-stu-id="de753-102">Use Tokens in Job Steps</span></span>
  [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="de753-103">Agent ermöglicht die Verwendung von Token in [!INCLUDE[tsql](../../includes/tsql-md.md)] -Auftragsschrittskripts.</span><span class="sxs-lookup"><span data-stu-id="de753-103">Agent allows you to use tokens in [!INCLUDE[tsql](../../includes/tsql-md.md)] job step scripts.</span></span> <span data-ttu-id="de753-104">Durch die Verwendung von Token verfügen Sie beim Schreiben von Auftragsschritten über dieselbe Flexibilität, die die Verwendung von Variablen beim Schreiben von Softwareprogrammen bietet.</span><span class="sxs-lookup"><span data-stu-id="de753-104">Using tokens when you write your job steps gives you the same flexibility that variables provide when you write software programs.</span></span> <span data-ttu-id="de753-105">Die von Ihnen in ein Auftragsschrittskript eingefügten Token werden vom [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent zur Ausführungszeit ersetzt, bevor der Auftragsschritt vom [!INCLUDE[tsql](../../includes/tsql-md.md)] -Subsystem ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="de753-105">After you insert a token in a job step script, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces the token at run time, before the job step is executed by the [!INCLUDE[tsql](../../includes/tsql-md.md)] subsystem.</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="de753-106">Mit [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1 wurde die Syntax der Token für die Arbeitsschritte des [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agents geändert.</span><span class="sxs-lookup"><span data-stu-id="de753-106">Starting with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step token syntax changed.</span></span> <span data-ttu-id="de753-107">Damit Auftragsschritte fehlerfrei ausgeführt werden können, müssen alle in Auftragsschritten verwendete Token von einem Escapemakro begleitet werden.</span><span class="sxs-lookup"><span data-stu-id="de753-107">As a result, an escape macro must now accompany all tokens used in job steps, or else those job steps will fail.</span></span> <span data-ttu-id="de753-108">Das Verwenden von Escapemakros und das Aktualisieren von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent-Auftragsschritten, in denen Token verwendet werden, wird in den folgenden Abschnitten "Grundlegendes zum Verwenden von Token", "[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent-Token und -Makros" und "Aktualisieren von Auftragsschritten für die Verwendung von Makros" beschrieben.</span><span class="sxs-lookup"><span data-stu-id="de753-108">Using escape macros and updating your [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job steps that use tokens are described in the following sections, "Understanding Using Tokens," "[!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent Tokens and Macros," and "Updating Job Steps to Use Macros."</span></span> <span data-ttu-id="de753-109">Außerdem wurde auch die [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] -Syntax, in der zur Auszeichnung von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent-Auftragsschritten eckige Klammern verwendet wurden (z. B. "`[DATE]`") geändert.</span><span class="sxs-lookup"><span data-stu-id="de753-109">In addition, the [!INCLUDE[ssVersion2000](../../includes/ssversion2000-md.md)] syntax, which used square brackets to call out [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step tokens (for example, "`[DATE]`") has also changed.</span></span> <span data-ttu-id="de753-110">Jetzt müssen Sie Tokennamen in runde Klammern einschließen und ein Dollarzeichen (`$`) an den Anfang der Tokensyntax setzen.</span><span class="sxs-lookup"><span data-stu-id="de753-110">You must now enclose token names in parentheses and place a dollar sign (`$`) at the beginning of the token syntax.</span></span> <span data-ttu-id="de753-111">Beispiel:</span><span class="sxs-lookup"><span data-stu-id="de753-111">For example:</span></span>  
>   
>  <span data-ttu-id="de753-112">`$(ESCAPE_` *Makroname* `(DATE))`</span><span class="sxs-lookup"><span data-stu-id="de753-112">`$(ESCAPE_` *macro name* `(DATE))`</span></span>  
  
## <a name="understanding-using-tokens"></a><span data-ttu-id="de753-113">Grundlegendes zum Verwenden von Token</span><span class="sxs-lookup"><span data-stu-id="de753-113">Understanding Using Tokens</span></span>  
  
> [!IMPORTANT]  
>  <span data-ttu-id="de753-114">Jeder Windows-Benutzer mit Schreibberechtigungen für das Windows-Ereignisprotokoll kann auf Auftragsschritte zugreifen, die durch [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent-Warnungen oder WMI-Warnungen aktiviert werden.</span><span class="sxs-lookup"><span data-stu-id="de753-114">Any Windows user with write permissions on the Windows Event Log can access job steps that are activated by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent alerts or WMI alerts.</span></span> <span data-ttu-id="de753-115">Zur Vermeidung dieses Sicherheitsrisikos sind [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent-Tokens, die in von Warnungen aktivierten Aufträgen verwendet werden können, standardmäßig deaktiviert.</span><span class="sxs-lookup"><span data-stu-id="de753-115">To avoid this security risk, [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent tokens that can be used in jobs activated by alerts are disabled by default.</span></span> <span data-ttu-id="de753-116">Dabei handelt es sich um folgende Token: **a-DBN**, **a-SVR**, **a-Err**, **a-SEV**, **a-msg**. und **WMI ( *`property`* )**.</span><span class="sxs-lookup"><span data-stu-id="de753-116">These tokens are: **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**., and **WMI(*`property`*)**.</span></span> <span data-ttu-id="de753-117">Beachten Sie, dass in dieser Version die Verwendung von Token auf alle Warnungen ausgeweitet ist.</span><span class="sxs-lookup"><span data-stu-id="de753-117">Note that in this release, use of tokens is extended to all alerting.</span></span>  
>   
>  <span data-ttu-id="de753-118">Wenn Sie diese Token verwenden müssen, stellen Sie zuvor sicher, dass ausschließlich Mitglieder von vertrauenswürdigen Windows-Sicherheitsgruppen, wie der Administratorengruppe, über Schreibberechtigungen für das Ereignisprotokoll des Computers verfügen, auf dem [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="de753-118">If you need to use these tokens, first ensure that only members of trusted Windows security groups, such as the Administrators group, have write permissions on the Event Log of the computer where [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] resides.</span></span> <span data-ttu-id="de753-119">Klicken Sie dann zum Aktivieren dieser Token im Objekt-Explorer mit der rechten Maustaste auf **SQL Server-Agent** , wählen Sie **Eigenschaften**, und wählen Sie anschließend auf der Seite **Warnungssystem** die Option **Token für alle Auftragsantworten auf Warnungen ersetzen** aus.</span><span class="sxs-lookup"><span data-stu-id="de753-119">Then, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select **Replace tokens for all job responses to alerts** to enable these tokens.</span></span>  
  
 [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="de753-120">Agent-Token können einfach und effizient ersetzt werden: Der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent ersetzt das Token durch ein genaues Zeichenfolgenliteral.</span><span class="sxs-lookup"><span data-stu-id="de753-120">Agent token replacement is simple and efficient: [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent replaces an exact literal string value for the token.</span></span> <span data-ttu-id="de753-121">Die Groß- und Kleinschreibung ist bei Token grundsätzlich zu beachten.</span><span class="sxs-lookup"><span data-stu-id="de753-121">All tokens are case-sensitive.</span></span> <span data-ttu-id="de753-122">Dies muss in den Auftragsschritten berücksichtigt werden, damit die verwendeten Token richtig angegeben werden oder die Ersatzzeichenfolge in den richtigen Datentyp konvertiert wird.</span><span class="sxs-lookup"><span data-stu-id="de753-122">Your job steps must take this into account and correctly quote the tokens you use or convert the replacement string to the correct data type.</span></span>  
  
 <span data-ttu-id="de753-123">Mit der folgenden Anweisung können Sie z. B. den Namen der Datenbank in einem Auftragsschritt drucken:</span><span class="sxs-lookup"><span data-stu-id="de753-123">For example, you might use the following statement to print the name of the database in a job step:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
 <span data-ttu-id="de753-124">In diesem Beispiel wird das Makro **ESCAPE_SQUOTE** mit dem Token **A-DBN** eingefügt.</span><span class="sxs-lookup"><span data-stu-id="de753-124">In this example, the **ESCAPE_SQUOTE** macro is inserted with the **A-DBN** token.</span></span> <span data-ttu-id="de753-125">Zur Laufzeit wird das Token **A-DBN** durch den entsprechenden Datenbanknamen ersetzt.</span><span class="sxs-lookup"><span data-stu-id="de753-125">At run time, the **A-DBN** token will be replaced with the appropriate database name.</span></span> <span data-ttu-id="de753-126">Das Escapemakro umgeht alle einfachen Anführungszeichen, die möglicherweise unbeabsichtigt in der Zeichenfolge, durch die das Token ersetzt werden soll, übergeben werden.</span><span class="sxs-lookup"><span data-stu-id="de753-126">The escape macro escapes any single quotation marks that may be inadvertently passed in the token replacement string.</span></span> [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] <span data-ttu-id="de753-127">Agent ersetzt in der endgültigen Zeichenfolge jedes einfache Anführungszeichen durch zwei einfache Anführungszeichen.</span><span class="sxs-lookup"><span data-stu-id="de753-127">Agent will replace one single quotation mark with two single quotation marks in the final string.</span></span>  
  
 <span data-ttu-id="de753-128">Wenn beispielsweise als Ersatz für das Token die Zeichenfolge `AdventureWorks2012'SELECT @@VERSION --`übergeben wird, wird im [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent-Auftragsschritt der folgende Befehl ausgeführt:</span><span class="sxs-lookup"><span data-stu-id="de753-128">For example, if the string passed to replace the token is `AdventureWorks2012'SELECT @@VERSION --`, the command executed by the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent job step will be:</span></span>  
  
 `PRINT N'Current database name is AdventureWorks2012''SELECT @@VERSION --' ;`  
  
 <span data-ttu-id="de753-129">In diesem Fall wird die eingefügte Anweisung `SELECT @@VERSION`nicht ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="de753-129">In this case, the inserted statement, `SELECT @@VERSION`, does not execute.</span></span> <span data-ttu-id="de753-130">Stattdessen wird durch das überzählige einfache Anführungszeichen der Server veranlasst, die eingefügte Anweisung als Zeichenfolge zu analysieren.</span><span class="sxs-lookup"><span data-stu-id="de753-130">Instead, the extra single quotation mark causes the server to parse the inserted statement as a string.</span></span> <span data-ttu-id="de753-131">Wenn die Zeichenfolge, durch die das Token ersetzt werden soll, keine einfachen Anführungszeichen enthält, werden keine Zeichen umgangen, und der Auftragsschritt mit dem Token wird wie beabsichtigt ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="de753-131">If the token replacement string does not contain a single quotation mark, no characters are escaped and the job step containing the token executes as intended.</span></span>  
  
 <span data-ttu-id="de753-132">Verwenden Sie zum Debuggen der Tokenverwendung in Auftragsschritten Druckanweisungen, wie z. B. `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` , und speichern Sie die Auftragsschrittausgabe in einer Datei oder Tabelle.</span><span class="sxs-lookup"><span data-stu-id="de753-132">To debug token usage in your job steps, use print statements such as `PRINT N'$(ESCAPE_SQUOTE(SQLDIR))'` and save job step output to a file or table.</span></span> <span data-ttu-id="de753-133">Auf der Seite **Erweitert** des Dialogfelds **Auftragsschritt-Eigenschaften** können Sie eine Datei oder Tabelle für die Auftragsschrittausgabe angeben.</span><span class="sxs-lookup"><span data-stu-id="de753-133">Use the **Advanced** page of the **Job Step Properties** dialog box to specify a job step output file or table.</span></span>  
  
## <a name="sql-server-agent-tokens-and-macros"></a><span data-ttu-id="de753-134">SQL Server-Agent-Token und -Makros</span><span class="sxs-lookup"><span data-stu-id="de753-134">SQL Server Agent Tokens and Macros</span></span>  
 <span data-ttu-id="de753-135">In der folgenden Tabelle sind die vom [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent unterstützten Token und Makros aufgelistet und beschrieben.</span><span class="sxs-lookup"><span data-stu-id="de753-135">The following tables list and describe the tokens and macros that [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent supports.</span></span>  
  
### <a name="sql-server-agent-tokens"></a><span data-ttu-id="de753-136">SQL Server-Agent-Token</span><span class="sxs-lookup"><span data-stu-id="de753-136">SQL Server Agent Tokens</span></span>  
  
|<span data-ttu-id="de753-137">Token</span><span class="sxs-lookup"><span data-stu-id="de753-137">Token</span></span>|<span data-ttu-id="de753-138">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="de753-138">Description</span></span>|  
|-----------|-----------------|  
|<span data-ttu-id="de753-139">**(A-DBN)**</span><span class="sxs-lookup"><span data-stu-id="de753-139">**(A-DBN)**</span></span>|<span data-ttu-id="de753-140">Datenbankname.</span><span class="sxs-lookup"><span data-stu-id="de753-140">Database name.</span></span> <span data-ttu-id="de753-141">Wenn der Auftrag durch eine Warnung ausgeführt wird, ersetzt der Wert des Datenbanknamens dieses Token im Auftragsschritt automatisch.</span><span class="sxs-lookup"><span data-stu-id="de753-141">If the job is run by an alert, the database name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="de753-142">**(A-SVR)**</span><span class="sxs-lookup"><span data-stu-id="de753-142">**(A-SVR)**</span></span>|<span data-ttu-id="de753-143">Servername.</span><span class="sxs-lookup"><span data-stu-id="de753-143">Server name.</span></span> <span data-ttu-id="de753-144">Wenn der Auftrag durch eine Warnung ausgeführt wird, ersetzt der Wert des Servernamens dieses Token im Auftragsschritt automatisch.</span><span class="sxs-lookup"><span data-stu-id="de753-144">If the job is run by an alert, the server name value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="de753-145">**(A-ERR)**</span><span class="sxs-lookup"><span data-stu-id="de753-145">**(A-ERR)**</span></span>|<span data-ttu-id="de753-146">Fehlernummer.</span><span class="sxs-lookup"><span data-stu-id="de753-146">Error number.</span></span> <span data-ttu-id="de753-147">Wenn der Auftrag durch eine Warnung ausgeführt wird, ersetzt der Wert der Fehlernummer dieses Token im Auftragsschritt automatisch.</span><span class="sxs-lookup"><span data-stu-id="de753-147">If the job is run by an alert, the error number value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="de753-148">**(A-SEV)**</span><span class="sxs-lookup"><span data-stu-id="de753-148">**(A-SEV)**</span></span>|<span data-ttu-id="de753-149">Fehlerschweregrad.</span><span class="sxs-lookup"><span data-stu-id="de753-149">Error severity.</span></span> <span data-ttu-id="de753-150">Wenn der Auftrag durch eine Warnung ausgeführt wird, ersetzt der Wert des Fehlerschweregrads dieses Token im Auftragsschritt automatisch.</span><span class="sxs-lookup"><span data-stu-id="de753-150">If the job is run by an alert, the error severity value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="de753-151">**(A-MSG)**</span><span class="sxs-lookup"><span data-stu-id="de753-151">**(A-MSG)**</span></span>|<span data-ttu-id="de753-152">Meldungstext.</span><span class="sxs-lookup"><span data-stu-id="de753-152">Message text.</span></span> <span data-ttu-id="de753-153">Wenn der Auftrag durch eine Warnung ausgeführt wird, ersetzt der Wert des Meldungstexts dieses Token im Auftragsschritt automatisch.</span><span class="sxs-lookup"><span data-stu-id="de753-153">If the job is run by an alert, the message text value automatically replaces this token in the job step.</span></span>|  
|<span data-ttu-id="de753-154">**Datum**</span><span class="sxs-lookup"><span data-stu-id="de753-154">**(DATE)**</span></span>|<span data-ttu-id="de753-155">Das aktuelle Datum (im Format YYYYMMDD).</span><span class="sxs-lookup"><span data-stu-id="de753-155">Current date (in YYYYMMDD format).</span></span>|  
|<span data-ttu-id="de753-156">**Hirn**</span><span class="sxs-lookup"><span data-stu-id="de753-156">**(INST)**</span></span>|<span data-ttu-id="de753-157">Der Instanzname.</span><span class="sxs-lookup"><span data-stu-id="de753-157">Instance name.</span></span> <span data-ttu-id="de753-158">Für eine Standardinstanz erhält dieses Token den Standardinstanznamen: MSSQLSERVER.</span><span class="sxs-lookup"><span data-stu-id="de753-158">For a default instance, this token will have the default instance name: MSSQLSERVER.</span></span>|  
|<span data-ttu-id="de753-159">**JobId**</span><span class="sxs-lookup"><span data-stu-id="de753-159">**(JOBID)**</span></span>|<span data-ttu-id="de753-160">Auftrags-ID.</span><span class="sxs-lookup"><span data-stu-id="de753-160">Job ID.</span></span>|  
|<span data-ttu-id="de753-161">**(MACH)**</span><span class="sxs-lookup"><span data-stu-id="de753-161">**(MACH)**</span></span>|<span data-ttu-id="de753-162">Name des Computers</span><span class="sxs-lookup"><span data-stu-id="de753-162">Computer name.</span></span>|  
|<span data-ttu-id="de753-163">**(MSSA)**</span><span class="sxs-lookup"><span data-stu-id="de753-163">**(MSSA)**</span></span>|<span data-ttu-id="de753-164">Name des Master-SQLServerAgent-Diensts.</span><span class="sxs-lookup"><span data-stu-id="de753-164">Master SQLServerAgent service name.</span></span>|  
|<span data-ttu-id="de753-165">**(OSCMD)**</span><span class="sxs-lookup"><span data-stu-id="de753-165">**(OSCMD)**</span></span>|<span data-ttu-id="de753-166">Das Präfix des Programms, das zur Ausführung der **CmdExec** -Auftragsschritte verwendet wird.</span><span class="sxs-lookup"><span data-stu-id="de753-166">Prefix for the program used to run **CmdExec** job steps.</span></span>|  
|<span data-ttu-id="de753-167">**(SQLDIR)**</span><span class="sxs-lookup"><span data-stu-id="de753-167">**(SQLDIR)**</span></span>|<span data-ttu-id="de753-168">Verzeichnis, in dem [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] installiert ist.</span><span class="sxs-lookup"><span data-stu-id="de753-168">The directory in which [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] is installed.</span></span> <span data-ttu-id="de753-169">Der Standardwert lautet "C:\Programme\Microsoft SQL Server\MSSQL".</span><span class="sxs-lookup"><span data-stu-id="de753-169">By default, this value is C:\Program Files\Microsoft SQL Server\MSSQL.</span></span>|  
|<span data-ttu-id="de753-170">**(SQLLOGDIR)**</span><span class="sxs-lookup"><span data-stu-id="de753-170">**(SQLLOGDIR)**</span></span>|<span data-ttu-id="de753-171">Ersetzungstoken für den Pfad des SQL Server-Fehlerprotokollordners, beispielsweise $(ESCAPE_SQUOTE(SQLLOGDIR)).</span><span class="sxs-lookup"><span data-stu-id="de753-171">Replacement token for the SQL Server error log folder path - for example, $(ESCAPE_SQUOTE(SQLLOGDIR)).</span></span>|  
|<span data-ttu-id="de753-172">**(STEPCT)**</span><span class="sxs-lookup"><span data-stu-id="de753-172">**(STEPCT)**</span></span>|<span data-ttu-id="de753-173">Die Angabe, wie oft dieser Schritt ausgeführt wurde (ohne Abbrüche).</span><span class="sxs-lookup"><span data-stu-id="de753-173">A count of the number of times this step has executed (excluding retries).</span></span> <span data-ttu-id="de753-174">Mit diesem Token kann der Schrittbefehl den Abbruch einer aus mehreren Schritten bestehenden Schleife erzwingen.</span><span class="sxs-lookup"><span data-stu-id="de753-174">Can be used by the step command to force termination of a multistep loop.</span></span>|  
|<span data-ttu-id="de753-175">**(StepID)**</span><span class="sxs-lookup"><span data-stu-id="de753-175">**(STEPID)**</span></span>|<span data-ttu-id="de753-176">Schritt-ID.</span><span class="sxs-lookup"><span data-stu-id="de753-176">Step ID.</span></span>|  
|<span data-ttu-id="de753-177">**(SRVR)**</span><span class="sxs-lookup"><span data-stu-id="de753-177">**(SRVR)**</span></span>|<span data-ttu-id="de753-178">Name des Computers, auf dem [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)]ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="de753-178">Name of the computer running [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)].</span></span> <span data-ttu-id="de753-179">Wenn es sich bei der [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Instanz um eine benannte Instanz handelt, ist auch der Name der Instanz angegeben.</span><span class="sxs-lookup"><span data-stu-id="de753-179">If the [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] instance is a named instance, this includes the instance name.</span></span>|  
|<span data-ttu-id="de753-180">**Zeit**</span><span class="sxs-lookup"><span data-stu-id="de753-180">**(TIME)**</span></span>|<span data-ttu-id="de753-181">Die aktuelle Zeit (im Format HHMMSS).</span><span class="sxs-lookup"><span data-stu-id="de753-181">Current time (in HHMMSS format).</span></span>|  
|<span data-ttu-id="de753-182">**(STRTTM)**</span><span class="sxs-lookup"><span data-stu-id="de753-182">**(STRTTM)**</span></span>|<span data-ttu-id="de753-183">Uhrzeit (im Format HHMMSS), zu der die Ausführung des Auftrags begonnen hat.</span><span class="sxs-lookup"><span data-stu-id="de753-183">The time (in HHMMSS format) that the job began executing.</span></span>|  
|<span data-ttu-id="de753-184">**(STRTDT)**</span><span class="sxs-lookup"><span data-stu-id="de753-184">**(STRTDT)**</span></span>|<span data-ttu-id="de753-185">Datum (im Format YYYYMMDD), an dem die Ausführung des Auftrags begonnen hat.</span><span class="sxs-lookup"><span data-stu-id="de753-185">The date (in YYYYMMDD format) that the job began executing.</span></span>|  
|<span data-ttu-id="de753-186">**(WMI(** *Eigenschaft* **))**</span><span class="sxs-lookup"><span data-stu-id="de753-186">**(WMI(** *property* **))**</span></span>|<span data-ttu-id="de753-187">Bei Aufträgen, die als Antwort auf WMI-Warnungen ausgeführt werden, ist dies der Wert der durch *property*angegebenen Eigenschaft.</span><span class="sxs-lookup"><span data-stu-id="de753-187">For jobs that run in response to WMI alerts, the value of the property specified by *property*.</span></span> <span data-ttu-id="de753-188">In `$(WMI(DatabaseName))` ist beispielsweise der Wert der **DatabaseName** -Eigenschaft für das WMI-Ereignis angegeben, das die Ausführung der Warnung verursacht hat.</span><span class="sxs-lookup"><span data-stu-id="de753-188">For example, `$(WMI(DatabaseName))` provides the value of the **DatabaseName** property for the WMI event that caused the alert to run.</span></span>|  
  
### <a name="sql-server-agent-escape-macros"></a><span data-ttu-id="de753-189">SQL Server-Agent-Escapemakros</span><span class="sxs-lookup"><span data-stu-id="de753-189">SQL Server Agent Escape Macros</span></span>  
  
|<span data-ttu-id="de753-190">Escapemakros</span><span class="sxs-lookup"><span data-stu-id="de753-190">Escape Macros</span></span>|<span data-ttu-id="de753-191">BESCHREIBUNG</span><span class="sxs-lookup"><span data-stu-id="de753-191">Description</span></span>|  
|-------------------|-----------------|  
|<span data-ttu-id="de753-192">**$(ESCAPE_SQUOTE(** *Tokenname* **))**</span><span class="sxs-lookup"><span data-stu-id="de753-192">**$(ESCAPE_SQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="de753-193">Umgeht einfache Anführungszeichen (') in der Token-Ersetzungszeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="de753-193">Escapes single quotation marks (') in the token replacement string.</span></span> <span data-ttu-id="de753-194">Ein einfaches Anführungszeichen wird durch zwei einfache Anführungszeichen ersetzt.</span><span class="sxs-lookup"><span data-stu-id="de753-194">Replaces one single quotation mark with two single quotation marks.</span></span>|  
|<span data-ttu-id="de753-195">**$(ESCAPE_DQUOTE(** *Tokenname* **))**</span><span class="sxs-lookup"><span data-stu-id="de753-195">**$(ESCAPE_DQUOTE(** *token_name* **))**</span></span>|<span data-ttu-id="de753-196">Umgeht doppelte Anführungszeichen (") in der Token-Ersetzungszeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="de753-196">Escapes double quotation marks (") in the token replacement string.</span></span> <span data-ttu-id="de753-197">Ein doppeltes Anführungszeichen wird durch zwei doppelte Anführungszeichen ersetzt.</span><span class="sxs-lookup"><span data-stu-id="de753-197">Replaces one double quotation mark with two double quotation marks.</span></span>|  
|<span data-ttu-id="de753-198">**$(ESCAPE_RBRACKET(** *Tokenname* **))**</span><span class="sxs-lookup"><span data-stu-id="de753-198">**$(ESCAPE_RBRACKET(** *token_name* **))**</span></span>|<span data-ttu-id="de753-199">Umgeht rechte eckige Klammern (]) in der Token-Ersetzungszeichenfolge.</span><span class="sxs-lookup"><span data-stu-id="de753-199">Escapes right brackets (]) in the token replacement string.</span></span> <span data-ttu-id="de753-200">Ersetzt jede rechte eckige Klammer durch zwei rechte eckige Klammern.</span><span class="sxs-lookup"><span data-stu-id="de753-200">Replaces one right bracket with two right brackets.</span></span>|  
|<span data-ttu-id="de753-201">**$(ESCAPE_NONE(** *Tokenname* **))**</span><span class="sxs-lookup"><span data-stu-id="de753-201">**$(ESCAPE_NONE(** *token_name* **))**</span></span>|<span data-ttu-id="de753-202">Ersetzt Token, ohne irgendein Zeichen in der Zeichenfolge zu umgehen.</span><span class="sxs-lookup"><span data-stu-id="de753-202">Replaces token without escaping any characters in the string.</span></span> <span data-ttu-id="de753-203">Dieses Makro wird zur Unterstützung der Abwärtskompatibilität in Umgebungen bereitgestellt, in denen Token-Ersetzungszeichenfolgen nur von vertrauenswürdigen Benutzern erwartet werden.</span><span class="sxs-lookup"><span data-stu-id="de753-203">This macro is provided to support backward compatibility in environments where token replacement strings are only expected from trusted users.</span></span> <span data-ttu-id="de753-204">Weitere Informationen finden Sie weiter unten im Abschnitt zum Aktualisieren von Auftragsschritten für die Verwendung von Makros.</span><span class="sxs-lookup"><span data-stu-id="de753-204">For more information, see "Updating Job Steps to Use Macros," later in this topic.</span></span>|  
  
## <a name="updating-job-steps-to-use-macros"></a><span data-ttu-id="de753-205">Aktualisieren von Auftragsschritten für die Verwendung von Makros</span><span class="sxs-lookup"><span data-stu-id="de753-205">Updating Job Steps to Use Macros</span></span>  
 <span data-ttu-id="de753-206">Seit [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1 können Auftragsschritte, die Token ohne Escapemakros enthalten, nicht ausgeführt werden. In diesen Fällen wird eine Fehlermeldung zurückgegeben, die darauf hinweist, dass der Auftragsschritt ein oder mehrere Token enthält, die mit einem Makro versehen werden müssen, bevor der Auftrag ausgeführt werden kann.</span><span class="sxs-lookup"><span data-stu-id="de753-206">Beginning with [!INCLUDE[ssVersion2005](../../includes/ssversion2005-md.md)] Service Pack 1, job steps that contain tokens without escape macros will fail and return an error message indicating the job step contains one or more tokens that must be updated with a macro before the job can run.</span></span>  
  
 <span data-ttu-id="de753-207">Im [!INCLUDE[msCoName](../../includes/msconame-md.md)] Knowledge Base-Artikel 915845 zu [SQL Server-Agent-Auftragsschritten mit Token, die in SQL Server 2005 Service Pack 1 nicht ausgeführt werden können](https://support.microsoft.com/kb/915845), ist ein Skript enthalten, mit dem Sie alle Ihre Auftragsschritte, in denen Token verwendet werden, mit dem Makro **ESCAPE_NONE** aktualisieren können.</span><span class="sxs-lookup"><span data-stu-id="de753-207">A script is provided with [!INCLUDE[msCoName](../../includes/msconame-md.md)] Knowledge Base article 915845: [SQL Server Agent Job Steps That Use Tokens Fail in SQL Server 2005 Service Pack 1](https://support.microsoft.com/kb/915845).You can use this script to update all of your job steps that use tokens with the **ESCAPE_NONE** macro.</span></span> <span data-ttu-id="de753-208">Nach dem Verwenden dieses Skripts sollten Sie so bald wie möglich die Auftragsschritte, in denen Token verwendet werden, überprüfen und das **ESCAPE_NONE** -Makro durch ein für den Kontext des Auftragsschritts geeignetes Escapemakro ersetzen.</span><span class="sxs-lookup"><span data-stu-id="de753-208">After using this script, we recommend that you review your job steps that use tokens as soon as possible, and replace the **ESCAPE_NONE** macro with an escape macro that is appropriate for the job step context.</span></span>  
  
 <span data-ttu-id="de753-209">Die folgende Tabelle beschreibt, wie die symbolische Ersetzung von [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] -Agent behandelt wird.</span><span class="sxs-lookup"><span data-stu-id="de753-209">The following table describes how token replacement is handled by [!INCLUDE[ssNoVersion](../../includes/ssnoversion-md.md)] Agent.</span></span> <span data-ttu-id="de753-210">Um die Tokenersetzung durch Warnungen ein- oder auszuschalten, klicken Sie im Objekt-Explorer mit der rechten Maustaste auf **SQL Server-Agent** , wählen Sie **Eigenschaften**, und aktivieren bzw. deaktivieren Sie anschließend auf der Seite **Warnungssystem** das Kontrollkästchen **Token für alle Auftragsantworten auf Warnungen ersetzen** .</span><span class="sxs-lookup"><span data-stu-id="de753-210">To turn alert token replacement on or off, right-click **SQL Server Agent** in Object Explorer, select **Properties**, and on the **Alert System** page, select or clear the **Replace tokens for all job responses to alerts** check box.</span></span>  
  
|<span data-ttu-id="de753-211">Tokensyntax</span><span class="sxs-lookup"><span data-stu-id="de753-211">Token syntax</span></span>|<span data-ttu-id="de753-212">Tokenersetzung durch Warnungen aktiviert</span><span class="sxs-lookup"><span data-stu-id="de753-212">Alert token replacement on</span></span>|<span data-ttu-id="de753-213">Tokenersetzung durch Warnungen deaktiviert</span><span class="sxs-lookup"><span data-stu-id="de753-213">Alert token replacement off</span></span>|  
|------------------|--------------------------------|---------------------------------|  
|<span data-ttu-id="de753-214">ESCAPE-Makro verwendet</span><span class="sxs-lookup"><span data-stu-id="de753-214">ESCAPE macro used</span></span>|<span data-ttu-id="de753-215">Alle Token in Auftragsschritten werden erfolgreich ersetzt.</span><span class="sxs-lookup"><span data-stu-id="de753-215">All tokens in jobs are successfully replaced.</span></span>|<span data-ttu-id="de753-216">Durch Warnungen aktivierte Token werden nicht ersetzt.</span><span class="sxs-lookup"><span data-stu-id="de753-216">Tokens activated by alerts are not replaced.</span></span> <span data-ttu-id="de753-217">Diese Token sind **a-DBN**, **a-SVR**, **a-Err**, **a-SEV**, **a-msg**und **WMI ( *`property`* )**.</span><span class="sxs-lookup"><span data-stu-id="de753-217">These tokens are **A-DBN**, **A-SVR**, **A-ERR**, **A-SEV**, **A-MSG**, and **WMI(*`property`*)**.</span></span> <span data-ttu-id="de753-218">Andere, statische Token werden erfolgreich ersetzt.</span><span class="sxs-lookup"><span data-stu-id="de753-218">Other static tokens are replaced successfully.</span></span>|  
|<span data-ttu-id="de753-219">Kein ESCAPE-Makro verwendet</span><span class="sxs-lookup"><span data-stu-id="de753-219">No ESCAPE macro used</span></span>|<span data-ttu-id="de753-220">Alle Auftragsschritte mit Token werden nicht ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="de753-220">Any jobs containing tokens fail.</span></span>|<span data-ttu-id="de753-221">Alle Auftragsschritte mit Token werden nicht ausgeführt.</span><span class="sxs-lookup"><span data-stu-id="de753-221">Any jobs containing tokens fail.</span></span>|  
  
## <a name="token-syntax-update-examples"></a><span data-ttu-id="de753-222">Beispiele für Updates der Tokensyntax</span><span class="sxs-lookup"><span data-stu-id="de753-222">Token Syntax Update Examples</span></span>  
  
### <a name="a-using-tokens-in-non-nested-strings"></a><span data-ttu-id="de753-223">A.</span><span class="sxs-lookup"><span data-stu-id="de753-223">A.</span></span> <span data-ttu-id="de753-224">Verwenden von Token in nicht geschachtelten Zeichenfolgen</span><span class="sxs-lookup"><span data-stu-id="de753-224">Using tokens in non-nested strings</span></span>  
 <span data-ttu-id="de753-225">Im folgenden Beispiel wird gezeigt, wie Sie ein einfaches, nicht geschachteltes Skript mit dem entsprechenden Escapemakro aktualisieren.</span><span class="sxs-lookup"><span data-stu-id="de753-225">The following example shows how to update a simple non-nested script with the appropriate escape macro.</span></span> <span data-ttu-id="de753-226">Vor dem Ausführen des Updateskripts verwendet das folgende Auftragsschrittskript ein Auftragsschritttoken, um den entsprechenden Datenbanknamen zu drucken:</span><span class="sxs-lookup"><span data-stu-id="de753-226">Before running the update script, the following job step script uses a job step token to print the appropriate database name:</span></span>  
  
 `PRINT N'Current database name is $(A-DBN)' ;`  
  
 <span data-ttu-id="de753-227">Nach dem Ausführen des Updateskripts wird vor dem `ESCAPE_NONE` -Token ein `A-DBN` -Makro eingefügt.</span><span class="sxs-lookup"><span data-stu-id="de753-227">After running the update script, an `ESCAPE_NONE` macro is inserted before the `A-DBN` token.</span></span> <span data-ttu-id="de753-228">Da die Druckzeichenfolge durch einfache Anführungszeichen begrenzt wird, müssen Sie den Auftragsschritt aktualisieren, indem Sie das `ESCAPE_SQUOTE` -Makro folgendermaßen einfügen:</span><span class="sxs-lookup"><span data-stu-id="de753-228">Because single quotation marks are used to delimit the print string, you must update the job step by inserting the `ESCAPE_SQUOTE` macro as follows:</span></span>  
  
 `PRINT N'Current database name is $(ESCAPE_SQUOTE(A-DBN))' ;`  
  
### <a name="b-using-tokens-in-nested-strings"></a><span data-ttu-id="de753-229">B.</span><span class="sxs-lookup"><span data-stu-id="de753-229">B.</span></span> <span data-ttu-id="de753-230">Verwenden von Token in geschachtelten Zeichenfolgen</span><span class="sxs-lookup"><span data-stu-id="de753-230">Using tokens in nested strings</span></span>  
 <span data-ttu-id="de753-231">In Auftragsschritten, in denen Token in geschachtelten Zeichenfolgen oder Anweisungen verwendet werden, sollten die geschachtelten Anweisungen als Einzelanweisungen neu geschrieben werden, bevor die entsprechenden Escapemakros eingefügt werden.</span><span class="sxs-lookup"><span data-stu-id="de753-231">In job step scripts where tokens are used in nested strings or statements, the nested statements should be rewritten as multiple statements before inserting the appropriate escape macros.</span></span>  
  
 <span data-ttu-id="de753-232">Betrachten Sie z. B. den folgenden Auftragsschritt, der das Token `A-MSG` verwendet und nicht mit einem Escapemakro aktualisiert wurde:</span><span class="sxs-lookup"><span data-stu-id="de753-232">For example, consider the following job step, which uses the `A-MSG` token and has not been updated with an escape macro:</span></span>  
  
 `PRINT N'Print ''$(A-MSG)''' ;`  
  
 <span data-ttu-id="de753-233">Nach dem Ausführen des Updateskripts wird mit dem Token ein `ESCAPE_NONE` -Makro eingefügt.</span><span class="sxs-lookup"><span data-stu-id="de753-233">After running the update script, an `ESCAPE_NONE` macro is inserted with the token.</span></span> <span data-ttu-id="de753-234">In diesem Fall müssten Sie das Skript jedoch ohne Verwenden von Schachtelungen folgendermaßen neu schreiben und das `ESCAPE_SQUOTE` -Makro einfügen, damit die in der Token-Ersetzungszeichenfolge möglicherweise übergebenen Begrenzungszeichen richtig umgangen werden:</span><span class="sxs-lookup"><span data-stu-id="de753-234">However, in this case, you would have to rewrite the script without using nesting as follows and insert the `ESCAPE_SQUOTE` macro to properly escape delimiters that may be passed in the token replacement string:</span></span>  
  
 `DECLARE @msgString nvarchar(max)`  
  
 `SET @msgString = '$(ESCAPE_SQUOTE(A-MSG))'`  
  
 `SET @msgString = QUOTENAME(@msgString,'''')`  
  
 `PRINT N'Print ' + @msgString ;`  
  
 <span data-ttu-id="de753-235">Beachten Sie auch, dass in diesem Beispiel mit der Funktion QUOTENAME das Anführungszeichen festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="de753-235">Note also in this example that the QUOTENAME function sets the quote character.</span></span>  
  
### <a name="c-using-tokens-with-the-escape_none-macro"></a><span data-ttu-id="de753-236">C.</span><span class="sxs-lookup"><span data-stu-id="de753-236">C.</span></span> <span data-ttu-id="de753-237">Verwenden von Token mit dem ESCAPE_NONE-Makro</span><span class="sxs-lookup"><span data-stu-id="de753-237">Using tokens with the ESCAPE_NONE macro</span></span>  
 <span data-ttu-id="de753-238">Das folgende Beispiel ist Teil eines Skripts, mit dem die Auftrags-ID ( `job_id` ) aus der `sysjobs` -Tabelle abgerufen wird und mithilfe des `JOBID` -Tokens die zuvor im Skript als binärer Datentyp deklarierte `@JobID` -Variable aufgefüllt wird.</span><span class="sxs-lookup"><span data-stu-id="de753-238">The following example is part of a script that retrieves the `job_id` from the `sysjobs` table and uses the `JOBID` token to populate the `@JobID` variable, which was declared earlier in the script as a binary data type.</span></span> <span data-ttu-id="de753-239">Beachten Sie, dass mit dem `ESCAPE_NONE` -Token das `JOBID` -Makro verwendet wird, da für binäre Datentypen keine Begrenzungszeichen erforderlich sind.</span><span class="sxs-lookup"><span data-stu-id="de753-239">Note that because no delimiters are required for binary data types, the `ESCAPE_NONE` macro is used with the `JOBID` token.</span></span> <span data-ttu-id="de753-240">In diesem Fall muss der Auftragsschritt nach Ausführen des Updateskripts nicht aktualisiert werden.</span><span class="sxs-lookup"><span data-stu-id="de753-240">You would not need to update this job step after running the update script.</span></span>  
  
 `SELECT * FROM msdb.dbo.sysjobs`  
  
 `WHERE @JobID = CONVERT(uniqueidentifier, $(ESCAPE_NONE(JOBID))) ;`  
  
## <a name="see-also"></a><span data-ttu-id="de753-241">Weitere Informationen</span><span class="sxs-lookup"><span data-stu-id="de753-241">See Also</span></span>  
 <span data-ttu-id="de753-242">[Implementieren von Aufträgen](implement-jobs.md) </span><span class="sxs-lookup"><span data-stu-id="de753-242">[Implement Jobs](implement-jobs.md) </span></span>  
 [<span data-ttu-id="de753-243">Verwalten von Auftragsschritten</span><span class="sxs-lookup"><span data-stu-id="de753-243">Manage Job Steps</span></span>](manage-job-steps.md)  
  
  
